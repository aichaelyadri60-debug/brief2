"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f80c68a4-8ab2-584a-aedf-d59f52b1a0cc")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[4288],{974528:(e,t,n)=>{n.d(t,{DL:()=>l,DX:()=>r,JM:()=>s,Zg:()=>o,lE:()=>i});let r="editable_typeahead--wrapperBase--rwdvD",l="editable_typeahead--wrapperDefault--G1MoY",i="editable_typeahead--mention--yPPjQ",s="editable_typeahead--hyperlink--JH0Ig",o="editable_typeahead--emoji--vp6nb"},790724:(e,t,n)=>{n.r(t),n.d(t,{CommentsSubmitButton:()=>ec,ThreadCommentComposer:()=>ef});var r=n(104076),l=n(716976),i=n(903927),s=n(951002),o=n(420680),a=n(293422),u=n(326763),c=n(50686);let d=(0,l.memo)(function(e){return(0,r.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,r.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",fillRule:"evenodd",d:"M12 6a6 6 0 1 0 0 12 .5.5 0 0 1 0 1 7 7 0 1 1 7-7v.5a2.5 2.5 0 0 1-4.62 1.326A3 3 0 1 1 14 9.764V9.5a.5.5 0 0 1 1 0v3a1.5 1.5 0 0 0 3 0V12a6 6 0 0 0-6-6m2 6a2 2 0 1 0-4 0 2 2 0 0 0 4 0",clipRule:"evenodd"})})});var f=n(945437),g=n(812714),h=n(795033),p=n(511570),m=n.n(p),y=n(873304),_=n(883765),x=n(686549),E=n(466890),b=n(653899),k=n(140490),T=n(681398),C=n(999521),A=n(641518),I=n(361170),v=n(876621),S=n(157869),O=n(192075),M=n(58212),D=n(814082),L=n(443192),N=n(459494),K=n(819851),F=n(551037),w=n(249586),R=n(876862),j=n(229150),P=n(76404),B=n(610973),U=n(211862),J=n(592726),W=n(174730),H=n(944350),$=n(338891),X=n(821359),q=n(298056),G=n(894210),z=n(366535),Q=n(434155),Y=n(261524),V=n(789837),Z=n(907469);function ee(e){let t=(0,i.wA)(),{attachments:n}=e,l=e=>{t((0,z.to)({type:Y.q,data:{attachments:n,selectedIdx:n.map(e=>e.thumbnailUrl).indexOf(e),onUpdateAltText:s,canEdit:!0}}))},s=(t,r)=>{let l=n[r];return e.fileKey?Q.l.put(e.fileKey,l.id,t).then(n=>(200===n.status&&e.onUpdate({...l,altText:t}),n)):Promise.resolve(void 0)};return(0,r.jsx)("div",{className:Z.kG,onClick:e.focusComposer,children:n.map(t=>(0,r.jsx)(V.v,{thumbnailUrl:t.thumbnailUrl,altText:(0,O.t)("comments.attachment_thumbnail_alt_text_default"),onClick:l,isUploading:t.isUploading,onDelete:()=>e.onDelete(t)},t.id))})}var et=n(696781),en=n(753703),er=n(624180),el=n(849894),ei=n(571861),es=n(607341),eo=n(788965),ea=n(156071);let eu=[];function ec(e){let t=(0,O.t)("comments.submit");return(0,r.jsx)(o.K,{recordingKey:A.Pt(e,"submit"),disabled:e.disabled,onClick:e.onClick,"data-tooltip-type":G.Ib.TEXT,"data-tooltip":t,"aria-label":t,htmlAttributes:{"data-testid":"comments-submit-button"},variant:"primaryCircle",children:(0,r.jsx)(u.G,{})})}let ed=e=>{switch(e.type){case q.Wn.MAX_UPLOADS_EXCEEDED:return(0,O.t)("comments.upload_error.media_file_maximum",e.params);case q.Wn.MAX_IMAGE_SIZE_EXCEEDED:case q.Wn.MAX_VIDEO_SIZE_EXCEEDED:return(0,O.t)("comments.upload_error.media_file_size_limit_MB",e.params);case q.Wn.INVALID_FILE_TYPE:return(0,O.t)("comments.upload_error.media_file_types");case q.Wn.DUPLICATE_FILE_UPLOAD:return(0,O.t)("comments.upload_error.already_uploaded_items",e.params);case q.Wn.FAILED_TO_UPLOAD:return(0,O.t)("comments.upload_error.failed_to_upload",e.params);default:(0,s.xb)(e)}};function ef(e){return(0,r.jsx)(k.u,{label:"ThreadCommentComposer",children:(0,r.jsx)(eg,{...e})})}function eg(e){let[t,n]=l.useState(e.mountInputFocused||e.mountWithButtons||!1),[s,u]=l.useState(!1),p=l.useRef(null),k=l.useRef(null),z=(0,J.iZ)(),Q=(0,W.f)("has_opened_comments_modal"),{threadPosition:Y,dispatch:V,viewportPositionFromClientPosition:Z,setHyperlinkLocation:ef,setHyperlinkEditorRef:eg,editorRef:eh,scrollToBottom:ep}=e,em=(0,U.q5)(),ey=em?.key||null,e_=(0,i.d4)(e=>e.currentUserOrgId),ex=em?.teamId,eE=(0,i.d4)(e=>e.orgUsersByOrgId),eb=(0,eo.i)(),ek=(0,i.d4)(e=>e.comments.editingComment),eT=!!(0,W.f)("has_mentioned_pending_user_invite"),eC=!!(0,W.f)("has_mentioned_pending_user_invite_twice"),eA=(0,h.Xr)(B.H),[eI,ev]=l.useState(!1),eS=(0,K.lg)(),eO=(0,K.HW)(),eM=(0,i.d4)(e=>e.comments.activeDragTarget),eD=(0,N.y)(),eL=(0,h.md)(B.H),eN=(0,j.eR)(e.threadId)&&eD({isDraftFile:!ex,isMobile:T.Ay.isMobileBrowser,showExpAtMentionInvite:!!(0,g.kc)().show_at_mention_invited_users,isFigmaDesign:eS===H._Y.DESIGN,inOrg:!!e_})&&eL||[],eK=l.useCallback(e=>{if(ef&&eg){if(e?.top===0&&e?.bottom===0&&e?.left===0&&e?.right===0&&e?.height===0&&e?.width===0&&k.current){let e=(0,x.E)(k.current.getBoundingClientRect());ef({...e,width:32,top:e.top+12})}else ef(e);eg(eh)}},[ef,eg,eh]),eF=(0,i.Pj)();l.useEffect(()=>{let t=!(0,j.eR)(e.threadId);(0,w.uE)("Comment composer opened",eF.getState(),{isThread:t}),Q||eF.dispatch(L.b({has_opened_comments_modal:!0}))},[eF,e.threadId,Q]);let ew=(0,i.d4)(e=>e.comments.emojiPicker),eR=l.useCallback(()=>ew?.visible?(ew.onCancel?.(),V(D.RI({visible:!1})),!0):(e.editorRef.current&&e.editorRef.current.handleEscape(),!1),[e.editorRef,ew,V]),ej=l.useCallback(()=>{e.editorRef.current&&e.editorRef.current.onFocus()},[e.editorRef]),eP=()=>{e9()||e.onSubmit()},eB=e=>{e.preventDefault(),eP()},eU=()=>{!1!==e.onCancel()&&n(!1)},eJ=l.useCallback(e=>{ep&&(e?setTimeout(ep,e):ep())},[ep]);(0,b.h)(()=>{e.scrollToBottom&&k.current&&new MutationObserver(e.scrollToBottom).observe(k.current,{childList:!0,subtree:!0})});let eW=A.qP(e.recordingKey,"update",([t,n])=>{n&&!e8(e.messageMeta)&&eJ(100),e.updateMessage(t)}),eH=A.qP(e.recordingKey,"emojiPick",t=>{if(e.editorRef&&e.editorRef.current){let n=y.dN.get(t.id);n&&e.editorRef.current.insertEmoji(n),e.dispatch(D.RI({visible:!1}))}}),e$=async()=>{e.dispatch(D.We(await (0,X.fG)("",e.mentionables,eS===H._Y.DESIGN))),(0,_.sx)("Comment Composer At Mention Clicked",{userId:e.user.id,fileKey:e.fileKey,parentCommentId:e.threadId}),u(!0),setTimeout(()=>{u(!1)},250),e.editorRef.current?.focus(!1)},eX=e.allowAttachments,{updateAttachment:eq,deleteAttachment:eG}=e,ez=e.attachments?.sort((e,t)=>e.uploadedAt.getTime()-t.uploadedAt.getTime())??eu,[eQ,eY]=l.useState(ez.length),[eV,eZ]=l.useState({}),e0=ez.some(e=>e.isUploading),e1=l.useRef(null),e2=l.useCallback(e=>{eY(e=>e-1),eV.hasOwnProperty(e.id)?eG&&eG(e.id,eV[e.id]):eG&&eG(e.id)},[eG,eV]),e6=l.useCallback((e,t)=>{if(e instanceof C.qW){(0,el.MZ)(V,(0,O.t)("check_network_compatibility.error_bell.comment_attachments.message"));return}V(M.F.enqueue({message:ed(e)})),t&&e2(t)},[V,e2]),e5=l.useCallback(t=>{if(!eX||!eq||0===t.length)return;let n=(0,$.K)(t,eQ,R.xS,q.xp,e6);eY(e=>e+n.length),n.forEach((t,n)=>{if(q.xp.includes(t.type)){let r=URL.createObjectURL(t),l=new Date;l.setMilliseconds(l.getMilliseconds()+n),(0,R.JZ)(e.recordingKey,eq,eZ,e6,r,t.type,ey,l,t.name||null)}else throw Error("unexpected file type")})},[eX,eq,eQ,e6,e.recordingKey,ey]),e3=l.useCallback(e=>()=>{let t=e.current?.files||null;if(null===t||0===t.length)return;let n=Array.from(t);(0,_.sx)("Comment Attachments Selected",{count:n.length,fileTypes:Array.from(n.reduce((e,t)=>(e.add(t.type),e),new Set))}),e5(n),e.current&&(e.current.value="")},[e5]),e7=(0,F.k)(),e9=()=>e.isDisabled||e0||e8(e.messageMeta)||(0,E.q)(e.messageMeta)||e7,e8=e=>(0,E.I)(e),e4=e9(),te=e8(e.messageMeta)&&(!eX||0===ez.length),tt=(0,h.md)(er.p),tn=eX&&eM===e.recordingKey&&!(0,j.eR)(e.threadId),tr=(0,g.kc)().comments_lexical?es.k:ei.iX;return(0,r.jsxs)(v.Y,{className:m()(e.containerClassName||{[ea.fP]:!0,[ea.U0]:(0,j.eR)(e.threadId),[ea.mr]:tn},te&&ea.Sg),isDragTarget:()=>eX,onTargetDrop:e=>{if(e.files.length>0){let t=Array.from(e.files);(0,_.sx)("Comment Attachments Dropped",{count:t.length,fileTypes:Array.from(t.reduce((e,t)=>(e.add(t.type),e),new Set))}),e5(t)}V(D.uz(null))},onTargetDragEnter:t=>{V(D.uz(e.recordingKey))},onTargetDragLeave:e=>{V(D.uz(null))},forwardedRef:k,"data-testid":e.editingExistingComment?"edit-comment-composer-container":"new-comment-composer-container",children:[(0,r.jsx)(P.$W,{handleEscape:eR,priority:P.KD.EDITING_TEXT_FIELD,children:(0,r.jsx)(tr,{ref:e.editorRef,activeMentionsId:tt,ariaLabel:e.ariaLabel,className:e.editableTypeaheadClassName||ea.OX,currentOrgId:e_,currentOrgUsers:eE,delegateEscapeHandling:!0,dispatch:e.dispatch,editingComment:ek??void 0,editorOnClear:e.editorOnClear,editorOnInsert:e.editorOnInsert,editorRef:e.editorRef,editorType:e.editorType,figmaEditorType:eS,hasMentionedPendingUserInvite:eT,hasMentionedPendingUserInviteTwice:eC,hyperlinkLocation:e.hyperlinkLocation,initMention:s,isProtoView:eO,isThreadCommentOverflowMenuOpen:eb,maintainSelectionOnFocus:e.maintainSelectionOnFocus,maxCommentLength:e.maxCommentLength,mentionables:e.mentionables,messageMeta:e.messageMeta,mountInputFocused:e.mountInputFocused,onCancel:eU,onFilePaste:e=>{if(e.length>0){let t=e.map(e=>new File([e],"",{type:e.type}));(0,_.sx)("Comment Attachments Pasted",{count:t.length,fileTypes:Array.from(t.reduce((e,t)=>(e.add(t.type),e),new Set))}),e5(t)}},onFocus:()=>{e.onComposeFocus&&e.onComposeFocus(),!t&&(n(!0),e.onEditStart&&e.onEditStart())},onSubmit:eP,onUpdateTextArea:e=>{if(!Y||!k.current)return;let t=k.current.getBoundingClientRect(),n=Z(new I.Mi(t.right,t.top)),r=Z(new I.Mi(t.left,t.bottom));V(D.i4({top:n.y-Y.y,right:n.x-Y.x,bottom:r.y-Y.y,left:r.x-Y.x,height:t.height,width:t.width})),eT&&eC||!eN||!(eN.length>0)||eI||e?.getCurrentContent().getPlainText()!==`${eN[0].user?.email} `||(V(D.We((0,en.tI)({index:-1,userId:z?.id}))),ev(!0))},openFileKey:ey,openFileTeamId:ex,pendingUserInvites:eN,placeholderText:e.placeholderText,readOnly:e.readOnly,setHyperlinkEditorRef:eg,setHyperlinkLocation:eK,setIsEditorFocused:e.setIsEditorFocused,setPendingUserInvitesAtom:eA,submitOnEnter:e.submitOnEnter??!0,typeahead:e.typeahead,updateMessage:eW,user:z})}),eX&&eq&&ez.length>0&&(0,r.jsx)(ee,{attachments:ez,fileKey:ey,onDelete:e2,onUpdate:eq,focusComposer:ej}),(0,r.jsxs)("div",{className:ea.o1,children:[!te&&(0,r.jsxs)("div",{className:ea.xu,children:[et.Y&&(0,r.jsx)(o.K,{onClick:t=>{(0,_.sx)("Emoji Picker Opened");let n=p.current?.getBoundingClientRect();n&&e.dispatch(D.RI({visible:!0,targetRect:n,onPick:t=>{eH(t),e.editorRef.current?.focus()},onCancel:()=>{e.editorRef.current?.focus(),e.dispatch(D.RI({visible:!1}))}}))},ref:p,"data-tooltip-type":G.Ib.TEXT,"data-tooltip":(0,O.t)("comments.add_emoji"),"aria-label":(0,O.t)("comments.add_emoji"),htmlAttributes:{"data-testid":"emoji-picker-button"},recordingKey:"emojiPicker",disabled:te,children:(0,r.jsx)(c.A,{})}),(0,r.jsx)(o.K,{onClick:e$,"data-tooltip-type":G.Ib.TEXT,"data-tooltip":(0,O.t)("comments.add_mention"),"aria-label":(0,O.t)("comments.add_mention"),disabled:te,recordingKey:"mentionButton",children:(0,r.jsx)(d,{})}),eX&&(0,r.jsx)(S.n,{svgAltText:(0,O.t)("comments.upload_images"),isDisabled:ez.length>=R.xS,acceptedFileTypes:q.xp.join(","),inputRef:e1,inputId:`fileUploadIconInput-${e.recordingKey}`,onFileInputChange:e3,"data-tooltip-type":G.Ib.TEXT,"data-tooltip":(0,O.t)("comments.upload_images"),children:(0,r.jsx)("span",{"aria-hidden":!0,children:(0,r.jsx)(f.T,{})})})]}),!e.hideSubmitButton&&(e.editingExistingComment?(0,r.jsxs)("div",{className:ea.q9,children:[(0,r.jsx)(a.$n,{variant:"secondary",onClick:eU,children:(0,O.tx)("comments.cancel")}),(0,r.jsx)(a.$n,{variant:"primary",onClick:eB,disabled:e4,recordingKey:A.Pt(e,"editSave"),children:e.submitText})]}):(0,r.jsx)(ec,{recordingKey:e.recordingKey,onClick:eB,disabled:e4}))]})]})}},484655:(e,t,n)=>{n.d(t,{r:()=>l});var r=n(883765);function l(e,t,n){let l=t.index,i=t.mentions?t.mentions.length:0;(0,r.sx)("at_mention_search_metrics",{did_click_through:n,search_text_length:e.length,selected_index:l,suggestions_length:i})}},403206:(e,t,n)=>{function r(e){let t;let n=0,r=0;-1!==e.lastIndexOf("\n")&&(r=e.lastIndexOf("\n")+1,e=e.substring(r));let l=e.lastIndexOf("@");if(-1!==l){if(t=e.substring(l+1),n=l," "===t.substring(0,1)||t.length>100)return null;let r=e.substring(0,l),i=r.lastIndexOf("@");if(-1!==i){let l=e.substring(i+1);if(-1===l.indexOf(" ")){if(0!==i&&" "!==r[i-1])return null;t=l,n=i}}else if(0!==l&&![" ","[","{","("].includes(e[l-1]))return null}return null!=t?{search:t,index:n+=r}:null}n.d(t,{cJ:()=>i,qm:()=>l,t8:()=>s,uT:()=>r});class l{constructor(){this._isCanceled=!1,this._isEnabled=!0}isCanceled(){return!!this._isEnabled&&this._isCanceled}reset(){this._isEnabled=!1}cancel(){this._isEnabled&&(this._isCanceled=!0)}}class i extends Error{}async function s(e,t){let n=await e;if(t.isCanceled())throw t.reset(),new i;return t.reset(),n}},335963:(e,t,n)=>{n.d(t,{n:()=>r,v:()=>l});let r=/:([0-9A-Za-z-_+]+)$/,l=/(:[0-9A-Za-z-_+]+:)$/},683785:(e,t,n)=>{n.d(t,{AO:()=>a,Ed:()=>d,Ly:()=>c,gG:()=>u,rv:()=>f});var r=n(291705),l=n(873304),i=n(372868),s=n(750802),o=n(695370);function a(e,t){let n=e.getCurrentContent();if(t.id.startsWith("invite-")&&!("profile_handle"in t)){let r=n.createEntity("INVITE","IMMUTABLE",{mention:t}).getLastCreatedEntityKey(),l=(0,o.TE)(e);return g(e,l,r,(0,s.F)(t.handle)||"",!1)}let r=n.createEntity("MENTION","IMMUTABLE",{mention:t}).getLastCreatedEntityKey(),l=(0,o.TE)(e),i="profile_handle"in t?`@${t.profile_handle}`:t.handle;return g(e,l,r,(0,s.F)(i)||"",!1)}function u(e,t){let n=l.il.getDefaultSkin(),r=n?`:skin-tone-${n}:`:"";return t.skins.length<2&&(r=""),c(e,`:${t.id}:`+r)}function c(e,t){let n=(0,o.TE)(e),r=(0,i.UF)(t)[0].unicode,l=e.getCurrentContent().createEntity("EMOJI","IMMUTABLE",{text:t,unicode:r}).getLastCreatedEntityKey();return g(e,n,l,r,!1)}function d(e,t){let n=e.getCurrentContent().createEntity("SUGGESTION","IMMUTABLE",{suggestion:t}).getLastCreatedEntityKey(),r=(0,o.TE)(e);return g(e,r,n,t.suggestionInsert,t.suggestionInsert.includes("@"))}function f(e,t){let n=e.getCurrentContent().createEntity("INVITE","IMMUTABLE",{mention:{email:t.user.email,id:`invite-${t.id}`}}).getLastCreatedEntityKey(),r=(0,o.TE)(e);return t.user.email?g(e,r,n,t.user.email,!1):e}let g=(e,t,n,l,i)=>{let s=e.getSelection(),a=e.getCurrentContent(),{start:u,end:c}=t,d=s;null!=u&&null!=c&&(d=s.merge({anchorOffset:u,focusOffset:c}));let f=r.Modifier.replaceText(a,d,l,void 0,n),g=f.getSelectionAfter(),h=f.getLastBlock();h.getKey()===g.getStartKey()&&h.getKey()===g.getEndKey()&&h.getLength()===g.getStartOffset()&&h.getLength()===g.getEndOffset()&&(f=r.Modifier.replaceText(f,g,i?"":" ",void 0,void 0));let p=r.EditorState.push(e,f,"insert-fragment");return i?(0,o.aC)(p,"@"):r.EditorState.forceSelection(p,f.getSelectionAfter())}},695370:(e,t,n)=>{n.d(t,{Aw:()=>q,Bm:()=>_,DL:()=>b,Er:()=>k,FA:()=>N,Gm:()=>A,Ji:()=>w,L5:()=>S,M1:()=>O,Qo:()=>D,TE:()=>v,Wt:()=>U,XM:()=>B,_S:()=>V,aC:()=>I,c9:()=>L,cL:()=>x,d8:()=>F,f7:()=>T,jM:()=>z,lZ:()=>$,mi:()=>E,oP:()=>J,q7:()=>W,wT:()=>K,ws:()=>Z,yN:()=>H});var r=n(291705),l=n(779666),i=n.n(l),s=n(686549),o=n(466890),a=n(372868),u=n(750802),c=n(390036),d=n(116553),f=n(403206),g=n(335963),h=n(479929);let p={BOLD:"b",ITALIC:"i",STRIKETHROUGH:"s"},m={b:"BOLD",i:"ITALIC",s:"STRIKETHROUGH"},y={BOLD:[{char:"*",sequence:"**"},{char:"_",sequence:"__"}],ITALIC:[{char:"*",sequence:"*"},{char:"_",sequence:"_"}],STRIKETHROUGH:[{char:"~",sequence:"~"}]},_=new Set(["*","-","+"]);function x(e,t,n){return C(e,t,n,"EMOJI")}function E(e,t,n){return C(e,t,n,"HYPERLINK")}function b(e,t){let n=e.getText();for(let r of(0,h.Vt)(n).filter(t=>{for(let n=t.start;n<t.end;n++)if(e.getEntityAt(n))return!1;return!0}))t(r.start,r.end)}function k(e,t,n){return C(e,t,n,"MENTION")}function T(e,t,n){return C(e,t,n,"INVITE")}let C=(e,t,n,r)=>{e.findEntityRanges(e=>(function(e,t,n){return null!==t&&e.getEntity(t).getType()===n})(n,e.getEntity(),r),t)};function A(e){let t=e.getSelection(),n=e.getCurrentContent(),r=t.getAnchorKey(),l=n.getBlockForKey(r),i=t.getAnchorOffset(),s=l.getText().substring(0,i),o=(0,f.uT)(s);return null!==o?o.search:""}function I(e,t){let n=e.getCurrentContent().getBlockMap().toArray(),l=null;for(let e of n){let n=e.getText().indexOf(t);if(-1!==n){l={blockKey:e.getKey(),position:n+1};break}}if(l){let t=new r.SelectionState({anchorKey:l.blockKey,anchorOffset:l.position,focusKey:l.blockKey,focusOffset:l.position});return r.EditorState.forceSelection(e,t)}return e}function v(e){let t,n,r,l;let i=e.getSelection(),s=e.getCurrentContent(),c=i.getAnchorKey(),d=s.getBlockForKey(c),h=i.getAnchorOffset(),p=s.getBlocksAsArray(),m=H(e),y=d.getText().substring(0,h),_=y.match(g.n),x=y.match(g.v),E=(0,f.uT)(y);if(E){let e=function(e,t,n,r,l){let{token:i}=function e(t,n){let r=0;for(let l=0;l<n.length;l++){if(n[l].children?.length){let{lengthOfText:i,token:s}=e(t-r,n[l].children);if((r+=i)>t)return{lengthOfText:r,token:s}}else n[l].t?r+=n[l].t?.replace(/\n/g,"").length||0:r+=u.F(n[l].user_annotated?.handle)?.length||0;if((r+="profile_id"in n[l]?1:0)>t)return{lengthOfText:r,token:n[l]}}return{lengthOfText:r,token:null}}(function(e,t,n,r){let l=0;for(let n=0;n<e.length&&e[n]!==t;++n)l+=e[n].getText().replace(/\n/g,"").length;return l+(n-(r.match(/\n/g)||[]).length)}(e,t,n,l),r);return i}(p,d,E.index,m,y);E=e&&(0,o.l5)(e)===o.vj.PLAIN_TEXT?E:null}return E?(t="MENTION",n=E.search,r=E.index,l=h):_?(t="EMOJI",n=_[1],r=_.index,l=h):x&&(0,a.xM)(x[1])&&(t="COMPLETE_EMOJI",n=x[1],r=x.index,l=h),{type:t,search:n,start:r,end:l}}function S(){let e=window.getSelection();if(e&&e.rangeCount>0){let t=e.getRangeAt(0).getBoundingClientRect();return(0,s.E)(t)}return null}function O(e){var t;let n=e.getSelection(),r=null;if((t=n).getStartKey()===t.getEndKey()){let t=F(e),l=[];if(t.findEntityRanges(t=>{let n=t.getEntity();return null!==n&&"HYPERLINK"===e.getCurrentContent().getEntity(n).getType()},(e,t)=>{l.push({start:e,end:t})}),l.length<1)return{selection:n,entityKey:r};let i={start:n.getStartOffset(),end:n.getEndOffset()};for(let s of l)if(i.start>=s.start&&i.end<=s.end){n=w(e,s),r=t.getEntityAt(s.start);break}}return r&&(n=D(e,n,r)),{selection:n,entityKey:r}}function M(e,t,n,r){let l=t.getEntityAt(n);if(!l)return!1;let i=e.getEntity(l);return"HYPERLINK"===i.getType()&&i.getData().hyperlink===r}function D(e,t,n){let r=e.getCurrentContent(),l=r.getEntity(n);if(!l||"HYPERLINK"!==l.getType())return t;let i=l.getData().hyperlink,s=r.getBlockForKey(t.getStartKey()),o=t.getStartOffset(),a=s,u=o-1;e:for(let e=0;e<r.getBlocksAsArray().length&&a;e++){for(;u>=0;u--){if(!M(r,a,u,i))break e;s=a,o=u}a=r.getBlockBefore(a.getKey()),u=(a?.getLength()||0)-1}let c=r.getBlockForKey(t.getEndKey()),d=t.getEndOffset();a=c,u=d+1;e:for(let e=0;e<r.getBlocksAsArray().length&&a;e++){for(;u<=a.getLength();u++){if(!M(r,a,u-1,i))break e;c=a,d=u}a=r.getBlockAfter(a.getKey()),u=1}return t.merge({anchorOffset:o,anchorKey:s.getKey(),focusOffset:d,focusKey:c.getKey()})}function L(e){let t=e.getSelection();return t.getAnchorKey()===t.getFocusKey()&&t.getAnchorOffset()===t.getFocusOffset()}function N(e){let t=e.getCurrentContent();return!t.hasText()&&"unstyled"===t.getBlockMap().first().getType()}function K(e){return!!L(e)&&0===e.getSelection().getStartOffset()}function F(e){let t=e.getSelection().getAnchorKey();return e.getCurrentContent().getBlockForKey(t)}function w(e,t){let n=F(e);return r.SelectionState.createEmpty(n.getKey()).merge({anchorOffset:t.start,focusOffset:t.end})}function R(e,t,n){let l=w(e,t);return r.Modifier.replaceText(e.getCurrentContent(),l,n)}let j=e=>{let{index:t,char:n,line:r,numRepeats:l,exactMatch:i}=e;if(i&&t-l-1>=0&&r.charAt(t-l-1)===n)return!1;for(let e=0;e<l;e++)if(r.charAt(t-e-1)!==n)return!1;return!0},P=(e,t,n)=>{if(n-1>0&&" "===e.charAt(n-1))return null;for(let r=n-1;r>=0;r--){if(" "===e.charAt(r))continue;let l=!1;switch(t){case"BOLD":for(let{char:t,sequence:i}of y.BOLD)e.charAt(r)!==t&&e.charAt(n)===t&&j({index:r,char:t,line:e,numRepeats:i.length,exactMatch:!1})&&(l=!0);break;case"ITALIC":for(let{char:t,sequence:i}of y.ITALIC)if(e.charAt(r)!==t&&e.charAt(n)===t&&j({index:r,char:t,line:e,numRepeats:i.length,exactMatch:!1})){if("_"===t){let t=r-i.length-1;(t<0||" "===e.charAt(t))&&(l=!0)}else l=!0}break;case"STRIKETHROUGH":for(let{char:t,sequence:i}of y.STRIKETHROUGH)e.charAt(r)!==t&&e.charAt(n)===t&&j({index:r,char:t,line:e,numRepeats:i.length,exactMatch:!1})&&(l=!0)}if(l)return{start:r,end:n}}return null};function B(e,t){if(!L(e))return null;let n=e.getSelection(),r=F(e),l=n.getAnchorOffset();if(0===l&&""===t){let t=e.getCurrentContent().getBlockBefore(r.getKey());if(!t)return null;r=t,l=t.getLength()}let i=r.getText();for(let e of Object.keys(y))for(let n of y[e]){let{char:r,sequence:s}=n;if(t!==r&&j({index:l,char:r,line:i,numRepeats:s.length,exactMatch:!0})){let t=P(i,e,l-s.length);if(t)return{sequence:s,style:e,range:t}}}return null}function U(e,t){if(" "!==t||!L(e))return null;let n=e.getSelection(),r=F(e);if(" "===t){let e=i()(r.getText().slice(0,n.getAnchorOffset()));if(_.has(e))return"unordered-list-item";if("1."===e)return"ordered-list-item"}return null}function J(e,t,n){let{sequence:l,style:i,range:s}=n;if(t.length){let n=r.Modifier.insertText(e.getCurrentContent(),w(e,{start:s.end+l.length,end:s.end+l.length}),t);e=r.EditorState.push(e,n,"insert-characters")}let o=r.Modifier.removeRange(e.getCurrentContent(),w(e,{start:s.end,end:s.end+l.length}),"backward");o=r.Modifier.removeRange(o,w(e,{start:s.start-l.length,end:s.start}),"backward");let a={start:s.start-l.length,end:s.end-l.length},u=w(e,a),c=r.Modifier.applyInlineStyle(o,u,i);e=r.EditorState.push(e,c,"change-inline-style");let d={start:a.end+t.length,end:a.end+t.length};return e=r.EditorState.forceSelection(e,w(e,d))}function W(e,t){let n={start:0,end:e.getSelection().getAnchorOffset()},l=F(e).getText().slice(n.start,n.end),i=R(e,n,`${l} `),s=R(e=r.EditorState.push(e,i,"insert-characters"),{start:n.start,end:n.end+1},""),o={start:0,end:0},a=w(e,o),u=r.Modifier.setBlockType(s,a,t);return e=r.EditorState.push(e,u,"change-block-type"),e=r.EditorState.forceSelection(e,w(e,o))}function H(e){let t,n;let l=[],i="",s=e=>{let t=n||l;e.profile_id||e.user_id||e.user_annotated||e.styles||e.link?t.push(e):""!==e.t&&(t.length&&"t"in t[t.length-1]&&1===Object.keys(t[t.length-1]).length?t[t.length-1].t+=e.t:t.push(e))},o=(e,t,n)=>{let r=a.entityMap[e.key],l={};"MENTION"===r.type&&"profile_handle"in r.data.mention?(l.profile_id=r.data.mention.id,l.t=r.data.mention.profile_handle):"MENTION"===r.type?(l.user_id=r.data.mention.id,l.user_annotated=r.data.mention):"HYPERLINK"===r.type?(l.link=r.data.hyperlink,l.t=t):"EMOJI"===r.type?l.t=r.data.text:"INVITE"===r.type?(l.t=r.data.mention.email,l.user_id=r.data.mention.id):(l.t=t,n.length&&(l.styles=n)),s(l)},a=(0,r.convertToRaw)(e.getCurrentContent()),d="";return a.blocks.forEach(e=>{let r=(0,c.Qt)((0,u.F)(e.text)||"");["ordered-list-item","unordered-list-item"].includes(e.type)?(e.type!==i&&(n&&l.push({styles:["ordered-list-item"===i?"ol":"ul"],children:t}),t=[],n=[]),t||=[],n||=[],i=e.type.slice()):(l.length&&""===i&&s({t:"\n"}),n&&(l.push({styles:["ordered-list-item"===i?"ol":"ul"],children:t}),t=void 0,n=void 0),i="");let a={};e.entityRanges.forEach(e=>{a[e.offset]=e});let f={};(0,h.Vt)(e.text).forEach(e=>{let{start:t,end:n}=e;for(let e=t;e<n;e++)if(a[e])return;f[t]=e});let g={};e.inlineStyleRanges.forEach(e=>{e.offset in g?g[e.offset].push(e):g[e.offset]=[e]});let m=[],y={};for(let e=0;e<r.length;e++){if(e in y&&m.length&&(s({t:d,styles:[...m]}),d="",m=m.filter(t=>!y[e].includes(t))),e in a){let t=a[e];if(m.length)for(var _ in s({t:d,styles:[...m]}),m=[],y)Number(_)>e+t.length&&m.push(...y[_]);else s({t:d});d="",o(t,r.slice(e,e+t.length).join(""),m),e+=t.length-1;continue}if(e in f){let t=f[e],n=t.end-t.start;if(m.length)for(var _ in s({t:d,styles:[...m]}),m=[],y)Number(_)>e+n&&m.push(...y[_]);else s({t:d});d="",s({t:r.slice(e,e+n).join(""),link:t.href}),e+=n-1;continue}e in g&&(m.length?s({t:d,styles:[...m]}):s({t:d}),d="",g[e].forEach(e=>{if(p[e.style]){let t=p[e.style];m.push(t);let n=e.offset+e.length;n in y?y[n].push(t):y[n]=[t]}})),d+=r[e]}m.length?s({t:d,styles:[...m]}):s({t:d}),d="",n&&(0===n.length&&n.push({t:""}),t.push({children:n}),n=[])}),n&&l.push({styles:["ordered-list-item"===i?"ol":"ul"],children:t}),l}function $(e){let t=[];return e.forEach(e=>{let n=(0,u.F)(e.t);if(n){let r=n.split("\n");1===r.length?t.push(e):r.forEach((n,l)=>{let i=l<r.length-1?`${n}
`:n;void 0!==e.styles?t.push({t:i,styles:e.styles}):t.push({t:i})})}else t.push(e)}),t}let X=(e,t,n,r,l,i="default")=>{let s=[],o=[],f="";$(e).forEach(e=>{let g=(0,u.F)(e.t);if(e.children?.length){""!==f&&(l.push({text:f,entityRanges:s,type:i,depth:0,inlineStyleRanges:o,key:l.length.toString()}),f="",o=[],s=[]);let a=e.styles?.includes("ol")?"ordered-list-item":"unordered-list-item";e.children.forEach(e=>{e.children?.length&&X(e.children,t,n,r,l,a)})}else if(e.user_annotated||e.profile_id){let t=e.user_annotated?(0,u.F)(e.user_annotated.handle)||"":"@"+g,n=e.user_annotated?e.user_annotated:{id:e.profile_id,profile_handle:g};s.push({key:Object.keys(r).length,length:(0,c.Qt)(t).length,offset:(0,c.Qt)(f).length}),r[Object.keys(r).length]={type:"MENTION",mutability:"IMMUTABLE",data:{mention:n}},f+=t}else if(e.link&&(0,h.$x)((0,d.xT)(e.link)))s.push({key:Object.keys(r).length,length:(0,c.Qt)(g).length,offset:(0,c.Qt)(f).length}),r[Object.keys(r).length]={type:"HYPERLINK",mutability:"MUTABLE",data:{hyperlink:e.link,commentEditorType:n}},f+=g;else{if(e.styles?.length)e.styles.forEach(e=>{if(m[e]){let t=m[e];o.push({style:t,length:(0,c.Qt)(g).length,offset:(0,c.Qt)(f).length})}});else if((0,a.Lg)(g)){let e=(0,a.wd)(g),t=0,n="";for(let l of e){let e="",i="";(0,a.xM)(l)&&((0,a.UF)(l).forEach(t=>{e+=t.unicode,i+=t.meta}),s.push({key:Object.keys(r).length,length:(0,c.Qt)(e).length,offset:(0,c.Qt)(f).length+t}),r[Object.keys(r).length]={type:"EMOJI",mutability:"IMMUTABLE",data:{text:i,unicode:e}}),n+=e.length?e:l,t+=(0,c.Qt)(e.length?e:l).length}g=n}g?.endsWith("\n")?(f+=g.slice(0,-1),l.push({text:f,entityRanges:s,type:i,depth:0,inlineStyleRanges:o,key:l.length.toString()}),f="",s=[],o=[]):f+=g}}),(""!==f||"default"!==i)&&l.push({text:f,entityRanges:s,type:i,depth:0,inlineStyleRanges:o,key:l.length.toString()})};function q(e,t,n){let l={},i=[];X(e,t,n,l,i,"default");let s=(0,r.convertFromRaw)({blocks:i,entityMap:l});return r.EditorState.createWithContent(s,t)}let G=e=>{let t=e.getCurrentContent().getFirstBlock(),n=t.getKey(),l=t.getLength();return r.EditorState.acceptSelection(e,new r.SelectionState({anchorKey:n,anchorOffset:l,focusKey:n,focusOffset:l,isBackward:!1}))};function z(e){let t=G(e);return r.EditorState.forceSelection(t,t.getSelection())}let Q=e=>{let t=e.getAttribute("data-mention-user-id"),n=e.getAttribute("data-tooltip-user-handle");return t&&n?{id:t,handle:n}:null},Y=e=>e.getAttribute("data-tooltip-url-string");function V(e,t){var n=new DOMParser().parseFromString(e,"text/html"),l=n.getElementsByTagName("a");let i={};for(let e=0;e<l.length;e++){l[e].setAttribute("href",new URL(l[e].href,document.baseURI).toString());let t=l[e].getAttribute("href"),n=Q(l[e]);n&&t&&(i[t]=n);let r=Y(l[e]);r&&l[e].setAttribute("href",r)}n.querySelectorAll('[data-stringify-type="paragraph-break"]').forEach(function(e){let t=n.createElement("br");e.parentNode&&e.parentNode.replaceChild(t,e)});let s=n.querySelector("body"),o=s?s.innerHTML:n.documentElement.outerHTML,a=o.includes("\x3c!--StartFragment--\x3e")?o:o.replace(/(?:\r\n|\r|\n)/g,"<br/>"),u=(0,r.convertFromHTML)(a),c=r.ContentState.createFromBlockArray(u.contentBlocks,u.entityMap);return c.getBlockMap().forEach(e=>{e?.findEntityRanges(e=>{let t=e.getEntity();return!!t&&"LINK"===c.getEntity(t).getType()},(n,l)=>{let s=e.getText().slice(n,l),o=r.SelectionState.createEmpty(e.getKey());o=o.merge({anchorOffset:n,focusKey:e.getKey(),focusOffset:l});let a=e.getEntityAt(n),u=c.getEntity(a).getData().url,f=i[u];f&&f.handle===s?c=c.createEntity("MENTION","IMMUTABLE",{mention:i[u]}):h.$x(d.xT(u))&&(c=c.createEntity("HYPERLINK","MUTABLE",{hyperlink:u,editorType:t}));let g=c.getLastCreatedEntityKey();c=r.Modifier.applyEntity(c,o,g)})}),c}function Z(e){let t=e.getCurrentContent().getLastBlock().getKey(),n=e.getSelection().getEndKey();return n===t||n===e.getCurrentContent().getKeyBefore(t)}},607341:(e,t,n)=>{n.d(t,{k:()=>e1});var r=n(104076),l=n(716976),i=n(240803),s=n(601393),o=n(883187),a=n(465428),u=n(723309),c=n(856434),d=n(942942),f=n(816154),g=n(436919),h=n(697872),p=n(120440),m=n(511570),y=n.n(m),_=n(328341),x=n(814082),E=n(675477),b=n(977899),k=n(17057),T=n(633065),C=n(129215),A=n(321259),I=n(801519),v=n(894210),S=n(974528);class O extends C.k_{static getType(){return"custom-auto-link"}constructor(e,t,n){super(e,t,n),this.editorType=t.editorType}static clone(e){return new O(e.__url,{isUnlinked:e.__isUnlinked,rel:e.__rel,target:e.__target,title:e.__title,editorType:e.editorType},e.__key)}createDOM(e){let t=document.createElement("span");this._setAttributes(t),t.className=S.JM;let n=super.createDOM(e);return t.appendChild(n),t}updateDOM(e,t,n){let r=t.firstChild;return null===r||(e.__url!==this.__url&&this._setAttributes(t),super.updateDOM(e,r,n),!1)}_setAttributes(e){e.setAttribute("data-testid",`implicit-hyperlink-${this.__url}`),e.setAttribute("data-tooltip",v.MW.HYPERLINK_POPUP),e.setAttribute("data-tooltip-can-edit","false"),e.setAttribute("data-tooltip-interactive","true"),e.setAttribute("data-tooltip-precise","true"),e.setAttribute("data-tooltip-show-above","true"),e.setAttribute("data-tooltip-type",v.Ib.SPECIAL),e.setAttribute("data-tooltip-unconstrain-width","true"),e.setAttribute("data-tooltip-url-string",this.__url),e.setAttribute("spellCheck","false")}static importJSON(e){let{url:t,rel:n,target:r,title:l,isUnlinked:i,editorType:s}=e;return M(t,{rel:n,target:r,title:l,isUnlinked:i,editorType:s})}exportJSON(){return{...super.exportJSON(),editorType:this.editorType,type:"custom-auto-link"}}}function M(e,t={}){return(0,I.pT)(new O(e,t))}class D extends I.Ey{static getType(){return"emoji"}static clone(e){return new D(e.__text,e.__shortcode,e.__key)}constructor(e,t,n){super(e,n),this.__shortcode=t}getUnicode(){return this.__text}getShortcode(){return this.__shortcode}createDOM(e){let t=super.createDOM(e);return t.className=p.Ay.classNames(N.emoji)??"",t.setAttribute("spellcheck","false"),t}updateDOM(){return!1}static importJSON(e){let{text:t,shortcode:n}=e;return L(t,n)}exportJSON(){return{...super.exportJSON(),type:"emoji",shortcode:this.__shortcode,version:1}}isSegmented(){return!0}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}isTextEntity(){return!0}}function L(e,t){return new D(e,t)}let N={emoji:{kMv6JI:"x1c6ngcr",$$css:!0}};class K extends C.Db{static getType(){return"custom-link"}constructor(e,t,n){super(e,t,n),this.editorType=t.editorType}static clone(e){return new K(e.__url,{rel:e.__rel,target:e.__target,title:e.__title,editorType:e.editorType},e.__key)}createDOM(e){let t=document.createElement("span");this._setAttributes(t),t.className=S.JM;let n=super.createDOM(e);return t.appendChild(n),t}updateDOM(e,t,n){let r=t.firstChild;return null===r||(e.__url!==this.__url&&this._setAttributes(t),super.updateDOM(e,r,n),!1)}_setAttributes(e){e.setAttribute("data-tooltip",v.MW.HYPERLINK_POPUP),e.setAttribute("data-tooltip-can-edit","true"),e.setAttribute("data-tooltip-entity-key",this.getKey()),e.setAttribute("data-tooltip-interactive","true"),e.setAttribute("data-tooltip-precise","true"),e.setAttribute("data-tooltip-show-above","true"),e.setAttribute("data-tooltip-target-ref-key",this.editorType??""),e.setAttribute("data-tooltip-type",v.Ib.SPECIAL),e.setAttribute("data-tooltip-unconstrain-width","true"),e.setAttribute("data-tooltip-url-string",this.__url),e.setAttribute("spellCheck","false")}static importJSON(e){let{url:t,rel:n,target:r,title:l,editorType:i}=e;return F(t,{rel:n,target:r,title:l,editorType:i})}exportJSON(){return{...super.exportJSON(),editorType:this.editorType,type:"custom-link"}}static importDOM(){return{a:e=>{let t=e.getAttribute("data-tooltip-url-string");return t?{conversion:e=>{var n;return{node:F(t,{rel:(n=e).getAttribute("rel"),target:n.getAttribute("target"),title:n.getAttribute("title")})}},priority:2}:null}}}}function F(e,t={}){return(0,I.pT)(new K(e,t))}function w(e){return e instanceof K}class R extends I.Ey{static getType(){return"mention"}static clone(e){return new R(e.__text,e.__userId,e.__profileId,e.__userAnnotated,e.__key)}constructor(e,t,n,r,l){super(e,l),this.__userId=t,this.__profileId=n,this.__userAnnotated=r}static importJSON(e){let{userId:t,profileId:n,userAnnotated:r,text:l}=e;return P({displayText:l,userId:t,profileId:n,userAnnotated:r})}exportJSON(){return{...super.exportJSON(),userId:this.__userId,profileId:this.__profileId,userAnnotated:this.__userAnnotated,type:"mention"}}createDOM(e){let t=super.createDOM(e);return t.className=S.lE,t.setAttribute("spellcheck","false"),this.__userId&&t.setAttribute("data-mention-user-id",this.__userId),this.__profileId&&t.setAttribute("data-mention-profile-id",this.__profileId),t}exportDOM(){let e=document.createElement("a");return e.setAttribute("data-lexical-mention","true"),this.__userId&&e.setAttribute("data-mention-user-id",this.__userId),this.__profileId&&e.setAttribute("data-mention-profile-id",this.__profileId),e.textContent=this.__text,{element:e}}static importDOM(){return{a:e=>e.hasAttribute("data-mention-user-id")||e.hasAttribute("data-mention-profile-id")?{conversion:j,priority:3}:null}}isToken(){return!0}isTextEntity(){return!0}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}getUserId(){return this.__userId}getProfileId(){return this.__profileId}getUserAnnotated(){return this.__userAnnotated}getMessageMetaText(){return this.getProfileId()&&this.getDisplayText().startsWith("@")?this.getDisplayText().slice(1):this.getDisplayText()}getDisplayText(){return this.__text}}function j(e){let t=e.getAttribute("data-mention-user-id")??void 0,n=e.getAttribute("data-mention-profile-id")??void 0,r=e.textContent??"";return{node:P({displayText:r,userId:t,profileId:n,userAnnotated:t?{id:t,img_url:e.getAttribute("data-tooltip-user-img-url")??"",handle:e.getAttribute("data-tooltip-user-handle")??r}:void 0})}}function P({displayText:e,userId:t,profileId:n,userAnnotated:r}){let l=new R(e,t,n,r);return l.setMode("token"),(0,I.pT)(l)}let B={bold:{k63SB2:"x1s688f",$$css:!0},italic:{kKX8nH:"x1k4tb9n",$$css:!0},strikethrough:{kybGjl:"xmqliwb",k1TLXF:null,kMnn75:null,kmVMDM:null,kNySMw:null,$$css:!0},listOl:{kmVPX3:"x1717udv",kg3NbH:null,kuDDbn:null,kE3dHu:null,kP0aTx:null,kpe85a:null,k8WAf4:null,kLKAdn:null,kGO01o:null,kogj98:"x1ghz6dp",kUOVxO:null,keTefX:null,koQZXg:null,k71WvV:null,km5ZXQ:null,kqGvvJ:null,keoZOQ:null,k1K539:null,kpqbRz:"x43c9pm",kH6xsr:"x3yw8vx",$$css:!0},listUl:{kmVPX3:"x1717udv",kg3NbH:null,kuDDbn:null,kE3dHu:null,kP0aTx:null,kpe85a:null,k8WAf4:null,kLKAdn:null,kGO01o:null,kogj98:"x1ghz6dp",kUOVxO:null,keTefX:null,koQZXg:null,k71WvV:null,km5ZXQ:null,kqGvvJ:null,keoZOQ:null,k1K539:null,kpqbRz:"x43c9pm",kH6xsr:"xtaz4m5",$$css:!0},listItem:{koQZXg:"x400o59",keTefX:null,k71WvV:null,$$css:!0}},U={text:{bold:p.Ay.classNames(B.bold),italic:p.Ay.classNames(B.italic),strikethrough:p.Ay.classNames(B.strikethrough)},list:{ol:p.Ay.classNames(B.listOl),ul:p.Ay.classNames(B.listUl),listitem:p.Ay.classNames(B.listItem)}};function J({editorState:e,editorType:t,editable:n}){return{editorState:e,editable:n,namespace:"lexical-editable-typeahead",onError(e){throw e},theme:U,html:{import:{span:()=>({conversion:W,priority:1})}},nodes:[I.Ey,D,R,K,O,{replace:C.Db,with:e=>F(e.__url,{editorType:t}),withKlass:K},{replace:C.k_,with:e=>M(e.__url,{editorType:t}),withKlass:O},A.v5,A.YW]}}function W(e){return{forChild:function(e){let t=e.fontWeight,n=parseInt(t,10),r=e.textDecoration.split(" "),l=isNaN(n)?"bold"===t:n>=600,i=r.includes("line-through"),s="italic"===e.fontStyle;return e=>((0,I.kF)(e)&&(l&&!e.hasFormat("bold")&&e.toggleFormat("bold"),i&&!e.hasFormat("strikethrough")&&e.toggleFormat("strikethrough"),s&&!e.hasFormat("italic")&&e.toggleFormat("italic")),e)}(e.style),node:null}}var H=n(983016),$=n(372868),X=n(750802),q=n(116553),G=n(695370),z=n(479929);let Q={b:"bold",i:"italic",s:"strikethrough"};function Y(e){let t=[];return e.read(()=>{let e=(0,I.Ni)();!function(e){let t=e.getChildren();if(1!==t.length)return!1;let n=t[0];return(0,I.bS)(n)&&0===n.getChildren().length}(e)&&e.getChildren().forEach(e=>(function e(t,n){if((0,A.HY)(t)){let r=t.getListType(),l=[];t.getChildren().forEach(t=>{e(t,l)}),Z({styles:["number"===r?"ol":"ul"],children:l},n)}else if((0,A.Mz)(t)){let r=[];t.getChildren().forEach(t=>{e(t,r)}),Z({children:r},n)}else if((0,I.bS)(t)){let r=n[n.length-1];r&&!et(r)&&Z({t:"\n"},n);let l=t.getChildren();l.length?l.forEach(t=>e(t,n)):Z({t:""},n)}else if(t instanceof R){let e=t.getUserId(),r=t.getProfileId(),l=t.getUserAnnotated(),i={};r?(i.profile_id=r,i.t=t.getMessageMetaText()):e&&l&&(i.user_id=e,i.user_annotated=l),Z(i,n)}else if(t instanceof D)Z({t:t.getShortcode()},n);else if(t instanceof O||w(t)){let e=t.getURL();Z({t:(0,X.F)(t.getTextContent())??"",link:e},n)}else if((0,I.kF)(t)){let e=(0,X.F)(t.getTextContent())??"",r=function(e){let t=[];for(let[n,r]of Object.entries(Q))e.hasFormat(r)&&t.push(n);return t}(t),l={t:e};r.length>0&&(l.styles=r),Z(l,n)}else(0,I.wH)(t)&&Z({t:"\n"},n)})(e,t))}),t}function V(e,t){let n=(0,H.D)({nodes:J({editorState:null,editorType:"headless-editor"}).nodes,onError:e=>{console.error("Error creating Lexical EditorState:",e)}});return n.update(()=>{let n=(0,I.Ni)();n.clear(),function e(t,n,r){let l=(0,G.lZ)(t),i=r;for(let t of l){if(t.children&&t.children.length>0){let l;if(et(t)){let e=ee(t)?"bullet":"number";l=(0,A.DE)(e)}else l=(0,A.i)();r.append(l),e(t.children,n,l),i=r;continue}if((0,I.hV)(i)&&(i=(0,I.lJ)(),r.append(i)),t.user_annotated||t.profile_id)(function(e,t){let n;let r=(0,X.F)(e.t)??"";if(e.profile_id){let t=r.startsWith("@")?r:`@${r}`;n=P({profileId:e.profile_id,displayText:t})}else if(e.user_id&&e.user_annotated){let t=(0,X.F)(e.user_annotated.handle)??"";n=P({userId:e.user_id,userAnnotated:e.user_annotated,displayText:t})}else{let e=(0,I.sT)(r);t.append(e);return}t.append(n)})(t,i);else if(t.link&&(0,z.$x)((0,q.xT)(t.link)))(function(e,t,n){if(!e.link||!(0,z.$x)((0,q.xT)(e.link)))return;let r=(0,X.F)(e.t)??"",l=F(e.link,{editorType:n}),i=(0,I.sT)(r);en(i,e),l.append(i),t.append(l)})(t,i,n);else if(null!=t.t){let e=(0,X.F)(t.t)??"";if((0,$.Lg)(e))(function(e,t,n){for(let r of(0,$.wd)(e)){let e="",l="";if((0,$.xM)(r)){(0,$.UF)(r).forEach(t=>{e+=t.unicode,l+=t.meta});let t=L(e,l);n.append(t)}else{let e=(0,I.sT)(r);en(e,t),n.append(e)}}})(e,t,i);else{let n=(0,I.sT)(e);en(n,t),i.append(n),e.endsWith("\n")&&(n.setTextContent(e.slice(0,-1)),i=(0,I.lJ)(),r.append(i))}}}if((0,I.hV)(r)&&!r.getChildren().length){let e=(0,I.lJ)();r.append(e)}}(e,t,n)},{discrete:!0}),n.getEditorState()}function Z(e,t){if(null!=e.t){let n=t[t.length-1];n?.t!=null&&1===Object.keys(n).length&&1===Object.keys(e).length?n.t+=e.t:t.push(e)}else t.push(e)}function ee(e){return Array.isArray(e.styles)&&e.styles.includes("ul")}function et(e){return ee(e)||Array.isArray(e.styles)&&e.styles.includes("ol")}function en(e,t){if(t.styles&&t.styles.length>0)for(let n of t.styles){let t=Q[n];t&&e.toggleFormat(t)}}let er=[e=>{let t=(0,z.Vt)(e)[0];if(!t)return null;let n=new URL(t.href).toString();return{index:t.start,length:t.end-t.start,text:t.value,url:n}}];function el(e){return(0,z.$x)(e)&&z.oh.test(e)}function ei(e,t,n){let r=F(e,{editorType:n}),l=(0,I.sT)(t);return r.append(l),r}function es(){let e=(0,I.vJ)();if(!(0,I.I2)(e))return null;let t=e.getNodes().filter(e=>!ec(e));if(t.length<1)return null;let n=eo(t[0]);return n&&t.every(e=>eo(e)===n)?n:null}function eo(e){return w(e)?e.getURL():w(e.getParent())?e.getParent().getURL():null}function ea(e,t,n){let r="next"===n?ef:ed,l=[],i=r(e,w);for(;i&&ep(i,t);)"next"===n?l.push(i):l.unshift(i),i=r(i,w);return l}function eu(e){if(!es())return;let t=e.getNodes(),n=t[0],r=t[t.length-1];if(!n||!r)return;let l=eo(n);if(!l)return;let i=ea(n,l,"previous"),s=ea(r,l,"next"),o=[...i,...t.map(e=>(function(e,t){if(ep(e,t))return e;let n=e?.getParent();return n&&ep(n,t)?n:null})(e,l)).filter(e=>null!==e),...s],a=o[0],u=o[o.length-1];if(!a||!u)return;let c=e.clone();c.anchor.set(a.getKey(),0,"element"),c.focus.set(u.getKey(),u.getTextContentSize?.()||0,"element"),(0,I.n1)(c)}function ec(e){return(0,I.bS)(e)||(0,A.HY)(e)||(0,A.Mz)(e)}function ed(e,t){return eg(e,t,"previous")}function ef(e,t){return eg(e,t,"next")}function eg(e,t,n){let r=null,l=e;for(r=eh(l,n);!r&&l;)r=eh(l=l.getParent(),n);return r&&t(r=function e(t,n){return t&&ec(t)?e("next"===n?t.getFirstChild():t.getLastChild(),n):t}(r,n))?r:null}function eh(e,t){return e?"next"===t?e.getNextSibling():e.getPreviousSibling():null}function ep(e,t){return w(e)&&e.getURL()===t}var em=n(371868),ey=n(909581);function e_(){let[e]=(0,em.DF)();return(0,r.jsx)(ey.G,{editor:e})}var ex=n(873337),eE=n(873304),eb=n(130689),ek=n(484655),eT=n(403206),eC=n(335963);function eA({anchorNode:e,replacementNode:t,end:n,matchText:r,selection:l,start:i}){let s=l.anchor.offset===e.getTextContent().length;for(let l of e.splitText(i,n))l.getTextContent()===r&&(l.replace(t),t.selectEnd());s&&eI()}function eI(){let e=(0,I.vJ)();(0,I.I2)(e)&&e.insertText(" ")}var ev=n(735212);function eS(e,t=!0){setTimeout(()=>{e.focus(),t&&e.update(()=>{(0,I.Ni)().selectEnd()})},0)}var eO=n(192075),eM=n(58212);let eD=(0,I.gu)();var eL=n(821359);function eN({dispatch:e,onUpdateTextArea:t}){let[n]=(0,em.DF)(),r=(0,l.useRef)(null);return(0,l.useEffect)(()=>n.registerUpdateListener(({editorState:n})=>{n.read(()=>{let n=(0,I.vJ)();if((0,I.I2)(n)){let l=n.anchor.getNode();if(l instanceof I.Ey){let i=l.getTextContent(),s=n.anchor.offset,o=i.substring(0,s).match(eC.n);if(o){let n=o[1];if(n!==r.current){r.current=n;let l=(0,eL.oQ)(n);l?(e(x.We(l)),t()):e(x.We(null))}}else null!==r.current&&(r.current=null,e(x.We(null)))}else null!==r.current&&(r.current=null,e(x.We(null)))}})}),[n,e,t]),null}function eK(e){return ev.sY?e.metaKey:e.ctrlKey}function eF(e,t){if((0,A.Mz)(e)){let n=e.getParent();if((0,A.HY)(n))return n.getListType()===t}let n=e.getParent();if((0,A.Mz)(n)){let e=n.getParent();if((0,A.HY)(e))return e.getListType()===t}return!1}function ew({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:i}){return function({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:i}){(function({delegateEscapeHandling:e,onEscape:t}){let[n]=(0,em.DF)();(0,l.useEffect)(()=>e?()=>{}:n.registerCommand(I.Q$,e=>(t(),!0),I.d),[e,n,t])})({delegateEscapeHandling:n,onEscape:e}),function({hasTypeahead:e}){let[t]=(0,em.DF)();(0,l.useEffect)(()=>(0,ev.Sd)(...[I.UD,I.bb,I.AX,I.JM].map(n=>t.registerCommand(n,eR(e),I.d))),[t,e])}({hasTypeahead:r}),function({hasTypeahead:e}){let[t]=(0,em.DF)();(0,l.useEffect)(()=>t.registerCommand(I.OX,eR(e),I.d),[t,e])}({hasTypeahead:r}),function({onSubmit:e,submitOnEnter:t}){let[n]=(0,em.DF)();(0,l.useEffect)(()=>n.registerCommand(I.if,r=>{if(t&&!r?.shiftKey||r&&(r.altKey||r.metaKey))return e(),r?.preventDefault(),!0;let l=(0,I.vJ)();if(!(0,I.I2)(l))return!1;if(null!==r){if((ev.pz||ev.Yw||ev.Dz)&&ev.aT)return!1;r.preventDefault()}return n.dispatchCommand(I.XK,void 0)},I.d),[n,e,t])}({onSubmit:t,submitOnEnter:i}),function(){let[e]=(0,em.DF)();(0,l.useEffect)(()=>e.registerCommand(I.Wu,()=>{let e=(0,I.vJ)();if(!(0,I.I2)(e))return!1;let t=function(e){let t=e.anchor.getNode();return t===e.focus.getNode()?{node:t,point:e.anchor}:null}(e);if(!t)return!1;let n=function(e){let{node:t,point:n}=e;if((0,A.Mz)(t))return t;let r=t.getParent();return r&&(0,A.Mz)(r)&&0===n.offset?r:null}(t);if(!n)return!1;let r=(0,I.lJ)();if(n.replace(r,!0),0===r.getChildrenSize()){let e=(0,I.sT)("");r.append(e),e.select()}return!0},I.d),[e])}(),function(){let[e]=(0,em.DF)(),t=(0,l.useCallback)(t=>{let{shiftKey:n,key:r}=t;return!!eK(t)&&!!n&&("x"===r?(t.preventDefault(),t.stopPropagation(),e.dispatchCommand(I.mB,"strikethrough"),!0):"8"===r?(t.preventDefault(),t.stopPropagation(),function(e){e.update(()=>{let t=(0,I.vJ)();(0,I.I2)(t)&&(eF(t.anchor.getNode(),"bullet")?e.dispatchCommand(A.uS,void 0):e.dispatchCommand(A.q7,void 0))})}(e),!0):"7"===r&&(t.preventDefault(),t.stopPropagation(),function(e){e.update(()=>{let t=(0,I.vJ)();(0,I.I2)(t)&&(eF(t.anchor.getNode(),"number")?e.dispatchCommand(A.uS,void 0):e.dispatchCommand(A.x,void 0))})}(e),!0))},[e]);(0,l.useEffect)(()=>e.registerRootListener(e=>{if(e)return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}),[e,t])}(),function(){let[e]=(0,em.DF)(),t=(0,l.useCallback)(t=>{eK(t)&&t.shiftKey&&"u"===t.key&&(t.stopPropagation(),e.dispatchCommand(eD,void 0))},[e]);(0,l.useEffect)(()=>e.registerRootListener(e=>{if(e)return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}),[e,t])}(),function(){let[e]=(0,em.DF)();(0,l.useEffect)(()=>e.registerRootListener(e=>{if(e){let t=e=>{"Escape"!==e.key&&"Backspace"!==e.key&&e.stopPropagation()};return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}}}),[e])}()}({onEscape:e,onSubmit:t,delegateEscapeHandling:n,hasTypeahead:r,submitOnEnter:i}),null}function eR(e){return t=>(t.stopPropagation(),!!e()&&(t.preventDefault(),!0))}var ej=n(776111),eP=n(666875),eB=n(944350);function eU({contactsAnalytics:e,dispatch:t,onUpdateTextArea:n,mentionables:r,isProtoView:i,figmaEditorType:s}){let[o]=(0,em.DF)(),a=(0,l.useRef)(null),u=(0,l.useRef)(null),[c]=(0,eP.A)(async l=>{let o=(async e=>{u.current&&u.current.cancel(),u.current=new eT.qm;try{return{result:await (0,eT.t8)((0,eL.fG)(e,r,!i&&s===eB._Y.DESIGN),u.current),canceled:!1}}catch(e){if(e instanceof eT.cJ)return{result:null,canceled:!0};throw e}})(l);(0,ej.Lg)()&&(window.TEST_ONLY_mentionsSearchPending=o);let{result:a,canceled:c}=await o;c||(a?(e.trackQueryResult(a.query,a.mentions.length),t(x.We(a))):t(x.We({type:"mentions",mentions:[],index:0,maxMentions:0,search:l,query:l})),n())},300),d=(0,l.useRef)(c);return d.current=c,(0,l.useEffect)(()=>o.registerUpdateListener(({editorState:e})=>{e.read(()=>{let e=(0,I.vJ)();if((0,I.I2)(e)){let n=e.anchor.getNode();if(n instanceof I.Ey){let r=n.getTextContent(),l=e.anchor.offset,i=r.substring(0,l),s=(0,eT.uT)(i);if(s){let{search:e}=s;e!==a.current&&(a.current=e,d.current(e))}else null!==a.current&&(a.current=null,u.current&&u.current.cancel(),t(x.We(null)))}else null!==a.current&&(a.current=null,u.current&&u.current.cancel(),t(x.We(null)))}})}),[o,t]),null}function eJ({contactsAnalytics:e,delegateEscapeHandling:t,dispatch:n,editingComment:i,editorOnClear:s,editorOnInsert:o,editorRef:a,editorType:u,figmaEditorType:c,hasTypeahead:d,isProtoView:f,isThreadCommentOverflowMenuOpen:g,maintainSelectionOnFocus:h,mentionables:p,onCancel:m,onFocus:y,onSubmit:_,onUpdateTextArea:b,setHyperlinkEditorRef:k,setHyperlinkLocation:T,setIsEditorFocused:C,submitOnEnter:A,typeahead:v}){let S=(0,l.useRef)(v);S.current=v;let{insertEmoji:O,insertMention:M,clearTypeahead:D,selectAll:N}=function({contactsAnalytics:e,dispatch:t}){let[n]=(0,em.DF)(),r=(0,l.useCallback)(e=>{let r=()=>{n.update(()=>{let t=(0,I.vJ)()??(0,I.S1)();if(!(0,I.I2)(t))return;let n=t.anchor.getNode(),r=eE.il.getDefaultSkin(),l=r?`:skin-tone-${r}:`:"";e.skins.length<2&&(l="");let i=`:${e.id}:${l}`,s=(0,$.UF)(i);if(!s||s.length<1)return;let o=L(s[0].unicode,i);if(n instanceof I.Ey){let e=n.getTextContent(),r=t.focus.offset,l=e.substring(0,r).match(eC.n);if(l){let e=l.index;eA({anchorNode:n,replacementNode:o,end:r,matchText:l[0],selection:t,start:e});return}}let a=t.anchor.offset===n.getTextContent().length;t.insertNodes([o]),a&&eI()}),t(x.We(null))};n.getEditorState().read(()=>(0,I.vJ)())?r():n.focus(r)},[t,n]);return{insertEmoji:r,insertMention:(0,l.useCallback)((r,l)=>{e.trackResultClicked(l.query,l.index,l.mentions.length,!1),(0,ek.r)(l.query,l,!0),n.update(()=>{let e=(0,I.vJ)()??(0,I.S1)();if(!(0,I.I2)(e))return;let t=e.anchor.getNode(),n="profile_handle"in r,l=n?void 0:r.id,i=n?r.id:void 0,s=n?void 0:r,o=P({displayText:n?`@${r.profile_handle}`:(0,X.F)(r.handle)??r.id,userId:l,profileId:i,userAnnotated:s});if(t instanceof I.Ey){let n=t.getTextContent(),r=e.focus.offset,l=n.substring(0,r),i=(0,eT.uT)(l);if(i){let n=i.index;eA({anchorNode:t,replacementNode:o,end:r,matchText:`@${i.search}`,selection:e,start:n});return}}e.insertNodes([o]),o.selectEnd()}),"profile_handle"in r&&t((0,eb.Hx)(r)),t(x.We(null))},[e,t,n]),clearTypeahead:(0,l.useCallback)(n=>{e.endSession(n),t(x.We(null))},[e,t]),selectAll:(0,l.useCallback)(()=>{n.focus(()=>{n.update(()=>{let e=(0,I.vJ)();(0,I.I2)(e)&&(0,ex.e1)(e)})})},[n])}}({contactsAnalytics:e,dispatch:n}),K=function(){let[e]=(0,em.DF)();return(0,l.useCallback)(()=>e.getEditorState().read(()=>{let e=(0,I.vJ)();if(!(0,I.I2)(e))return!1;let{anchor:t,focus:n}=e,r=e.isBackward(),l=r?n:t,i=r?t:n,s=(0,I.Ni)(),o=function(e,t){let n=e.getFirstDescendant(),r=e.getFirstChild();return n?.getKey()===t?n:r?.getKey()===t?r:null}(s,l.key),a=function(e,t){let n=e.getLastDescendant(),r=e.getLastChild();return n?.getKey()===t?n:r?.getKey()===t?r:null}(s,i.key);return!!o&&!!a&&0===l.offset&&i.offset===((0,I.ff)(a)?a.getChildrenSize():a.getTextContentSize())}),[e])}(),F=function({editingComment:e,editorType:t,hasTypeahead:n,isThreadCommentOverflowMenuOpen:r,onCancel:i}){let s=!r&&!(e&&"comment-editor-reply"===t);return(0,l.useCallback)(()=>{!n()&&s&&i()},[s,n,i])}({editingComment:i,editorType:u,hasTypeahead:d,isThreadCommentOverflowMenuOpen:g,onCancel:m}),{hasFocus:R,handleOnFocus:j,focus:B}=function({contactsAnalytics:e,maintainSelectionOnFocus:t=!1,onFocus:n,setIsEditorFocused:r,typeaheadRef:i}){let[s]=(0,em.DF)(),o=(0,l.useRef)(!1),a=(0,l.useCallback)(()=>o.current,[]),u=(0,l.useCallback)(()=>(o.current=!0,r(o.current),n(),!1),[n,r]),c=(0,l.useCallback)(()=>{eS(s,!t)},[s,t]),d=(0,l.useCallback)((e=!0)=>{a()||eS(s,e)},[s,a]),f=(0,l.useCallback)(()=>{o.current=!1,r(o.current);let t=i.current;return t?.type==="mentions"&&t.mentions[t.index]&&(e.endSession("input_blurred"),(0,ek.r)(t.query,t,!1)),!1},[e,r,i]);return(0,l.useLayoutEffect)(()=>(o.current=s.getRootElement()===document.activeElement,(0,ev.Sd)(s.registerCommand(I.$7,u,I.Ac),s.registerCommand(I.pF,f,I.Ac))),[s,f,u]),{hasFocus:a,handleOnFocus:c,handleOnBlur:f,focus:d}}({contactsAnalytics:e,maintainSelectionOnFocus:h,onFocus:y,setIsEditorFocused:C,typeaheadRef:S});!function({setHyperlinkLocation:e,setHyperlinkEditorRef:t,editorRef:n}){let[r]=(0,em.DF)();(0,l.useEffect)(()=>n&&e&&t?r.registerCommand(eD,()=>(r.update(()=>{let r=(0,I.vJ)();(0,I.I2)(r)&&eu(r);let l=(0,G.L5)();l&&(e(l),t(n))}),!0),I.d):()=>{},[r,n,t,e])}({setHyperlinkLocation:T,setHyperlinkEditorRef:k,editorRef:a});let U=function({dispatch:e,editorType:t}){let[n]=(0,em.DF)();return(0,l.useCallback)(r=>{let l=(0,q.xT)(r);if(!(0,z.$x)(l)){e(eM.F.enqueue({message:(0,eO.t)("hyperlink.invalid_link_plain")}));return}n.update(()=>{!function(e,t){let n=(0,I.vJ)();if(!(0,I.I2)(n))return;if(n.isCollapsed()){let r=ei(e,e,t);n.insertNodes([r]);return}let r=new Set;n.getNodes().forEach(e=>{if((0,I.kF)(e)){let t=e.getParent();w(t)?r.add(t):r.add(e)}else w(e)&&r.add(e)});let l=Array.from(r),i=n.anchor,s=n.focus;for(let n=0;n<l.length;n++){let r=l[n];if((0,I.kF)(r)){let o,a;1===l.length?(o=Math.min(i.offset,s.offset),a=Math.max(i.offset,s.offset)):0===n?(o=i.key===r.getKey()?i.offset:s.offset,a=void 0):n===l.length-1&&(o=0,a=i.key===r.getKey()?i.offset:s.offset),function(e,t,n,r,l){let i=e.getTextContent(),s=r??0,o=l??i.length,a=i.slice(0,s),u=i.slice(s,o),c=i.slice(o),d=[];a&&d.push((0,I.sT)(a)),u&&d.push(ei(t,u,n)),c&&d.push((0,I.sT)(c));let[f,...g]=d;f&&(e.replace(f),g.reduce((e,t)=>(t.insertAfter(e),t),f))}(r,e,t,o,a)}else w(r)&&r.setURL(e)}}(l,t)})},[e,n,t])}({dispatch:n,editorType:u}),J=function(){let[e]=(0,em.DF)();return(0,l.useCallback)(()=>e.read(()=>es()??""),[e])}(),W=function(){let[e]=(0,em.DF)();return(0,l.useCallback)(()=>{e.update(()=>{!function(){if(!es())return;let e=I.vJ()?.getNodes().filter(w);e?.forEach(e=>{!function(e){let t=e.getTextContent(),n=(0,I.sT)(t),r=(0,I.vJ)();e.replace(n),(0,I.I2)(r)&&n.select()}(e)})}()})},[e])}(),H=function({dispatch:e,setHyperlinkLocation:t,setHyperlinkEditorRef:n,editorRef:r}){let[i]=(0,em.DF)();return(0,l.useCallback)((l,s)=>{t&&n&&r&&(e((0,E.jD)()),i.update(()=>{let e=(0,I.ns)(l);if(!w(e))return;e.select();let i=(0,I.vJ)();(0,I.I2)(i)&&eu(i),s&&(t(s),n(r))}))},[e,i,r,n,t])}({dispatch:n,setHyperlinkLocation:T,setHyperlinkEditorRef:k,editorRef:a});(0,l.useImperativeHandle)(a,()=>({onFocus:j,focus:B,selectAll:N,onSubmitHyperlink:U,onRemoveHyperlink:W,getActiveHyperlinkForCurrentSelection:J,editHyperlinkFromTooltip:H,handleEscape:F,hasFocus:R,isAllSelected:K,insertEmoji:O}),[H,B,J,F,j,W,U,R,O,K,N]);let Q=(0,l.useCallback)(()=>{let e=S.current;if(e){if("emojis"===e.type){let t=e.emojis[e.index];t&&O(t)}else if("mentions"===e.type){let t=e.mentions[e.index];t&&M(t,e)}}},[O,M]);return(0,l.useEffect)(()=>{o(Q),s(()=>D("editor_clear"))},[D,o,s,Q]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eN,{dispatch:n,onUpdateTextArea:b}),(0,r.jsx)(eU,{contactsAnalytics:e,dispatch:n,onUpdateTextArea:b,mentionables:p,isProtoView:f,figmaEditorType:c}),(0,r.jsx)(ew,{onEscape:F,onSubmit:_,delegateEscapeHandling:t,hasTypeahead:d,submitOnEnter:A})]})}function eW(){let[e]=(0,em.DF)();return(0,l.useEffect)(()=>e.registerNodeTransform(I.Ey,e=>{let t=e.getTextContent(),n=(function(e,t){let n=e.getTextContent(),r=n;if((0,I.I2)(t)&&t.anchor.getNode()===e){let e=t.anchor.offset;r=n.substring(0,e)}return r})(e,(0,I.vJ)()).match(eC.v);if(!n)return;let r=n[0],l=n.index,i=l+r.length;if(!(0,$.xM)(r))return;let s=(0,$.UF)(r);if(null==s||0===s.length)return;let o=L(s[0].unicode,r);switch(function({startOffset:e,endOffset:t,textContent:n}){return 0===e&&t===n.length?"all":0===e?"start":t===n.length?"end":"middle"}({startOffset:l,endOffset:i,textContent:t})){case"all":e.replace(o);break;case"start":{let n=t.slice(i),r=(0,I.sT)(n);e.insertAfter(r),e.replace(o);break}case"end":{let n=t.slice(0,l),r=(0,I.sT)(n);e.insertBefore(r);let i=(0,I.sT)(" ");e.insertAfter(i),e.replace(o),i.select();break}case"middle":{let n=t.slice(0,l),r=t.slice(i),s=(0,I.sT)(n),a=(0,I.sT)(r);e.insertBefore(s),e.insertAfter(a),e.replace(o)}}}),[e]),null}var eH=n(832937);function e$({onFilePaste:e}){let[t]=(0,em.DF)();return(0,l.useEffect)(()=>t.registerCommand(I.w,t=>{let[,n,r]=(0,eH.gA)(t);return n.length>0&&!r&&(e(n),!0)},I.Ac),[t,e]),null}function eX({initMention:e}){let[t]=(0,em.DF)(),n=(0,l.useRef)();return(0,l.useEffect)(()=>{let r=n.current;e&&!r&&t.update(()=>{let e=(0,I.vJ)();(0,I.I2)(e)&&e.insertText("@")}),n.current=e},[t,e]),null}function eq({maxLength:e}){let[t]=(0,em.DF)();return(0,l.useEffect)(()=>{let n=null;return t.registerNodeTransform(I.h,r=>{let l=(0,I.vJ)();if(!(0,I.I2)(l)||!l.isCollapsed())return;let i=t.getEditorState(),s=i.read(()=>r.getTextContentSize()),o=r.getTextContentSize();if(s!==o){let r=o-e,a=l.anchor;r>0&&(s===e&&n!==i?(n=i,(0,ev.Xq)(t,i)):(0,ex._A)(t,a,r))}})},[t,e]),null}var eG=n(466890);function ez({messageMeta:e,editorType:t}){let[n]=(0,em.DF)(),r=(0,_.ZC)(e);return l.useEffect(()=>{if(r&&!(0,eG.Wf)(e,r)){let r=Y(n.getEditorState());if(!(0,eG.Wf)(r,e)){let r=V(e,t);n.setEditorState(r),n.focus()}}},[n,e,r,t]),null}function eQ({shouldAutoFocus:e}){let[t]=(0,em.DF)();return l.useEffect(()=>{e&&t.focus()},[t,e]),null}var eY=n(725694),eV=n(901144);let eZ=[eY.d7,eY.Pi,eY.Eg,eY.gW,eY.NB,eY.mK,eY.WY];function e0(){return(0,r.jsx)(eV.E,{transformers:eZ})}let e1=l.forwardRef(function(e,t){let{ariaLabel:n,className:p,currentOrgId:m,currentOrgUsers:C,delegateEscapeHandling:A,dispatch:v,editingComment:O,editorOnClear:M,editorOnInsert:D,editorRef:L,editorType:N,figmaEditorType:K,initMention:F,isProtoView:w,isThreadCommentOverflowMenuOpen:R,maintainSelectionOnFocus:j,maxCommentLength:P,mentionables:B,messageMeta:U,onCancel:W,onFilePaste:H,onFocus:$,onSubmit:X,onUpdateTextArea:q,openFileKey:G,openFileTeamId:z,placeholderText:Q,readOnly:Z,setHyperlinkEditorRef:ee,setHyperlinkLocation:et,setIsEditorFocused:en,showDebugger:ei,submitOnEnter:es,tabIndex:eo,typeahead:ea,updateMessage:eu,user:ec}=e,ed=function({messageMeta:e,editorType:t,editable:n}){let[r]=(0,l.useState)(()=>V(e,t));return(0,l.useMemo)(()=>J({editorState:r,editorType:t,editable:n}),[n,t,r])}({messageMeta:U,editorType:N,editable:!Z}),ef=function({currentOrgId:e,currentOrgUsers:t,openFileKey:n,openFileTeamId:r,user:i}){return(0,l.useMemo)(()=>{let l=(0,k.Ty)(e??null,i??null,t),s=(0,k.pP)(e,r,l);return new k.yO(k.I2,n,s,e,r,"lexical")},[e,t,n,r,i])}({currentOrgId:m,currentOrgUsers:C,openFileKey:G,openFileTeamId:z,user:ec}),eg=function(){let[e]=(0,l.useState)(()=>{let e=["onMouseDown"];return T.eD||e.push("onContextMenu"),e});return e}(),eh=(0,_.ZC)(ea),ep=l.useRef(ea);ep.current=ea;let em=(0,l.useCallback)(()=>!!ep.current,[]);return(0,l.useEffect)(()=>{L&&N&&v(E.pP({targetKey:N,targetRef:L}))},[v,L,N]),(0,l.useEffect)(()=>{eh||ea?.type!=="mentions"||v((0,x.Qe)())},[eh,ea,v]),(0,r.jsx)("div",{className:y()(S.DX,p||S.DL),"data-testid":"editable-typeahead",children:(0,r.jsx)(i.o,{eventListeners:eg,children:(0,r.jsxs)(o.n,{initialConfig:ed,children:[(0,r.jsx)(c.G,{}),(0,r.jsx)(h.$,{contentEditable:(0,r.jsx)("div",{className:"x1n2onr6",children:(0,r.jsx)(a.a,{"aria-haspopup":"listbox","aria-placeholder":Q??"",ariaActiveDescendant:ea?.type==="mentions"?e.activeMentionsId:void 0,ariaControls:ea?.type==="mentions"?b.Qd:void 0,ariaExpanded:ea?.type==="mentions",ariaLabel:n??Q,placeholder:(0,r.jsx)("span",{className:"x3vvef7 x10l6tqk x13vifvy xu96u03 x47corl",children:Q}),role:"combobox",tabIndex:eo})}),ErrorBoundary:u.A}),(0,r.jsx)(g.D,{onChange:e=>{eu([Y(e),e.read(()=>{let e=(0,I.vJ)();if(!(0,I.I2)(e))return!1;let t=(0,I.Ni)(),n=t.getChildren();if(0===n.length)return!1;let r=n[n.length-1],l=n.length>1?n[n.length-2]:null,i=e.getNodes()[e.getNodes().length-1]??e.focus.getNode();for(;i&&i.getParent()!==t;)i=i.getParent();return i===r||null!=l&&i===l})])}}),(0,r.jsx)(eQ,{shouldAutoFocus:!0}),(0,r.jsx)(ez,{messageMeta:U,editorType:N}),(0,r.jsx)(eX,{initMention:F}),null!=P&&P>0&&(0,r.jsx)(eq,{maxLength:P}),(0,r.jsx)(eW,{}),null!=H&&(0,r.jsx)(e$,{onFilePaste:H}),(0,r.jsx)(eJ,{contactsAnalytics:ef,delegateEscapeHandling:A,dispatch:v,editingComment:O,editorOnClear:M,editorOnInsert:D,editorRef:L,editorType:N,figmaEditorType:K,hasTypeahead:em,isProtoView:w,isThreadCommentOverflowMenuOpen:R,maintainSelectionOnFocus:j,mentionables:B,onCancel:W,onFocus:$,onSubmit:X,onUpdateTextArea:q,setHyperlinkEditorRef:ee,setHyperlinkLocation:et,setIsEditorFocused:en,submitOnEnter:es,typeahead:ea}),(0,r.jsx)(s.p,{matchers:er}),(0,r.jsx)(d.W,{validateUrl:el}),(0,r.jsx)(e0,{}),(0,r.jsx)(f.Q,{}),ei&&(0,r.jsx)(e_,{})]})})})})},157869:(e,t,n)=>{n.d(t,{n:()=>c});var r=n(104076),l=n(674524),i=n(511570),s=n.n(i),o=n(652539),a=n(894210);let u="file_upload_icon_input--disabledIcon--JLhI1";function c(e){let{svg:t,svgAltText:n,isDisabled:i,acceptedFileTypes:c,inputRef:d,onFileInputChange:f,singleFile:g,recordingKey:h}=e,p=(0,l.AF)(h,"change",e=>{f(d)()});return(0,r.jsxs)("label",{htmlFor:e.inputId,className:s()("file_upload_icon_input--fileUploadIconLabel--GkBse",{[u]:i}),"data-tooltip-type":a.Ib.TEXT,"data-tooltip-show-immediately":!0,"data-tooltip":i?null:e["data-tooltip"],children:[(0,r.jsx)("input",{ref:d,accept:c,"aria-label":e["data-tooltip"],className:"file_upload_icon_input--fileInput--qwRav",disabled:i,id:e.inputId,multiple:!g,name:e.inputId,onChange:p,type:"file"}),e.children||t&&(0,r.jsx)("div",{className:"file_upload_icon_input--svg--qwaj3",children:(0,r.jsx)(o.B,{title:n,ariaLabel:n,svg:t,autosize:!0,className:s()({[u]:i})})})]})}}}]);

//# debugId=f80c68a4-8ab2-584a-aedf-d59f52b1a0cc

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/fcc1a1091c2aaa9d82b629815d3a14b20f85f845/4288-48658f6831fa1f33.min.js.map