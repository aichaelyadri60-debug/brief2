"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b2e32ac7-05d2-5880-af5e-006e1aa4fe2d")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[297],{472207:(e,t,r)=>{r.d(t,{e:()=>o});let o="https://go/figmascope-docs"},787538:(e,t,r)=>{r.d(t,{rf:()=>a,tV:()=>s,zG:()=>i});var o=r(104076),n=r(659062);function i(){return(0,o.jsx)(s,{children:(0,o.jsx)("p",{children:"Reading file..."})})}function a({error:e}){let t="Oops! Something went wrong";return"string"==typeof e?t=e:e instanceof Error&&(t=e.message,console.error(e)),(0,o.jsx)(s,{children:(0,o.jsx)("p",{style:n.sx.colorTextOndanger.colorBgDanger.p16.font20.maxW400.$,children:t})})}function s({children:e}){return(0,o.jsx)("div",{style:n.sx.fillPositionedContainer.flex.itemsCenter.justifyCenter.flexColumn.lh1_5Lines.font16.$,children:e})}},123315:(e,t,r)=>{r.d(t,{J:()=>tm});var o=r(104076),n=r(716976),i=r(737121),a=r(795033),s=r(883765),l=r(222714),c=r(221586),d=r(514223),u=r(659062),f=r(569963),p=r(284068),h=r(383947),g=r(432099),m=r(657878),v=r(377399),y=r(800108),k=(e=>(e[e.Fetched=0]="Fetched",e[e.Fetching=1]="Fetching",e[e.NeverFetched=2]="NeverFetched",e))(k||{});let b=(0,a.eU)(e=>{let t=e(m.OC);return"fullscreen"===t.view?`/api/file/scenegraph_validations/${t.fileKey}`:(0,v.E)(t)&&t.urlParams?.type==="server_file"?`/api/admin/scenegraph_validations/${t.urlParams.key}`:null}),S=(0,a.eU)(e=>null!=e(b)),x=(()=>{let e=(0,a.eU)((0,h.Ok)());return(0,a.eU)(t=>t(e),async(t,r)=>{let o;if(t(e).status===d.r.LOADING)return;let n=t(b);if(n){r(e,(0,h.ux)());try{o=await O(n)}catch(t){r(e,(0,h.uW)(t));return}r(e,(0,h.NY)(o))}})})();async function O(e){let t=await (0,g.GD)(e),r=new y._;for(let e of t.data.meta.data.results.violations)if("always-fail-for-testing"!==e.name)for(let t of e.instances)r.add(t.guid,t.message);return r}var N=r(617748),w=r(707425),C=r(787538),j=r(255054),I=r(843717),P=r(999083),J=r(266808),E=r(824570),T=r(957501),K=r.n(T),V=r(236631),M=r(911990),_=r(585627);let A=(0,w.Sv)("bookmarkSettings",{bookmarks:{}}),F=(0,a.eU)(e=>{let t=e(A),r=e(p.Cc).id;return new Set((t.bookmarks[r]??[]).map(e=>e.id))});function D(){let[e,t]=(0,a.fp)(A),r=(0,a.md)(p.Cc).id,o=n.useCallback(o=>{t({...e,bookmarks:{...e.bookmarks,[r]:o(e.bookmarks[r]||[])}})},[e,r,t]),i=n.useCallback((e,t)=>{o(r=>[...r,{id:e,name:t}])},[o]),s=n.useCallback(e=>{o(t=>t.filter((t,r)=>r!==e))},[o]),l=n.useCallback((e,t)=>{o(r=>r.map((r,o)=>o===e?{...r,name:t}:r))},[o]),c=n.useCallback((e,t)=>{o(r=>r.map((r,o)=>o===e?{...r,id:_.SW.fromString(t)}:r))},[o]);return{addBookmark:i,deleteBookmark:s,moveBookmarkDown:n.useCallback(e=>{o(t=>{if(e>=t.length-1)return t;let r=t.slice(),[o]=r.splice(e,1);return r.splice(e+1,0,o),r})},[o]),moveBookmarkUp:n.useCallback(e=>{o(t=>{if(e<=0)return t;let r=t.slice(),[o]=r.splice(e,1);return r.splice(e-1,0,o),r})},[o]),renameBookmark:l,updateBookmarkId:c,bookmarks:n.useMemo(()=>e.bookmarks[r]||[],[e,r])}}var $=r(674473);function L(e,t,r){return[...e.getObject(r)?.mapDescendants(e=>e.id)??[],...t?.getObject(r)?.mapDescendants(e=>e.id)??[]]}let U=(0,a.FZ)((0,a.eU)({}),(e,t,r)=>{let o=r(p.Cc),n=r(p.lX);switch(t.type){case"toggleExpanded":return(0,$.X9)(e,t.objectId,t.toggleSubtree?L(o,n,t.objectId):[]);case"expandAncestors":return(0,$.nE)(e,function(e,t,r){return[...e.getObject(r)?.mapAncestors(e=>e.id)??[],...t?.getObject(r)?.mapAncestors(e=>e.id)??[]]}(o,n,t.objectId),!0);case"expandDescendants":return(0,$.nE)(e,[t.objectId,...L(o,n,t.objectId)],!0);case"collapseDescendants":return(0,$.IO)(e,[t.objectId,...L(o,n,t.objectId)])}});var H=r(99723),B=r(382629),R=r(115069);let G=(0,a.eU)({status:"initial"}),z=(0,a.eU)(0),X=(0,a.eU)(!1),q=(0,a.eU)(e=>{if(e(X)){let t=e(z);return`Indexing search results (this may take a moment)... [${t}/???]`}return null}),Y=(0,w.Sv)("searchMode",w.Y6.Search),W=(0,a.eU)(e=>{let t=e(G),r=e(p.Cc),o=e(N.Sd);return"initial"===t.status?o.map(e=>r.getObject(e)).filter(B.Vq).map(e=>({object:e,matches:[]})).reverse():"results"in t&&t.results.length>0?t.results:null}),Q=(0,a.eU)(e=>{let t=e(G);if("searching"===t.status&&0===t.results.length){let t=["Searching..."],r=e(q);return r&&t.push(r),t}if("success"===t.status&&0===t.results.length){let t=["No results found."],r=e(p.Cc);return r instanceof R.G2&&t.push("Some content may be unavailable because of incremental loading"),"hide"===r.sensitiveTextPolicy&&t.push("Searching text fields is limited beacuse text redaction has been applied."),t}return"error"===t.status?["Error searching:",String(t.error)]:null}),Z=(0,a.eU)(e=>{if(e(Y)!==w.Y6.Filter)return null;let t=e(G);return"results"in t?t.results.map(e=>e.object):null}),ee=(0,a.eU)(e=>{if(e(Y)!==w.Y6.Filter)return null;let t=e(Q);return t?t.join(" "):null}),et=(0,w.Sv)("sortOrder",w.hX.Position),er=(0,a.eU)(e=>{let t=[w.hX.Position,w.hX.Name,w.hX.NodeId];return e(p.Cc).rootObjects[0]?.displayProperties.memoryFraction!=null&&t.push(w.hX.Memory),t.sort(),t}),eo=(0,a.eU)(e=>{switch(e(et)){case w.hX.Position:return ei;case w.hX.Name:return en;case w.hX.Memory:return es;case w.hX.NodeId:return ea}});function en(e,t){return e.displayProperties.name.localeCompare(t.displayProperties.name)}function ei(e,t){let[r,o]=el(e,t);if(r&&o){let e=r.parentIndex?.position,t=o.parentIndex?.position;if(null==e&&null==t)return 0;if(null==t)return 1;if(null==e)return -1;if(e<t)return -1;else if(e>t)return 1}return en(e,t)}function ea(e,t){let[r,o]=el(e,t);if(r&&o){let{sessionID:e,localID:t}=r.guid??{localID:-1,sessionID:-1},{sessionID:n,localID:i}=o.guid??{localID:-1,sessionID:-1};return e-n||t-i}return ei(e,t)}function es(e,t){return(t.displayProperties.memoryFraction??0)-(e.displayProperties.memoryFraction??0)||ei(e,t)}function el(e,t){return"nodeChange"in e&&"nodeChange"in t?[e.nodeChange,t.nodeChange]:[null,null]}var ec=r(727989),ed=r(403671),eu=r(110178),ef=r(665261),ep=r(192075),eh=r(770484),eg=r(66293);let em=ef.ms,ev=ef.c$,ey=ef.wv;function ek({contextMenuData:{objectId:e,position:t},onClose:r}){let[i,s]=n.useState(0),l=t.left,c=t.top+i>window.innerHeight?t.top-i:t.top,{canSelectInApp:d,selectInApp:h}=n.useContext(N.H$),g=n.useRef(null);(0,eu.ww)(g,r);let m=(0,a.md)(p.Cc).getObject(e),v=m instanceof eg.R?m:null,y=m instanceof eh.E?m:null,[k,b]=(0,a.fp)(f.Oz),S=(0,a.Xr)(U);if(null==m)return null;let x=e=>()=>{e(),r()},O=m.children.length>0,w=(()=>{if(d?.(m))return x(()=>h(m))})(),C=e=>x(()=>J.glU.triggerAction(e,{guid:m.id})),j=k?.object.id===m.id;return(0,o.jsx)(em,{style:{...u.sx.fixed.$,left:l,top:c},dropdownRef:e=>{e&&s(e.clientHeight)},children:(0,o.jsxs)("div",{ref:g,children:[w&&(0,o.jsx)(ev,{onClick:w,children:"Jump to node"}),O&&(0,o.jsx)(ev,{onClick:x(()=>S({type:"expandDescendants",objectId:e})),children:"Expand descendants"}),O&&(0,o.jsx)(ev,{onClick:x(()=>S({type:"collapseDescendants",objectId:e})),children:"Collapse descendants"}),(w||O)&&(0,o.jsx)(ey,{}),j&&(0,o.jsx)(ev,{onClick:x(()=>b({type:"clear"})),children:"Stop diffing against this node"}),(!j||k?.type!==f.Lp.Layer)&&(0,o.jsx)(ev,{onClick:x(()=>b({type:"start",diffType:f.Lp.Layer,id:e})),children:"Layer diff against this node"}),(!j||k?.type!==f.Lp.Tree)&&(0,o.jsx)(ev,{onClick:x(()=>b({type:"start",diffType:f.Lp.Tree,id:e})),children:"Tree diff against this node"}),v&&(0,o.jsx)(ey,{}),v&&(0,o.jsx)(ev,{onClick:x(()=>{let e=JSON.stringify(v.nodeChange,null,2);navigator.clipboard.writeText(e)}),children:"Copy NodeChange JSON"}),y&&"DOCUMENT"!==y.type&&"CANVAS"!==y.type&&(0,o.jsx)(ev,{onClick:C("debug-print-as-test-code"),children:(0,ep.tx)("fullscreen_actions.debug-print-as-test-code")}),y&&"VECTOR"===y.type&&(0,o.jsx)(ev,{onClick:C("debug-print-vector-network-as-test-code"),children:(0,ep.tx)("fullscreen_actions.debug-print-vector-network-as-test-code")})]})})}var eb=r(62084);let eS=n.memo(function({diffType:e,id:t,primaryId:r,secondaryId:i,leftBadges:a,indent:s,index:l,isExpanded:c,isLeaf:d,isSelected:u,isSelectedSecondary:f,memoryFraction:p,rightBadges:h,name:g,style:m,select:v,toggle:y,showContextMenu:k}){let b=n.useCallback(e=>{e.preventDefault(),k({objectId:t,position:{left:e.clientX,top:e.clientY}})},[t,k]);return(0,o.jsxs)(eb.Z,{changeType:e,indent:s,isExpanded:c,isLeaf:d,isSelected:u,isSelectedSecondary:f,keyboardNavigationPath:[l],onContextMenu:b,onMouseEnter:()=>{J.Ez5&&J.Ez5.editorState().figmaScopeHighlightedNode.set(t)},onMouseLeave:()=>{J.Ez5&&J.Ez5.editorState().figmaScopeHighlightedNode.set("")},select:()=>v(t),style:m,toggleExpanded:e=>y(t,e),children:[(0,o.jsx)(ec.IV,{badges:a}),(0,o.jsx)(ed.nK,{id:r}),i&&(0,o.jsx)(ed.nK,{id:i,secondary:!0}),(0,o.jsx)("div",{title:g,className:V.s.ellipsis.noWrap.overflowHidden.$,children:g}),(0,o.jsx)(M.M,{}),(0,o.jsx)(ec.IV,{badges:h}),null!=p&&(0,o.jsxs)("span",{className:V.s.colorTextSecondary.$,title:"Node memory usage",children:[(100*p).toFixed(3),"%"]})]})});function ex({style:e,data:{displayedObjects:t,selectedId:r,selectedIds:n,...i},index:a}){let s=t[a],l=(0,E.zN)(e);return(0,o.jsx)(eS,{...s,...i,isSelected:r===s.id,isSelectedSecondary:!!s&&n.includes(s.id),style:l,index:a})}let eO=[];function eN({appSelection:e}){let t=(0,a.md)(ew),[r,i]=(0,a.fp)(N.AJ),s=(0,E.k9)(()=>e?.guids??eO,[e?.guids]),[l,c]=n.useState(null),d=n.useRef(null);n.useEffect(()=>{let e=t.findIndex(e=>e.id===r);e>=0&&d.current?.scrollToItem(e,"smart")},[t,r]);let u=(0,a.Xr)(U);n.useEffect(()=>{u({type:"expandAncestors",objectId:r})},[u,r]);let f=n.useCallback((e,t)=>{u({type:"toggleExpanded",objectId:e,toggleSubtree:t})},[u]),p=(0,a.md)(ee);return 0===t.length?(0,o.jsx)("div",{children:p??"Empty Scene"}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(j.A,{disableWidth:!0,children:({height:e})=>(0,o.jsx)(I.Y1,{itemSize:18,itemCount:t.length,height:e,ref:d,itemData:{displayedObjects:t,selectedId:r,selectedIds:s,select:i,toggle:f,showContextMenu:c},width:"100%",children:ex})}),l&&(0,o.jsx)(ek,{contextMenuData:l,onClose:()=>{c(null)}})]})}let ew=(0,a.eU)(e=>{let t=e(F),r=e(p.Cc);return(e(eC)??e(ej)).map(e=>({...e,rightBadges:[...e.rightBadges,...t.has(e.id)?[{type:"bookmark",value:"Bookmarked"}]:[],...r.getAdditionalBadges?.(e.id)||[]]}))}),eC=(0,a.eU)(e=>{let t=e(Z);return t?t.map(e=>({...e.displayProperties,diffType:void 0,id:e.id,indent:0,isExpanded:!1,isLeaf:!0})):null}),ej=(0,a.eU)(e=>{let t=e(p.Cc).rootObjects,r=e(f.sg),o=e(U),n=e(eo),i=(()=>{switch(r.type){case f.Lp.Tree:return[r.object];case f.Lp.Full:return r.resource.rootObjects;default:return[]}})(),a={sortFn:n,expandedIds:o};return K()(t,e=>{if(!e)return[];if(0===i.length)return eI(e,0,a);let t=eJ(e,i);return t?eP(e,t,0,a):function e(t,r,o,n){let i=t.id,a=t.children,s=0===a.length,l=!!n.expandedIds[i],c=!1,d=K()(a,t=>{let i=(()=>{let i=eJ(t,r);if(i)return eP(t,i,o+1,n);let a=r.filter(e=>e.someAncestor(e=>e.id===t.id,{includeSelf:!0}));return a.length>0?e(t,a,o+1,n):eI(t,o+1,n)})();return c=c||i[0]?.diffType!=null,i}),u={...t.displayProperties,diffType:c?"CHILD_MODIFIED":void 0,id:i,indent:o,isExpanded:l,isLeaf:s};return l?[u,...d]:[u]}(e,i,0,a)})});function eI(e,t,r){let o=e.id,n=e.children,i=0===n.length,a=!!r.expandedIds[o],s={...e.displayProperties,diffType:void 0,id:o,indent:t,isExpanded:a,isLeaf:i};return a?[s,...K()(eE(n,r.sortFn),e=>eI(e,t+1,r))]:[s]}function eP(e,t,r,o){let n=e??t;if(!n)throw Error("Diffing two nothings");if(e&&t&&e.id!==t.id)throw Error("Diffing nodes with mismatched keys");let i=n.id,a=eE(e?.children??[],o.sortFn),s=eE(t?.children??[],o.sortFn),l=(0,P.TR)(a,s,e=>e.id),c=!1,d=K()(l,({left:e,right:t})=>{let n=eP(e,t,r+1,o);return c=c||n[0]?.diffType!=null,n}),u=(0,f.wc)(e,t,c),p=e?.displayProperties.name,h=t?.displayProperties.name,g=null!=p&&null!=h&&p!==h?`${p} <=> ${h}`:n.displayProperties.name,m=!!o.expandedIds[i],v={...n.displayProperties,diffType:u,id:i,indent:r,isExpanded:m,isLeaf:0===l.length,name:g};return m?[v,...d]:[v]}function eJ(e,t){return t.find(t=>t.id===e.id)}function eE(e,t){return e.slice().sort(t)}var eT=r(307829),eK=r(420680),eV=r(32557);r(120440);var eM=r(878604),e_=r(268389),eA=r(162954),eF=r(208754),eD=r(760238),e$=r(216940),eL=r(927287),eU=r(36758),eH=r(523657),eB=r(390579);function eR(e){let{bookmarks:t,deleteBookmark:r,moveBookmarkDown:i,moveBookmarkUp:a,renameBookmark:s,updateBookmarkId:l}=D();return(0,o.jsx)(eM.bL,{defaultPosition:{x:window.innerWidth/2,y:window.innerHeight/2},onClose:e.onClose,width:400,children:(0,o.jsxs)(e_.vo,{children:[(0,o.jsx)(e_.Y9,{children:(0,o.jsx)(e_.hE,{children:"FigmaScope Bookmarks"})}),(0,o.jsx)(e_.nB,{children:(0,o.jsxs)(eA.bL,{className:"xrvj5dj x1nfngrj",children:[0===t.length&&(0,o.jsx)("div",{className:"x6s0dn4 x78zum5 xpyat2d xl56j7k",children:"No bookmarks"}),t.length>0&&(0,o.jsxs)(eF.fI,{className:"xrvj5dj xuhvigx xg2d0mh",children:[(0,o.jsx)(eD.fh,{children:"Name"}),(0,o.jsx)(eD.fh,{children:"ID"})]}),t.map((e,c)=>(0,n.createElement)(eF.fI,{className:"xrvj5dj xuhvigx xg2d0mh",key:c},(0,o.jsx)(eD.fh,{children:(0,o.jsx)(e$.p,{id:`edit-bookmark-name-${c}`,value:e.name,onChange:e=>s(c,e)})}),(0,o.jsx)(eD.fh,{children:(0,o.jsx)(e$.p,{id:`edit-bookmark-id-${c}`,value:e.id,onChange:e=>l(c,e)})}),(0,o.jsx)(eD.fh,{children:(0,o.jsxs)(eL.e,{"aria-label":`Bookmark actions for ${e.name}`,children:[(0,o.jsx)(eK.K,{"aria-label":"Delete bookmark",onClick:()=>r(c),children:(0,o.jsx)(eU.i,{})}),(0,o.jsx)(eK.K,{"aria-label":"Move bookmark up",disabled:0===c,onClick:()=>a(c),children:(0,o.jsx)(eH.t,{})}),(0,o.jsx)(eK.K,{"aria-label":"Move bookmark down",disabled:c===t.length-1,onClick:()=>i(c),children:(0,o.jsx)(eB.O,{})})]})})))]})})]})})}function eG(){let[e,t]=(0,a.fp)(N.AJ),r=(0,a.md)(N.gg),{getTriggerProps:i,manager:s}=eT.b(),{addBookmark:l,bookmarks:c}=D(),[d,u]=n.useState(!1);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(eT.bL,{manager:s,children:[(0,o.jsx)("div",{className:"xrybvsa",children:(0,o.jsx)(eK.K,{...i(),"aria-label":"bookmarks",children:(0,o.jsx)(eV.j,{})})}),(0,o.jsxs)(eT.mc,{children:[(0,o.jsxs)(eT.YJ,{title:(0,o.jsx)(eT.r1,{children:"Bookmark settings"}),children:[(0,o.jsx)(eT.q7,{onClick:()=>{let t=r?.displayProperties.name??"Bookmark";l(e,`${t} - ${e}`)},children:"Add bookmark"}),(0,o.jsx)(eT.q7,{onClick:()=>{u(!0)},children:"Manage bookmarks"})]}),c.length?(0,o.jsx)(eT.YJ,{title:(0,o.jsx)(eT.r1,{children:"Bookmark list"}),children:c.map((e,r)=>(0,o.jsx)(eT.q7,{onClick:()=>{t(e.id)},children:e.name},r))}):null]})]}),d&&(0,o.jsx)(eR,{onClose:()=>u(!1)})]})}var ez=r(511570),eX=r.n(ez),eq=r(150062),eY=r(848561);function eW({searchRef:e}){let t=(0,a.Xr)(N.AJ),r=(0,a.md)(W),i=(0,a.md)(Q),[s,l]=n.useState(!1),c=(0,a.md)(Y)!==w.Y6.Filter&&s,d=n.useRef(null);(0,eu.ww)(d,()=>l(!1));let u=n.useCallback(e=>{l(!1),t(e.object.id)},[l,t]);return(0,o.jsxs)(eY.dP,{className:V.s.flex1.$,ref:d,allowVim:!0,children:[(0,o.jsx)(eQ,{searchRef:e,setShowSearchResults:l}),c&&(r?(0,o.jsx)(e0,{searchResults:r,selectResult:u}):i?(0,o.jsx)(e1,{text:i}):null)]})}function eQ({searchRef:e,setShowSearchResults:t}){let r=(0,a.md)(Y),i=function(){let e=(0,a.md)(p.Cc),t=(0,a.Xr)(G),r=(0,a.Xr)(z),o=(0,a.Xr)(X),i=n.useRef(0),s=n.useMemo(()=>(0,H.s)(n=>{let a=++i.current;o(!0);let s=new TaskController({priority:"user-visible"});scheduler.postTask(()=>o(!0),{signal:s.signal,delay:300}).catch(()=>{});let l=e.getObject(n);l&&t({status:"searching",results:[{object:l,matches:[{value:n,property:"id",isExact:!0}]}]}),e.getSearch(r).then(e=>e.searchWithText(n)).then(e=>{s.abort(),a===i.current&&t({status:"success",results:e})}).catch(e=>{console.error(e),s.abort(),a===i.current&&t({status:"error",error:e})})},200),[e,r,t,o]);return n.useCallback(e=>0===e.length?t({status:"initial"}):s(e),[s,t])}(),{setKeyboardNavigationElement:s}=(0,eY.M3)({path:[0,0],id:"input"});return(0,o.jsx)("input",{ref:t=>{s(t),e.current=t},type:"text",placeholder:r,className:"search_bar--searchBar--qnpUm",onChange:e=>i(e.target.value),onFocus:()=>t(!0)})}function eZ({children:e}){return(0,o.jsx)("div",{className:V.s.absolute.zIndexModal.colorBg.b1.colorBorder.mt2.overflowAuto.$,style:{maxHeight:450,minWidth:500,boxShadow:"0px 2px 14px var(--color-shadow, rgba(0, 0, 0, 0.15))"},children:e})}function e0({searchResults:e,selectResult:t}){return(0,o.jsx)(eZ,{children:e.map((e,r)=>(0,o.jsx)(e2,{result:e,index:r,onClick:()=>t(e)},e.object.id))})}function e1({text:e}){return(0,o.jsx)(eZ,{children:(Array.isArray(e)?e:[e]).map((e,t)=>(0,o.jsx)("div",{className:V.s.colorBg.colorTextSecondary.px8.py4.$,children:e},t))})}function e2({result:e,index:t,onClick:r}){let{object:i,matches:a}=e,{displayProperties:s}=i,{setKeyboardNavigationElement:l,keyboardNavigationItem:c,isFauxFocused:d}=(0,eY.M3)({path:[1,t],id:i.id});return n.useEffect(()=>{c&&0===t&&c.fauxFocus()},[c,t]),(0,o.jsx)("button",{ref:l,className:eX()(V.s.block.wFull.px4.py8.colorText.flex.itemsCenter.alignLeft.$,"search_bar--searchResult--0iOvc",d&&"search_bar--fauxFocus--BYHwu"),onClick:r,children:(0,o.jsxs)(M.Y,{spacing:4,children:[(0,o.jsx)(ec.IV,{badges:s.leftBadges}),(0,o.jsx)(ed.nK,{id:i.displayProperties.primaryId}),(0,o.jsx)(eq.R,{className:V.s.overflowHidden.$,text:s.name}),(0,o.jsx)(M.M,{}),a.filter(({property:e})=>!["id","guid","name","type","phase"].includes(e)).map(({property:e,value:t},r)=>(0,o.jsxs)(M.Y,{spacing:4,width:"hug-contents",children:[(0,o.jsxs)("div",{children:[e,":"]}),(0,o.jsx)("div",{children:t})]},r))]})})}var e3=r(652539);function e5({children:e}){return(0,o.jsx)("div",{className:V.s.colorBorder.px8.py4.bb1.bSolid.$,children:(0,o.jsx)(M.Y,{children:e})})}function e7(e){let t={className:"toolbar_components--iconButton--1-XNe",children:(0,o.jsx)(e3.B,{svg:e.svg}),title:e.label,"aria-label":e.label};return"href"in e?(0,o.jsx)("a",{...t,href:e.href,target:"blank"}):(0,o.jsx)("button",{...t,onClick:e.onClick,disabled:e.disabled})}var e4=r(129503),e8=r(718668);function e6({searchRef:e}){let[t,r]=(0,a.fp)(N.jI),[i,l]=(0,a.fp)(N.JN),c=!!n.useContext(N.H$).selectInApp,[d,u]=(0,a.fp)(Y),[f,p]=(0,a.fp)(N.bA),[h,g]=(0,a.fp)(et),m=(0,a.md)(er);return(0,o.jsxs)(e5,{children:[(0,o.jsx)(eW,{searchRef:e}),(0,o.jsxs)("select",{name:"filter-or-search",title:"Determines whether the text box searches or filters",onChange:e=>{u(e.target.value)},defaultValue:d,children:[(0,o.jsx)("option",{value:w.Y6.Search,children:"Search"}),(0,o.jsx)("option",{value:w.Y6.Filter,children:"Filter"})]}),(0,o.jsx)("select",{name:"sort",title:"Sets the left panel sort order",onChange:e=>{let t=e.target.value;s.az.trackDefinedEvent("figmascope.sort_order_change",{order:function(e){switch(e){case w.hX.Position:return"position";case w.hX.Name:return"name";case w.hX.Memory:return"memory";case w.hX.NodeId:return"node_id"}}(t)}),g(t)},defaultValue:h,children:m.map(e=>(0,o.jsxs)("option",{value:e,children:["Sort by ",e]},e))}),c&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("input",{name:"follow-selection",type:"checkbox",checked:f,onChange:e=>p(e.target.checked)}),(0,o.jsx)("label",{htmlFor:"follow-selection",children:"Follow"})]}),(0,o.jsx)(e7,{label:"Select Previous",onClick:()=>{r(),s.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"button"})},disabled:!t,svg:e4.A}),(0,o.jsx)(e7,{label:"Select Next",onClick:()=>{l(),s.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"button"})},disabled:!i,svg:e8.A}),(0,o.jsx)(eG,{})]})}var e9=r(815701),te=r(577693),tt=r(555013),tr=r(472207),to=r(380980),tn=r(458609),ti=r(619883),ta=r(821527);function ts({selectedObject:e,diffObject:t,onClose:r}){let n=(0,a.md)(S),[i,s]=(0,a.fp)(f.Oz);return(0,o.jsxs)(e5,{children:[e?i&&t?(0,o.jsx)(td,{selectedObject:e,diffObject:t,diffState:i,setDiffState:s}):(0,o.jsx)(tc,{object:e}):t?(0,o.jsx)(tc,{object:t}):(0,o.jsx)(M.M,{}),n&&(0,o.jsx)(tu,{}),(0,o.jsx)(e7,{label:"Help",href:tr.e,svg:to.A}),r&&(0,o.jsx)(e7,{label:"Close FigmaScope",onClick:r,svg:ta.A})]})}let tl=V.s.flex1.ml10.my4.$;function tc({object:e}){return(0,o.jsx)("div",{className:tl,children:(0,o.jsx)("span",{className:V.s.fontSemiBold.$,children:e.displayProperties.longName})})}function td({selectedObject:e,diffObject:t,diffState:r,setDiffState:n}){let i=(0,a.Xr)(N.AJ);return(0,o.jsxs)("div",{className:V.s.flex1.ml10.my4.$,children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:V.s.colorTextSecondary.$,children:"Diffing "}),(0,o.jsx)("span",{className:V.s.fontSemiBold.$,children:e.displayProperties.longName}),(0,o.jsx)("span",{className:V.s.colorTextSecondary.$,children:" against "}),(0,o.jsx)("span",{className:V.s.fontSemiBold.$,children:t.displayProperties.longName})]}),r&&(0,o.jsx)("div",{className:V.s.colorTextSecondary.mt8.$,children:(0,o.jsxs)(M.Y,{spacing:8,width:"hug-contents",height:"hug-contents",verticalAlignItems:"start",children:[(0,o.jsxs)("span",{children:["Snapshot of"," ",(0,o.jsx)(tt.CY,{onClick:()=>i(r.object.id),className:V.s.colorTextFigjam.fontSemiBold.$,trusted:!0,children:r.object.displayProperties.name}),r.type===f.Lp.Tree&&" and full subtree"," was taken at"," ",r.time.toLocaleTimeString("en-US")]}),(0,o.jsx)(tt.CY,{onClick:()=>n({type:"refresh"}),className:V.s.colorTextDesign.$,trusted:!0,children:"Refresh"}),(0,o.jsx)(tt.CY,{onClick:()=>n({type:"clear"}),className:V.s.colorTextDanger.$,trusted:!0,children:"Finish"})]})})]})}function tu(){let[e,t]=(0,a.fp)(x),r=e.status===d.r.LOADING;return n.useEffect(()=>{t()},[t]),(0,o.jsx)(e7,{label:r?"Fetching scene graph validation failures":"Refetch scenegraph validation failures",onClick:t,svg:r?tn.A:ti.A})}var tf=r(171660);function tp({children:e}){return(0,o.jsx)("div",{className:V.s.hFull.$,children:(0,o.jsxs)(M.Y,{direction:"vertical",width:"fill-parent",height:"fill-parent",padding:0,spacing:0,children:[(0,o.jsx)(th,{}),e]})})}function th(){let{name:e,metadata:t}=(0,a.md)(p.Cc);return(0,o.jsxs)(M.Y,{direction:"horizontal",width:"fill-parent",height:32,padding:8,spacing:32,backgroundColor:"toolbar",children:[e&&(0,o.jsx)(tf.E,{fontWeight:"bold",color:"toolbar",children:e}),t&&Object.entries(t).map(([e,t])=>t&&(0,o.jsxs)("span",{children:[(0,o.jsxs)(tf.E,{color:"toolbar-secondary",children:[e,": "]}),(0,o.jsx)(tf.E,{color:"toolbar",fontFamily:"monospace",fontWeight:"bold",children:t})]},e))]})}var tg=r(753639);let tm=n.memo(function({embedded:e=!1,emptyStateContent:t,onClose:r,appSelection:n,setAppSelection:i}){let s=(0,a.md)(p.lu);switch(s.status){case d.r.INIT:return t??(0,o.jsx)(C.zG,{});case d.r.LOADING:return(0,o.jsx)(C.zG,{});case d.r.FAILURE:return(0,o.jsx)(C.rf,{error:s.error});case d.r.SUCCESS:}if(0===s.value.primaryResource.rootObjects.length)return(0,o.jsx)(C.rf,{error:"No root objects found. This is likely a bug - please report in #figmascope."});let l=(0,o.jsx)(tv,{appSelection:n,setAppSelection:i,onClose:r});return e?l:(0,o.jsx)(tp,{children:l})});function tv({onClose:e,appSelection:t,setAppSelection:r}){let h=n.useRef(null),g=n.useRef(null),{windowInnerWidth:m}=(0,l.l)(),[v,y]=(0,a.fp)(ty),[k,b]=(0,a.fp)(tk),[S,O]=(0,i.i)({onDrag(e){let t=e.clientX/m;y(`${(100*t).toFixed(2)}%`)}}),[w,C]=(0,i.i)({onDrag(e){let t=g.current;if(!t)return;let r=(e.clientX-t.getBoundingClientRect().left)/t.clientWidth;b(`${(100*r).toFixed(2)}%`)}}),j=(0,a.Xr)(N.jI),I=(0,a.Xr)(N.JN),P=n.useCallback(e=>{let t=h.current;document.activeElement!==t&&(e.keyCode===c.Uz.FORWARD_SLASH&&t?(t.focus(),e.preventDefault()):e.keyCode===c.Uz.BRACKET_LEFT?(s.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"keyboard"}),j()):e.keyCode===c.Uz.BRACKET_RIGHT&&(s.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"keyboard"}),I()))},[j,I]),J=(0,a.md)(p.Cc);window.figmaScope=J,window.figmaScopeScene=J,function(e){let[t,r]=(0,a.fp)(x);t.status===d.r.SUCCESS&&e?.setSceneGraphValidationInfo?.(t.value),(0,n.useEffect)(()=>{r()},[r])}(J);let E=(0,a.md)(N.AJ),T=(0,a.md)(N.gg),K=(0,a.md)(f.tH);return(0,o.jsx)(N.q,{appSelection:t,setAppSelection:r,children:(0,o.jsxs)("div",{className:tg.zr,style:u.sx.if(S||w,{cursor:"ew-resize"}).$,onKeyDown:P,children:[(0,o.jsxs)("div",{className:tg.Pd,style:{width:v},children:[(0,o.jsx)(e6,{searchRef:h}),(0,o.jsxs)(e9.o,{className:tg._H,children:[(0,o.jsx)("div",{...O({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,o.jsx)(eN,{appSelection:t})]})]}),(0,o.jsxs)("div",{className:tg.io,children:[(0,o.jsx)(ts,{selectedObject:T,diffObject:K,onClose:e}),(T||K)&&(0,o.jsxs)("div",{className:tg._t,ref:g,children:[(0,o.jsxs)(e9.o,{className:tg.S3,style:{width:k},children:[(0,o.jsx)("div",{...C({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,o.jsx)(te.P,{panel:"middle",items:T?.rawProperties,diffItems:K?.rawProperties,extraItems:void 0},E)]}),(0,o.jsx)(e9.o,{className:tg.xK,children:(0,o.jsx)(te.P,{panel:"right",items:T?.computedProperties,diffItems:K?.computedProperties,extraItems:J.getAdditionalProperties?.(E)},E)})]})]})]})})}let ty=(0,w.Sv)("leftPanelWidth","35%"),tk=(0,w.Sv)("rightPanelWidth","50%")},318648:(e,t,r)=>{r.d(t,{th:()=>g,dH:()=>m,Fc:()=>h,gB:()=>p});var o=r(716976),n=r(405242),i=r(370012),a=r(400045),s=r(723584);let l=(e,t,r)=>{let o=t.safeParse(r);if(!o.success){let t=Object.keys(r);throw new a.T(`Failed to parse ${e} message part. Type: ${r.type}. Keys: ${t.join(", ")}. Error: ${o.error.message}`)}return o.data};var c=r(333331),d=r(520199),u=r(449572),f=r(59849);function p({isEnabled:e,fileKey:t,nodeGuid:r}){let o,n;let i=e&&t;r?(o=(0,f.Zrv)(i?{ownerId:t,nodeGuid:r}:null),n=e=>c.oA(e?.nodeAiChatThreads)?.[0]):(o=(0,f.r3i)(i?{ownerId:t}:null),n=e=>e?.fileAiChatThreads?.[0]);let a=(0,u.Rs)(o),s=n(a.data);return{threadId:s?.id??null,isOldFile:s?.nodeGuid==="old_file",isLoadingThreadId:"loading"===a.status}}function h(e,t,r,n,i){let{threadId:a,isLoadingThreadId:s}=p({isEnabled:!0,fileKey:e,nodeGuid:void 0}),[l,h]=o.useState(null),g=l??a,v=(0,u.Rs)((0,f.A6w)(e&&g?{ownerId:e,id:g}:null)),y=(0,c.oA)(v.data?.activeAiChatThread);return o.useEffect(()=>{if(!y||!g||i)return;let e=m(y);h(e=>(e!==g&&(0,d.nH)(`Livegraph Assistant threadId updating: ${e} => ${g}`),g));let o=n();e.length>o.length+t&&((0,d.nH)("LiveGraph ActiveAiChatThread updating =>",e),r(e))},[y,n,r,g,t,i,h]),{threadId:i?null:g,setThreadId:h,isLoadingThreadId:s}}function g(e){let t=e.parts.map(({partType:e,contentPb:t,blobstoreContentKey:r})=>{let{type:o,...a}=(0,n.H)(e,t);return(0,i.N)({type:o,contentJson:a,blobstoreContentKey:r})});return function({role:e,content:t,...r}){return{...(()=>{switch(e){case"user":return{role:e,content:t.map(t=>l(e,s.Fd,t))};case"assistant":return{role:e,content:t.map(t=>l(e,s.G4,t))};case"tool":return{role:e,content:t.map(t=>l(e,s.iS,t))};case"system":return{role:e,content:t.map(t=>l(e,s.jV,t))};default:throw new a.T(`Unknown message role: ${e}`)}})(),...r}}({role:e.role,content:t,createdAtMs:e.createdAt.getTime(),clientId:e.clientId??void 0,userId:"user"in e?e.user?.id??void 0:void 0,guid:"nodeGuid"in e?e.nodeGuid??void 0:void 0})}function m(e){return e.messages.map(g)}},659689:(e,t,r)=>{r.d(t,{B:()=>c});var o=r(716976),n=r(520199),i=r(770366),a=r(657878),s=r(442218);let l=new Map;function c(e){let t=(0,a.Td)(),{threadId:r,context:c}=e,d="code_chat"===c?e.isOldFile:void 0,u="code_chat"===c?e.nodeGuid:void 0;return o.useCallback(async(e,{forceCreate:o=!1}={})=>{if(!t){let e="No file key, cannot create thread";return(0,n.fL)(new n.Tv(e),"create_thread_record"),{status:"error",error:e}}let a=e.planRecordId;if(!a){let e="No plan public record id, cannot create thread";return(0,n.fL)(new n.Tv(e),"create_thread_record",{fileKey:t}),{status:"error",error:e}}if(null!=r&&!o)return{status:"existing",threadId:r};let f=async()=>{let e;let o={};"code_chat"===c?(e="file",o={privacyMode:"file",nodeGuid:d?"old_file":u}):e="user";let l=performance.now(),f=await s.NH.createThread({fileKey:t,planId:a,privacyMode:e,...o});if(200===f.status)return(0,i.aD)(`${c}.chat_sdk.thread_creation_time`,performance.now()-l),{status:"created",threadId:f.data.meta.threadId,isOldFile:"old_file"===o.nodeGuid};{let e=`ApiAiChat.createThread failed with status ${f.status}`;return(0,n.fL)(new n.Tv(e),"create_thread_record",{fileKey:t,threadId:r,status:f.status,cause:f.cause}),{status:"error",error:e}}};if("code_chat"!==c)return await f();{let e=`${t}:${c}:${u}`;return await function(e,t){let r=l.get(e);if(r)return r;let o=(async()=>{try{return await t()}finally{l.delete(e)}})();return l.set(e,o),o}(e,f)}},[t,r,c,d,u])}},520199:(e,t,r)=>{r.d(t,{Tv:()=>o.T,fL:()=>c,nH:()=>l});var o=r(400045),n=r(638004),i=r(146283),a=r(755444),s=r(550209);function l(e,...t){(0,a.b5)()&&i.k.log(`[chat-sdk] ${e}`,...t)}function c(e,t,r){(0,s.kF)("action",t),(0,s.$D)(n.e.AGENT_PLATFORM,e,{extra:r})}},129575:(e,t,r)=>{r.d(t,{KF:()=>m,YP:()=>v,di:()=>k,qD:()=>y});var o=r(716976),n=r(151823),i=r(812714),a=r(795033),s=r(883765),l=r(318648),c=r(659689),d=r(520199),u=r(219199),f=r(211862),p=r(904017);if(443==r.j)var h=r(963433);if(443==r.j)var g=r(738591);function m(e,t){let r=v({overrideCodeLibraryNode:e===n.lV.FIGMAKE?t:null,disabled:e!==n.lV.FIGMAKE}),o=y({codeFileNode:e===n.lV.CODE_IN_SITES?t:null,disabled:e!==n.lV.CODE_IN_SITES}),i=k({codeFileNode:e===n.lV.FIGMAKE_IN_DESIGN?t:null,disabled:e!==n.lV.FIGMAKE_IN_DESIGN});switch(e){case n.lV.FIGMAKE:return r;case n.lV.CODE_IN_SITES:return o;case n.lV.FIGMAKE_IN_DESIGN:return i;default:throw Error(`Unsupported feature type: ${e}`)}}function v({overrideCodeLibraryNode:e,disabled:t}){let{codeLibraryInstance:r}=(0,h.oA)(),m=t?null:void 0!==e?e:r;m&&!u.Ay.location.pathname.startsWith("/make/")&&(console.warn("useMakeChatController used outside of make file"),(0,s.sx)("chat_controller.wrong_file_type",{hookName:"useMakeChatController",expectedFileType:"make",expectedPath:"/make/",currentPath:u.Ay.location.pathname,nodeGuid:m.guid}));let v=(0,g.gO)(m),y=(0,g.eW)(m),k=function({fileKey:e,chatMessagesNode:t}){let r=t?.guid||"",{threadId:n,isOldFile:a,isLoadingThreadId:s}=(0,l.gB)({isEnabled:(0,i.kc)().make_chat_sdk??!1,fileKey:e,nodeGuid:r}),{status:u,data:f}=(0,p.No)(),h=(0,i.kc)().make_chat_sdk&&e&&r&&!s&&"loaded"===u&&f,g=(0,c.B)({threadId:n,context:"code_chat",nodeGuid:r,isOldFile:a??(t?.chatMessages_DEPRECATED??[]).length>0});return o.useEffect(()=>{h&&null===n&&g(f).then(e=>{"error"===e.status&&(0,d.fL)(new d.Tv(`Failed to create AiChatThread db record: ${e.error}`),"create_thread_record",{threadId:n,nodeGuid:r}),"created"===e.status&&(0,d.nH)(`Figmake AiChatThread created, id: ${e.threadId}, isOldFile?: ${e.isOldFile}`)})},[h,f,n,g,r]),o.useMemo(()=>{if(n&&null!=a)return{threadId:n,isOldFile:a}},[n,a])}({fileKey:(0,a.md)(f.ze),chatMessagesNode:m}),b=(0,i.kc)().make_chat_sdk&&(0,i.kc)().make_chat_sdk_read&&(!k?.isOldFile||(0,i.kc)().make_chat_sdk_read_old_files)&&(m?.chatMessages_DEPRECATED??[]).length<100;return o.useMemo(()=>{let e=b?y:v,t=[v];(0,i.kc)().make_chat_sdk&&t.push(y);let r=!!(m&&(!(0,i.kc)().make_chat_sdk||k));return new n.F1({readingSource:e,writingSinks:t,isInitialized:r,node:m,chatSdkState:k})},[m,v,y,b,k])}function y({codeFileNode:e,disabled:t}){let r=t?null:e;r&&!u.Ay.location.pathname.startsWith("/site/")&&(console.warn("useSitesChatController used outside of sites file"),(0,s.sx)("chat_controller.wrong_file_type",{hookName:"useSitesChatController",expectedFileType:"sites",expectedPath:"/site/",currentPath:u.Ay.location.pathname,nodeGuid:r.guid}));let i=(0,g.gO)(r);return o.useMemo(()=>new n.F1({readingSource:i,writingSinks:[i],node:r,isInitialized:!!r}),[i,r])}function k({codeFileNode:e,disabled:t}){let r=t?null:e;r&&!u.Ay.location.pathname.startsWith("/design/")&&(console.warn("useMakeInDesignChatController used outside of design file"),(0,s.sx)("chat_controller.wrong_file_type",{hookName:"useMakeInDesignChatController",expectedFileType:"design",expectedPath:"/design/",currentPath:u.Ay.location.pathname,nodeGuid:r.guid}));let i=(0,g.gO)(r);return o.useMemo(()=>new n.F1({readingSource:i,writingSinks:[i],node:r,isInitialized:!!r}),[i,r])}},738591:(e,t,r)=>{r.d(t,{eW:()=>P,HL:()=>J,gO:()=>C});var o=r(716976),n=r(967325),i=r(400045),a=r(266808),s=r(151823),l=r(442498),c=r(951002);async function d(e){let t={userId:e.userId,messageGuid:e.guid,createdAtMs:e.createdAtMs};switch(e.role){case"user":{let r=function(e,t){let r=(0,l.XL)(e,"code-chat-snapshot-restore");if(r){let e={type:"restore",plainText:"",codeSnapshot:{codeSnapshotKey:r.legacyS3CodeSnapshotKey,blobstoreContentKey:r.blobstoreContentKey},title:r.title},o=u(a.K$p.SYSTEM_MESSAGE,t);return o.textContent=JSON.stringify(e),o}let o=(0,l.XL)(e,"code-chat-manual-edit");if(o){let e={type:"manual_edit",plainText:"",changedFiles:o.changedFiles},r=u(a.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(e),r}let n=(0,l.XL)(e,"code-chat-duplicated-file");if(n){let e={type:"duplicated_file",plainText:n.plainText,fileKeyHash:n.fileKeyHash},r=u(a.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(e),r}let i=(0,l.XL)(e,"code-chat-deleted-chat-history");if(i){let e={type:"deleted_chat_history",plainText:"",userId:i.userId,timestamp:Number(i.timestamp)},r=u(a.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(e),r}}(e,t);if(r)return r;let o={plainText:"",imports:[]};for(let t of e.content)switch(t.type){case"text":o.plainText=t.text;break;case"selected-node-ids":break;case"code-chat-model-config-version":o.modelConfigVersion=t.modelConfigVersion;break;case"code-chat-library-keys":o.libraryKey=t.libraryKeys[0],o.libraryKeys=[...t.libraryKeys];break;case"code-chat-errors":o.errors=[...t.errors],o.hidden=!0,o.plainText="";break;case"cortex-request-uuid":o.requestUuid=t.requestUuid;break;case"code-chat-origin":o.origin=t.origin;break;case"code-chat-inspected-component":o.inspectedComponent={filePath:t.filePath,tagName:t.tagName};break;case"code-chat-snapshot-restore":case"code-chat-manual-edit":case"code-chat-duplicated-file":case"code-chat-deleted-chat-history":throw new i.T(`${t.type} should have been handled by maybeHandleNodeChatSystemMessage. Probably a bug`);case"code-chat-code-import-ref":case"code-chat-image-import-ref":case"code-chat-inspected-element-ref":console.warn(`[chat-sdk] Part not implemented: ${t.type}`);break;case"image":case"jsx":throw new i.T(`Make does not support message part with type ${t.type}`);default:(0,c.xb)(t)}let n=u(a.K$p.USER_MESSAGE,t);return n.textContent=(0,s.J6)(o),n}case"assistant":{let r=[],o=[],n={plainText:""};for(let t of e.content)switch(t.type){case"text":throw new i.T("Cannot use 'text' for Code Chat assistant messages. Use 'code-chat-assistant-text' instead.");case"tool-call":r.push({toolCallId:t.toolCallId,toolName:t.toolName,argsJson:t.argsJSON});break;case"code-chat-legacy-assistant-tool-result":{let{type:e,...r}=t;o.push({...r});break}case"reasoning":t.signature?n.signedReasoning={text:t.text,signature:t.signature}:n.reasoning=[{text:t.text}];break;case"redacted-reasoning":n.redactedReasoning=t.data;break;case"code-chat-model-config-version":n.modelConfigVersion=t.modelConfigVersion;break;case"code-chat-assistant-text":n.plainText=t.text,n.mode=t.textMode;break;case"code-chat-assistant-code":case"code-chat-provider-metadata":console.warn(`[chat-sdk] Part not implemented: ${t.type}`);break;case"code-chat-assistant-title":n.title=t.title;break;case"code-chat-legacy-s3-code-snapshot":{let e=n.codeSnapshot??{};n.codeSnapshot={...e,codeSnapshotKey:t.codeSnapshotKey,fileVersionId:"-1"};break}case"code-chat-code-snapshot":{let e=n.codeSnapshot??{};n.codeSnapshot={...e,blobstoreContentKey:t.blobstoreContentKey,fileVersionId:"-1"};break}default:(0,c.xb)(t)}let l=u(a.K$p.ASSISTANT_MESSAGE,t);return l.textContent=(0,s.J6)(n),l.toolCalls=r,l.toolResults=o,l}case"tool":{let r=[],o={plainText:""};for(let t of e.content)switch(t.type){case"tool-result":r.push({toolCallId:t.toolCallId,toolName:t.toolName,resultJson:t.resultJSON});break;case"code-chat-model-config-version":o.modelConfigVersion=t.modelConfigVersion;break;case"tool-result-ref":console.warn(`[chat-sdk] Part not implemented: ${t.type}`);break;default:(0,c.xb)(t)}let n=u(a.K$p.TOOL_MESSAGE,t);return n.textContent=(0,s.J6)(o),n.toolResults=r,n}case"system":throw new i.T("Chat SDK does not store system messages in the database (yet), we should never get here");default:(0,c.xb)(e)}}function u(e,t){let r=(0,s.ic)(e,t.userId??"placeholderUserId",()=>"placeholderMessageGuid");return void 0!==t.messageGuid&&(r.id=t.messageGuid),r.sentAt64=t.createdAtMs.toString(),r}var f=r(289172),p=r(812714),h=r(795033),g=r(333331),m=r(318648),v=r(520199),y=r(449572),k=r(106170),b=r(211862),S=r(59849),x=r(835307),O=r(252285);let N="null-hash",w=(0,O.H)({hash:N,messages:[]});function C(e){let t=(0,x.Fk)((e,t)=>t?.chatMessagesHash??N,e),r=e?.guid||"",[n,i]=(0,h.fp)(w(r)),a=(0,h.Pj)(),s=o.useMemo(()=>e&&n.hash!==N,[n.hash,e]);o.useEffect(()=>{e&&t&&t!==n.hash&&i({hash:t,messages:e.chatMessages_DEPRECATED||[],pendingMessages:void 0})},[e,t,n.hash,i,r]);let l=o.useCallback(()=>{let e=a.get(w(r));return e.pendingMessages??e.messages??[]},[a,r]),c=o.useCallback(t=>{if(s&&e){(0,k.r)(()=>e.chatMessages_DEPRECATED=t);let o=a.get(w(r));a.set(w(r),{...o,pendingMessages:t})}},[s,e,a,r]),d=o.useCallback(t=>{s&&e&&c([...l(),...t])},[c,l,s,e]),u=o.useCallback(t=>{s&&e&&c(t((0,f.A)(l())))},[l,s,e,c]);return o.useMemo(()=>({getMessages:l,appendMessages:d,editMessages:u}),[l,d,u])}let j=(0,O.H)({messages:[]}),I=(0,O.H)({messages:[]});function P(e){let t=(function(e){let[t,r]=(0,h.fp)(j(e?.guid||"")),n=o.useRef({numberOfMessages:0,lastMessageUpdatedAt:new Date(0),lastMessageId:""}),i=(0,h.md)(b.ze),a=(0,p.kc)().make_chat_sdk_read&&i,{threadId:s,isLoadingThreadId:l}=(0,m.gB)({isEnabled:!!a,fileKey:i,nodeGuid:e?.guid||""}),c=(0,y.Rs)((0,S.A6w)(a&&s?{ownerId:i,id:s}:null)),d="loaded"!==c.status,u=(0,g.oA)(c.data?.activeAiChatThread);o.useEffect(()=>{if(!u||!s||d||l)return;let e=u.messages.length,t=u.messages[e-1],o=t?.updatedAt??new Date(0),i=t?.id??"";if(e!==n.current.numberOfMessages||i!==n.current.lastMessageId||o.getTime()!==n.current.lastMessageUpdatedAt.getTime()){let t=(0,m.dH)(u);(0,v.nH)("Updating local cache with AiChatMessages",{thread:u,aiChatMessages:t}),r({messages:t??[]}),n.current={numberOfMessages:e,lastMessageUpdatedAt:o,lastMessageId:i}}},[s,u,r,l,d]);let f=o.useCallback(()=>t.messages,[t.messages]),k=o.useCallback(e=>[],[]),x=o.useCallback(()=>{},[]);return o.useMemo(()=>({getMessages:f,editMessages:k,appendMessages:x}),[f,k,x])})(e).getMessages(),[r,n]=(0,h.fp)(I(e?.guid||""));o.useEffect(()=>{0!==t.length&&Promise.all(t.map(async e=>await d(e))).then(e=>{(0,v.nH)("Converted chat messages from AI SDK to NodeChatMessages",{messages:t,convertedMessages:e}),n({messages:e})}).catch(e=>(0,v.nH)("Error converting chat messages from AI SDK to NodeChatMessages",e))},[t,n]);let i=o.useCallback(()=>r.messages,[r.messages]),a=o.useCallback(e=>[],[]),s=o.useCallback(()=>{},[]);return o.useMemo(()=>({getMessages:i,editMessages:a,appendMessages:s}),[i,a,s])}function J(e){let t=e.getMessages();return o.useMemo(()=>(0,n.Qf)(t),[t])}},523657:(e,t,r)=>{r.d(t,{t:()=>i});var o=r(716976),n=r(104076);let i=(0,o.memo)(function(e){return(0,n.jsx)("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",...e,children:(0,n.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",d:"M7.646 6.404a.5.5 0 0 1 .707 0l2.122 2.121a.5.5 0 0 1-.708.707L8 7.465 6.232 9.232a.5.5 0 0 1-.707-.707z"})})})},36758:(e,t,r)=>{r.d(t,{i:()=>a});var o=r(240831),n=r(716976),i=r(104076);let a=(0,n.memo)(function(e){return(0,o.O)()?(0,i.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,i.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",fillRule:"evenodd",d:"M6.5 7a1 1 0 0 1 1-1h9a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1h-.039l-.08 1H17a.5.5 0 0 1 0 1h-.7l-.455 5.62A1.5 1.5 0 0 1 14.35 18h-4.7a1.5 1.5 0 0 1-1.495-1.38L7.7 11H7a.5.5 0 0 1 0-1h.62l-.081-1H7.5a1 1 0 0 1-1-1zm9.494 1h.506V7h-9v1zm-.536 1H8.542l.61 7.54a.5.5 0 0 0 .498.46h4.7a.5.5 0 0 0 .499-.46zM11.5 11.5a.5.5 0 0 0-1 0v3a.5.5 0 0 0 1 0zm2 0a.5.5 0 0 0-1 0v3a.5.5 0 0 0 1 0z",clipRule:"evenodd"})}):(0,i.jsx)("svg",{width:"24",height:"24",fill:"none",viewBox:"0 0 24 24",...e,children:(0,i.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",fillRule:"evenodd",d:"M7 6a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h.039l.08 1H6.5a.5.5 0 0 0 0 1h.7l.455 5.62A1.5 1.5 0 0 0 9.15 18h4.7a1.5 1.5 0 0 0 1.495-1.38L15.8 11h.7a.5.5 0 0 0 0-1h-.62l.081-1H16a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1zm8.505 2H7V7h9v1zM8.042 9h6.916l-.61 7.54a.5.5 0 0 1-.498.46h-4.7a.5.5 0 0 1-.499-.46zm2.458 2a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 1 .5-.5m2 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 1 .5-.5",clipRule:"evenodd"})})})},967325:(e,t,r)=>{r.d(t,{EY:()=>l,Qf:()=>a,gG:()=>s});var o=r(151823),n=r(266808),i=r(621592);function a(e){let t=e?.filter(e=>e.type!==n.K$p.TOOL_MESSAGE);return t?t.reduce((e,t)=>{let r=t.type===n.K$p.ASSISTANT_MESSAGE,a=t.toolCalls.length>0,s=0===(0,o.H5)(t.textContent||"").plainText.length;if(r&&a&&s){let r=e[e.length-1];return r?.type===n.K$p.ASSISTANT_MESSAGE&&(r.toolCalls=i([...r.toolCalls,...t.toolCalls],"toolCallId")),e}return[...e,t]},[]):[]}function s(e){let{hidden:t,errors:r}=e;return!!t&&!!r&&r.length>0&&e.origin!==o.zm.FIX_ERRORS_BUTTON}function l(e){let t=e.slice().reverse().find(e=>e.type===n.K$p.USER_MESSAGE);return t?t.id:null}},405242:(e,t,r)=>{r.d(t,{H:()=>s,pQ:()=>i});var o=r(400045),n=r(472846);function i(e){return n.g.includes(e)}function a(e,t){let r=(function(e){let t=n.l[e];if(null==t)throw new o.T(`Unknown message part type: ${e}. Did you add a new message part type to a proto file? Run \`pnpm --filter @figma/synapse-global generate-ai-chat-proto\` to regenerate Typescript bindings.`);return t})(e).decode(t);return{type:e,...r}}function s(e,t){try{return a(e,function(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}(t))}catch(r){return a(e,function(e){let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2){let o=e.slice(r,r+2);t[r/2]=parseInt(o,16)}return t}(t))}}},472846:(e,t,r)=>{r.d(t,{g:()=>e$,l:()=>eL});var o=r(153379);function n(){return{selectedNodeIds:[]}}let i={encode(e,t=new o.fI){for(let r of e.selectedNodeIds)t.uint32(10).string(r);return t},decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),i=void 0===t?r.len:r.pos+t,a=n();for(;r.pos<i;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;a.selectedNodeIds.push(r.string());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return a},fromJSON:e=>({selectedNodeIds:a.Array.isArray(e?.selectedNodeIds)?e.selectedNodeIds.map(e=>a.String(e)):[]}),toJSON(e){let t={};return e.selectedNodeIds?.length&&(t.selectedNodeIds=e.selectedNodeIds),t},create:e=>i.fromPartial(e??{}),fromPartial(e){let t=n();return t.selectedNodeIds=e.selectedNodeIds?.map(e=>e)||[],t}},a=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function s(){return{text:"",providerOptions:{}}}let l={encode:(e,t=new o.fI)=>(""!==e.text&&t.uint32(10).string(e.text),Object.entries(e.providerOptions).forEach(([e,r])=>{d.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=s();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.text=r.string();continue;case 2:{if(18!==e)break;let t=d.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({text:Z(e.text)?W.String(e.text):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.text&&(t.text=e.text),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>l.fromPartial(e??{}),fromPartial(e){let t=s();return t.text=e.text??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function c(){return{key:"",value:""}}let d={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=c();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>d.fromPartial(e??{}),fromPartial(e){let t=c();return t.key=e.key??"",t.value=e.value??"",t}};function u(){return{textBlobstoreKey:"",providerOptions:{}}}let f={encode:(e,t=new o.fI)=>(""!==e.textBlobstoreKey&&t.uint32(10).string(e.textBlobstoreKey),Object.entries(e.providerOptions).forEach(([e,r])=>{h.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=u();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.textBlobstoreKey=r.string();continue;case 2:{if(18!==e)break;let t=h.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({textBlobstoreKey:Z(e.textBlobstoreKey)?W.String(e.textBlobstoreKey):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.textBlobstoreKey&&(t.textBlobstoreKey=e.textBlobstoreKey),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>f.fromPartial(e??{}),fromPartial(e){let t=u();return t.textBlobstoreKey=e.textBlobstoreKey??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function p(){return{key:"",value:""}}let h={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=p();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>h.fromPartial(e??{}),fromPartial(e){let t=p();return t.key=e.key??"",t.value=e.value??"",t}};function g(){return{mimeType:void 0,providerOptions:{}}}let m={encode:(e,t=new o.fI)=>(void 0!==e.mimeType&&t.uint32(18).string(e.mimeType),Object.entries(e.providerOptions).forEach(([e,r])=>{y.encode({key:e,value:r},t.uint32(26).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=g();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 2:if(18!==e)break;i.mimeType=r.string();continue;case 3:{if(26!==e)break;let t=y.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({mimeType:Z(e.mimeType)?W.String(e.mimeType):void 0,providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(void 0!==e.mimeType&&(t.mimeType=e.mimeType),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>m.fromPartial(e??{}),fromPartial(e){let t=g();return t.mimeType=e.mimeType??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function v(){return{key:"",value:""}}let y={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=v();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>y.fromPartial(e??{}),fromPartial(e){let t=v();return t.key=e.key??"",t.value=e.value??"",t}};function k(){return{text:"",signature:void 0,providerOptions:{}}}let b={encode:(e,t=new o.fI)=>(""!==e.text&&t.uint32(10).string(e.text),void 0!==e.signature&&t.uint32(18).string(e.signature),Object.entries(e.providerOptions).forEach(([e,r])=>{x.encode({key:e,value:r},t.uint32(26).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=k();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.text=r.string();continue;case 2:if(18!==e)break;i.signature=r.string();continue;case 3:{if(26!==e)break;let t=x.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({text:Z(e.text)?W.String(e.text):"",signature:Z(e.signature)?W.String(e.signature):void 0,providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.text&&(t.text=e.text),void 0!==e.signature&&(t.signature=e.signature),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>b.fromPartial(e??{}),fromPartial(e){let t=k();return t.text=e.text??"",t.signature=e.signature??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function S(){return{key:"",value:""}}let x={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=S();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>x.fromPartial(e??{}),fromPartial(e){let t=S();return t.key=e.key??"",t.value=e.value??"",t}};function O(){return{providerOptions:{}}}let N={encode:(e,t=new o.fI)=>(Object.entries(e.providerOptions).forEach(([e,r])=>{C.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=O();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 2:{if(18!==e)break;let t=C.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>N.fromPartial(e??{}),fromPartial(e){let t=O();return t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function w(){return{key:"",value:""}}let C={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=w();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>C.fromPartial(e??{}),fromPartial(e){let t=w();return t.key=e.key??"",t.value=e.value??"",t}};function j(){return{data:"",providerOptions:{}}}let I={encode:(e,t=new o.fI)=>(""!==e.data&&t.uint32(10).string(e.data),Object.entries(e.providerOptions).forEach(([e,r])=>{J.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=j();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.data=r.string();continue;case 2:{if(18!==e)break;let t=J.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({data:Z(e.data)?W.String(e.data):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.data&&(t.data=e.data),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>I.fromPartial(e??{}),fromPartial(e){let t=j();return t.data=e.data??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function P(){return{key:"",value:""}}let J={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=P();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>J.fromPartial(e??{}),fromPartial(e){let t=P();return t.key=e.key??"",t.value=e.value??"",t}};function E(){return{providerOptions:{}}}let T={encode:(e,t=new o.fI)=>(Object.entries(e.providerOptions).forEach(([e,r])=>{V.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=E();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 2:{if(18!==e)break;let t=V.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>T.fromPartial(e??{}),fromPartial(e){let t=E();return t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function K(){return{key:"",value:""}}let V={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=K();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>V.fromPartial(e??{}),fromPartial(e){let t=K();return t.key=e.key??"",t.value=e.value??"",t}};function M(){return{toolCallId:"",toolName:"",providerOptions:{}}}let _={encode:(e,t=new o.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),Object.entries(e.providerOptions).forEach(([e,r])=>{F.encode({key:e,value:r},t.uint32(34).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=M();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.toolCallId=r.string();continue;case 2:if(18!==e)break;i.toolName=r.string();continue;case 4:{if(34!==e)break;let t=F.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({toolCallId:Z(e.toolCallId)?W.String(e.toolCallId):"",toolName:Z(e.toolName)?W.String(e.toolName):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>_.fromPartial(e??{}),fromPartial(e){let t=M();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function A(){return{key:"",value:""}}let F={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=A();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>F.fromPartial(e??{}),fromPartial(e){let t=A();return t.key=e.key??"",t.value=e.value??"",t}};function D(){return{toolCallId:"",toolName:"",isError:void 0,providerOptions:{}}}let $={encode:(e,t=new o.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),void 0!==e.isError&&t.uint32(32).bool(e.isError),Object.entries(e.providerOptions).forEach(([e,r])=>{U.encode({key:e,value:r},t.uint32(42).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=D();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.toolCallId=r.string();continue;case 2:if(18!==e)break;i.toolName=r.string();continue;case 4:if(32!==e)break;i.isError=r.bool();continue;case 5:{if(42!==e)break;let t=U.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({toolCallId:Z(e.toolCallId)?W.String(e.toolCallId):"",toolName:Z(e.toolName)?W.String(e.toolName):"",isError:Z(e.isError)?W.Boolean(e.isError):void 0,providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),void 0!==e.isError&&(t.isError=e.isError),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>$.fromPartial(e??{}),fromPartial(e){let t=D();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.isError=e.isError??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function L(){return{key:"",value:""}}let U={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=L();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>U.fromPartial(e??{}),fromPartial(e){let t=L();return t.key=e.key??"",t.value=e.value??"",t}};function H(){return{toolCallId:"",toolName:"",argsJson:"",providerOptions:{}}}let B={encode:(e,t=new o.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),""!==e.argsJson&&t.uint32(26).string(e.argsJson),Object.entries(e.providerOptions).forEach(([e,r])=>{G.encode({key:e,value:r},t.uint32(34).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=H();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.toolCallId=r.string();continue;case 2:if(18!==e)break;i.toolName=r.string();continue;case 3:if(26!==e)break;i.argsJson=r.string();continue;case 4:{if(34!==e)break;let t=G.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({toolCallId:Z(e.toolCallId)?W.String(e.toolCallId):"",toolName:Z(e.toolName)?W.String(e.toolName):"",argsJson:Z(e.argsJson)?W.String(e.argsJson):"",providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),""!==e.argsJson&&(t.argsJson=e.argsJson),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>B.fromPartial(e??{}),fromPartial(e){let t=H();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.argsJson=e.argsJson??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function R(){return{key:"",value:""}}let G={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=R();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>G.fromPartial(e??{}),fromPartial(e){let t=R();return t.key=e.key??"",t.value=e.value??"",t}};function z(){return{toolCallId:"",toolName:"",resultJson:"",isError:void 0,providerOptions:{}}}let X={encode:(e,t=new o.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),""!==e.resultJson&&t.uint32(26).string(e.resultJson),void 0!==e.isError&&t.uint32(32).bool(e.isError),Object.entries(e.providerOptions).forEach(([e,r])=>{Y.encode({key:e,value:r},t.uint32(42).fork()).join()}),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=z();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.toolCallId=r.string();continue;case 2:if(18!==e)break;i.toolName=r.string();continue;case 3:if(26!==e)break;i.resultJson=r.string();continue;case 4:if(32!==e)break;i.isError=r.bool();continue;case 5:{if(42!==e)break;let t=Y.decode(r,r.uint32());void 0!==t.value&&(i.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({toolCallId:Z(e.toolCallId)?W.String(e.toolCallId):"",toolName:Z(e.toolName)?W.String(e.toolName):"",resultJson:Z(e.resultJson)?W.String(e.resultJson):"",isError:Z(e.isError)?W.Boolean(e.isError):void 0,providerOptions:Q(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),""!==e.resultJson&&(t.resultJson=e.resultJson),void 0!==e.isError&&(t.isError=e.isError),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>X.fromPartial(e??{}),fromPartial(e){let t=z();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.resultJson=e.resultJson??"",t.isError=e.isError??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function q(){return{key:"",value:""}}let Y={encode:(e,t=new o.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=q();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.key=r.string();continue;case 2:if(18!==e)break;i.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({key:Z(e.key)?W.String(e.key):"",value:Z(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>Y.fromPartial(e??{}),fromPartial(e){let t=q();return t.key=e.key??"",t.value=e.value??"",t}},W=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function Q(e){return"object"==typeof e&&null!==e}function Z(e){return null!=e}let ee={encode:(e,t=new o.fI)=>(""!==e.foo&&t.uint32(10).string(e.foo),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i={foo:""};for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.foo=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({foo:eD(e.foo)?eF.String(e.foo):""}),toJSON(e){let t={};return""!==e.foo&&(t.foo=e.foo),t},create:e=>ee.fromPartial(e??{}),fromPartial(e){let t={foo:""};return t.foo=e.foo??"",t}};function et(){return{requestUuid:""}}let er={encode:(e,t=new o.fI)=>(""!==e.requestUuid&&t.uint32(10).string(e.requestUuid),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=et();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.requestUuid=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({requestUuid:eD(e.requestUuid)?eF.String(e.requestUuid):""}),toJSON(e){let t={};return""!==e.requestUuid&&(t.requestUuid=e.requestUuid),t},create:e=>er.fromPartial(e??{}),fromPartial(e){let t=et();return t.requestUuid=e.requestUuid??"",t}};function eo(){return{text:"",textMode:""}}let en={encode:(e,t=new o.fI)=>(""!==e.text&&t.uint32(10).string(e.text),""!==e.textMode&&t.uint32(18).string(e.textMode),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eo();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.text=r.string();continue;case 2:if(18!==e)break;i.textMode=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({text:eD(e.text)?eF.String(e.text):"",textMode:eD(e.textMode)?eF.String(e.textMode):""}),toJSON(e){let t={};return""!==e.text&&(t.text=e.text),""!==e.textMode&&(t.textMode=e.textMode),t},create:e=>en.fromPartial(e??{}),fromPartial(e){let t=eo();return t.text=e.text??"",t.textMode=e.textMode??"",t}};function ei(){return{code:"",codeFilePath:""}}let ea={encode:(e,t=new o.fI)=>(""!==e.code&&t.uint32(10).string(e.code),""!==e.codeFilePath&&t.uint32(18).string(e.codeFilePath),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=ei();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.code=r.string();continue;case 2:if(18!==e)break;i.codeFilePath=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({code:eD(e.code)?eF.String(e.code):"",codeFilePath:eD(e.codeFilePath)?eF.String(e.codeFilePath):""}),toJSON(e){let t={};return""!==e.code&&(t.code=e.code),""!==e.codeFilePath&&(t.codeFilePath=e.codeFilePath),t},create:e=>ea.fromPartial(e??{}),fromPartial(e){let t=ei();return t.code=e.code??"",t.codeFilePath=e.codeFilePath??"",t}};function es(){return{modelConfigVersion:""}}let el={encode:(e,t=new o.fI)=>(""!==e.modelConfigVersion&&t.uint32(10).string(e.modelConfigVersion),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=es();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.modelConfigVersion=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({modelConfigVersion:eD(e.modelConfigVersion)?eF.String(e.modelConfigVersion):""}),toJSON(e){let t={};return""!==e.modelConfigVersion&&(t.modelConfigVersion=e.modelConfigVersion),t},create:e=>el.fromPartial(e??{}),fromPartial(e){let t=es();return t.modelConfigVersion=e.modelConfigVersion??"",t}};function ec(){return{title:""}}let ed={encode:(e,t=new o.fI)=>(""!==e.title&&t.uint32(10).string(e.title),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=ec();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.title=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({title:eD(e.title)?eF.String(e.title):""}),toJSON(e){let t={};return""!==e.title&&(t.title=e.title),t},create:e=>ed.fromPartial(e??{}),fromPartial(e){let t=ec();return t.title=e.title??"",t}};function eu(){return{providerMetadataJson:""}}let ef={encode:(e,t=new o.fI)=>(""!==e.providerMetadataJson&&t.uint32(10).string(e.providerMetadataJson),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eu();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.providerMetadataJson=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({providerMetadataJson:eD(e.providerMetadataJson)?eF.String(e.providerMetadataJson):""}),toJSON(e){let t={};return""!==e.providerMetadataJson&&(t.providerMetadataJson=e.providerMetadataJson),t},create:e=>ef.fromPartial(e??{}),fromPartial(e){let t=eu();return t.providerMetadataJson=e.providerMetadataJson??"",t}},ep={encode:(e,t=new o.fI)=>t,decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t;for(;r.pos<n;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>ep.fromPartial(e??{}),fromPartial:e=>({})},eh={encode:(e,t=new o.fI)=>t,decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t;for(;r.pos<n;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>eh.fromPartial(e??{}),fromPartial:e=>({})};function eg(){return{codeSnapshotKey:""}}let em={encode:(e,t=new o.fI)=>(""!==e.codeSnapshotKey&&t.uint32(10).string(e.codeSnapshotKey),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eg();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.codeSnapshotKey=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({codeSnapshotKey:eD(e.codeSnapshotKey)?eF.String(e.codeSnapshotKey):""}),toJSON(e){let t={};return""!==e.codeSnapshotKey&&(t.codeSnapshotKey=e.codeSnapshotKey),t},create:e=>em.fromPartial(e??{}),fromPartial(e){let t=eg();return t.codeSnapshotKey=e.codeSnapshotKey??"",t}},ev={encode:(e,t=new o.fI)=>t,decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t;for(;r.pos<n;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>ev.fromPartial(e??{}),fromPartial:e=>({})};function ey(){return{errors:[]}}let ek={encode(e,t=new o.fI){for(let r of e.errors)t.uint32(10).string(r);return t},decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=ey();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.errors.push(r.string());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({errors:eF.Array.isArray(e?.errors)?e.errors.map(e=>eF.String(e)):[]}),toJSON(e){let t={};return e.errors?.length&&(t.errors=e.errors),t},create:e=>ek.fromPartial(e??{}),fromPartial(e){let t=ey();return t.errors=e.errors?.map(e=>e)||[],t}};function eb(){return{libraryKeys:[]}}let eS={encode(e,t=new o.fI){for(let r of e.libraryKeys)t.uint32(10).string(r);return t},decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eb();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.libraryKeys.push(r.string());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({libraryKeys:eF.Array.isArray(e?.libraryKeys)?e.libraryKeys.map(e=>eF.String(e)):[]}),toJSON(e){let t={};return e.libraryKeys?.length&&(t.libraryKeys=e.libraryKeys),t},create:e=>eS.fromPartial(e??{}),fromPartial(e){let t=eb();return t.libraryKeys=e.libraryKeys?.map(e=>e)||[],t}};function ex(){return{filePath:"",snippetStartLine:0,tagLine:0,tagName:""}}let eO={encode:(e,t=new o.fI)=>(""!==e.filePath&&t.uint32(10).string(e.filePath),0!==e.snippetStartLine&&t.uint32(16).int32(e.snippetStartLine),0!==e.tagLine&&t.uint32(24).int32(e.tagLine),""!==e.tagName&&t.uint32(34).string(e.tagName),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=ex();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.filePath=r.string();continue;case 2:if(16!==e)break;i.snippetStartLine=r.int32();continue;case 3:if(24!==e)break;i.tagLine=r.int32();continue;case 4:if(34!==e)break;i.tagName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({filePath:eD(e.filePath)?eF.String(e.filePath):"",snippetStartLine:eD(e.snippetStartLine)?eF.Number(e.snippetStartLine):0,tagLine:eD(e.tagLine)?eF.Number(e.tagLine):0,tagName:eD(e.tagName)?eF.String(e.tagName):""}),toJSON(e){let t={};return""!==e.filePath&&(t.filePath=e.filePath),0!==e.snippetStartLine&&(t.snippetStartLine=Math.round(e.snippetStartLine)),0!==e.tagLine&&(t.tagLine=Math.round(e.tagLine)),""!==e.tagName&&(t.tagName=e.tagName),t},create:e=>eO.fromPartial(e??{}),fromPartial(e){let t=ex();return t.filePath=e.filePath??"",t.snippetStartLine=e.snippetStartLine??0,t.tagLine=e.tagLine??0,t.tagName=e.tagName??"",t}};function eN(){return{filePath:"",tagName:""}}let ew={encode:(e,t=new o.fI)=>(""!==e.filePath&&t.uint32(10).string(e.filePath),""!==e.tagName&&t.uint32(18).string(e.tagName),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eN();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.filePath=r.string();continue;case 2:if(18!==e)break;i.tagName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({filePath:eD(e.filePath)?eF.String(e.filePath):"",tagName:eD(e.tagName)?eF.String(e.tagName):""}),toJSON(e){let t={};return""!==e.filePath&&(t.filePath=e.filePath),""!==e.tagName&&(t.tagName=e.tagName),t},create:e=>ew.fromPartial(e??{}),fromPartial(e){let t=eN();return t.filePath=e.filePath??"",t.tagName=e.tagName??"",t}};function eC(){return{origin:""}}let ej={encode:(e,t=new o.fI)=>(""!==e.origin&&t.uint32(10).string(e.origin),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eC();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.origin=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({origin:eD(e.origin)?eF.String(e.origin):""}),toJSON(e){let t={};return""!==e.origin&&(t.origin=e.origin),t},create:e=>ej.fromPartial(e??{}),fromPartial(e){let t=eC();return t.origin=e.origin??"",t}};function eI(){return{toolCallId:"",toolName:"",resultJson:""}}let eP={encode:(e,t=new o.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),""!==e.resultJson&&t.uint32(26).string(e.resultJson),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eI();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.toolCallId=r.string();continue;case 2:if(18!==e)break;i.toolName=r.string();continue;case 3:if(26!==e)break;i.resultJson=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({toolCallId:eD(e.toolCallId)?eF.String(e.toolCallId):"",toolName:eD(e.toolName)?eF.String(e.toolName):"",resultJson:eD(e.resultJson)?eF.String(e.resultJson):""}),toJSON(e){let t={};return""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),""!==e.resultJson&&(t.resultJson=e.resultJson),t},create:e=>eP.fromPartial(e??{}),fromPartial(e){let t=eI();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.resultJson=e.resultJson??"",t}};function eJ(){return{changedFilesJson:"",title:"",legacyS3CodeSnapshotKey:void 0}}let eE={encode:(e,t=new o.fI)=>(""!==e.changedFilesJson&&t.uint32(10).string(e.changedFilesJson),""!==e.title&&t.uint32(18).string(e.title),void 0!==e.legacyS3CodeSnapshotKey&&t.uint32(26).string(e.legacyS3CodeSnapshotKey),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eJ();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.changedFilesJson=r.string();continue;case 2:if(18!==e)break;i.title=r.string();continue;case 3:if(26!==e)break;i.legacyS3CodeSnapshotKey=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({changedFilesJson:eD(e.changedFilesJson)?eF.String(e.changedFilesJson):"",title:eD(e.title)?eF.String(e.title):"",legacyS3CodeSnapshotKey:eD(e.legacyS3CodeSnapshotKey)?eF.String(e.legacyS3CodeSnapshotKey):void 0}),toJSON(e){let t={};return""!==e.changedFilesJson&&(t.changedFilesJson=e.changedFilesJson),""!==e.title&&(t.title=e.title),void 0!==e.legacyS3CodeSnapshotKey&&(t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey),t},create:e=>eE.fromPartial(e??{}),fromPartial(e){let t=eJ();return t.changedFilesJson=e.changedFilesJson??"",t.title=e.title??"",t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey??void 0,t}};function eT(){return{plainText:"",fileKeyHash:""}}let eK={encode:(e,t=new o.fI)=>(""!==e.plainText&&t.uint32(10).string(e.plainText),""!==e.fileKeyHash&&t.uint32(18).string(e.fileKeyHash),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eT();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.plainText=r.string();continue;case 2:if(18!==e)break;i.fileKeyHash=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({plainText:eD(e.plainText)?eF.String(e.plainText):"",fileKeyHash:eD(e.fileKeyHash)?eF.String(e.fileKeyHash):""}),toJSON(e){let t={};return""!==e.plainText&&(t.plainText=e.plainText),""!==e.fileKeyHash&&(t.fileKeyHash=e.fileKeyHash),t},create:e=>eK.fromPartial(e??{}),fromPartial(e){let t=eT();return t.plainText=e.plainText??"",t.fileKeyHash=e.fileKeyHash??"",t}};function eV(){return{userId:"",timestamp:""}}let eM={encode:(e,t=new o.fI)=>(""!==e.userId&&t.uint32(10).string(e.userId),""!==e.timestamp&&t.uint32(18).string(e.timestamp),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=eV();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.userId=r.string();continue;case 2:if(18!==e)break;i.timestamp=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({userId:eD(e.userId)?eF.String(e.userId):"",timestamp:eD(e.timestamp)?eF.String(e.timestamp):""}),toJSON(e){let t={};return""!==e.userId&&(t.userId=e.userId),""!==e.timestamp&&(t.timestamp=e.timestamp),t},create:e=>eM.fromPartial(e??{}),fromPartial(e){let t=eV();return t.userId=e.userId??"",t.timestamp=e.timestamp??"",t}};function e_(){return{title:"",legacyS3CodeSnapshotKey:void 0,blobstoreContentKey:void 0}}let eA={encode:(e,t=new o.fI)=>(""!==e.title&&t.uint32(10).string(e.title),void 0!==e.legacyS3CodeSnapshotKey&&t.uint32(18).string(e.legacyS3CodeSnapshotKey),void 0!==e.blobstoreContentKey&&t.uint32(26).string(e.blobstoreContentKey),t),decode(e,t){let r=e instanceof o.V5?e:new o.V5(e),n=void 0===t?r.len:r.pos+t,i=e_();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;i.title=r.string();continue;case 2:if(18!==e)break;i.legacyS3CodeSnapshotKey=r.string();continue;case 3:if(26!==e)break;i.blobstoreContentKey=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return i},fromJSON:e=>({title:eD(e.title)?eF.String(e.title):"",legacyS3CodeSnapshotKey:eD(e.legacyS3CodeSnapshotKey)?eF.String(e.legacyS3CodeSnapshotKey):void 0,blobstoreContentKey:eD(e.blobstoreContentKey)?eF.String(e.blobstoreContentKey):void 0}),toJSON(e){let t={};return""!==e.title&&(t.title=e.title),void 0!==e.legacyS3CodeSnapshotKey&&(t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey),void 0!==e.blobstoreContentKey&&(t.blobstoreContentKey=e.blobstoreContentKey),t},create:e=>eA.fromPartial(e??{}),fromPartial(e){let t=e_();return t.title=e.title??"",t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey??void 0,t.blobstoreContentKey=e.blobstoreContentKey??void 0,t}},eF=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function eD(e){return null!=e}let e$=["selected-node-ids","text","text-ref","image-ref","reasoning","reasoning-ref","redacted-reasoning","redacted-reasoning-ref","tool-call-ref","tool-result-ref","tool-call-json-DO-NOT-USE-IN-PROD","tool-result-json-DO-NOT-USE-IN-PROD","figmake-test-part","cortex-request-uuid","code-chat-assistant-text","code-chat-assistant-code","code-chat-model-config-version","code-chat-assistant-title","code-chat-provider-metadata","code-chat-code-import-ref","code-chat-image-import-ref","code-chat-legacy-s3-code-snapshot","code-chat-code-snapshot","code-chat-errors","code-chat-library-keys","code-chat-inspected-element-ref","code-chat-inspected-component","code-chat-origin","code-chat-legacy-assistant-tool-result","code-chat-manual-edit","code-chat-duplicated-file","code-chat-deleted-chat-history","code-chat-snapshot-restore"],eL={"selected-node-ids":i,text:l,"text-ref":f,"image-ref":m,reasoning:b,"reasoning-ref":N,"redacted-reasoning":I,"redacted-reasoning-ref":T,"tool-call-ref":_,"tool-result-ref":$,"tool-call-json-DO-NOT-USE-IN-PROD":B,"tool-result-json-DO-NOT-USE-IN-PROD":X,"figmake-test-part":ee,"cortex-request-uuid":er,"code-chat-assistant-text":en,"code-chat-assistant-code":ea,"code-chat-model-config-version":el,"code-chat-assistant-title":ed,"code-chat-provider-metadata":ef,"code-chat-code-import-ref":ep,"code-chat-image-import-ref":eh,"code-chat-legacy-s3-code-snapshot":em,"code-chat-code-snapshot":ev,"code-chat-errors":ek,"code-chat-library-keys":eS,"code-chat-inspected-element-ref":eO,"code-chat-inspected-component":ew,"code-chat-origin":ej,"code-chat-legacy-assistant-tool-result":eP,"code-chat-manual-edit":eE,"code-chat-duplicated-file":eK,"code-chat-deleted-chat-history":eM,"code-chat-snapshot-restore":eA}},370012:(e,t,r)=>{r.d(t,{N:()=>d,t:()=>c});var o=r(400045),n=r(723584),i=r(472846),a=r(405242),s=r(839903);if(443==r.j)var l=r(951002);function c(e){let t=structuredClone(e);switch(t.type){case"text":case"reasoning":case"redacted-reasoning":return{...t,providerOptions:{}};case"selected-node-ids":case"cortex-request-uuid":case"code-chat-assistant-code":case"code-chat-assistant-text":case"code-chat-assistant-title":case"code-chat-model-config-version":case"code-chat-legacy-s3-code-snapshot":case"code-chat-errors":case"code-chat-library-keys":case"code-chat-origin":case"code-chat-legacy-assistant-tool-result":case"code-chat-snapshot-restore":return t;case"tool-call":{let{toolCallId:e,toolName:r,argsJSON:o}=t;return{type:"tool-call-json-DO-NOT-USE-IN-PROD",toolCallId:e,toolName:r,argsJson:o,providerOptions:{}}}case"tool-result":{let{toolCallId:e,toolName:r,resultJSON:o,isError:n}=t;return{type:"tool-result-json-DO-NOT-USE-IN-PROD",toolCallId:e,toolName:r,resultJson:o,isError:n,providerOptions:{}}}case"tool-result-ref":{let{toolCallId:e,toolName:r,blobstoreContentKey:o,isError:n}=t;return{type:"tool-result-ref",toolCallId:e,toolName:r,isError:n,providerOptions:{}}}case"code-chat-provider-metadata":return{type:"code-chat-provider-metadata",providerMetadataJson:JSON.stringify(t.providerMetadata)};case"code-chat-code-import-ref":case"code-chat-image-import-ref":case"code-chat-code-snapshot":return{type:t.type};case"code-chat-inspected-element-ref":{let{blobstoreContentKey:e,...r}=t;return r}case"code-chat-inspected-component":return{type:t.type,filePath:t.filePath,tagName:t.tagName};case"code-chat-manual-edit":return{type:t.type,changedFilesJson:JSON.stringify(t.changedFiles),title:t.title,legacyS3CodeSnapshotKey:t.legacyS3CodeSnapshotKey};case"code-chat-duplicated-file":return{type:t.type,plainText:t.plainText,fileKeyHash:t.fileKeyHash};case"code-chat-deleted-chat-history":return{type:t.type,timestamp:t.timestamp,userId:t.userId??""};case"image":case"jsx":throw new o.T(`Not implemented: Conversion from part type ${t.type} to protobuf not implemented`);default:(0,l.xb)(t)}}function d({type:e,contentJson:t,blobstoreContentKey:r}){if(!(0,a.pQ)(e))throw new o.T(`Unknown message part type: ${e}`);let c=i.l[e].fromJSON(t),d={type:e,...c};switch(d.type){case"text":case"reasoning":case"redacted-reasoning":case"selected-node-ids":case"cortex-request-uuid":case"code-chat-assistant-code":case"code-chat-assistant-title":case"code-chat-model-config-version":case"code-chat-legacy-s3-code-snapshot":case"code-chat-errors":case"code-chat-library-keys":case"code-chat-legacy-assistant-tool-result":case"code-chat-snapshot-restore":case"code-chat-duplicated-file":case"code-chat-deleted-chat-history":return d;case"code-chat-manual-edit":{let e;let{title:t,changedFilesJson:r,legacyS3CodeSnapshotKey:i}=c;try{let t=JSON.parse(r);e=n.Op.shape.changedFiles.parse(t)}catch(t){let e=t instanceof Error?t.message:String(t);throw new o.T(`Invalid changedFiles for code-chat-manual-edit: ${e}`)}return{type:"code-chat-manual-edit",changedFiles:e,title:t,legacyS3CodeSnapshotKey:i,blobstoreContentKey:void 0}}case"code-chat-origin":{let{origin:e}=c,t=n.Iw.shape.origin.safeParse(e);if(!t.success)throw new o.T(`Invalid origin for code-chat-origin: ${e}`);return{type:"code-chat-origin",origin:t.data}}case"tool-call-json-DO-NOT-USE-IN-PROD":{let{toolCallId:e,toolName:t,argsJson:r}=c;return{type:"tool-call",toolCallId:e,toolName:t,argsJSON:r}}case"tool-result-json-DO-NOT-USE-IN-PROD":{let{toolCallId:e,toolName:t,resultJson:r,isError:o}=c;return{type:"tool-result",toolCallId:e,toolName:t,resultJSON:r,isError:o}}case"tool-result-ref":{if(!r)throw new o.T("Blobstore content key is required for tool-result-ref");let{toolCallId:e,toolName:t,isError:n}=c;return{type:"tool-result-ref",toolCallId:e,toolName:t,isError:n,blobstoreContentKey:r}}case"code-chat-assistant-text":{let{text:e,textMode:t}=c,r=s.w_.safeParse(t);if(!r.success)throw new o.T(`Invalid textMode for code-chat-assistant-text: ${t}`);if("code"===r.data)throw new o.T("Code mode messages should be represented by code-chat-assistant-code, not code-chat-assistant-text");return{type:"code-chat-assistant-text",text:e,textMode:r.data}}case"code-chat-provider-metadata":return{type:"code-chat-provider-metadata",providerMetadata:JSON.parse(c.providerMetadataJson)};case"code-chat-code-snapshot":if(!r)throw new o.T("Blobstore content key is required for code-chat-code-snapshot");return{type:"code-chat-code-snapshot",blobstoreContentKey:r};case"code-chat-image-import-ref":if(!r)throw new o.T("Blobstore content key is required for code-chat-image-import-ref");return{type:"code-chat-image-import-ref",blobstoreContentKey:r};case"code-chat-code-import-ref":if(!r)throw new o.T("Blobstore content key is required for code-chat-code-import-ref");return{type:"code-chat-code-import-ref",blobstoreContentKey:r};case"code-chat-inspected-element-ref":{if(!r)throw new o.T("Blobstore content key is required for code-chat-inspected-element-ref");let{filePath:e,snippetStartLine:t,tagLine:n,tagName:i}=c;return{type:"code-chat-inspected-element-ref",filePath:e,snippetStartLine:t,tagLine:n,tagName:i,blobstoreContentKey:r}}case"code-chat-inspected-component":{let{filePath:e,tagName:t}=c;return{type:"code-chat-inspected-component",filePath:e,tagName:t}}case"text-ref":case"image-ref":case"reasoning-ref":case"redacted-reasoning-ref":case"tool-call-ref":case"figmake-test-part":throw new o.T(`Not implemented: Conversion from pb MessagePart type ${d.type} to AnyPart not implemented`);default:(0,l.xb)(d)}}}}]);

//# debugId=b2e32ac7-05d2-5880-af5e-006e1aa4fe2d

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/787e18c6d20c5a50997e9d8c53f21a00403994c3/297-db90cd904a72aa84.min.js.map