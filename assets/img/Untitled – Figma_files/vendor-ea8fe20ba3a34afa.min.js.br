
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="b29ef061-e470-52d7-91f9-35a342bb438d")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[7305],{365147:(e,t,r)=>{let a=r(895770),i=r(61286).p,s=r(232877).p,n=r(85217),o=r(339043).Base64,l=new n(o.toUint8Array(i)),c=new n(o.toUint8Array(s)),d={Initial:0,ExtendOrZWJ:1,NotBoundary:2};e.exports=function(e){let t=[],r=[0],i=[];for(let t=0;t<e.length;){let a=e.codePointAt(t);i.push(l.get(a)|c.get(a)),t+=a>65535?2:1,r.push(t)}for(let s=0;s<i.length;){let n=function(e,t){let r=e.length,i=0,s=d.Initial;for(let n=t;n+1<r;n++){let r=e[n+0],o=e[n+1];switch((r&a.Regional_Indicator)!=0||(i=0),s){case d.NotBoundary:case d.Initial:s=(r&a.Extended_Pictographic)!=0?d.ExtendOrZWJ:d.Initial;break;case d.ExtendOrZWJ:s=(r&a.Extend)!=0?d.ExtendOrZWJ:(r&a.ZWJ)!=0&&(o&a.Extended_Pictographic)!=0?d.NotBoundary:d.Initial}if((r&a.CR)==0||(o&a.LF)==0){if((r&(a.Control|a.CR|a.LF))!=0||(o&(a.Control|a.CR|a.LF))!=0)return n+1-t;if(((r&a.L)==0||(o&(a.L|a.V|a.LV|a.LVT))==0)&&((r&(a.LV|a.V))==0||(o&(a.V|a.T))==0)&&((r&(a.LVT|a.T))==0||(o&a.T)==0)&&(o&(a.Extend|a.ZWJ))==0&&(o&a.SpacingMark)==0&&(r&a.Prepend)==0&&s!==d.NotBoundary){if((r&a.Regional_Indicator)!=0&&(o&a.Regional_Indicator)!=0&&i%2==0){i++;continue}return n+1-t}}}return r-t}(i,s),o=r[s],l=r[s+n];t.push(e.slice(o,l)),s+=n}return t}},895770:e=>{e.exports={Other:0,CR:1,LF:2,Control:4,Extend:8,ZWJ:16,Regional_Indicator:32,Prepend:64,SpacingMark:128,L:256,V:512,T:1024,LV:2048,LVT:4096,Extended_Pictographic:8192}},339043:function(e,t,r){var a;"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g&&r.g,a=function(){"use strict";var e,t="3.7.7",r="function"==typeof Buffer,a="function"==typeof TextDecoder?new TextDecoder:void 0,i="function"==typeof TextEncoder?new TextEncoder:void 0,s=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),n=(e={},s.forEach(function(t,r){return e[t]=r}),e),o=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,l=String.fromCharCode.bind(String),c="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(e){return new Uint8Array(Array.prototype.slice.call(e,0))},d=function(e){return e.replace(/=/g,"").replace(/[+\/]/g,function(e){return"+"==e?"-":"_"})},u=function(e){return e.replace(/[^A-Za-z0-9\+\/]/g,"")},h=function(e){for(var t,r,a,i,n="",o=e.length%3,l=0;l<e.length;){if((r=e.charCodeAt(l++))>255||(a=e.charCodeAt(l++))>255||(i=e.charCodeAt(l++))>255)throw TypeError("invalid character found");n+=s[(t=r<<16|a<<8|i)>>18&63]+s[t>>12&63]+s[t>>6&63]+s[63&t]}return o?n.slice(0,o-3)+"===".substring(o):n},m="function"==typeof btoa?function(e){return btoa(e)}:r?function(e){return Buffer.from(e,"binary").toString("base64")}:h,f=r?function(e){return Buffer.from(e).toString("base64")}:function(e){for(var t=[],r=0,a=e.length;r<a;r+=4096)t.push(l.apply(null,e.subarray(r,r+4096)));return m(t.join(""))},p=function(e,t){return void 0===t&&(t=!1),t?d(f(e)):f(e)},g=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?l(192|t>>>6)+l(128|63&t):l(224|t>>>12&15)+l(128|t>>>6&63)+l(128|63&t)}var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return l(240|t>>>18&7)+l(128|t>>>12&63)+l(128|t>>>6&63)+l(128|63&t)},k=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,b=function(e){return e.replace(k,g)},y=r?function(e){return Buffer.from(e,"utf8").toString("base64")}:i?function(e){return f(i.encode(e))}:function(e){return m(b(e))},w=function(e,t){return void 0===t&&(t=!1),t?d(y(e)):y(e)},T=function(e){return w(e,!0)},C=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,S=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return l((t>>>10)+55296)+l((1023&t)+56320);case 3:return l((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return l((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},v=function(e){return e.replace(C,S)},x=function(e){if(e=e.replace(/\s+/g,""),!o.test(e))throw TypeError("malformed base64.");e+="==".slice(2-(3&e.length));for(var t,r,a,i="",s=0;s<e.length;)t=n[e.charAt(s++)]<<18|n[e.charAt(s++)]<<12|(r=n[e.charAt(s++)])<<6|(a=n[e.charAt(s++)]),i+=64===r?l(t>>16&255):64===a?l(t>>16&255,t>>8&255):l(t>>16&255,t>>8&255,255&t);return i},A="function"==typeof atob?function(e){return atob(u(e))}:r?function(e){return Buffer.from(e,"base64").toString("binary")}:x,E=r?function(e){return c(Buffer.from(e,"base64"))}:function(e){return c(A(e).split("").map(function(e){return e.charCodeAt(0)}))},I=function(e){return E(_(e))},P=r?function(e){return Buffer.from(e,"base64").toString("utf8")}:a?function(e){return a.decode(E(e))}:function(e){return v(A(e))},_=function(e){return u(e.replace(/[-_]/g,function(e){return"-"==e?"+":"/"}))},R=function(e){return P(_(e))},B=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}},M=function(){var e=function(e,t){return Object.defineProperty(String.prototype,e,B(t))};e("fromBase64",function(){return R(this)}),e("toBase64",function(e){return w(this,e)}),e("toBase64URI",function(){return w(this,!0)}),e("toBase64URL",function(){return w(this,!0)}),e("toUint8Array",function(){return I(this)})},F=function(){var e=function(e,t){return Object.defineProperty(Uint8Array.prototype,e,B(t))};e("toBase64",function(e){return p(this,e)}),e("toBase64URI",function(){return p(this,!0)}),e("toBase64URL",function(){return p(this,!0)})},U={version:t,VERSION:t,atob:A,atobPolyfill:x,btoa:m,btoaPolyfill:h,fromBase64:R,toBase64:w,encode:w,encodeURI:T,encodeURL:T,utob:b,btou:v,decode:R,isValid:function(e){if("string"!=typeof e)return!1;var t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},fromUint8Array:p,toUint8Array:I,extendString:M,extendUint8Array:F,extendBuiltins:function(){M(),F()}};return U.Base64={},Object.keys(U).forEach(function(e){return U.Base64[e]=U[e]}),U},e.exports=a()},403046:(e,t,r)=>{var a=r(98392),i=r(947285)(function(e,t,r,i){a(e,t,r,i)});e.exports=i},528258:(e,t,r)=>{var a=r(528816),i=Object.prototype.hasOwnProperty,s="undefined"!=typeof Map;function n(){this._array=[],this._set=s?new Map:Object.create(null)}n.fromArray=function(e,t){for(var r=new n,a=0,i=e.length;a<i;a++)r.add(e[a],t);return r},n.prototype.size=function(){return s?this._set.size:Object.getOwnPropertyNames(this._set).length},n.prototype.add=function(e,t){var r=s?e:a.toSetString(e),n=s?this.has(e):i.call(this._set,r),o=this._array.length;(!n||t)&&this._array.push(e),n||(s?this._set.set(e,o):this._set[r]=o)},n.prototype.has=function(e){if(s)return this._set.has(e);var t=a.toSetString(e);return i.call(this._set,t)},n.prototype.indexOf=function(e){if(s){var t=this._set.get(e);if(t>=0)return t}else{var r=a.toSetString(e);if(i.call(this._set,r))return this._set[r]}throw Error('"'+e+'" is not in the set.')},n.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw Error("No element indexed by "+e)},n.prototype.toArray=function(){return this._array.slice()},t.C=n},941931:(e,t,r)=>{var a=r(606951);t.encode=function(e){var t,r="",i=e<0?(-e<<1)+1:(e<<1)+0;do t=31&i,(i>>>=5)>0&&(t|=32),r+=a.encode(t);while(i>0)return r},t.decode=function(e,t,r){var i,s,n,o,l=e.length,c=0,d=0;do{if(t>=l)throw Error("Expected more digits in base 64 VLQ value.");if(-1===(o=a.decode(e.charCodeAt(t++))))throw Error("Invalid base64 digit: "+e.charAt(t-1));n=!!(32&o),o&=31,c+=o<<d,d+=5}while(n)r.value=(s=(i=c)>>1,(1&i)==1?-s:s),r.rest=t}},606951:(e,t)=>{var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<r.length)return r[e];throw TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},791490:(e,t)=>{t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,r,a,i){if(0===r.length)return -1;var s=function e(r,a,i,s,n,o){var l=Math.floor((a-r)/2)+r,c=n(i,s[l],!0);return 0===c?l:c>0?a-l>1?e(l,a,i,s,n,o):o==t.LEAST_UPPER_BOUND?a<s.length?a:-1:l:l-r>1?e(r,l,i,s,n,o):o==t.LEAST_UPPER_BOUND?l:r<0?-1:r}(-1,r.length,e,r,a,i||t.GREATEST_LOWER_BOUND);if(s<0)return -1;for(;s-1>=0&&0===a(r[s],r[s-1],!0);)--s;return s}},571801:(e,t,r)=>{var a=r(528816);function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){var t,r,i,s,n;(r=(t=this._last).generatedLine,i=e.generatedLine,s=t.generatedColumn,n=e.generatedColumn,i>r||i==r&&n>=s||0>=a.compareByGeneratedPositionsInflated(t,e))?this._last=e:this._sorted=!1,this._array.push(e)},i.prototype.toArray=function(){return this._sorted||(this._array.sort(a.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.P=i},274794:(e,t)=>{function r(e,t,r){var a=e[t];e[t]=e[r],e[r]=a}t.g=function(e,t){!function e(t,a,i,s){if(i<s){var n=Math.round(i+Math.random()*(s-i)),o=i-1;r(t,n,s);for(var l=t[s],c=i;c<s;c++)0>=a(t[c],l)&&r(t,o+=1,c);r(t,o+1,c);var d=o+1;e(t,a,i,d-1),e(t,a,d+1,s)}}(e,t,0,e.length-1)}},555471:(e,t,r)=>{var a=r(528816),i=r(791490),s=r(528258).C,n=r(941931),o=r(274794).g;function l(e,t){var r=e;return"string"==typeof e&&(r=a.parseSourceMapInput(e)),null!=r.sections?new u(r,t):new c(r,t)}function c(e,t){var r=e;"string"==typeof e&&(r=a.parseSourceMapInput(e));var i=a.getArg(r,"version"),n=a.getArg(r,"sources"),o=a.getArg(r,"names",[]),l=a.getArg(r,"sourceRoot",null),c=a.getArg(r,"sourcesContent",null),d=a.getArg(r,"mappings"),u=a.getArg(r,"file",null);if(i!=this._version)throw Error("Unsupported version: "+i);l&&(l=a.normalize(l)),n=n.map(String).map(a.normalize).map(function(e){return l&&a.isAbsolute(l)&&a.isAbsolute(e)?a.relative(l,e):e}),this._names=s.fromArray(o.map(String),!0),this._sources=s.fromArray(n,!0),this._absoluteSources=this._sources.toArray().map(function(e){return a.computeSourceURL(l,e,t)}),this.sourceRoot=l,this.sourcesContent=c,this._mappings=d,this._sourceMapURL=t,this.file=u}function d(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function u(e,t){var r=e;"string"==typeof e&&(r=a.parseSourceMapInput(e));var i=a.getArg(r,"version"),n=a.getArg(r,"sections");if(i!=this._version)throw Error("Unsupported version: "+i);this._sources=new s,this._names=new s;var o={line:-1,column:0};this._sections=n.map(function(e){if(e.url)throw Error("Support for url field in sections not implemented.");var r=a.getArg(e,"offset"),i=a.getArg(r,"line"),s=a.getArg(r,"column");if(i<o.line||i===o.line&&s<o.column)throw Error("Section offsets must be ordered and non-overlapping.");return o=r,{generatedOffset:{generatedLine:i+1,generatedColumn:s+1},consumer:new l(a.getArg(e,"map"),t)}})}l.fromSourceMap=function(e,t){return c.fromSourceMap(e,t)},l.prototype._version=3,l.prototype.__generatedMappings=null,Object.defineProperty(l.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),l.prototype.__originalMappings=null,Object.defineProperty(l.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),l.prototype._charIsMappingSeparator=function(e,t){var r=e.charAt(t);return";"===r||","===r},l.prototype._parseMappings=function(e,t){throw Error("Subclasses must implement _parseMappings")},l.GENERATED_ORDER=1,l.ORIGINAL_ORDER=2,l.GREATEST_LOWER_BOUND=1,l.LEAST_UPPER_BOUND=2,l.prototype.eachMapping=function(e,t,r){switch(r||l.GENERATED_ORDER){case l.GENERATED_ORDER:i=this._generatedMappings;break;case l.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw Error("Unknown order of iteration.")}var i,s=this.sourceRoot;i.map(function(e){var t=null===e.source?null:this._sources.at(e.source);return{source:t=a.computeSourceURL(s,t,this._sourceMapURL),generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}},this).forEach(e,t||null)},l.prototype.allGeneratedPositionsFor=function(e){var t=a.getArg(e,"line"),r={source:a.getArg(e,"source"),originalLine:t,originalColumn:a.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];var s=[],n=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(n>=0){var o=this._originalMappings[n];if(void 0===e.column)for(var l=o.originalLine;o&&o.originalLine===l;)s.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++n];else for(var c=o.originalColumn;o&&o.originalLine===t&&o.originalColumn==c;)s.push({line:a.getArg(o,"generatedLine",null),column:a.getArg(o,"generatedColumn",null),lastColumn:a.getArg(o,"lastGeneratedColumn",null)}),o=this._originalMappings[++n]}return s},t.SourceMapConsumer=l,c.prototype=Object.create(l.prototype),c.prototype.consumer=l,c.prototype._findSourceIndex=function(e){var t,r=e;if(null!=this.sourceRoot&&(r=a.relative(this.sourceRoot,r)),this._sources.has(r))return this._sources.indexOf(r);for(t=0;t<this._absoluteSources.length;++t)if(this._absoluteSources[t]==e)return t;return -1},c.fromSourceMap=function(e,t){var r=Object.create(c.prototype),i=r._names=s.fromArray(e._names.toArray(),!0),n=r._sources=s.fromArray(e._sources.toArray(),!0);r.sourceRoot=e._sourceRoot,r.sourcesContent=e._generateSourcesContent(r._sources.toArray(),r.sourceRoot),r.file=e._file,r._sourceMapURL=t,r._absoluteSources=r._sources.toArray().map(function(e){return a.computeSourceURL(r.sourceRoot,e,t)});for(var l=e._mappings.toArray().slice(),u=r.__generatedMappings=[],h=r.__originalMappings=[],m=0,f=l.length;m<f;m++){var p=l[m],g=new d;g.generatedLine=p.generatedLine,g.generatedColumn=p.generatedColumn,p.source&&(g.source=n.indexOf(p.source),g.originalLine=p.originalLine,g.originalColumn=p.originalColumn,p.name&&(g.name=i.indexOf(p.name)),h.push(g)),u.push(g)}return o(r.__originalMappings,a.compareByOriginalPositions),r},c.prototype._version=3,Object.defineProperty(c.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),c.prototype._parseMappings=function(e,t){for(var r,i,s,l,c,u=1,h=0,m=0,f=0,p=0,g=0,k=e.length,b=0,y={},w={},T=[],C=[];b<k;)if(";"===e.charAt(b))u++,b++,h=0;else if(","===e.charAt(b))b++;else{for((r=new d).generatedLine=u,l=b;l<k&&!this._charIsMappingSeparator(e,l);l++);if(s=y[i=e.slice(b,l)])b+=i.length;else{for(s=[];b<l;)n.decode(e,b,w),c=w.value,b=w.rest,s.push(c);if(2===s.length)throw Error("Found a source, but no line and column");if(3===s.length)throw Error("Found a source and line, but no column");y[i]=s}r.generatedColumn=h+s[0],h=r.generatedColumn,s.length>1&&(r.source=p+s[1],p+=s[1],r.originalLine=m+s[2],m=r.originalLine,r.originalLine+=1,r.originalColumn=f+s[3],f=r.originalColumn,s.length>4&&(r.name=g+s[4],g+=s[4])),C.push(r),"number"==typeof r.originalLine&&T.push(r)}o(C,a.compareByGeneratedPositionsDeflated),this.__generatedMappings=C,o(T,a.compareByOriginalPositions),this.__originalMappings=T},c.prototype._findMapping=function(e,t,r,a,s,n){if(e[r]<=0)throw TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[a]<0)throw TypeError("Column must be greater than or equal to 0, got "+e[a]);return i.search(e,t,s,n)},c.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var r=this._generatedMappings[e+1];if(t.generatedLine===r.generatedLine){t.lastGeneratedColumn=r.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},c.prototype.originalPositionFor=function(e){var t={generatedLine:a.getArg(e,"line"),generatedColumn:a.getArg(e,"column")},r=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",a.compareByGeneratedPositionsDeflated,a.getArg(e,"bias",l.GREATEST_LOWER_BOUND));if(r>=0){var i=this._generatedMappings[r];if(i.generatedLine===t.generatedLine){var s=a.getArg(i,"source",null);null!==s&&(s=this._sources.at(s),s=a.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));var n=a.getArg(i,"name",null);return null!==n&&(n=this._names.at(n)),{source:s,line:a.getArg(i,"originalLine",null),column:a.getArg(i,"originalColumn",null),name:n}}}return{source:null,line:null,column:null,name:null}},c.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e})},c.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;var r,i=this._findSourceIndex(e);if(i>=0)return this.sourcesContent[i];var s=e;if(null!=this.sourceRoot&&(s=a.relative(this.sourceRoot,s)),null!=this.sourceRoot&&(r=a.urlParse(this.sourceRoot))){var n=s.replace(/^file:\/\//,"");if("file"==r.scheme&&this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if((!r.path||"/"==r.path)&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(t)return null;throw Error('"'+s+'" is not in the SourceMap.')},c.prototype.generatedPositionFor=function(e){var t=a.getArg(e,"source");if((t=this._findSourceIndex(t))<0)return{line:null,column:null,lastColumn:null};var r={source:t,originalLine:a.getArg(e,"line"),originalColumn:a.getArg(e,"column")},i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",a.compareByOriginalPositions,a.getArg(e,"bias",l.GREATEST_LOWER_BOUND));if(i>=0){var s=this._originalMappings[i];if(s.source===r.source)return{line:a.getArg(s,"generatedLine",null),column:a.getArg(s,"generatedColumn",null),lastColumn:a.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},u.prototype=Object.create(l.prototype),u.prototype.constructor=l,u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}}),u.prototype.originalPositionFor=function(e){var t={generatedLine:a.getArg(e,"line"),generatedColumn:a.getArg(e,"column")},r=i.search(t,this._sections,function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn}),s=this._sections[r];return s?s.consumer.originalPositionFor({line:t.generatedLine-(s.generatedOffset.generatedLine-1),column:t.generatedColumn-(s.generatedOffset.generatedLine===t.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},u.prototype.sourceContentFor=function(e,t){for(var r=0;r<this._sections.length;r++){var a=this._sections[r].consumer.sourceContentFor(e,!0);if(a)return a}if(t)return null;throw Error('"'+e+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var r=this._sections[t];if(-1!==r.consumer._findSourceIndex(a.getArg(e,"source"))){var i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},u.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var i=this._sections[r],s=i.consumer._generatedMappings,n=0;n<s.length;n++){var l=s[n],c=i.consumer._sources.at(l.source);c=a.computeSourceURL(i.consumer.sourceRoot,c,this._sourceMapURL),this._sources.add(c),c=this._sources.indexOf(c);var d=null;l.name&&(d=i.consumer._names.at(l.name),this._names.add(d),d=this._names.indexOf(d));var u={source:c,generatedLine:l.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(i.generatedOffset.generatedLine===l.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:d};this.__generatedMappings.push(u),"number"==typeof u.originalLine&&this.__originalMappings.push(u)}o(this.__generatedMappings,a.compareByGeneratedPositionsDeflated),o(this.__originalMappings,a.compareByOriginalPositions)}},572314:(e,t,r)=>{var a=r(941931),i=r(528816),s=r(528258).C,n=r(571801).P;function o(e){e||(e={}),this._file=i.getArg(e,"file",null),this._sourceRoot=i.getArg(e,"sourceRoot",null),this._skipValidation=i.getArg(e,"skipValidation",!1),this._sources=new s,this._names=new s,this._mappings=new n,this._sourcesContents=null}o.prototype._version=3,o.fromSourceMap=function(e){var t=e.sourceRoot,r=new o({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var a={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(a.source=e.source,null!=t&&(a.source=i.relative(t,a.source)),a.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(a.name=e.name)),r.addMapping(a)}),e.sources.forEach(function(a){var s=a;null!==t&&(s=i.relative(t,a)),r._sources.has(s)||r._sources.add(s);var n=e.sourceContentFor(a);null!=n&&r.setSourceContent(a,n)}),r},o.prototype.addMapping=function(e){var t=i.getArg(e,"generated"),r=i.getArg(e,"original",null),a=i.getArg(e,"source",null),s=i.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,a,s),null==a||(a=String(a),this._sources.has(a)||this._sources.add(a)),null==s||(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:a,name:s})},o.prototype.setSourceContent=function(e,t){var r=e;null!=this._sourceRoot&&(r=i.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[i.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[i.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},o.prototype.applySourceMap=function(e,t,r){var a=t;if(null==t){if(null==e.file)throw Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');a=e.file}var n=this._sourceRoot;null!=n&&(a=i.relative(n,a));var o=new s,l=new s;this._mappings.unsortedForEach(function(t){if(t.source===a&&null!=t.originalLine){var s=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=s.source&&(t.source=s.source,null!=r&&(t.source=i.join(r,t.source)),null!=n&&(t.source=i.relative(n,t.source)),t.originalLine=s.line,t.originalColumn=s.column,null!=s.name&&(t.name=s.name))}var c=t.source;null==c||o.has(c)||o.add(c);var d=t.name;null==d||l.has(d)||l.add(d)},this),this._sources=o,this._names=l,e.sources.forEach(function(t){var a=e.sourceContentFor(t);null!=a&&(null!=r&&(t=i.join(r,t)),null!=n&&(t=i.relative(n,t)),this.setSourceContent(t,a))},this)},o.prototype._validateMapping=function(e,t,r,a){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!e||!("line"in e)||!("column"in e)||!(e.line>0)||!(e.column>=0)||t||r||a)&&(!e||!("line"in e)||!("column"in e)||!t||!("line"in t)||!("column"in t)||!(e.line>0)||!(e.column>=0)||!(t.line>0)||!(t.column>=0)||!r))throw Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:a}))},o.prototype._serializeMappings=function(){for(var e,t,r,s,n=0,o=1,l=0,c=0,d=0,u=0,h="",m=this._mappings.toArray(),f=0,p=m.length;f<p;f++){if(t=m[f],e="",t.generatedLine!==o)for(n=0;t.generatedLine!==o;)e+=";",o++;else if(f>0){if(!i.compareByGeneratedPositionsInflated(t,m[f-1]))continue;e+=","}e+=a.encode(t.generatedColumn-n),n=t.generatedColumn,null!=t.source&&(s=this._sources.indexOf(t.source),e+=a.encode(s-u),u=s,e+=a.encode(t.originalLine-1-c),c=t.originalLine-1,e+=a.encode(t.originalColumn-l),l=t.originalColumn,null!=t.name&&(r=this._names.indexOf(t.name),e+=a.encode(r-d),d=r)),h+=e}return h},o.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=i.relative(t,e));var r=i.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null},this)},o.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},o.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.x=o},18254:(e,t,r)=>{var a=r(572314).x,i=r(528816),s=/(\r?\n)/,n="$$$isSourceNode$$$";function o(e,t,r,a,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==i?null:i,this[n]=!0,null!=a&&this.add(a)}o.fromStringWithSourceMap=function(e,t,r){var a=new o,n=e.split(s),l=0,c=function(){return e()+(e()||"");function e(){return l<n.length?n[l++]:void 0}},d=1,u=0,h=null;return t.eachMapping(function(e){if(null!==h){if(d<e.generatedLine)m(h,c()),d++,u=0;else{var t=n[l]||"",r=t.substr(0,e.generatedColumn-u);n[l]=t.substr(e.generatedColumn-u),u=e.generatedColumn,m(h,r),h=e;return}}for(;d<e.generatedLine;)a.add(c()),d++;if(u<e.generatedColumn){var t=n[l]||"";a.add(t.substr(0,e.generatedColumn)),n[l]=t.substr(e.generatedColumn),u=e.generatedColumn}h=e},this),l<n.length&&(h&&m(h,c()),a.add(n.splice(l).join(""))),t.sources.forEach(function(e){var s=t.sourceContentFor(e);null!=s&&(null!=r&&(e=i.join(r,e)),a.setSourceContent(e,s))}),a;function m(e,t){if(null===e||void 0===e.source)a.add(t);else{var s=r?i.join(r,e.source):e.source;a.add(new o(e.originalLine,e.originalColumn,s,t,e.name))}}},o.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else if(e[n]||"string"==typeof e)e&&this.children.push(e);else throw TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this},o.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else if(e[n]||"string"==typeof e)this.children.unshift(e);else throw TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this},o.prototype.walk=function(e){for(var t,r=0,a=this.children.length;r<a;r++)(t=this.children[r])[n]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},o.prototype.join=function(e){var t,r,a=this.children.length;if(a>0){for(r=0,t=[];r<a-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this},o.prototype.replaceRight=function(e,t){var r=this.children[this.children.length-1];return r[n]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this},o.prototype.setSourceContent=function(e,t){this.sourceContents[i.toSetString(e)]=t},o.prototype.walkSourceContents=function(e){for(var t=0,r=this.children.length;t<r;t++)this.children[t][n]&&this.children[t].walkSourceContents(e);for(var a=Object.keys(this.sourceContents),t=0,r=a.length;t<r;t++)e(i.fromSetString(a[t]),this.sourceContents[a[t]])},o.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},o.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},r=new a(e),i=!1,s=null,n=null,o=null,l=null;return this.walk(function(e,a){t.code+=e,null!==a.source&&null!==a.line&&null!==a.column?((s!==a.source||n!==a.line||o!==a.column||l!==a.name)&&r.addMapping({source:a.source,original:{line:a.line,column:a.column},generated:{line:t.line,column:t.column},name:a.name}),s=a.source,n=a.line,o=a.column,l=a.name,i=!0):i&&(r.addMapping({generated:{line:t.line,column:t.column}}),s=null,i=!1);for(var c=0,d=e.length;c<d;c++)10===e.charCodeAt(c)?(t.line++,t.column=0,c+1===d?(s=null,i=!1):i&&r.addMapping({source:a.source,original:{line:a.line,column:a.column},generated:{line:t.line,column:t.column},name:a.name})):t.column++}),this.walkSourceContents(function(e,t){r.setSourceContent(e,t)}),{code:t.code,map:r}}},528816:(e,t)=>{t.getArg=function(e,t,r){if(t in e)return e[t];if(3==arguments.length)return r;throw Error('"'+t+'" is a required argument.')};var r=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,a=/^data:.+\,.+$/;function i(e){var t=e.match(r);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function s(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function n(e){var r=e,a=i(e);if(a){if(!a.path)return e;r=a.path}for(var n,o=t.isAbsolute(r),l=r.split(/\/+/),c=0,d=l.length-1;d>=0;d--)"."===(n=l[d])?l.splice(d,1):".."===n?c++:c>0&&(""===n?(l.splice(d+1,c),c=0):(l.splice(d,2),c--));return(""===(r=l.join("/"))&&(r=o?"/":"."),a)?(a.path=r,s(a)):r}function o(e,t){""===e&&(e="."),""===t&&(t=".");var r=i(t),o=i(e);if(o&&(e=o.path||"/"),r&&!r.scheme)return o&&(r.scheme=o.scheme),s(r);if(r||t.match(a))return t;if(o&&!o.host&&!o.path)return o.host=t,s(o);var l="/"===t.charAt(0)?t:n(e.replace(/\/+$/,"")+"/"+t);return o?(o.path=l,s(o)):l}t.urlParse=i,t.urlGenerate=s,t.normalize=n,t.join=o,t.isAbsolute=function(e){return"/"===e.charAt(0)||r.test(e)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var r=0;0!==t.indexOf(e+"/");){var a=e.lastIndexOf("/");if(a<0||(e=e.slice(0,a)).match(/^([^\/]+:\/)?\/*$/))return t;++r}return Array(r+1).join("../")+t.substr(e.length+1)};var l=!("__proto__"in Object.create(null));function c(e){return e}function d(e){if(!e)return!1;var t=e.length;if(t<9||95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function u(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}t.toSetString=l?c:function(e){return d(e)?"$"+e:e},t.fromSetString=l?c:function(e){return d(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,r){var a=u(e.source,t.source);return 0!==a||0!=(a=e.originalLine-t.originalLine)||0!=(a=e.originalColumn-t.originalColumn)||r||0!=(a=e.generatedColumn-t.generatedColumn)||0!=(a=e.generatedLine-t.generatedLine)?a:u(e.name,t.name)},t.compareByGeneratedPositionsDeflated=function(e,t,r){var a=e.generatedLine-t.generatedLine;return 0!==a||0!=(a=e.generatedColumn-t.generatedColumn)||r||0!==(a=u(e.source,t.source))||0!=(a=e.originalLine-t.originalLine)||0!=(a=e.originalColumn-t.originalColumn)?a:u(e.name,t.name)},t.compareByGeneratedPositionsInflated=function(e,t){var r=e.generatedLine-t.generatedLine;return 0!==r||0!=(r=e.generatedColumn-t.generatedColumn)||0!==(r=u(e.source,t.source))||0!=(r=e.originalLine-t.originalLine)||0!=(r=e.originalColumn-t.originalColumn)?r:u(e.name,t.name)},t.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},t.computeSourceURL=function(e,t,r){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),r){var a=i(r);if(!a)throw Error("sourceMapURL could not be parsed");if(a.path){var l=a.path.lastIndexOf("/");l>=0&&(a.path=a.path.substring(0,l+1))}t=o(s(a),t)}return n(t)}},146238:(e,t,r)=>{r(572314).x,t.SourceMapConsumer=r(555471).SourceMapConsumer,r(18254)},517865:e=>{function t(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function r(e,r){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=r,this.destLen=0,this.ltree=new t,this.dtree=new t}var a=new t,i=new t,s=new Uint8Array(30),n=new Uint16Array(30),o=new Uint8Array(30),l=new Uint16Array(30),c=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new t,u=new Uint8Array(320);function h(e,t,r,a){var i,s;for(i=0;i<r;++i)e[i]=0;for(i=0;i<30-r;++i)e[i+r]=i/r|0;for(s=a,i=0;i<30;++i)t[i]=s,s+=1<<e[i]}var m=new Uint16Array(16);function f(e,t,r,a){var i,s;for(i=0;i<16;++i)e.table[i]=0;for(i=0;i<a;++i)e.table[t[r+i]]++;for(s=0,e.table[0]=0,i=0;i<16;++i)m[i]=s,s+=e.table[i];for(i=0;i<a;++i)t[r+i]&&(e.trans[m[t[r+i]]++]=i)}function p(e,t,r){if(!t)return r;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var a=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,a+r}function g(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=0,a=0,i=0,s=e.tag;do a=2*a+(1&s),s>>>=1,++i,r+=t.table[i],a-=t.table[i];while(a>=0)return e.tag=s,e.bitcount-=i,t.trans[r+a]}function k(e,t,r){for(;;){var a,i,c,d,u=g(e,t);if(256===u)return 0;if(u<256)e.dest[e.destLen++]=u;else for(u-=257,a=p(e,s[u],n[u]),i=g(e,r),d=c=e.destLen-p(e,o[i],l[i]);d<c+a;++d)e.dest[e.destLen++]=e.dest[d]}}!function(e,t){var r;for(r=0;r<7;++r)e.table[r]=0;for(r=0,e.table[7]=24,e.table[8]=152,e.table[9]=112;r<24;++r)e.trans[r]=256+r;for(r=0;r<144;++r)e.trans[24+r]=r;for(r=0;r<8;++r)e.trans[168+r]=280+r;for(r=0;r<112;++r)e.trans[176+r]=144+r;for(r=0;r<5;++r)t.table[r]=0;for(r=0,t.table[5]=32;r<32;++r)t.trans[r]=r}(a,i),h(s,n,4,3),h(o,l,2,1),s[28]=0,n[28]=258,e.exports=function(e,t){var s,n,o=new r(e,t);do{switch(s=function(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}(o),p(o,2,0)){case 0:n=function(e){for(var t,r;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return -3;for(e.sourceIndex+=4,r=t;r;--r)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,0}(o);break;case 1:n=k(o,a,i);break;case 2:(function(e,t,r){for(n=0,a=p(e,5,257),i=p(e,5,1),s=p(e,4,4);n<19;++n)u[n]=0;for(n=0;n<s;++n){var a,i,s,n,o,l,h=p(e,3,0);u[c[n]]=h}for(f(d,u,0,19),o=0;o<a+i;){var m=g(e,d);switch(m){case 16:var k=u[o-1];for(l=p(e,2,3);l;--l)u[o++]=k;break;case 17:for(l=p(e,3,3);l;--l)u[o++]=0;break;case 18:for(l=p(e,7,11);l;--l)u[o++]=0;break;default:u[o++]=m}}f(t,u,0,a),f(r,u,a,i)})(o,o.ltree,o.dtree),n=k(o,o.ltree,o.dtree);break;default:n=-3}if(0!==n)throw Error("Data error")}while(!s)return o.destLen<o.dest.length?"function"==typeof o.dest.slice?o.dest.slice(0,o.destLen):o.dest.subarray(0,o.destLen):o.dest}},85217:(e,t,r)=>{let a=r(517865),{swap32LE:i}=r(429134);e.exports=class{constructor(e){let t="function"==typeof e.readUInt32BE&&"function"==typeof e.slice;if(t||e instanceof Uint8Array){let r;if(t)this.highStart=e.readUInt32LE(0),this.errorValue=e.readUInt32LE(4),r=e.readUInt32LE(8),e=e.slice(12);else{let t=new DataView(e.buffer);this.highStart=t.getUint32(0,!0),this.errorValue=t.getUint32(4,!0),r=t.getUint32(8,!0),e=e.subarray(12)}e=a(e,new Uint8Array(r)),i(e=a(e,new Uint8Array(r))),this.data=new Uint32Array(e.buffer)}else({data:this.data,highStart:this.highStart,errorValue:this.errorValue}=e)}get(e){let t;return e<0||e>1114111?this.errorValue:e<55296||e>56319&&e<=65535?(t=(this.data[e>>5]<<2)+(31&e),this.data[t]):e<=65535?(t=(this.data[2048+(e-55296>>5)]<<2)+(31&e),this.data[t]):e<this.highStart?(t=this.data[2080+(e>>11)],t=((t=this.data[t+(e>>5&63)])<<2)+(31&e),this.data[t]):this.data[this.data.length-4]}}},429134:e=>{let t=18===new Uint8Array(new Uint32Array([0x12345678]).buffer)[0],r=(e,t,r)=>{let a=e[t];e[t]=e[r],e[r]=a},a=e=>{let t=e.length;for(let a=0;a<t;a+=4)r(e,a,a+3),r(e,a+1,a+2)};e.exports={swap32LE:e=>{t&&a(e)}}},461509:(e,t,r)=>{"use strict";let a,i,s;function n(e){let t=function(){if(!s){s=[];let e=l("std");for(let t=0;t<e.length;t++)s[e[t].charCodeAt(0)]=t;s["-".charCodeAt(0)]=e.indexOf("+"),s["_".charCodeAt(0)]=e.indexOf("/")}return s}(),r=3*e.length/4;"="==e[e.length-2]?r-=2:"="==e[e.length-1]&&(r-=1);let a=new Uint8Array(r),i=0,n=0,o,c=0;for(let r=0;r<e.length;r++){if(void 0===(o=t[e.charCodeAt(r)]))switch(e[r]){case"=":n=0;case"\n":case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string")}switch(n){case 0:c=o,n=1;break;case 1:a[i++]=c<<2|(48&o)>>4,c=o,n=2;break;case 2:a[i++]=(15&c)<<4|(60&o)>>2,c=o,n=3;break;case 3:a[i++]=(3&c)<<6|o,n=0}}if(1==n)throw Error("invalid base64 string");return a.subarray(0,i)}function o(e,t="std"){let r=l(t),a="std"==t,i="",s=0,n,c=0;for(let t=0;t<e.length;t++)switch(n=e[t],s){case 0:i+=r[n>>2],c=(3&n)<<4,s=1;break;case 1:i+=r[c|n>>4],c=(15&n)<<2,s=2;break;case 2:i+=r[c|n>>6],i+=r[63&n],s=0}return s&&(i+=r[c],a&&(i+="=",1==s&&(i+="="))),i}function l(e){return a||(i=(a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("")).slice(0,-2).concat("-","_")),"url"==e?i:a}r.d(t,{K:()=>o,u:()=>n})},600032:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>C});var a=r(689845);r(608488),r(395274),r(715037),r(883279),r(643538),r(238112),r(710780),r(563375),r(116697),r(217790),r(456459),r(420708),r(113600),r(97920),r(368336),r(521483),r(197009),r(25075),r(823168),r(484706),r(879198),r(979854);var i=r(128300),s=r(847156),n=r(725512),o=r(930732),l=r(637137),c=r(204996),d=r(610941),u=r(905427),h=r(695453),m=r(598920),f=r(602867),p=r(494232),g=r(257389),k=r(766014),b=r(451008),y=r(124895),w=r(742746),T=r(356062);r(335496),r(38302),r(412508),r(804352),r(906640),r(991467),r(708598),r(97806),r(995794),r(471938),r(379099),r(550506),r(494044),r(285312),r(985044),Object.assign(a.A,{analyze:u.n,average:i.A,bezier:s.A,blend:n.A,brewer:w.A,Color:T.A,colors:y.A,contrast:h.A,contrastAPCA:m.A,cubehelix:o.A,deltaE:f.A,distance:p.A,input:k.A,interpolate:l.A,limits:u.F,mix:l.A,random:c.A,scale:d.A,scales:b.A,valid:g.A});let C=a.A},936639:(e,t,r)=>{"use strict";r.d(t,{$P:()=>P});var a=r(365147);let i=e=>e.normalize("NFKD").split(""),s=/^\s+$/,n=/^[`~!@#$%^&*()\-=_+{}[\]\|\\;':",./<>?]+$/,o={insertOrder:"insertOrder",bestMatch:"bestMatch"},l={keySelector:e=>e,threshold:.6,ignoreCase:!0,ignoreSymbols:!0,normalizeWhitespace:!0,returnMatchData:!1,useDamerau:!0,useSellers:!0,useSeparatedUnicode:!1,sortBy:o.bestMatch},c=()=>{},d=e=>e instanceof Array?e:[e];function u(e,t){let r=t.ignoreCase?e.toLocaleLowerCase():e,o=[],l=[],c=!0,d=0;for(let e of t.useSeparatedUnicode?i(r):a(r))s.lastIndex=0,n.lastIndex=0,t.normalizeWhitespace&&s.test(e)?c||(o.push(" "),l.push(d),c=!0):t.ignoreSymbols&&n.test(e)||(t.useSeparatedUnicode?o.push(e):o.push(e.normalize()),l.push(d),c=!1),d+=e.length;for(l.push(e.length);" "===o[o.length-1];)o.pop(),l.pop();return{original:e,normal:o,map:l}}function h(e,t){return{index:t[e.start],length:t[e.end+1]-t[e.start]}}function m(e,t){if(0===t)return{index:0,length:0};let r=t;for(let t=e.length-2;t>0&&r>1;t--){let a=e[t];r=a[r]<a[r-1]?r:r-1}return{start:r-1,end:t-1}}function f(){return{start:0,end:0}}let p=()=>!0,g=(e,t)=>e<t;function k(e,t){let r=Array(e);for(let a=0;a<e;a++)r[a]=Array(t),r[a][0]=a;for(let e=0;e<t;e++)r[0][e]=e;return r}function b(e,t){let r=Array(e);r[0]=Array(t).fill(0);for(let a=1;a<e;a++)r[a]=Array(t),r[a][0]=a;return r}function y(e,t,r,a,i){let s;let n=r[a],o=r[a+1],l=e[a]===t[i]?0:1,c=o[i]+1;(s=n[i+1]+1)<c&&(c=s),(s=n[i]+l)<c&&(c=s),o[i+1]=c}function w(e,t,r,a){for(let i=0;i<e.length;i++)y(e,t,r,i,a)}function T(e,t,r,a){if(0===a){w(e,t,r,a);return}e.length>0&&y(e,t,r,0,a);for(let i=1;i<e.length;i++){let s;let n=r[i-1],o=r[i],l=r[i+1],c=e[i]===t[a]?0:1,d=l[a]+1;(s=o[a+1]+1)<d&&(d=s),(s=o[a]+c)<d&&(d=s),e[i]===t[a-1]&&e[i-1]===t[a]&&(s=n[a-1]+c)<d&&(d=s),l[a+1]=d}}function C(e,t){let r=t.score-e.score;if(0!==r)return r;let a=e.match.start-t.match.start;if(0!==a)return a;let i=e.keyIndex-t.keyIndex;if(0!==i)return i;let s=e.lengthDiff-t.lengthDiff;return 0!==s?s:S(e,t)}function S(e,t){return e.index-t.index}function v(e,t,r,a,i,s,n){let o={item:r.item,normalized:r.normalized,score:a,match:i,index:r.index,keyIndex:r.keyIndex,lengthDiff:s};null==t[r.index]?(t[r.index]=e.length,e.push(o)):0>n(o,e[t[r.index]])&&(e[t[r.index]]=o)}let x=Math.max,A=e=>e;function E(e,t,r,a,i){let s=Math.min(r.length,t+e.depth+1),n=Math.ceil((t+i+s)/2);return 1-(n-s)/n>=a}function I(e,t,r,a,i,s){return 1-Math.min(i,s-(e.depth+1))/r.length>=a}function P(e,t,r){r={...l,...r};let a={children:{},candidates:[],depth:0};return!function(e,t,r,a){for(let i of r){let r=d(a.keySelector(i)).map((e,r)=>({index:t,keyIndex:r,item:i,normalized:u(e,a)}));for(let a of(t++,r))!function(e,t,r){let a=e;for(let e=0;e<t.length;e++){let r=t[e];null==a.children[r]&&(a.children[r]={children:{},candidates:[],depth:0}),a.depth=Math.max(a.depth,t.length-e),a=a.children[r]}a.candidates.push(r)}(e,a.normalized.normal,a)}}(a,0,t,r),function(e,t,r){let a=r.useSellers?b:k,i={score:r.useDamerau?T:w,getLength:r.useSellers?A:x,shouldUpdateScore:r.useSellers?g:p,shouldContinue:r.useSellers?I:E,walkBack:r.useSellers?m:f,compareItems:function(e){switch(e){case o.bestMatch:return C;case o.insertOrder:return S;default:throw Error(`unknown sortBy method ${e}`)}}(r.sortBy)},s={},n=[],l=a(e.length+1,t.depth+1);if(r.threshold<=0||0===e.length)for(let r of t.candidates)v(n,s,r,0,{index:0,length:0},e.length,i.compareItems);!function(e,t,r,a,i,s,n){let o=[];for(let r in e.children){let a=e.children[r];o.push([a,1,r,0,t.length])}let l=Array(e.depth);for(;0!==o.length;){let[e,c,d,u,h]=o.pop();l[c-1]=d,r.score(t,l,a,c-1);let f=a[a.length-1][c],p=u,g=h;if(r.shouldUpdateScore(f,h)&&(p=c,g=f),e.candidates.length>0){let o=1-g/r.getLength(t.length,c);if(o>=n.threshold){let n=m(a,p),l=Math.abs(c-t.length);for(let t of e.candidates)v(i,s,t,o,n,l,r.compareItems)}}for(let a in e.children){let i=e.children[a];r.shouldContinue(i,c,t,n.threshold,g,f)&&o.push([i,c+1,a,p,g])}}}(t,e,i,l,n,s,r);let d=n.sort(i.compareItems);if(r.returnMatchData){let e=r.useSellers?h:c;return d.map(t=>({item:t.item,original:t.normalized.original,key:t.normalized.normal.join(""),score:t.score,match:e(t.match,t.normalized.map)}))}return d.map(e=>e.item)}(u(e,r).normal,a,r)}},950899:(e,t,r)=>{"use strict";r.d(t,{EZ:()=>d,PC:()=>i,Xg:()=>u,Yq:()=>a,_m:()=>n,as:()=>s,c9:()=>c,hY:()=>o,rD:()=>l});/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let a=4,i={1:[-1,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],2:[-1,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],3:[-1,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1]},s={1:[-1,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],2:[-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],3:[-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1]},n={0:[11025,12e3,8e3,-1],2:[22050,24e3,16e3,-1],3:[44100,48e3,32e3,-1]},o=0x58696e67,l=0x496e666f,c=(e,t,r,a)=>3===e?Math.floor((12*t/r+a)*4):Math.floor(144*t/r+a),d=(e,t)=>3===e?3===t?21:36:3===t?13:21,u=(e,t)=>{let r;let a=t.pos,o=e>>>24,l=e>>>16&255,d=e>>>8&255,u=255&e;if(255!==o&&255!==l&&255!==d&&255!==u)return t.pos+=4,null;if(t.pos+=1,255!==o||(224&l)!=224)return null;let h=l>>3&3,m=l>>1&3,f=d>>4&15,p=d>>2&3,g=3===h?i[m]?.[f]:s[m]?.[f];if(!g||-1===g)return null;let k=1e3*g,b=n[h]?.[p];if(!b||-1===b)return null;let y=c(m,k,b,d>>1&1);return null!==t.fileSize&&t.fileSize-a<y?null:(r=3===h?3===m?384:1152:3===m?384:2===m?1152:576,{startPos:a,totalSize:y,mpegVersionId:h,layer:m,bitrate:k,frequencyIndex:p,sampleRate:b,channel:u>>6&3,modeExtension:u>>4&3,copyright:u>>3&1,original:u>>2&1,emphasis:3&u,audioSamplesInFrame:r})}},481140:(e,t,r)=>{"use strict";r.d(t,{Co:()=>I,D5:()=>m,KU:()=>u,PR:()=>P,Qf:()=>x,UU:()=>v,Us:()=>T,bs:()=>C,fH:()=>d,ls:()=>E,no:()=>l});var a=r(496023),i=r(250601);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let s=e=>{let t=[],r=0;for(;r<e.length;){let a=-1,i=0;for(let t=r;t<e.length-3;t++){if(0===e[t]&&0===e[t+1]&&1===e[t+2]){a=t,i=3;break}if(t<e.length-4&&0===e[t]&&0===e[t+1]&&0===e[t+2]&&1===e[t+3]){a=t,i=4;break}}if(-1===a)break;if(r>0&&a>r){let i=e.subarray(r,a);i.length>0&&t.push(i)}r=a+i}if(r<e.length){let a=e.subarray(r);a.length>0&&t.push(a)}return t},n=(e,t)=>{let r=[],a=0,s=new DataView(e.buffer,e.byteOffset,e.byteLength);for(;a+t<=e.length;){let n;1===t?n=s.getUint8(a):2===t?n=s.getUint16(a,!1):3===t?n=(s.getUint16(a,!1)<<8)+s.getUint8(a+2):4===t?n=s.getUint32(a,!1):((0,i.xb)(t),(0,i.vA)(!1)),a+=t;let o=e.subarray(a,a+n);r.push(o),a+=n}return r},o=e=>{let t=[],r=e.length;for(let a=0;a<r;a++)a+2<r&&0===e[a]&&0===e[a+1]&&3===e[a+2]?(t.push(0,0),a+=2):t.push(e[a]);return new Uint8Array(t)},l=e=>{let t=s(e);if(0===t.length)return null;let r=0;for(let e of t)r+=4+e.byteLength;let a=new Uint8Array(r),i=new DataView(a.buffer),n=0;for(let e of t){let t=e.byteLength;i.setUint32(n,t,!1),n+=4,a.set(e,n),n+=e.byteLength}return a},c=e=>31&e[0],d=e=>{try{let t=s(e),r=t.filter(e=>7===c(e)),a=t.filter(e=>8===c(e)),n=t.filter(e=>13===c(e));if(0===r.length||0===a.length)return null;let l=r[0],d=new i._c(o(l));d.skipBits(1),d.skipBits(2);let u=d.readBits(5);if(7!==u)return console.error("Invalid SPS NAL unit type"),null;let h=d.readAlignedByte(),m=d.readAlignedByte(),f=d.readAlignedByte(),p={configurationVersion:1,avcProfileIndication:h,profileCompatibility:m,avcLevelIndication:f,lengthSizeMinusOne:3,sequenceParameterSets:r,pictureParameterSets:a,chromaFormat:null,bitDepthLumaMinus8:null,bitDepthChromaMinus8:null,sequenceParameterSetExt:null};if(100===h||110===h||122===h||144===h){(0,i.IP)(d);let e=(0,i.IP)(d);3===e&&d.skipBits(1);let t=(0,i.IP)(d),r=(0,i.IP)(d);p.chromaFormat=e,p.bitDepthLumaMinus8=t,p.bitDepthChromaMinus8=r,p.sequenceParameterSetExt=n}return p}catch(e){return console.error("Error building AVC Decoder Configuration Record:",e),null}},u=e=>{let t=[];for(let r of(t.push(e.configurationVersion),t.push(e.avcProfileIndication),t.push(e.profileCompatibility),t.push(e.avcLevelIndication),t.push(252|3&e.lengthSizeMinusOne),t.push(224|31&e.sequenceParameterSets.length),e.sequenceParameterSets)){let e=r.byteLength;t.push(e>>8),t.push(255&e);for(let a=0;a<e;a++)t.push(r[a])}for(let r of(t.push(e.pictureParameterSets.length),e.pictureParameterSets)){let e=r.byteLength;t.push(e>>8),t.push(255&e);for(let a=0;a<e;a++)t.push(r[a])}if(100===e.avcProfileIndication||110===e.avcProfileIndication||122===e.avcProfileIndication||144===e.avcProfileIndication)for(let r of((0,i.vA)(null!==e.chromaFormat),(0,i.vA)(null!==e.bitDepthLumaMinus8),(0,i.vA)(null!==e.bitDepthChromaMinus8),(0,i.vA)(null!==e.sequenceParameterSetExt),t.push(252|3&e.chromaFormat),t.push(248|7&e.bitDepthLumaMinus8),t.push(248|7&e.bitDepthChromaMinus8),t.push(e.sequenceParameterSetExt.length),e.sequenceParameterSetExt)){let e=r.byteLength;t.push(e>>8),t.push(255&e);for(let a=0;a<e;a++)t.push(r[a])}return new Uint8Array(t)},h=e=>e[0]>>1&63,m=e=>{try{let t=s(e),r=t.filter(e=>32===h(e)),a=t.filter(e=>33===h(e)),n=t.filter(e=>34===h(e)),l=t.filter(e=>39===h(e)||40===h(e));if(0===a.length||0===n.length)return null;let c=a[0],d=new i._c(o(c));d.skipBits(16),d.readBits(4);let u=d.readBits(3),m=d.readBits(1),{general_profile_space:k,general_tier_flag:y,general_profile_idc:w,general_profile_compatibility_flags:T,general_constraint_indicator_flags:C,general_level_idc:S}=f(d,u);(0,i.IP)(d);let v=(0,i.IP)(d);3===v&&d.skipBits(1),(0,i.IP)(d),(0,i.IP)(d),d.readBits(1)&&((0,i.IP)(d),(0,i.IP)(d),(0,i.IP)(d),(0,i.IP)(d));let x=(0,i.IP)(d),A=(0,i.IP)(d);(0,i.IP)(d);let E=d.readBits(1)?0:u;for(let e=E;e<=u;e++)(0,i.IP)(d),(0,i.IP)(d),(0,i.IP)(d);(0,i.IP)(d),(0,i.IP)(d),(0,i.IP)(d),(0,i.IP)(d),(0,i.IP)(d),(0,i.IP)(d),d.readBits(1)&&d.readBits(1)&&p(d),d.skipBits(1),d.skipBits(1),d.readBits(1)&&(d.skipBits(4),d.skipBits(4),(0,i.IP)(d),(0,i.IP)(d),d.skipBits(1));let I=(0,i.IP)(d);if(g(d,I),d.readBits(1)){let e=(0,i.IP)(d);for(let t=0;t<e;t++)(0,i.IP)(d),d.skipBits(1)}d.skipBits(1),d.skipBits(1);let P=0;d.readBits(1)&&(P=b(d,u));let _=0;if(n.length>0){let e=n[0],t=new i._c(o(e));t.skipBits(16),(0,i.IP)(t),(0,i.IP)(t),t.skipBits(1),t.skipBits(1),t.skipBits(3),t.skipBits(1),t.skipBits(1),(0,i.IP)(t),(0,i.IP)(t),(0,i.OO)(t),t.skipBits(1),t.skipBits(1),t.readBits(1)&&(0,i.IP)(t),(0,i.OO)(t),(0,i.OO)(t),t.skipBits(1),t.skipBits(1),t.skipBits(1),t.skipBits(1);let r=t.readBits(1),a=t.readBits(1);_=r||a?r&&!a?2:!r&&a?3:0:0}let R=[...r.length?[{arrayCompleteness:1,nalUnitType:32,nalUnits:r}]:[],...a.length?[{arrayCompleteness:1,nalUnitType:33,nalUnits:a}]:[],...n.length?[{arrayCompleteness:1,nalUnitType:34,nalUnits:n}]:[],...l.length?[{arrayCompleteness:1,nalUnitType:h(l[0]),nalUnits:l}]:[]];return{configurationVersion:1,generalProfileSpace:k,generalTierFlag:y,generalProfileIdc:w,generalProfileCompatibilityFlags:T,generalConstraintIndicatorFlags:C,generalLevelIdc:S,minSpatialSegmentationIdc:P,parallelismType:_,chromaFormatIdc:v,bitDepthLumaMinus8:x,bitDepthChromaMinus8:A,avgFrameRate:0,constantFrameRate:0,numTemporalLayers:u+1,temporalIdNested:m,lengthSizeMinusOne:3,arrays:R}}catch(e){return console.error("Error building HEVC Decoder Configuration Record:",e),null}},f=(e,t)=>{let r=e.readBits(2),a=e.readBits(1),i=e.readBits(5),s=0;for(let t=0;t<32;t++)s=s<<1|e.readBits(1);let n=new Uint8Array(6);for(let t=0;t<6;t++)n[t]=e.readBits(8);let o=e.readBits(8),l=[],c=[];for(let r=0;r<t;r++)l.push(e.readBits(1)),c.push(e.readBits(1));if(t>0)for(let r=t;r<8;r++)e.skipBits(2);for(let r=0;r<t;r++)l[r]&&e.skipBits(88),c[r]&&e.skipBits(8);return{general_profile_space:r,general_tier_flag:a,general_profile_idc:i,general_profile_compatibility_flags:s,general_constraint_indicator_flags:n,general_level_idc:o}},p=e=>{for(let t=0;t<4;t++)for(let r=0;r<(3===t?2:6);r++)if(e.readBits(1)){let r=Math.min(64,1<<4+(t<<1));t>1&&(0,i.OO)(e);for(let t=0;t<r;t++)(0,i.OO)(e)}else(0,i.IP)(e)},g=(e,t)=>{let r=[];for(let a=0;a<t;a++)r[a]=k(e,a,t,r)},k=(e,t,r,a)=>{let s=0,n=0,o=0;if(0!==t&&(n=e.readBits(1)),n){o=t===r?t-((0,i.IP)(e)+1):t-1,e.readBits(1),(0,i.IP)(e);let n=a[o]??0;for(let t=0;t<=n;t++)e.readBits(1)||e.readBits(1);s=a[o]}else{let t=(0,i.IP)(e),r=(0,i.IP)(e);for(let r=0;r<t;r++)(0,i.IP)(e),e.readBits(1);for(let t=0;t<r;t++)(0,i.IP)(e),e.readBits(1);s=t+r}return s},b=(e,t)=>{if(e.readBits(1)&&255===e.readBits(8)&&(e.readBits(16),e.readBits(16)),e.readBits(1)&&e.readBits(1),e.readBits(1)&&(e.readBits(3),e.readBits(1),e.readBits(1)&&(e.readBits(8),e.readBits(8),e.readBits(8))),e.readBits(1)&&((0,i.IP)(e),(0,i.IP)(e)),e.readBits(1),e.readBits(1),e.readBits(1),e.readBits(1)&&((0,i.IP)(e),(0,i.IP)(e),(0,i.IP)(e),(0,i.IP)(e)),e.readBits(1)&&(e.readBits(32),e.readBits(32),e.readBits(1)&&(0,i.IP)(e),e.readBits(1)&&y(e,!0,t)),e.readBits(1)){e.readBits(1),e.readBits(1),e.readBits(1);let t=(0,i.IP)(e);return(0,i.IP)(e),(0,i.IP)(e),(0,i.IP)(e),(0,i.IP)(e),t}return 0},y=(e,t,r)=>{let a=!1,s=!1,n=!1;t&&(a=1===e.readBits(1),s=1===e.readBits(1),(a||s)&&((n=1===e.readBits(1))&&(e.readBits(8),e.readBits(5),e.readBits(1),e.readBits(5)),e.readBits(4),e.readBits(4),n&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5)));for(let t=0;t<=r;t++){let t=1===e.readBits(1),r=!0;t||(r=1===e.readBits(1));let o=!1;r?(0,i.IP)(e):o=1===e.readBits(1);let l=1;o||(l=(0,i.IP)(e)+1),a&&w(e,l,n),s&&w(e,l,n)}},w=(e,t,r)=>{for(let a=0;a<t;a++)(0,i.IP)(e),(0,i.IP)(e),r&&((0,i.IP)(e),(0,i.IP)(e)),e.readBits(1)},T=e=>{let t=[];for(let r of(t.push(e.configurationVersion),t.push((3&e.generalProfileSpace)<<6|(1&e.generalTierFlag)<<5|31&e.generalProfileIdc),t.push(e.generalProfileCompatibilityFlags>>>24&255),t.push(e.generalProfileCompatibilityFlags>>>16&255),t.push(e.generalProfileCompatibilityFlags>>>8&255),t.push(255&e.generalProfileCompatibilityFlags),t.push(...e.generalConstraintIndicatorFlags),t.push(255&e.generalLevelIdc),t.push(240|e.minSpatialSegmentationIdc>>8&15),t.push(255&e.minSpatialSegmentationIdc),t.push(252|3&e.parallelismType),t.push(252|3&e.chromaFormatIdc),t.push(248|7&e.bitDepthLumaMinus8),t.push(248|7&e.bitDepthChromaMinus8),t.push(e.avgFrameRate>>8&255),t.push(255&e.avgFrameRate),t.push((3&e.constantFrameRate)<<6|(7&e.numTemporalLayers)<<3|(1&e.temporalIdNested)<<2|3&e.lengthSizeMinusOne),t.push(255&e.arrays.length),e.arrays))for(let e of(t.push((1&r.arrayCompleteness)<<7|0|63&r.nalUnitType),t.push(r.nalUnits.length>>8&255),t.push(255&r.nalUnits.length),r.nalUnits)){t.push(e.length>>8&255),t.push(255&e.length);for(let r=0;r<e.length;r++)t.push(e[r])}return new Uint8Array(t)},C=e=>{let t=new i._c(e);if(2!==t.readBits(2))return null;let r=t.readBits(1),s=(t.readBits(1)<<1)+r;if(3===s&&t.skipBits(1),1===t.readBits(1)||0!==t.readBits(1)||(t.skipBits(2),4817730!==t.readBits(24)))return null;let n=8;s>=2&&(n=t.readBits(1)?12:10);let o=t.readBits(3),l=0,c=0;if(7!==o){if(c=t.readBits(1),1===s||3===s){let e=t.readBits(1),r=t.readBits(1);l=e||r?e&&!r?2:1:3,t.skipBits(1)}else l=1}else l=3,c=1;let d=(t.readBits(16)+1)*(t.readBits(16)+1),u=(0,i._g)(a.ye).level;for(let e of a.ye)if(d<=e.maxPictureSize){u=e.level;break}return{profile:s,level:u,bitDepth:n,chromaSubsampling:l,videoFullRangeFlag:c,colourPrimaries:2===o?1:1===o?6:2,transferCharacteristics:2===o?1:1===o?6:2,matrixCoefficients:7===o?0:2===o?1:1===o?6:2}};function*S(e){let t=new i._c(e),r=()=>{let e=0;for(let r=0;r<8;r++){let a=t.readAlignedByte();if(e|=(127&a)<<7*r,!(128&a))break;if(7===r&&128&a)return null}return e>=0x100000000-1?null:e};for(;t.getBitsLeft()>=8;){let a;t.skipBits(1);let s=t.readBits(4),n=t.readBits(1),o=t.readBits(1);if(t.skipBits(1),n&&t.skipBits(8),o){let e=r();if(null===e)return;a=e}else a=Math.floor(t.getBitsLeft()/8);(0,i.vA)(t.pos%8==0),yield{type:s,data:e.subarray(t.pos/8,t.pos/8+a)},t.skipBits(8*a)}}let v=e=>{for(let{type:t,data:r}of S(e)){if(1!==t)continue;let e=new i._c(r),a=e.readBits(3);e.readBits(1);let s=e.readBits(1),n=0,o=0,l=0;if(s)n=e.readBits(5);else{if(e.readBits(1)&&(e.skipBits(32),e.skipBits(32),e.readBits(1)))return null;let t=e.readBits(1);t&&(l=e.readBits(5),e.skipBits(32),e.skipBits(5),e.skipBits(5));let r=e.readBits(5);for(let a=0;a<=r;a++){e.skipBits(12);let r=e.readBits(5);if(0===a&&(n=r),r>7){let t=e.readBits(1);0===a&&(o=t)}if(t&&e.readBits(1)){let t=l+1;e.skipBits(t),e.skipBits(t),e.skipBits(1)}e.readBits(1)&&e.skipBits(4)}}let c=e.readBits(1),d=8;2===a&&c?d=e.readBits(1)?12:10:a<=2&&(d=c?10:8);let u=0;1!==a&&(u=e.readBits(1));let h=1,m=1,f=0;return!u&&(0===a?(h=1,m=1):1===a?(h=0,m=0):12===d&&(h=e.readBits(1))&&(m=e.readBits(1)),h&&m&&(f=e.readBits(2))),{profile:a,level:n,tier:o,bitDepth:d,monochrome:u,chromaSubsamplingX:h,chromaSubsamplingY:m,chromaSamplePosition:f}}return null},x=e=>{let t=(0,i.Zc)(e),r=t.getUint8(9),a=t.getUint16(10,!0),s=t.getUint32(12,!0),n=t.getInt16(16,!0),o=t.getUint8(18),l=null;return o&&(l=e.subarray(19,21+r)),{outputChannelCount:r,preSkip:a,inputSampleRate:s,outputGain:n,channelMappingFamily:o,channelMappingTable:l}},A=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960],E=e=>({durationInSamples:A[e[0]>>3]}),I=e=>{if(e.length<7)throw Error("Setup header is too short.");if(5!==e[0])throw Error("Wrong packet type in Setup header.");if("vorbis"!==String.fromCharCode(...e.slice(1,7)))throw Error("Invalid packet signature in Setup header.");let t=e.length,r=new Uint8Array(t);for(let a=0;a<t;a++)r[a]=e[t-1-a];let a=new i._c(r),s=0;for(;a.getBitsLeft()>97;)if(1===a.readBits(1)){s=a.pos;break}if(0===s)throw Error("Invalid Setup header: framing bit not found.");let n=0,o=!1,l=0;for(;a.getBitsLeft()>=97;){let e=a.pos,t=a.readBits(8),r=a.readBits(16),i=a.readBits(16);if(t>63||0!==r||0!==i){a.pos=e;break}if(a.skipBits(1),++n>64)break;a.clone().readBits(6)+1===n&&(o=!0,l=n)}if(!o)throw Error("Invalid Setup header: mode header not found.");if(l>63)throw Error(`Unsupported mode count: ${l}.`);let c=l;a.pos=0,a.skipBits(s);let d=Array(c).fill(0);for(let e=c-1;e>=0;e--)a.skipBits(40),d[e]=a.readBits(1);return{modeBlockflags:d}},P=async(e,t)=>{switch((0,i.vA)(e.codec),e.codec){case"avc":{let r;let a=await e.getDecoderConfig();if((0,i.vA)(a),a.description){let e=3&(0,i.Fo)(a.description)[4];r=n(t.data,e+1)}else r=s(t.data);return r.some(e=>5===c(e))?"key":"delta"}case"hevc":{let r;let a=await e.getDecoderConfig();if((0,i.vA)(a),a.description){let e=3&(0,i.Fo)(a.description)[21];r=n(t.data,e+1)}else r=s(t.data);return r.some(e=>{let t=h(e);return 16<=t&&t<=23})?"key":"delta"}case"vp8":return 0==(1&t.data[0])?"key":"delta";case"vp9":{let e=new i._c(t.data);if(2!==e.readBits(2))return null;let r=e.readBits(1);if(3===(e.readBits(1)<<1)+r&&e.skipBits(1),e.readBits(1))return null;return 0===e.readBits(1)?"key":"delta"}case"av1":{let e=!1;for(let{type:r,data:a}of S(t.data))if(1===r){let t=new i._c(a);t.skipBits(4),e=!!t.readBits(1)}else if(3===r||6===r||7===r){if(e)return"key";let t=new i._c(a);if(t.readBits(1))return null;return 0===t.readBits(2)?"key":"delta"}return null}default:(0,i.xb)(e.codec),(0,i.vA)(!1)}}},496023:(e,t,r)=>{"use strict";r.d(t,{DC:()=>k,Ei:()=>v,GL:()=>O,IJ:()=>E,KZ:()=>y,P7:()=>z,PP:()=>o,QP:()=>b,Rc:()=>A,VW:()=>l,WN:()=>i,Wq:()=>s,X0:()=>w,YB:()=>n,aF:()=>U,cj:()=>C,en:()=>I,j7:()=>p,m0:()=>P,mD:()=>g,oU:()=>x,ye:()=>u,zF:()=>T});var a=r(250601);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let i=["avc","hevc","vp9","av1","vp8"],s=["pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be","pcm-u8","pcm-s8","ulaw","alaw"],n=["aac","opus","mp3","vorbis","flac"],o=[...n,...s],l=["webvtt"],c=[{maxMacroblocks:99,maxBitrate:64e3,level:10},{maxMacroblocks:396,maxBitrate:192e3,level:11},{maxMacroblocks:396,maxBitrate:384e3,level:12},{maxMacroblocks:396,maxBitrate:768e3,level:13},{maxMacroblocks:396,maxBitrate:2e6,level:20},{maxMacroblocks:792,maxBitrate:4e6,level:21},{maxMacroblocks:1620,maxBitrate:4e6,level:22},{maxMacroblocks:1620,maxBitrate:1e7,level:30},{maxMacroblocks:3600,maxBitrate:14e6,level:31},{maxMacroblocks:5120,maxBitrate:2e7,level:32},{maxMacroblocks:8192,maxBitrate:2e7,level:40},{maxMacroblocks:8192,maxBitrate:5e7,level:41},{maxMacroblocks:8704,maxBitrate:5e7,level:42},{maxMacroblocks:22080,maxBitrate:135e6,level:50},{maxMacroblocks:36864,maxBitrate:24e7,level:51},{maxMacroblocks:36864,maxBitrate:24e7,level:52},{maxMacroblocks:139264,maxBitrate:24e7,level:60},{maxMacroblocks:139264,maxBitrate:48e7,level:61},{maxMacroblocks:139264,maxBitrate:8e8,level:62}],d=[{maxPictureSize:36864,maxBitrate:128e3,tier:"L",level:30},{maxPictureSize:122880,maxBitrate:15e5,tier:"L",level:60},{maxPictureSize:245760,maxBitrate:3e6,tier:"L",level:63},{maxPictureSize:552960,maxBitrate:6e6,tier:"L",level:90},{maxPictureSize:983040,maxBitrate:1e7,tier:"L",level:93},{maxPictureSize:2228224,maxBitrate:12e6,tier:"L",level:120},{maxPictureSize:2228224,maxBitrate:3e7,tier:"H",level:120},{maxPictureSize:2228224,maxBitrate:2e7,tier:"L",level:123},{maxPictureSize:2228224,maxBitrate:5e7,tier:"H",level:123},{maxPictureSize:8912896,maxBitrate:25e6,tier:"L",level:150},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:150},{maxPictureSize:8912896,maxBitrate:4e7,tier:"L",level:153},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:153},{maxPictureSize:8912896,maxBitrate:6e7,tier:"L",level:156},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:156},{maxPictureSize:0x2200000,maxBitrate:6e7,tier:"L",level:180},{maxPictureSize:0x2200000,maxBitrate:24e7,tier:"H",level:180},{maxPictureSize:0x2200000,maxBitrate:12e7,tier:"L",level:183},{maxPictureSize:0x2200000,maxBitrate:48e7,tier:"H",level:183},{maxPictureSize:0x2200000,maxBitrate:24e7,tier:"L",level:186},{maxPictureSize:0x2200000,maxBitrate:8e8,tier:"H",level:186}],u=[{maxPictureSize:36864,maxBitrate:2e5,level:10},{maxPictureSize:73728,maxBitrate:8e5,level:11},{maxPictureSize:122880,maxBitrate:18e5,level:20},{maxPictureSize:245760,maxBitrate:36e5,level:21},{maxPictureSize:552960,maxBitrate:72e5,level:30},{maxPictureSize:983040,maxBitrate:12e6,level:31},{maxPictureSize:2228224,maxBitrate:18e6,level:40},{maxPictureSize:2228224,maxBitrate:3e7,level:41},{maxPictureSize:8912896,maxBitrate:6e7,level:50},{maxPictureSize:8912896,maxBitrate:12e7,level:51},{maxPictureSize:8912896,maxBitrate:18e7,level:52},{maxPictureSize:0x2200000,maxBitrate:18e7,level:60},{maxPictureSize:0x2200000,maxBitrate:24e7,level:61},{maxPictureSize:0x2200000,maxBitrate:48e7,level:62}],h=[{maxPictureSize:147456,maxBitrate:15e5,tier:"M",level:0},{maxPictureSize:278784,maxBitrate:3e6,tier:"M",level:1},{maxPictureSize:665856,maxBitrate:6e6,tier:"M",level:4},{maxPictureSize:1065024,maxBitrate:1e7,tier:"M",level:5},{maxPictureSize:2359296,maxBitrate:12e6,tier:"M",level:8},{maxPictureSize:2359296,maxBitrate:3e7,tier:"H",level:8},{maxPictureSize:2359296,maxBitrate:2e7,tier:"M",level:9},{maxPictureSize:2359296,maxBitrate:5e7,tier:"H",level:9},{maxPictureSize:8912896,maxBitrate:3e7,tier:"M",level:12},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:12},{maxPictureSize:8912896,maxBitrate:4e7,tier:"M",level:13},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:13},{maxPictureSize:8912896,maxBitrate:6e7,tier:"M",level:14},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:14},{maxPictureSize:0x2200000,maxBitrate:6e7,tier:"M",level:15},{maxPictureSize:0x2200000,maxBitrate:24e7,tier:"H",level:15},{maxPictureSize:0x2200000,maxBitrate:6e7,tier:"M",level:16},{maxPictureSize:0x2200000,maxBitrate:24e7,tier:"H",level:16},{maxPictureSize:0x2200000,maxBitrate:1e8,tier:"M",level:17},{maxPictureSize:0x2200000,maxBitrate:48e7,tier:"H",level:17},{maxPictureSize:0x2200000,maxBitrate:16e7,tier:"M",level:18},{maxPictureSize:0x2200000,maxBitrate:8e8,tier:"H",level:18},{maxPictureSize:0x2200000,maxBitrate:16e7,tier:"M",level:19},{maxPictureSize:0x2200000,maxBitrate:8e8,tier:"H",level:19}],m=".01.01.01.01.00",f=".0.110.01.01.01.0",p=(e,t,r,i)=>{if("avc"===e){let e=Math.ceil(t/16)*Math.ceil(r/16),s=c.find(t=>e<=t.maxMacroblocks&&i<=t.maxBitrate)??(0,a._g)(c),n=s?s.level:0,o="64".padStart(2,"0"),l=n.toString(16).padStart(2,"0");return`avc1.${o}00${l}`}if("hevc"===e){let e=t*r,s=d.find(t=>e<=t.maxPictureSize&&i<=t.maxBitrate)??(0,a._g)(d);return`hev1.1.6.${s.tier}${s.level}.B0`}if("vp8"===e)return"vp8";if("vp9"===e){let e=t*r,s=u.find(t=>e<=t.maxPictureSize&&i<=t.maxBitrate)??(0,a._g)(u);return`vp09.00.${s.level.toString().padStart(2,"0")}.08`}if("av1"===e){let e=t*r,s=h.find(t=>e<=t.maxPictureSize&&i<=t.maxBitrate)??(0,a._g)(h),n=s.level.toString().padStart(2,"0");return`av01.0.${n}${s.tier}.08`}throw TypeError(`Unhandled codec '${e}'.`)},g=e=>{let t=e.split("."),r=Number(t[1]);return[1,1,r,2,1,Number(t[2]),3,1,Number(t[3]),4,1,t[4]?Number(t[4]):1]},k=e=>{let t=e.split("."),r=Number(t[1]),a=t[2],i=Number(a.slice(0,-1)),s="H"===a.slice(-1)?1:0,n=Number(t[3]),o=t[4]?Number(t[4]):0,l=t[5]?Number(t[5][0]):1;return[129,(r<<5)+i,(s<<7)+((8===n?0:1)<<6)+0+(o<<4)+(l<<3)+((t[5]?Number(t[5][1]):1)<<2)+(t[5]?Number(t[5][2]):0),0]},b=e=>{let{codec:t,codecDescription:r,colorSpace:i,avcCodecInfo:s,hevcCodecInfo:n,vp9CodecInfo:o,av1CodecInfo:l}=e;if("avc"===t){if(s){let e=new Uint8Array([s.avcProfileIndication,s.profileCompatibility,s.avcLevelIndication]);return`avc1.${(0,a.Br)(e)}`}if(!r||r.byteLength<4)throw TypeError("AVC decoder description is not provided or is not at least 4 bytes long.");return`avc1.${(0,a.Br)(r.subarray(1,4))}`}if("hevc"===t){let e,t,i,s,o,l;if(n)e=n.generalProfileSpace,t=n.generalProfileIdc,i=(0,a.P5)(n.generalProfileCompatibilityFlags),s=n.generalTierFlag,o=n.generalLevelIdc,l=[...n.generalConstraintIndicatorFlags];else{if(!r||r.byteLength<23)throw TypeError("HEVC decoder description is not provided or is not at least 23 bytes long.");let n=(0,a.Zc)(r),c=n.getUint8(1);e=c>>6&3,t=31&c,i=(0,a.P5)(n.getUint32(2)),s=c>>5&1,o=n.getUint8(12),l=[];for(let e=0;e<6;e++)l.push(n.getUint8(6+e))}let c="hev1.";for(c+=["","A","B","C"][e]+t,c+=".",c+=i.toString(16).toUpperCase(),c+=".",c+=0===s?"L":"H",c+=o;l.length>0&&0===l[l.length-1];)l.pop();return l.length>0&&(c+=".",c+=l.map(e=>e.toString(16).toUpperCase()).join(".")),c}if("vp8"===t)return"vp8";if("vp9"===t){if(!o){let t=e.width*e.height,r=(0,a._g)(u).level;for(let e of u)if(t<=e.maxPictureSize){r=e.level;break}return`vp09.00.${r.toString().padStart(2,"0")}.08`}let t=o.profile.toString().padStart(2,"0"),r=o.level.toString().padStart(2,"0"),i=o.bitDepth.toString().padStart(2,"0"),s=o.chromaSubsampling.toString().padStart(2,"0"),n=o.colourPrimaries.toString().padStart(2,"0"),l=o.transferCharacteristics.toString().padStart(2,"0"),c=o.matrixCoefficients.toString().padStart(2,"0"),d=o.videoFullRangeFlag.toString().padStart(2,"0"),h=`vp09.${t}.${r}.${i}.${s}`;return(h+=`.${n}.${l}.${c}.${d}`).endsWith(m)&&(h=h.slice(0,-m.length)),h}if("av1"===t){if(!l){let t=e.width*e.height,r=(0,a._g)(u).level;for(let e of u)if(t<=e.maxPictureSize){r=e.level;break}return`av01.0.${r.toString().padStart(2,"0")}M.08`}let t=l.profile,r=l.level.toString().padStart(2,"0"),s=l.tier?"H":"M",n=l.bitDepth.toString().padStart(2,"0"),o=l.monochrome?"1":"0",c=100*l.chromaSubsamplingX+10*l.chromaSubsamplingY+1*(l.chromaSubsamplingX&&l.chromaSubsamplingY?l.chromaSamplePosition:0),d=i?.primaries?a.wd[i.primaries]:1,h=i?.transfer?a.uN[i.transfer]:1,m=i?.matrix?a.Au[i.matrix]:1,p=i?.fullRange?1:0,g=`av01.${t}.${r}${s}.${n}`;return g+=`.${o}.${c.toString().padStart(3,"0")}`,g+=`.${d.toString().padStart(2,"0")}`,g+=`.${h.toString().padStart(2,"0")}`,g+=`.${m.toString().padStart(2,"0")}`,(g+=`.${p}`).endsWith(f)&&(g=g.slice(0,-f.length)),g}throw TypeError(`Unhandled codec '${t}'.`)},y=(e,t,r)=>{if("aac"===e)return t>=2&&r<=24e3?"mp4a.40.29":r<=24e3?"mp4a.40.5":"mp4a.40.2";if("mp3"===e)return"mp3";if("opus"===e)return"opus";if("vorbis"===e)return"vorbis";if("flac"===e)return"flac";if(s.includes(e))return e;throw TypeError(`Unhandled codec '${e}'.`)},w=e=>{let{codec:t,codecDescription:r,aacCodecInfo:a}=e;if("aac"===t){if(!a)throw TypeError("AAC codec info must be provided.");if(a.isMpeg2)return"mp4a.67";{let e=T(r);return`mp4a.40.${e.objectType}`}}if("mp3"===t)return"mp3";if("opus"===t)return"opus";if("vorbis"===t)return"vorbis";if("flac"===t)return"flac";if(t&&s.includes(t))return t;throw TypeError(`Unhandled codec '${t}'.`)},T=e=>{if(!e||e.byteLength<2)throw TypeError("AAC description must be at least 2 bytes long.");let t=new a._c(e),r=t.readBits(5);31===r&&(r=32+t.readBits(6));let i=t.readBits(4),s=null;if(15===i)s=t.readBits(24);else{let e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i<e.length&&(s=e[i])}let n=t.readBits(4),o=null;return n>=1&&n<=7&&(o=({1:1,2:2,3:3,4:4,5:5,6:6,7:8})[n]),{objectType:r,frequencyIndex:i,sampleRate:s,channelConfiguration:n,numberOfChannels:o}},C=48e3,S=/^pcm-([usf])(\d+)+(be)?$/,v=e=>{let t;if((0,a.vA)(s.includes(e)),"ulaw"===e)return{dataType:"ulaw",sampleSize:1,littleEndian:!0,silentValue:255};if("alaw"===e)return{dataType:"alaw",sampleSize:1,littleEndian:!0,silentValue:213};let r=S.exec(e);return(0,a.vA)(r),t="u"===r[1]?"unsigned":"s"===r[1]?"signed":"float",{dataType:t,sampleSize:Number(r[2])/8,littleEndian:"be"!==r[3],silentValue:"pcm-u8"===e?128:0}},x=e=>{if(e.startsWith("avc1")||e.startsWith("avc3"))return"avc";if(e.startsWith("hev1")||e.startsWith("hvc1"))return"hevc";if("vp8"===e)return"vp8";if(e.startsWith("vp09"))return"vp9";if(e.startsWith("av01"))return"av1";if(e.startsWith("mp4a.40")||"mp4a.67"===e)return"aac";if("mp3"===e||"mp4a.69"===e||"mp4a.6B"===e||"mp4a.6b"===e)return"mp3";if("opus"===e)return"opus";if("vorbis"===e)return"vorbis";if("flac"===e)return"flac";if("ulaw"===e)return"ulaw";if("alaw"===e)return"alaw";else if(S.test(e))return e;return"webvtt"===e?"webvtt":null},A=e=>"avc"===e?{avc:{format:"avc"}}:"hevc"===e?{hevc:{format:"hevc"}}:{},E=e=>"aac"===e?{aac:{format:"aac"}}:"opus"===e?{opus:{format:"opus"}}:{};class I{constructor(e){this._factor=e}_toVideoBitrate(e,t,r){return 1e3*Math.ceil(3e6*Math.pow(t*r/2073600,.95)*({avc:1,hevc:.6,vp9:.6,av1:.4,vp8:1.2})[e]*this._factor/1e3)}_toAudioBitrate(e){if(s.includes(e)||"flac"===e)return;let t={aac:128e3,opus:64e3,mp3:16e4,vorbis:64e3}[e];if(!t)throw Error(`Unhandled codec: ${e}`);let r=t*this._factor;return"aac"===e?r=[96e3,128e3,16e4,192e3].reduce((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e):"opus"===e||"vorbis"===e?r=Math.max(6e3,r):"mp3"===e&&(r=[8e3,16e3,24e3,32e3,4e4,48e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4].reduce((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e)),1e3*Math.round(r/1e3)}}new I(.3),new I(.6),new I(1),new I(2);let P=new I(4),_=["avc1","avc3","hev1","hvc1","vp8","vp09","av01"],R=/^(avc1|avc3)\.[0-9a-fA-F]{6}$/,B=/^(hev1|hvc1)\.(?:[ABC]?\d+)\.[0-9a-fA-F]{1,8}\.[LH]\d+(?:\.[0-9a-fA-F]{1,2}){0,6}$/,M=/^vp09(?:\.\d{2}){3}(?:(?:\.\d{2}){5})?$/,F=/^av01\.\d\.\d{2}[MH]\.\d{2}(?:\.\d\.\d{3}\.\d{2}\.\d{2}\.\d{2}\.\d)?$/,U=e=>{if(!e)throw TypeError("Video chunk metadata must be provided.");if("object"!=typeof e)throw TypeError("Video chunk metadata must be an object.");if(!e.decoderConfig)throw TypeError("Video chunk metadata must include a decoder configuration.");if("object"!=typeof e.decoderConfig)throw TypeError("Video chunk metadata decoder configuration must be an object.");if("string"!=typeof e.decoderConfig.codec)throw TypeError("Video chunk metadata decoder configuration must specify a codec string.");if(!_.some(t=>e.decoderConfig.codec.startsWith(t)))throw TypeError("Video chunk metadata decoder configuration codec string must be a valid video codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(e.decoderConfig.codedWidth)||e.decoderConfig.codedWidth<=0)throw TypeError("Video chunk metadata decoder configuration must specify a valid codedWidth (positive integer).");if(!Number.isInteger(e.decoderConfig.codedHeight)||e.decoderConfig.codedHeight<=0)throw TypeError("Video chunk metadata decoder configuration must specify a valid codedHeight (positive integer).");if(void 0!==e.decoderConfig.description&&!(0,a.SM)(e.decoderConfig.description))throw TypeError("Video chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(void 0!==e.decoderConfig.colorSpace){let{colorSpace:t}=e.decoderConfig;if("object"!=typeof t)throw TypeError("Video chunk metadata decoder configuration colorSpace, when provided, must be an object.");let r=Object.keys(a.wd);if(null!=t.primaries&&!r.includes(t.primaries))throw TypeError(`Video chunk metadata decoder configuration colorSpace primaries, when defined, must be one of ${r.join(", ")}.`);let i=Object.keys(a.uN);if(null!=t.transfer&&!i.includes(t.transfer))throw TypeError(`Video chunk metadata decoder configuration colorSpace transfer, when defined, must be one of ${i.join(", ")}.`);let s=Object.keys(a.Au);if(null!=t.matrix&&!s.includes(t.matrix))throw TypeError(`Video chunk metadata decoder configuration colorSpace matrix, when defined, must be one of ${s.join(", ")}.`);if(null!=t.fullRange&&"boolean"!=typeof t.fullRange)throw TypeError("Video chunk metadata decoder configuration colorSpace fullRange, when defined, must be a boolean.")}if(e.decoderConfig.codec.startsWith("avc1")||e.decoderConfig.codec.startsWith("avc3")){if(!R.test(e.decoderConfig.codec))throw TypeError("Video chunk metadata decoder configuration codec string for AVC must be a valid AVC codec string as specified in Section 3.4 of RFC 6381.")}else if(e.decoderConfig.codec.startsWith("hev1")||e.decoderConfig.codec.startsWith("hvc1")){if(!B.test(e.decoderConfig.codec))throw TypeError("Video chunk metadata decoder configuration codec string for HEVC must be a valid HEVC codec string as specified in Section E.3 of ISO 14496-15.")}else if(e.decoderConfig.codec.startsWith("vp8")){if("vp8"!==e.decoderConfig.codec)throw TypeError('Video chunk metadata decoder configuration codec string for VP8 must be "vp8".')}else if(e.decoderConfig.codec.startsWith("vp09")){if(!M.test(e.decoderConfig.codec))throw TypeError('Video chunk metadata decoder configuration codec string for VP9 must be a valid VP9 codec string as specified in Section "Codecs Parameter String" of https://www.webmproject.org/vp9/mp4/.')}else if(e.decoderConfig.codec.startsWith("av01")&&!F.test(e.decoderConfig.codec))throw TypeError('Video chunk metadata decoder configuration codec string for AV1 must be a valid AV1 codec string as specified in Section "Codecs Parameter String" of https://aomediacodec.github.io/av1-isobmff/.')},D=["mp4a","mp3","opus","vorbis","flac","ulaw","alaw","pcm"],z=e=>{if(!e)throw TypeError("Audio chunk metadata must be provided.");if("object"!=typeof e)throw TypeError("Audio chunk metadata must be an object.");if(!e.decoderConfig)throw TypeError("Audio chunk metadata must include a decoder configuration.");if("object"!=typeof e.decoderConfig)throw TypeError("Audio chunk metadata decoder configuration must be an object.");if("string"!=typeof e.decoderConfig.codec)throw TypeError("Audio chunk metadata decoder configuration must specify a codec string.");if(!D.some(t=>e.decoderConfig.codec.startsWith(t)))throw TypeError("Audio chunk metadata decoder configuration codec string must be a valid audio codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(e.decoderConfig.sampleRate)||e.decoderConfig.sampleRate<=0)throw TypeError("Audio chunk metadata decoder configuration must specify a valid sampleRate (positive integer).");if(!Number.isInteger(e.decoderConfig.numberOfChannels)||e.decoderConfig.numberOfChannels<=0)throw TypeError("Audio chunk metadata decoder configuration must specify a valid numberOfChannels (positive integer).");if(void 0!==e.decoderConfig.description&&!(0,a.SM)(e.decoderConfig.description))throw TypeError("Audio chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(e.decoderConfig.codec.startsWith("mp4a")&&"mp4a.69"!==e.decoderConfig.codec&&"mp4a.6B"!==e.decoderConfig.codec&&"mp4a.6b"!==e.decoderConfig.codec){if(!["mp4a.40.2","mp4a.40.02","mp4a.40.5","mp4a.40.05","mp4a.40.29","mp4a.67"].includes(e.decoderConfig.codec))throw TypeError("Audio chunk metadata decoder configuration codec string for AAC must be a valid AAC codec string as specified in https://www.w3.org/TR/webcodecs-aac-codec-registration/.");if(!e.decoderConfig.description)throw TypeError("Audio chunk metadata decoder configuration for AAC must include a description, which is expected to be an AudioSpecificConfig as specified in ISO 14496-3.")}else if(e.decoderConfig.codec.startsWith("mp3")||e.decoderConfig.codec.startsWith("mp4a")){if("mp3"!==e.decoderConfig.codec&&"mp4a.69"!==e.decoderConfig.codec&&"mp4a.6B"!==e.decoderConfig.codec&&"mp4a.6b"!==e.decoderConfig.codec)throw TypeError('Audio chunk metadata decoder configuration codec string for MP3 must be "mp3", "mp4a.69" or "mp4a.6B".')}else if(e.decoderConfig.codec.startsWith("opus")){if("opus"!==e.decoderConfig.codec)throw TypeError('Audio chunk metadata decoder configuration codec string for Opus must be "opus".');if(e.decoderConfig.description&&e.decoderConfig.description.byteLength<18)throw TypeError("Audio chunk metadata decoder configuration description, when specified, is expected to be an Identification Header as specified in Section 5.1 of RFC 7845.")}else if(e.decoderConfig.codec.startsWith("vorbis")){if("vorbis"!==e.decoderConfig.codec)throw TypeError('Audio chunk metadata decoder configuration codec string for Vorbis must be "vorbis".');if(!e.decoderConfig.description)throw TypeError("Audio chunk metadata decoder configuration for Vorbis must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-vorbis-codec-registration/.")}else if(e.decoderConfig.codec.startsWith("flac")){if("flac"!==e.decoderConfig.codec)throw TypeError('Audio chunk metadata decoder configuration codec string for FLAC must be "flac".');if(!e.decoderConfig.description||e.decoderConfig.description.byteLength<42)throw TypeError("Audio chunk metadata decoder configuration for FLAC must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-flac-codec-registration/.")}else if((e.decoderConfig.codec.startsWith("pcm")||e.decoderConfig.codec.startsWith("ulaw")||e.decoderConfig.codec.startsWith("alaw"))&&!s.includes(e.decoderConfig.codec))throw TypeError(`Audio chunk metadata decoder configuration codec string for PCM must be one of the supported PCM codecs (${s.join(", ")}).`)},O=e=>{if(!e)throw TypeError("Subtitle metadata must be provided.");if("object"!=typeof e)throw TypeError("Subtitle metadata must be an object.");if(!e.config)throw TypeError("Subtitle metadata must include a config object.");if("object"!=typeof e.config)throw TypeError("Subtitle metadata config must be an object.");if("string"!=typeof e.config.description)throw TypeError("Subtitle metadata config description must be a string.")}},131110:(e,t,r)=>{"use strict";r.d(t,{Lr:()=>n,WE:()=>s,wb:()=>a,zx:()=>i});let a=[],i=[],s=[],n=[]},602805:(e,t,r)=>{"use strict";r.d(t,{B:()=>a});/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class a{constructor(e){this.input=e}}},392528:(e,t,r)=>{"use strict";r.d(t,{CW:()=>q,uS:()=>Q});var a,i=r(496023),s=r(481140),n=r(602805),o=r(574019),l=r(250601),c=r(909929),d=r(107530),u=r(955911),h=r(492648);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class m extends n.B{constructor(e){super(e),this.currentTrack=null,this.tracks=[],this.metadataPromise=null,this.movieTimescale=-1,this.movieDurationInTimescale=-1,this.isQuickTime=!1,this.isFragmented=!1,this.fragmentTrackDefaults=[],this.fragments=[],this.currentFragment=null,this.fragmentLookupMutex=new l.aD,this.metadataReader=new h.oj(e._mainReader),this.chunkReader=new h.oj(new d.m(e.source,0x4000000))}async computeDuration(){let e=await this.getTracks();return Math.max(0,...await Promise.all(e.map(e=>e.computeDuration())))}async getTracks(){return await this.readMetadata(),this.tracks.map(e=>e.inputTrack)}async getMimeType(){await this.readMetadata();let e=await Promise.all(this.tracks.map(e=>e.inputTrack.getCodecParameterString()));return(0,u.X)({isQuickTime:this.isQuickTime,hasVideo:this.tracks.some(e=>e.info?.type==="video"),hasAudio:this.tracks.some(e=>e.info?.type==="audio"),codecStrings:e.filter(Boolean)})}readMetadata(){return this.metadataPromise??=(async()=>{let e=await this.metadataReader.reader.source.getSize();for(;this.metadataReader.pos<e;){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+h.Xk);let e=this.metadataReader.pos,t=this.metadataReader.readBoxHeader();if("ftyp"===t.name){let e=this.metadataReader.readAscii(4);this.isQuickTime="qt  "===e}else if("moov"===t.name){for(let e of(await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+t.contentSize),this.readContiguousBoxes(t.contentSize),this.tracks)){let t=e.editListPreviousSegmentDurations/this.movieTimescale;e.editListOffset-=Math.round(t*e.timescale)}break}this.metadataReader.pos=e+t.totalSize}if(this.isFragmented){await this.metadataReader.reader.loadRange(e-4,e),this.metadataReader.pos=e-4;let t=e-this.metadataReader.readU32();if(t>=0&&t<e){await this.metadataReader.reader.loadRange(t,e),this.metadataReader.pos=t;let r=this.metadataReader.readBoxHeader();"mfra"===r.name&&this.readContiguousBoxes(r.contentSize)}}})()}getSampleTableForTrack(e){if(e.sampleTable)return e.sampleTable;let t={sampleTimingEntries:[],sampleCompositionTimeOffsets:[],sampleSizes:[],keySampleIndices:null,chunkOffsets:[],sampleToChunk:[],presentationTimestamps:null,presentationTimestampIndexMap:null};if(e.sampleTable=t,this.metadataReader.pos=e.sampleTableByteOffset,this.currentTrack=e,this.traverseBox(),this.currentTrack=null,e.info?.type==="audio"&&e.info.codec&&i.Wq.includes(e.info.codec)&&0===t.sampleCompositionTimeOffsets.length){(0,l.vA)(e.info?.type==="audio");let r=(0,i.Ei)(e.info.codec),a=[],s=[];for(let i=0;i<t.sampleToChunk.length;i++){let n=t.sampleToChunk[i],o=t.sampleToChunk[i+1],c=(o?o.startChunkIndex:t.chunkOffsets.length)-n.startChunkIndex;for(let i=0;i<c;i++){let o=n.startSampleIndex+i*n.samplesPerChunk,c=o+n.samplesPerChunk,d=(0,l.eE)(t.sampleTimingEntries,o,e=>e.startIndex),u=t.sampleTimingEntries[d],h=(0,l.eE)(t.sampleTimingEntries,c,e=>e.startIndex),m=t.sampleTimingEntries[h],f=u.startDecodeTimestamp+(o-u.startIndex)*u.delta,p=m.startDecodeTimestamp+(c-m.startIndex)*m.delta-f,g=(0,l._g)(a);g&&g.delta===p?g.count++:a.push({startIndex:n.startChunkIndex+i,startDecodeTimestamp:f,count:1,delta:p});let k=n.samplesPerChunk*r.sampleSize*e.info.numberOfChannels;s.push(k)}n.startSampleIndex=n.startChunkIndex,n.samplesPerChunk=1}t.sampleTimingEntries=a,t.sampleSizes=s}if(t.sampleCompositionTimeOffsets.length>0){for(let e of(t.presentationTimestamps=[],t.sampleTimingEntries))for(let r=0;r<e.count;r++)t.presentationTimestamps.push({presentationTimestamp:e.startDecodeTimestamp+r*e.delta,sampleIndex:e.startIndex+r});for(let e of t.sampleCompositionTimeOffsets)for(let r=0;r<e.count;r++){let a=e.startIndex+r,i=t.presentationTimestamps[a];i&&(i.presentationTimestamp+=e.offset)}t.presentationTimestamps.sort((e,t)=>e.presentationTimestamp-t.presentationTimestamp),t.presentationTimestampIndexMap=Array(t.presentationTimestamps.length).fill(-1);for(let e=0;e<t.presentationTimestamps.length;e++)t.presentationTimestampIndexMap[t.presentationTimestamps[e].sampleIndex]=e}return t}async readFragment(){let e=this.metadataReader.pos;await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+h.Xk);let t=this.metadataReader.readBoxHeader();(0,l.vA)("moof"===t.name);let r=this.metadataReader.pos;await this.metadataReader.reader.loadRange(r,r+t.contentSize),this.metadataReader.pos=e,this.traverseBox();let a=(0,l.pl)(this.fragments,e,e=>e.moofOffset);(0,l.vA)(-1!==a);let i=this.fragments[a];for(let[a,s]of((0,l.vA)(i.moofOffset===e),this.metadataReader.reader.forgetRange(r,r+t.contentSize),i.trackData)){if(s.startTimestampIsFinal)continue;let t=this.tracks.find(e=>e.id===a);this.metadataReader.pos=0;let r=null,i=null,n=(0,l.eE)(t.fragments,e-1,e=>e.moofOffset);-1!==n&&(i=r=t.fragments[n],this.metadataReader.pos=r.moofOffset+r.moofSize);let o=0===this.metadataReader.pos;for(;this.metadataReader.pos<e;){if(r?.nextFragment)r=r.nextFragment,this.metadataReader.pos=r.moofOffset+r.moofSize;else{await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+h.Xk);let e=this.metadataReader.pos,t=this.metadataReader.readBoxHeader();if("moof"===t.name){let t;let a=(0,l.pl)(this.fragments,e,e=>e.moofOffset);-1===a?(this.metadataReader.pos=e,t=await this.readFragment()):t=this.fragments[a],r&&(r.nextFragment=t),r=t,o&&(t.isKnownToBeFirstFragment=!0,o=!1)}this.metadataReader.pos=e+t.totalSize}r&&r.trackData.has(a)&&(i=r)}if(i){let e=i.trackData.get(a);(0,l.vA)(e.startTimestampIsFinal),T(s,e.endTimestamp)}s.startTimestampIsFinal=!0}return i}readContiguousBoxes(e){let t=this.metadataReader.pos;for(;this.metadataReader.pos-t<=e-h.ZM;)this.traverseBox()}traverseBox(){let e=this.metadataReader.pos,t=this.metadataReader.readBoxHeader(),r=e+t.totalSize;switch(t.name){case"mdia":case"minf":case"dinf":case"mfra":case"edts":case"wave":this.readContiguousBoxes(t.contentSize);break;case"mvhd":{let e=this.metadataReader.readU8();this.metadataReader.pos+=3,1===e?(this.metadataReader.pos+=16,this.movieTimescale=this.metadataReader.readU32(),this.movieDurationInTimescale=this.metadataReader.readU64()):(this.metadataReader.pos+=8,this.movieTimescale=this.metadataReader.readU32(),this.movieDurationInTimescale=this.metadataReader.readU32())}break;case"trak":{let e={id:-1,demuxer:this,inputTrack:null,info:null,timescale:-1,durationInMovieTimescale:-1,durationInMediaTimescale:-1,rotation:0,languageCode:l.IR,sampleTableByteOffset:-1,sampleTable:null,fragmentLookupTable:null,currentFragmentState:null,fragments:[],fragmentsWithKeyFrame:[],editListPreviousSegmentDurations:0,editListOffset:0};this.currentTrack=e,this.readContiguousBoxes(t.contentSize),-1!==e.id&&-1!==e.timescale&&null!==e.info&&("video"===e.info.type&&-1!==e.info.width?(e.inputTrack=new o.N0(new p(e)),this.tracks.push(e)):"audio"===e.info.type&&-1!==e.info.numberOfChannels&&(e.inputTrack=new o.Yi(new g(e)),this.tracks.push(e))),this.currentTrack=null}break;case"tkhd":{let e=this.currentTrack;(0,l.vA)(e);let t=this.metadataReader.readU8();if(!((1&this.metadataReader.readU24())!=0))break;if(0===t)this.metadataReader.pos+=8,e.id=this.metadataReader.readU32(),this.metadataReader.pos+=4,e.durationInMovieTimescale=this.metadataReader.readU32();else if(1===t)this.metadataReader.pos+=16,e.id=this.metadataReader.readU32(),this.metadataReader.pos+=4,e.durationInMovieTimescale=this.metadataReader.readU64();else throw Error(`Incorrect track header version ${t}.`);this.metadataReader.pos+=16;let r=[this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_2_30(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_2_30(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_16_16(),this.metadataReader.readFixed_2_30()],a=(0,l.qT)((0,l.in)(C(r),90));(0,l.vA)(0===a||90===a||180===a||270===a),e.rotation=a}break;case"elst":{let e=this.currentTrack;(0,l.vA)(e);let t=this.metadataReader.readU8();this.metadataReader.pos+=3;let r=!1,a=0,i=this.metadataReader.readU32();for(let s=0;s<i;s++){let i=1===t?this.metadataReader.readU64():this.metadataReader.readU32(),s=1===t?this.metadataReader.readI64():this.metadataReader.readI32(),n=this.metadataReader.readFixed_16_16();if(0!==i){if(r){console.warn("Unsupported edit list: multiple edits are not currently supported. Only using first edit.");break}if(-1===s){a+=i;continue}if(1!==n){console.warn("Unsupported edit list entry: media rate must be 1.");break}e.editListPreviousSegmentDurations=a,e.editListOffset=s,r=!0}}}break;case"mdhd":{let e=this.currentTrack;(0,l.vA)(e);let t=this.metadataReader.readU8();this.metadataReader.pos+=3,0===t?(this.metadataReader.pos+=8,e.timescale=this.metadataReader.readU32(),e.durationInMediaTimescale=this.metadataReader.readU32()):1===t&&(this.metadataReader.pos+=16,e.timescale=this.metadataReader.readU32(),e.durationInMediaTimescale=this.metadataReader.readU64());let r=this.metadataReader.readU16();if(r>0){e.languageCode="";for(let t=0;t<3;t++)e.languageCode=String.fromCharCode(96+(31&r))+e.languageCode,r>>=5;(0,l.Nu)(e.languageCode)||(e.languageCode=l.IR)}}break;case"hdlr":{let e=this.currentTrack;(0,l.vA)(e),this.metadataReader.pos+=8;let t=this.metadataReader.readAscii(4);"vide"===t?e.info={type:"video",width:-1,height:-1,codec:null,codecDescription:null,colorSpace:null,avcCodecInfo:null,hevcCodecInfo:null,vp9CodecInfo:null,av1CodecInfo:null}:"soun"===t&&(e.info={type:"audio",numberOfChannels:-1,sampleRate:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case"stbl":{let r=this.currentTrack;(0,l.vA)(r),r.sampleTableByteOffset=e,this.readContiguousBoxes(t.contentSize)}break;case"stsd":{let e=this.currentTrack;if((0,l.vA)(e),null===e.info||e.sampleTable)break;let t=this.metadataReader.readU8();this.metadataReader.pos+=3;let r=this.metadataReader.readU32();for(let a=0;a<r;a++){let r=this.metadataReader.pos,a=this.metadataReader.readBoxHeader(),i=a.name.toLowerCase();if("video"===e.info.type)"avc1"===i?e.info.codec="avc":"hvc1"===i||"hev1"===i?e.info.codec="hevc":"vp08"===i?e.info.codec="vp8":"vp09"===i?e.info.codec="vp9":"av01"===i?e.info.codec="av1":console.warn(`Unsupported video codec (sample entry type '${a.name}').`),this.metadataReader.pos+=24,e.info.width=this.metadataReader.readU16(),e.info.height=this.metadataReader.readU16(),this.metadataReader.pos+=50,this.readContiguousBoxes(r+a.totalSize-this.metadataReader.pos);else{"mp4a"===i||("opus"===i?e.info.codec="opus":"flac"===i?e.info.codec="flac":"twos"===i||"sowt"===i||"raw "===i||"in24"===i||"in32"===i||"fl32"===i||"fl64"===i||"lpcm"===i||"ipcm"===i||"fpcm"===i||("ulaw"===i?e.info.codec="ulaw":"alaw"===i?e.info.codec="alaw":console.warn(`Unsupported audio codec (sample entry type '${a.name}').`))),this.metadataReader.pos+=8;let s=this.metadataReader.readU16();this.metadataReader.pos+=6;let n=this.metadataReader.readU16(),o=this.metadataReader.readU16();this.metadataReader.pos+=4;let l=this.metadataReader.readU32()/65536;if(0===t&&s>0){if(1===s)this.metadataReader.pos+=4,o=8*this.metadataReader.readU32(),this.metadataReader.pos+=8;else if(2===s){this.metadataReader.pos+=4,l=this.metadataReader.readF64(),n=this.metadataReader.readU32(),this.metadataReader.pos+=4,o=this.metadataReader.readU32();let t=this.metadataReader.readU32();if(this.metadataReader.pos+=8,"lpcm"===i){let r=o+7>>3,a=!!(1&t),i=!!(2&t),s=4&t?-1:0;o>0&&o<=64&&(a?32===o&&(e.info.codec=i?"pcm-f32be":"pcm-f32"):s&1<<r-1?1===r?e.info.codec="pcm-s8":2===r?e.info.codec=i?"pcm-s16be":"pcm-s16":3===r?e.info.codec=i?"pcm-s24be":"pcm-s24":4===r&&(e.info.codec=i?"pcm-s32be":"pcm-s32"):1===r&&(e.info.codec="pcm-u8")),null===e.info.codec&&console.warn("Unsupported PCM format.")}}}e.info.numberOfChannels=n,e.info.sampleRate=l,"twos"===i?8===o?e.info.codec="pcm-s8":16===o?e.info.codec="pcm-s16be":(console.warn(`Unsupported sample size ${o} for codec 'twos'.`),e.info.codec=null):"sowt"===i?8===o?e.info.codec="pcm-s8":16===o?e.info.codec="pcm-s16":(console.warn(`Unsupported sample size ${o} for codec 'sowt'.`),e.info.codec=null):"raw "===i?e.info.codec="pcm-u8":"in24"===i?e.info.codec="pcm-s24be":"in32"===i?e.info.codec="pcm-s32be":"fl32"===i?e.info.codec="pcm-f32be":"fl64"===i?e.info.codec="pcm-f64be":"ipcm"===i?e.info.codec="pcm-s16be":"fpcm"===i&&(e.info.codec="pcm-f32be"),this.readContiguousBoxes(r+a.totalSize-this.metadataReader.pos)}}}break;case"avcC":{let e=this.currentTrack;(0,l.vA)(e&&e.info),e.info.codecDescription=this.metadataReader.readBytes(t.contentSize)}break;case"hvcC":{let e=this.currentTrack;(0,l.vA)(e&&e.info),e.info.codecDescription=this.metadataReader.readBytes(t.contentSize)}break;case"vpcC":{let e=this.currentTrack;(0,l.vA)(e&&e.info?.type==="video"),this.metadataReader.pos+=4;let t=this.metadataReader.readU8(),r=this.metadataReader.readU8(),a=this.metadataReader.readU8(),i=this.metadataReader.readU8(),s=this.metadataReader.readU8(),n=this.metadataReader.readU8();e.info.vp9CodecInfo={profile:t,level:r,bitDepth:a>>4,chromaSubsampling:a>>1&7,videoFullRangeFlag:1&a,colourPrimaries:i,transferCharacteristics:s,matrixCoefficients:n}}break;case"av1C":{let e=this.currentTrack;(0,l.vA)(e&&e.info?.type==="video"),this.metadataReader.pos+=1;let t=this.metadataReader.readU8(),r=t>>5,a=this.metadataReader.readU8(),i=a>>6&1;e.info.av1CodecInfo={profile:r,level:31&t,tier:a>>7,bitDepth:2==r&&i?a>>5&1?12:10:i?10:8,monochrome:a>>4&1,chromaSubsamplingX:a>>3&1,chromaSubsamplingY:a>>2&1,chromaSamplePosition:3&a}}break;case"colr":{let e=this.currentTrack;if((0,l.vA)(e&&e.info?.type==="video"),"nclx"!==this.metadataReader.readAscii(4))break;let t=this.metadataReader.readU16(),r=this.metadataReader.readU16(),a=this.metadataReader.readU16(),i=!!(128&this.metadataReader.readU8());e.info.colorSpace={primaries:l.BL[t],transfer:l.x_[r],matrix:l.fl[a],fullRange:i}}break;case"esds":{let e=this.currentTrack;(0,l.vA)(e&&e.info?.type==="audio"),this.metadataReader.pos+=4;let t=this.metadataReader.readU8();(0,l.vA)(3===t),this.metadataReader.readIsomVariableInteger(),this.metadataReader.pos+=2;let r=this.metadataReader.readU8();if((128&r)!=0&&(this.metadataReader.pos+=2),(64&r)!=0){let e=this.metadataReader.readU8();this.metadataReader.pos+=e}(32&r)!=0&&(this.metadataReader.pos+=2);let a=this.metadataReader.readU8();(0,l.vA)(4===a);let s=this.metadataReader.readIsomVariableInteger(),n=this.metadataReader.pos,o=this.metadataReader.readU8();if(64===o||103===o?(e.info.codec="aac",e.info.aacCodecInfo={isMpeg2:103===o}):105===o||107===o?e.info.codec="mp3":221===o?e.info.codec="vorbis":console.warn(`Unsupported audio codec (objectTypeIndication ${o}) - discarding track.`),this.metadataReader.pos+=12,s>this.metadataReader.pos-n){let t=this.metadataReader.readU8();(0,l.vA)(5===t);let r=this.metadataReader.readIsomVariableInteger();if(e.info.codecDescription=this.metadataReader.readBytes(r),"aac"===e.info.codec){let t=(0,i.zF)(e.info.codecDescription);null!==t.numberOfChannels&&(e.info.numberOfChannels=t.numberOfChannels),null!==t.sampleRate&&(e.info.sampleRate=t.sampleRate)}}}break;case"enda":{let e=this.currentTrack;(0,l.vA)(e&&e.info?.type==="audio"),255&this.metadataReader.readU16()&&("pcm-s16be"===e.info.codec?e.info.codec="pcm-s16":"pcm-s24be"===e.info.codec?e.info.codec="pcm-s24":"pcm-s32be"===e.info.codec?e.info.codec="pcm-s32":"pcm-f32be"===e.info.codec?e.info.codec="pcm-f32":"pcm-f64be"===e.info.codec&&(e.info.codec="pcm-f64"))}break;case"pcmC":{let e=this.currentTrack;(0,l.vA)(e&&e.info?.type==="audio"),this.metadataReader.pos+=4;let t=!!(1&this.metadataReader.readU8()),r=this.metadataReader.readU8();"pcm-s16be"===e.info.codec?t?16===r?e.info.codec="pcm-s16":24===r?e.info.codec="pcm-s24":32===r?e.info.codec="pcm-s32":(console.warn(`Invalid ipcm sample size ${r}.`),e.info.codec=null):16===r?e.info.codec="pcm-s16be":24===r?e.info.codec="pcm-s24be":32===r?e.info.codec="pcm-s32be":(console.warn(`Invalid ipcm sample size ${r}.`),e.info.codec=null):"pcm-f32be"===e.info.codec&&(t?32===r?e.info.codec="pcm-f32":64===r?e.info.codec="pcm-f64":(console.warn(`Invalid fpcm sample size ${r}.`),e.info.codec=null):32===r?e.info.codec="pcm-f32be":64===r?e.info.codec="pcm-f64be":(console.warn(`Invalid fpcm sample size ${r}.`),e.info.codec=null));break}case"dOps":{let e;let t=this.currentTrack;(0,l.vA)(t&&t.info?.type==="audio"),this.metadataReader.pos+=1;let r=this.metadataReader.readU8(),a=this.metadataReader.readU16(),i=this.metadataReader.readU32(),s=this.metadataReader.readI16(),n=this.metadataReader.readU8();e=0!==n?this.metadataReader.readBytes(2+r):new Uint8Array(0);let o=new Uint8Array(19+e.byteLength),c=new DataView(o.buffer);c.setUint32(0,0x4f707573,!1),c.setUint32(4,0x48656164,!1),c.setUint8(8,1),c.setUint8(9,r),c.setUint16(10,a,!0),c.setUint32(12,i,!0),c.setInt16(16,s,!0),c.setUint8(18,n),o.set(e,19),t.info.codecDescription=o,t.info.numberOfChannels=r,t.info.sampleRate=i}break;case"dfLa":{let e=this.currentTrack;(0,l.vA)(e&&e.info?.type==="audio"),this.metadataReader.pos+=4;let t=this.metadataReader.pos;for(;this.metadataReader.pos<r;){let t=this.metadataReader.readU8(),r=this.metadataReader.readU24();if(0==(127&t)){this.metadataReader.pos+=10;let t=this.metadataReader.readU32(),r=t>>>12,a=(t>>9&7)+1;e.info.sampleRate=r,e.info.numberOfChannels=a,this.metadataReader.pos+=20}else this.metadataReader.pos+=r;if(128&t)break}let a=this.metadataReader.pos;this.metadataReader.pos=t;let i=this.metadataReader.readBytes(a-t),s=new Uint8Array(4+i.byteLength);new DataView(s.buffer).setUint32(0,0x664c6143,!1),s.set(i,4),e.info.codecDescription=s}break;case"stts":{let e=this.currentTrack;if((0,l.vA)(e),!e.sampleTable)break;this.metadataReader.pos+=4;let t=this.metadataReader.readU32(),r=0,a=0;for(let i=0;i<t;i++){let t=this.metadataReader.readU32(),i=this.metadataReader.readU32();e.sampleTable.sampleTimingEntries.push({startIndex:r,startDecodeTimestamp:a,count:t,delta:i}),r+=t,a+=t*i}}break;case"ctts":{let e=this.currentTrack;if((0,l.vA)(e),!e.sampleTable)break;this.metadataReader.pos+=4;let t=this.metadataReader.readU32(),r=0;for(let a=0;a<t;a++){let t=this.metadataReader.readU32(),a=this.metadataReader.readI32();e.sampleTable.sampleCompositionTimeOffsets.push({startIndex:r,count:t,offset:a}),r+=t}}break;case"stsz":{let e=this.currentTrack;if((0,l.vA)(e),!e.sampleTable)break;this.metadataReader.pos+=4;let t=this.metadataReader.readU32(),r=this.metadataReader.readU32();if(0===t)for(let t=0;t<r;t++){let t=this.metadataReader.readU32();e.sampleTable.sampleSizes.push(t)}else e.sampleTable.sampleSizes.push(t)}break;case"stz2":{let e=this.currentTrack;if((0,l.vA)(e),!e.sampleTable)break;this.metadataReader.pos+=4,this.metadataReader.pos+=3;let t=this.metadataReader.readU8(),r=this.metadataReader.readU32(),a=this.metadataReader.readBytes(Math.ceil(r*t/8)),i=new l._c(a);for(let a=0;a<r;a++){let r=i.readBits(t);e.sampleTable.sampleSizes.push(r)}}break;case"stss":{let e=this.currentTrack;if((0,l.vA)(e),!e.sampleTable)break;this.metadataReader.pos+=4,e.sampleTable.keySampleIndices=[];let t=this.metadataReader.readU32();for(let r=0;r<t;r++){let t=this.metadataReader.readU32()-1;e.sampleTable.keySampleIndices.push(t)}0!==e.sampleTable.keySampleIndices[0]&&e.sampleTable.keySampleIndices.unshift(0)}break;case"stsc":{let e=this.currentTrack;if((0,l.vA)(e),!e.sampleTable)break;this.metadataReader.pos+=4;let t=this.metadataReader.readU32();for(let r=0;r<t;r++){let t=this.metadataReader.readU32()-1,r=this.metadataReader.readU32(),a=this.metadataReader.readU32();e.sampleTable.sampleToChunk.push({startSampleIndex:-1,startChunkIndex:t,samplesPerChunk:r,sampleDescriptionIndex:a})}let r=0;for(let t=0;t<e.sampleTable.sampleToChunk.length;t++)e.sampleTable.sampleToChunk[t].startSampleIndex=r,t<e.sampleTable.sampleToChunk.length-1&&(r+=(e.sampleTable.sampleToChunk[t+1].startChunkIndex-e.sampleTable.sampleToChunk[t].startChunkIndex)*e.sampleTable.sampleToChunk[t].samplesPerChunk)}break;case"stco":{let e=this.currentTrack;if((0,l.vA)(e),!e.sampleTable)break;this.metadataReader.pos+=4;let t=this.metadataReader.readU32();for(let r=0;r<t;r++){let t=this.metadataReader.readU32();e.sampleTable.chunkOffsets.push(t)}}break;case"co64":{let e=this.currentTrack;if((0,l.vA)(e),!e.sampleTable)break;this.metadataReader.pos+=4;let t=this.metadataReader.readU32();for(let r=0;r<t;r++){let t=this.metadataReader.readU64();e.sampleTable.chunkOffsets.push(t)}}break;case"mvex":this.isFragmented=!0,this.readContiguousBoxes(t.contentSize);break;case"mehd":{let e=this.metadataReader.readU8();this.metadataReader.pos+=3;let t=1===e?this.metadataReader.readU64():this.metadataReader.readU32();this.movieDurationInTimescale=t}break;case"trex":{this.metadataReader.pos+=4;let e=this.metadataReader.readU32(),t=this.metadataReader.readU32(),r=this.metadataReader.readU32(),a=this.metadataReader.readU32(),i=this.metadataReader.readU32();this.fragmentTrackDefaults.push({trackId:e,defaultSampleDescriptionIndex:t,defaultSampleDuration:r,defaultSampleSize:a,defaultSampleFlags:i})}break;case"tfra":{let e=this.metadataReader.readU8();this.metadataReader.pos+=3;let t=this.metadataReader.readU32(),r=this.tracks.find(e=>e.id===t);if(!r)break;r.fragmentLookupTable=[];let a=this.metadataReader.readU32(),i=this.metadataReader,s=[i.readU8.bind(i),i.readU16.bind(i),i.readU24.bind(i),i.readU32.bind(i)],n=s[(48&a)>>4],o=s[(12&a)>>2],l=s[3&a],c=this.metadataReader.readU32();for(let t=0;t<c;t++){let t=1===e?this.metadataReader.readU64():this.metadataReader.readU32(),a=1===e?this.metadataReader.readU64():this.metadataReader.readU32();n(),o(),l(),r.fragmentLookupTable.push({timestamp:t,moofOffset:a})}}break;case"moof":for(let[,r]of(this.currentFragment={moofOffset:e,moofSize:t.totalSize,implicitBaseDataOffset:e,trackData:new Map,dataStart:1/0,dataEnd:0,nextFragment:null,isKnownToBeFirstFragment:!1},this.readContiguousBoxes(t.contentSize),(0,l.h8)(this.fragments,this.currentFragment,e=>e.moofOffset),this.currentFragment.trackData)){let e=r.samples[0],t=(0,l._g)(r.samples);this.currentFragment.dataStart=Math.min(this.currentFragment.dataStart,e.byteOffset),this.currentFragment.dataEnd=Math.max(this.currentFragment.dataEnd,t.byteOffset+t.byteSize)}this.currentFragment=null;break;case"traf":if((0,l.vA)(this.currentFragment),this.readContiguousBoxes(t.contentSize),this.currentTrack){let e=this.currentFragment.trackData.get(this.currentTrack.id);if(e){(0,l.h8)(this.currentTrack.fragments,this.currentFragment,e=>e.moofOffset),null!==e.firstKeyFrameTimestamp&&(0,l.h8)(this.currentTrack.fragmentsWithKeyFrame,this.currentFragment,e=>e.moofOffset);let{currentFragmentState:t}=this.currentTrack;(0,l.vA)(t),null!==t.startTimestamp&&(T(e,t.startTimestamp),e.startTimestampIsFinal=!0)}this.currentTrack.currentFragmentState=null,this.currentTrack=null}break;case"tfhd":{(0,l.vA)(this.currentFragment),this.metadataReader.pos+=1;let e=this.metadataReader.readU24(),t=this.metadataReader.readU32(),r=this.tracks.find(e=>e.id===t);if(!r)break;let a=this.fragmentTrackDefaults.find(e=>e.trackId===t);this.currentTrack=r,r.currentFragmentState={baseDataOffset:this.currentFragment.implicitBaseDataOffset,sampleDescriptionIndex:a?.defaultSampleDescriptionIndex??null,defaultSampleDuration:a?.defaultSampleDuration??null,defaultSampleSize:a?.defaultSampleSize??null,defaultSampleFlags:a?.defaultSampleFlags??null,startTimestamp:null},1&e?r.currentFragmentState.baseDataOffset=this.metadataReader.readU64():131072&e&&(r.currentFragmentState.baseDataOffset=this.currentFragment.moofOffset),2&e&&(r.currentFragmentState.sampleDescriptionIndex=this.metadataReader.readU32()),8&e&&(r.currentFragmentState.defaultSampleDuration=this.metadataReader.readU32()),16&e&&(r.currentFragmentState.defaultSampleSize=this.metadataReader.readU32()),32&e&&(r.currentFragmentState.defaultSampleFlags=this.metadataReader.readU32()),65536&e&&(r.currentFragmentState.defaultSampleDuration=0)}break;case"tfdt":{let e=this.currentTrack;if(!e)break;(0,l.vA)(e.currentFragmentState);let t=this.metadataReader.readU8();this.metadataReader.pos+=3;let r=0===t?this.metadataReader.readU32():this.metadataReader.readU64();e.currentFragmentState.startTimestamp=r}break;case"trun":{let e=this.currentTrack;if(!e)break;if((0,l.vA)(this.currentFragment),(0,l.vA)(e.currentFragmentState),this.currentFragment.trackData.has(e.id)){console.warn("Can't have two trun boxes for the same track in one fragment. Ignoring...");break}let t=this.metadataReader.readU8(),r=this.metadataReader.readU24(),a=!!(256&r),i=!!(512&r),s=!!(1024&r),n=!!(2048&r),o=this.metadataReader.readU32(),c=e.currentFragmentState.baseDataOffset;1&r&&(c+=this.metadataReader.readI32());let d=null;4&r&&(d=this.metadataReader.readU32());let u=c;if(0===o){this.currentFragment.implicitBaseDataOffset=u;break}let h=0,m={startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,samples:[],presentationTimestamps:[],startTimestampIsFinal:!1};this.currentFragment.trackData.set(e.id,m);for(let r=0;r<o;r++){let o,c,f;a?o=this.metadataReader.readU32():((0,l.vA)(null!==e.currentFragmentState.defaultSampleDuration),o=e.currentFragmentState.defaultSampleDuration),i?c=this.metadataReader.readU32():((0,l.vA)(null!==e.currentFragmentState.defaultSampleSize),c=e.currentFragmentState.defaultSampleSize),s?f=this.metadataReader.readU32():((0,l.vA)(null!==e.currentFragmentState.defaultSampleFlags),f=e.currentFragmentState.defaultSampleFlags),0===r&&null!==d&&(f=d);let p=0;n&&(p=0===t?this.metadataReader.readU32():this.metadataReader.readI32());let g=!(65536&f);m.samples.push({presentationTimestamp:h+p,duration:o,byteOffset:u,byteSize:c,isKeyFrame:g}),u+=c,h+=o}m.presentationTimestamps=m.samples.map((e,t)=>({presentationTimestamp:e.presentationTimestamp,sampleIndex:t})).sort((e,t)=>e.presentationTimestamp-t.presentationTimestamp);for(let e=0;e<m.presentationTimestamps.length;e++){let t=m.presentationTimestamps[e],r=m.samples[t.sampleIndex];if(null===m.firstKeyFrameTimestamp&&r.isKeyFrame&&(m.firstKeyFrameTimestamp=r.presentationTimestamp),e<m.presentationTimestamps.length-1){let a=m.presentationTimestamps[e+1];r.duration=a.presentationTimestamp-t.presentationTimestamp}}let f=m.samples[m.presentationTimestamps[0].sampleIndex],p=m.samples[(0,l._g)(m.presentationTimestamps).sampleIndex];m.startTimestamp=f.presentationTimestamp,m.endTimestamp=p.presentationTimestamp+p.duration,this.currentFragment.implicitBaseDataOffset=u}}this.metadataReader.pos=r}}class f{constructor(e){this.internalTrack=e,this.packetToSampleIndex=new WeakMap,this.packetToFragmentLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw Error("Not implemented on base class.")}getLanguageCode(){return this.internalTrack.languageCode}getTimeResolution(){return this.internalTrack.timescale}async computeDuration(){let e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){let e=await this.getFirstPacket({metadataOnly:!0});return e?.timestamp??0}async getFirstPacket(e){let t=await this.fetchPacketForSampleIndex(0,e);return t||!this.internalTrack.demuxer.isFragmented?t:this.performFragmentedLookup(()=>{let e=this.internalTrack.demuxer.fragments[0]??null;if(e?.isKnownToBeFirstFragment){let t=e;for(;t;){if(t.trackData.get(this.internalTrack.id))return{fragmentIndex:(0,l.pl)(this.internalTrack.fragments,t.moofOffset,e=>e.moofOffset),sampleIndex:0,correctSampleFound:!0};t=t.nextFragment}}return{fragmentIndex:-1,sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,e)}mapTimestampIntoTimescale(e){return(0,l.CR)(e*this.internalTrack.timescale,14)+this.internalTrack.editListOffset}async getPacket(e,t){let r=this.mapTimestampIntoTimescale(e),a=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),i=k(a,r),s=await this.fetchPacketForSampleIndex(i,t);return S(a)&&this.internalTrack.demuxer.isFragmented?this.performFragmentedLookup(()=>this.findSampleInFragmentsForTimestamp(r),r,r,t):s}async getNextPacket(e,t){let r=this.packetToSampleIndex.get(e);if(void 0!==r)return this.fetchPacketForSampleIndex(r+1,t);let a=this.packetToFragmentLocation.get(e);if(void 0===a)throw Error("Packet was not created from this track.");let i=a.fragment.trackData.get(this.internalTrack.id),s=(0,l.pl)(this.internalTrack.fragments,a.fragment.moofOffset,e=>e.moofOffset);return(0,l.vA)(-1!==s),this.performFragmentedLookup(()=>{if(a.sampleIndex+1<i.samples.length)return{fragmentIndex:s,sampleIndex:a.sampleIndex+1,correctSampleFound:!0};{let e=a.fragment;for(;e.nextFragment;)if((e=e.nextFragment).trackData.get(this.internalTrack.id)){let t=(0,l.pl)(this.internalTrack.fragments,e.moofOffset,e=>e.moofOffset);return(0,l.vA)(-1!==t),{fragmentIndex:t,sampleIndex:0,correctSampleFound:!0}}return{fragmentIndex:s,sampleIndex:-1,correctSampleFound:!1}}},-1/0,1/0,t)}async getKeyPacket(e,t){let r=this.mapTimestampIntoTimescale(e),a=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),i=k(a,r),s=-1===i?-1:y(a,i),n=await this.fetchPacketForSampleIndex(s,t);return S(a)&&this.internalTrack.demuxer.isFragmented?this.performFragmentedLookup(()=>this.findKeySampleInFragmentsForTimestamp(r),r,r,t):n}async getNextKeyPacket(e,t){let r=this.packetToSampleIndex.get(e);if(void 0!==r){let e=w(this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),r);return this.fetchPacketForSampleIndex(e,t)}let a=this.packetToFragmentLocation.get(e);if(void 0===a)throw Error("Packet was not created from this track.");let i=a.fragment.trackData.get(this.internalTrack.id),s=(0,l.pl)(this.internalTrack.fragments,a.fragment.moofOffset,e=>e.moofOffset);return(0,l.vA)(-1!==s),this.performFragmentedLookup(()=>{let e=i.samples.findIndex((e,t)=>e.isKeyFrame&&t>a.sampleIndex);if(-1!==e)return{fragmentIndex:s,sampleIndex:e,correctSampleFound:!0};{let e=a.fragment;for(;e.nextFragment;){let t=(e=e.nextFragment).trackData.get(this.internalTrack.id);if(t&&null!==t.firstKeyFrameTimestamp){let r=(0,l.pl)(this.internalTrack.fragments,e.moofOffset,e=>e.moofOffset);(0,l.vA)(-1!==r);let a=t.samples.findIndex(e=>e.isKeyFrame);return(0,l.vA)(-1!==a),{fragmentIndex:r,sampleIndex:a,correctSampleFound:!0}}}return{fragmentIndex:s,sampleIndex:-1,correctSampleFound:!1}}},-1/0,1/0,t)}async fetchPacketForSampleIndex(e,t){let r;if(-1===e)return null;let a=b(this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),e);if(!a)return null;t.metadataOnly?r=c.T:(await this.internalTrack.demuxer.chunkReader.reader.loadRange(a.chunkOffset,a.chunkOffset+a.chunkSize),this.internalTrack.demuxer.chunkReader.pos=a.sampleOffset,r=this.internalTrack.demuxer.chunkReader.readBytes(a.sampleSize));let i=(a.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,s=a.duration/this.internalTrack.timescale,n=new c.Z(r,a.isKeyFrame?"key":"delta",i,s,e,a.sampleSize);return this.packetToSampleIndex.set(n,e),n}async fetchPacketInFragment(e,t,r){let a;if(-1===t)return null;let i=e.trackData.get(this.internalTrack.id).samples[t];(0,l.vA)(i),r.metadataOnly?a=c.T:(await this.internalTrack.demuxer.chunkReader.reader.loadRange(e.dataStart,e.dataEnd),this.internalTrack.demuxer.chunkReader.pos=i.byteOffset,a=this.internalTrack.demuxer.chunkReader.readBytes(i.byteSize));let s=(i.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,n=i.duration/this.internalTrack.timescale,o=new c.Z(a,i.isKeyFrame?"key":"delta",s,n,e.moofOffset+t,i.byteSize);return this.packetToFragmentLocation.set(o,{fragment:e,sampleIndex:t}),o}findSampleInFragmentsForTimestamp(e){let t=(0,l.eE)(this.internalTrack.fragments,e,e=>e.trackData.get(this.internalTrack.id).startTimestamp),r=-1,a=!1;if(-1!==t){let i=this.internalTrack.fragments[t].trackData.get(this.internalTrack.id),s=(0,l.eE)(i.presentationTimestamps,e,e=>e.presentationTimestamp);(0,l.vA)(-1!==s),r=i.presentationTimestamps[s].sampleIndex,a=e<i.endTimestamp}return{fragmentIndex:t,sampleIndex:r,correctSampleFound:a}}findKeySampleInFragmentsForTimestamp(e){let t=(0,l.eE)(this.internalTrack.fragmentsWithKeyFrame,e,e=>e.trackData.get(this.internalTrack.id).startTimestamp),r=-1,a=-1,i=!1;if(-1!==t){let s=this.internalTrack.fragmentsWithKeyFrame[t];r=(0,l.pl)(this.internalTrack.fragments,s.moofOffset,e=>e.moofOffset),(0,l.vA)(-1!==r);let n=s.trackData.get(this.internalTrack.id),o=(0,l.Kl)(n.presentationTimestamps,t=>n.samples[t.sampleIndex].isKeyFrame&&t.presentationTimestamp<=e);(0,l.vA)(-1!==o),a=n.presentationTimestamps[o].sampleIndex,i=e<n.endTimestamp}return{fragmentIndex:r,sampleIndex:a,correctSampleFound:i}}async performFragmentedLookup(e,t,r,a){let i=this.internalTrack.demuxer,s=await i.fragmentLookupMutex.acquire();try{let{fragmentIndex:s,sampleIndex:n,correctSampleFound:o}=e();if(o){let e=this.internalTrack.fragments[s];return this.fetchPacketInFragment(e,n,a)}let c=i.metadataReader,d=await c.reader.source.getSize(),u=null,m=s,f=n,p=this.internalTrack.fragmentLookupTable?(0,l.eE)(this.internalTrack.fragmentLookupTable,t,e=>e.timestamp):-1,g=-1!==p?this.internalTrack.fragmentLookupTable[p]:null,k=!1;if(-1===s)c.pos=g?.moofOffset??0,k=0===c.pos;else{let e=this.internalTrack.fragments[s];!g||e.moofOffset>=g.moofOffset?(c.pos=e.moofOffset+e.moofSize,u=e):c.pos=g.moofOffset}for(;c.pos<d;){if(u){let e=u.trackData.get(this.internalTrack.id);if(e&&e.startTimestamp>r)break;if(u.nextFragment){c.pos=u.nextFragment.moofOffset+u.nextFragment.moofSize,u=u.nextFragment;continue}}await c.reader.loadRange(c.pos,c.pos+h.Xk);let t=c.pos,s=c.readBoxHeader();if("moof"===s.name){let r;let s=(0,l.pl)(i.fragments,t,e=>e.moofOffset);-1===s?(c.pos=t,r=await i.readFragment()):r=i.fragments[s],u&&(u.nextFragment=r),u=r,k&&(r.isKnownToBeFirstFragment=!0,k=!1);let{fragmentIndex:n,sampleIndex:o,correctSampleFound:d}=e();if(d){let e=this.internalTrack.fragments[n];return this.fetchPacketInFragment(e,o,a)}-1!==n&&(m=n,f=o)}c.pos=t+s.totalSize}let b=null,y=-1!==m?this.internalTrack.fragments[m]:null;if(y&&(b=await this.fetchPacketInFragment(y,f,a)),!b&&g&&(!y||y.moofOffset<g.moofOffset)){let t=this.internalTrack.fragmentLookupTable[p-1],i=t?.timestamp??-1/0;return this.performFragmentedLookup(e,i,r,a)}return b}finally{s()}}}class p extends f{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{if("vp9"!==this.internalTrack.info.codec||this.internalTrack.info.vp9CodecInfo){if("av1"===this.internalTrack.info.codec&&!this.internalTrack.info.av1CodecInfo){let e=await this.getFirstPacket({});this.internalTrack.info.av1CodecInfo=e&&(0,s.UU)(e.data)}}else{let e=await this.getFirstPacket({});this.internalTrack.info.vp9CodecInfo=e&&(0,s.bs)(e.data)}return{codec:(0,i.QP)(this.internalTrack.info),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class g extends f{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:(0,i.X0)(this.internalTrack.info),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}let k=(e,t)=>{if(e.presentationTimestamps){let r=(0,l.eE)(e.presentationTimestamps,t,e=>e.presentationTimestamp);return -1===r?-1:e.presentationTimestamps[r].sampleIndex}{let r=(0,l.eE)(e.sampleTimingEntries,t,e=>e.startDecodeTimestamp);if(-1===r)return -1;let a=e.sampleTimingEntries[r];return a.startIndex+Math.min(Math.floor((t-a.startDecodeTimestamp)/a.delta),a.count-1)}},b=(e,t)=>{let r=(0,l.eE)(e.sampleTimingEntries,t,e=>e.startIndex),a=e.sampleTimingEntries[r];if(!a||a.startIndex+a.count<=t)return null;let i=a.startDecodeTimestamp+(t-a.startIndex)*a.delta,s=(0,l.eE)(e.sampleCompositionTimeOffsets,t,e=>e.startIndex),n=e.sampleCompositionTimeOffsets[s];n&&t-n.startIndex<n.count&&(i+=n.offset);let o=e.sampleSizes[Math.min(t,e.sampleSizes.length-1)],c=(0,l.eE)(e.sampleToChunk,t,e=>e.startSampleIndex),d=e.sampleToChunk[c];(0,l.vA)(d);let u=d.startChunkIndex+Math.floor((t-d.startSampleIndex)/d.samplesPerChunk),h=e.chunkOffsets[u],m=d.startSampleIndex+(u-d.startChunkIndex)*d.samplesPerChunk,f=0,p=h;if(1===e.sampleSizes.length)p+=o*(t-m),f+=o*d.samplesPerChunk;else for(let r=m;r<m+d.samplesPerChunk;r++){let a=e.sampleSizes[r];r<t&&(p+=a),f+=a}let g=a.delta;if(e.presentationTimestamps){let r=e.presentationTimestampIndexMap[t];(0,l.vA)(void 0!==r),r<e.presentationTimestamps.length-1&&(g=e.presentationTimestamps[r+1].presentationTimestamp-i)}return{presentationTimestamp:i,duration:g,sampleOffset:p,sampleSize:o,chunkOffset:h,chunkSize:f,isKeyFrame:!e.keySampleIndices||-1!==(0,l.pl)(e.keySampleIndices,t,e=>e)}},y=(e,t)=>{if(!e.keySampleIndices)return t;let r=(0,l.eE)(e.keySampleIndices,t,e=>e);return e.keySampleIndices[r]??-1},w=(e,t)=>{if(!e.keySampleIndices)return t+1;let r=(0,l.eE)(e.keySampleIndices,t,e=>e);return e.keySampleIndices[r+1]??-1},T=(e,t)=>{for(let r of(e.startTimestamp+=t,e.endTimestamp+=t,e.samples))r.presentationTimestamp+=t;for(let r of e.presentationTimestamps)r.presentationTimestamp+=t},C=e=>{let[t,,,r]=e,a=Math.hypot(t,r);return-(180/Math.PI*Math.atan2(r/a,t/a))},S=e=>0===e.sampleSizes.length;var v=r(237184),x=r(370053);!function(e){e[e.None=0]="None",e[e.Xiph=1]="Xiph",e[e.FixedSize=2]="FixedSize",e[e.Ebml=3]="Ebml"}(a||(a={}));let A=[{id:v.Cl.SeekHead,flag:"seekHeadSeen"},{id:v.Cl.Info,flag:"infoSeen"},{id:v.Cl.Tracks,flag:"tracksSeen"},{id:v.Cl.Cues,flag:"cuesSeen"}];class E extends n.B{constructor(e){super(e),this.readMetadataPromise=null,this.segments=[],this.currentSegment=null,this.currentTrack=null,this.currentCluster=null,this.currentBlock=null,this.currentCueTime=null,this.isWebM=!1,this.metadataReader=new v.q0(e._mainReader),this.clusterReader=new v.q0(new d.m(e.source,0x4000000))}async computeDuration(){let e=await this.getTracks();return Math.max(0,...await Promise.all(e.map(e=>e.computeDuration())))}async getTracks(){return await this.readMetadata(),this.segments.flatMap(e=>e.tracks.map(e=>e.inputTrack))}async getMimeType(){await this.readMetadata();let e=await this.getTracks(),t=await Promise.all(e.map(e=>e.getCodecParameterString()));return(0,x.V)({isWebM:this.isWebM,hasVideo:this.segments.some(e=>e.tracks.some(e=>e.info?.type==="video")),hasAudio:this.segments.some(e=>e.tracks.some(e=>e.info?.type==="audio")),codecStrings:t.filter(Boolean)})}readMetadata(){return this.readMetadataPromise??=(async()=>{this.metadataReader.pos=0;let e=await this.input.source.getSize();for(;this.metadataReader.pos<=e-v.De;){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+v.r1);let t=this.metadataReader.readElementHeader();if(!t)break;let r=t.id,a=t.size,i=this.metadataReader.pos;if(r===v.Cl.EBML)(0,v.p)(a),await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+a),this.readContiguousElements(this.metadataReader,a);else if(r===v.Cl.Segment){if(await this.readSegment(a),null===a)break}else if(r===v.Cl.Cluster){null===a&&(a=(await this.clusterReader.searchForNextElementId(v.K9,e)??e)-i);let t=(0,l._g)(this.segments);t&&(t.elementEndPos=i+a)}(0,v.p)(a),this.metadataReader.pos=i+a}})()}async readSegment(e){let t=this.metadataReader.pos;this.currentSegment={seekHeadSeen:!1,infoSeen:!1,tracksSeen:!1,cuesSeen:!1,timestampScale:-1,timestampFactor:-1,duration:-1,seekEntries:[],tracks:[],cuePoints:[],dataStartPos:t,elementEndPos:null===e?await this.input.source.getSize():t+e,clusterSeekStartPos:t,clusters:[],clusterLookupMutex:new l.aD},this.segments.push(this.currentSegment),await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+16384);let r=!1;for(;this.metadataReader.pos<=this.currentSegment.elementEndPos-v.De;){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+v.r1);let e=this.metadataReader.pos,t=this.metadataReader.readElementHeader();if(!t)break;let{id:a,size:i}=t,s=this.metadataReader.pos,n=A.findIndex(e=>e.id===a);if(-1!==n){let e=A[n].flag;this.currentSegment[e]=!0,(0,v.p)(i),await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+i),this.readContiguousElements(this.metadataReader,i)}else a!==v.Cl.Cluster||r||(r=!0,this.currentSegment.clusterSeekStartPos=e);if(this.currentSegment.infoSeen&&this.currentSegment.tracksSeen&&this.currentSegment.cuesSeen)break;if(this.currentSegment.seekHeadSeen){let e=this.currentSegment.infoSeen,t=this.currentSegment.tracksSeen,r=this.currentSegment.cuesSeen;for(let a of this.currentSegment.seekEntries)a.id===v.Cl.Info?e=!0:a.id===v.Cl.Tracks?t=!0:a.id===v.Cl.Cues&&(r=!0);if(e&&t&&r)break}if(null===i)break;this.metadataReader.pos=s+i,r||(this.currentSegment.clusterSeekStartPos=this.metadataReader.pos)}for(let e of A){if(this.currentSegment[e.flag])continue;let r=this.currentSegment.seekEntries.find(t=>t.id===e.id);if(!r)continue;this.metadataReader.pos=t+r.segmentPosition,await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+4096);let a=this.metadataReader.readElementHeader();if(!a)continue;let{id:i,size:s}=a;i===e.id&&((0,v.p)(s),this.currentSegment[e.flag]=!0,await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+s),this.readContiguousElements(this.metadataReader,s))}-1===this.currentSegment.timestampScale&&(this.currentSegment.timestampScale=1e6,this.currentSegment.timestampFactor=1e3),this.currentSegment.tracks.sort((e,t)=>Number(t.isDefault)-Number(e.isDefault)),this.currentSegment.cuePoints.sort((e,t)=>e.clusterPosition-t.clusterPosition);let a=this.currentSegment.tracks.map(e=>e.id),i=new Set,s=null,n=null;for(let e of this.currentSegment.cuePoints){if(e.clusterPosition!==s){for(let e of i)(0,l.vA)(n),this.currentSegment.tracks.find(t=>t.id===e).cuePoints.push(n);for(let e of a)i.add(e)}n=e,i.has(e.trackId)&&(this.currentSegment.tracks.find(t=>t.id===e.trackId).cuePoints.push(e),i.delete(e.trackId),s=e.clusterPosition)}for(let e of i)(0,l.vA)(n),this.currentSegment.tracks.find(t=>t.id===e).cuePoints.push(n);for(let e of this.currentSegment.tracks)e.cuePoints.sort((e,t)=>e.time-t.time);this.currentSegment=null}async readCluster(e){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+v.r1);let t=this.metadataReader.pos,r=this.metadataReader.readElementHeader();(0,l.vA)(r);let i=r.id,s=r.size,n=this.metadataReader.pos;null===s&&(this.clusterReader.pos=n,s=(await this.clusterReader.searchForNextElementId(v.K9,e.elementEndPos)??e.elementEndPos)-n),(0,l.vA)(i===v.Cl.Cluster),this.clusterReader.pos=n,await this.clusterReader.reader.loadRange(this.clusterReader.pos,this.clusterReader.pos+s);let o={elementStartPos:t,elementEndPos:n+s,dataStartPos:n,timestamp:-1,trackData:new Map,nextCluster:null,isKnownToBeFirstCluster:!1};for(let[t,r]of(this.currentCluster=o,this.readContiguousElements(this.clusterReader,s),o.trackData)){let i=e.tracks.find(e=>e.id===t)??null;(0,l.vA)(r.blocks.length>0);let s=!1,n=!1;for(let e=0;e<r.blocks.length;e++){let t=r.blocks[e];t.timestamp+=o.timestamp,s||=t.referencedTimestamps.length>0,n||=t.lacing!==a.None}s&&(r.blocks=R(r.blocks)),r.presentationTimestamps=r.blocks.map((e,t)=>({timestamp:e.timestamp,blockIndex:t})).sort((e,t)=>e.timestamp-t.timestamp);for(let e=0;e<r.presentationTimestamps.length;e++){let t=r.presentationTimestamps[e],s=r.blocks[t.blockIndex];if(null===r.firstKeyFrameTimestamp&&s.isKeyFrame&&(r.firstKeyFrameTimestamp=s.timestamp),e<r.presentationTimestamps.length-1){let t=r.presentationTimestamps[e+1];s.duration=t.timestamp-s.timestamp}else 0===s.duration&&i?.defaultDuration!=null&&s.lacing===a.None&&(s.duration=i.defaultDuration)}n&&(this.expandLacedBlocks(r.blocks,i),r.presentationTimestamps=r.blocks.map((e,t)=>({timestamp:e.timestamp,blockIndex:t})).sort((e,t)=>e.timestamp-t.timestamp));let c=r.blocks[r.presentationTimestamps[0].blockIndex],d=r.blocks[(0,l._g)(r.presentationTimestamps).blockIndex];r.startTimestamp=c.timestamp,r.endTimestamp=d.timestamp+d.duration,i&&((0,l.h8)(i.clusters,o,e=>e.elementStartPos),null!==r.firstKeyFrameTimestamp&&(0,l.h8)(i.clustersWithKeyFrame,o,e=>e.elementStartPos))}return(0,l.h8)(e.clusters,o,e=>e.elementStartPos),this.currentCluster=null,o}getTrackDataInCluster(e,t){let r=e.trackData.get(t);return r||(r={startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,blocks:[],presentationTimestamps:[]},e.trackData.set(t,r)),r}expandLacedBlocks(e,t){for(let r=0;r<e.length;r++){let i=e[r];if(i.lacing===a.None)continue;let s=i.data,n=0,o=[],c=s[0]+1;switch(n++,i.lacing){case a.Xiph:{let e=0;for(let t=0;t<c-1;t++){let t=0;for(;n<s.length;){let r=s[n];if(t+=r,n++,r<255){o.push(t),e+=t;break}}}o.push(s.length-(n+e))}break;case a.FixedSize:{let e=Math.floor((s.length-1)/c);for(let t=0;t<c;t++)o.push(e)}break;case a.Ebml:{let e=(0,v.pT)(s,n),t=e.value;o.push(t),n+=e.width;let r=t;for(let e=1;e<c-1;e++){let e=(0,v.pT)(s,n);t+=e.value-((1<<7*e.width-1)-1),o.push(t),n+=e.width,r+=t}o.push(s.length-(n+r))}break;default:(0,l.vA)(!1)}(0,l.vA)(o.length===c),e.splice(r,1);let d=n;for(let n=0;n<c;n++){let l=o[n],u=s.subarray(d,d+l),h=i.duration||c*(t?.defaultDuration??0),m=i.timestamp+h*n/c,f=h/c;e.splice(r+n,0,{timestamp:m,duration:f,isKeyFrame:i.isKeyFrame,referencedTimestamps:i.referencedTimestamps,data:u,lacing:a.None}),d+=l}r+=c,r--}}readContiguousElements(e,t){let r=e.pos;for(;e.pos-r<=t-v.De&&this.traverseElement(e););}traverseElement(e){let t=e.readElementHeader();if(!t)return!1;let{id:r,size:a}=t,i=e.pos;switch((0,v.p)(a),r){case v.Cl.DocType:this.isWebM="webm"===e.readAsciiString(a);break;case v.Cl.Seek:{if(!this.currentSegment)break;let t={id:-1,segmentPosition:-1};this.currentSegment.seekEntries.push(t),this.readContiguousElements(e,a),(-1===t.id||-1===t.segmentPosition)&&this.currentSegment.seekEntries.pop()}break;case v.Cl.SeekID:{let t=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!t)break;t.id=e.readUnsignedInt(a)}break;case v.Cl.SeekPosition:{let t=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!t)break;t.segmentPosition=e.readUnsignedInt(a)}break;case v.Cl.TimestampScale:if(!this.currentSegment)break;this.currentSegment.timestampScale=e.readUnsignedInt(a),this.currentSegment.timestampFactor=1e9/this.currentSegment.timestampScale;break;case v.Cl.Duration:if(!this.currentSegment)break;this.currentSegment.duration=e.readFloat(a);break;case v.Cl.TrackEntry:if(!this.currentSegment)break;if(this.currentTrack={id:-1,segment:this.currentSegment,demuxer:this,clusters:[],clustersWithKeyFrame:[],cuePoints:[],isDefault:!1,inputTrack:null,codecId:null,codecPrivate:null,defaultDuration:null,languageCode:l.IR,info:null},this.readContiguousElements(e,a),this.currentTrack&&-1!==this.currentTrack.id&&this.currentTrack.codecId&&this.currentTrack.info){let e=this.currentTrack.codecId.indexOf("/"),t=-1===e?this.currentTrack.codecId:this.currentTrack.codecId.slice(0,e);if("video"===this.currentTrack.info.type&&-1!==this.currentTrack.info.width&&-1!==this.currentTrack.info.height){this.currentTrack.codecId===v.oo.avc?(this.currentTrack.info.codec="avc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===v.oo.hevc?(this.currentTrack.info.codec="hevc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):t===v.oo.vp8?this.currentTrack.info.codec="vp8":t===v.oo.vp9?this.currentTrack.info.codec="vp9":t===v.oo.av1&&(this.currentTrack.info.codec="av1");let e=this.currentTrack,r=new o.N0(new P(e));this.currentTrack.inputTrack=r,this.currentSegment.tracks.push(this.currentTrack)}else if("audio"===this.currentTrack.info.type&&-1!==this.currentTrack.info.numberOfChannels&&-1!==this.currentTrack.info.sampleRate){t===v.oo.aac?(this.currentTrack.info.codec="aac",this.currentTrack.info.aacCodecInfo={isMpeg2:this.currentTrack.codecId.includes("MPEG2")},this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===v.oo.mp3?this.currentTrack.info.codec="mp3":t===v.oo.opus?(this.currentTrack.info.codec="opus",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):t===v.oo.vorbis?(this.currentTrack.info.codec="vorbis",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):t===v.oo.flac?(this.currentTrack.info.codec="flac",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):"A_PCM/INT/LIT"===this.currentTrack.codecId?8===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-u8":16===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s16":24===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s24":32===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-s32"):"A_PCM/INT/BIG"===this.currentTrack.codecId?8===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-u8":16===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s16be":24===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s24be":32===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-s32be"):"A_PCM/FLOAT/IEEE"===this.currentTrack.codecId&&(32===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-f32":64===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-f64"));let e=this.currentTrack,r=new o.Yi(new _(e));this.currentTrack.inputTrack=r,this.currentSegment.tracks.push(this.currentTrack)}}this.currentTrack=null;break;case v.Cl.TrackNumber:if(!this.currentTrack)break;this.currentTrack.id=e.readUnsignedInt(a);break;case v.Cl.TrackType:{if(!this.currentTrack)break;let t=e.readUnsignedInt(a);1===t?this.currentTrack.info={type:"video",width:-1,height:-1,rotation:0,codec:null,codecDescription:null,colorSpace:null}:2===t&&(this.currentTrack.info={type:"audio",numberOfChannels:-1,sampleRate:-1,bitDepth:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case v.Cl.FlagEnabled:if(!this.currentTrack)break;e.readUnsignedInt(a)||(this.currentSegment.tracks.pop(),this.currentTrack=null);break;case v.Cl.FlagDefault:if(!this.currentTrack)break;this.currentTrack.isDefault=!!e.readUnsignedInt(a);break;case v.Cl.CodecID:if(!this.currentTrack)break;this.currentTrack.codecId=e.readAsciiString(a);break;case v.Cl.CodecPrivate:if(!this.currentTrack)break;this.currentTrack.codecPrivate=e.readBytes(a);break;case v.Cl.DefaultDuration:if(!this.currentTrack)break;this.currentTrack.defaultDuration=this.currentTrack.segment.timestampFactor*e.readUnsignedInt(a)/1e9;break;case v.Cl.Language:if(!this.currentTrack)break;this.currentTrack.languageCode=e.readAsciiString(a),(0,l.Nu)(this.currentTrack.languageCode)||(this.currentTrack.languageCode=l.IR);break;case v.Cl.Video:if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e,a);break;case v.Cl.PixelWidth:if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.width=e.readUnsignedInt(a);break;case v.Cl.PixelHeight:if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.height=e.readUnsignedInt(a);break;case v.Cl.Colour:if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.colorSpace={},this.readContiguousElements(e,a);break;case v.Cl.MatrixCoefficients:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;let t=e.readUnsignedInt(a),r=l.fl[t]??null;this.currentTrack.info.colorSpace.matrix=r}break;case v.Cl.Range:if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;this.currentTrack.info.colorSpace.fullRange=2===e.readUnsignedInt(a);break;case v.Cl.TransferCharacteristics:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;let t=e.readUnsignedInt(a),r=l.x_[t]??null;this.currentTrack.info.colorSpace.transfer=r}break;case v.Cl.Primaries:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;let t=e.readUnsignedInt(a),r=l.BL[t]??null;this.currentTrack.info.colorSpace.primaries=r}break;case v.Cl.Projection:if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e,a);break;case v.Cl.ProjectionPoseRoll:{if(this.currentTrack?.info?.type!=="video")break;let t=e.readFloat(a);try{this.currentTrack.info.rotation=(0,l.qT)(-t)}catch{}}break;case v.Cl.Audio:if(this.currentTrack?.info?.type!=="audio")break;this.readContiguousElements(e,a);break;case v.Cl.SamplingFrequency:if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.sampleRate=e.readFloat(a);break;case v.Cl.Channels:if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.numberOfChannels=e.readUnsignedInt(a);break;case v.Cl.BitDepth:if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.bitDepth=e.readUnsignedInt(a);break;case v.Cl.CuePoint:if(!this.currentSegment)break;this.readContiguousElements(e,a),this.currentCueTime=null;break;case v.Cl.CueTime:this.currentCueTime=e.readUnsignedInt(a);break;case v.Cl.CueTrackPositions:{if(null===this.currentCueTime)break;(0,l.vA)(this.currentSegment);let t={time:this.currentCueTime,trackId:-1,clusterPosition:-1};this.currentSegment.cuePoints.push(t),this.readContiguousElements(e,a),(-1===t.trackId||-1===t.clusterPosition)&&this.currentSegment.cuePoints.pop()}break;case v.Cl.CueTrack:{let t=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!t)break;t.trackId=e.readUnsignedInt(a)}break;case v.Cl.CueClusterPosition:{let t=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!t)break;(0,l.vA)(this.currentSegment),t.clusterPosition=this.currentSegment.dataStartPos+e.readUnsignedInt(a)}break;case v.Cl.Timestamp:if(!this.currentCluster)break;this.currentCluster.timestamp=e.readUnsignedInt(a);break;case v.Cl.SimpleBlock:{if(!this.currentCluster)break;let t=e.readVarInt();if(null===t)break;let r=e.readS16(),s=e.readU8();this.getTrackDataInCluster(this.currentCluster,t).blocks.push({timestamp:r,duration:0,isKeyFrame:!!(128&s),referencedTimestamps:[],data:e.readBytes(a-(e.pos-i)),lacing:s>>1&3})}break;case v.Cl.BlockGroup:if(!this.currentCluster)break;if(this.readContiguousElements(e,a),this.currentBlock){for(let e=0;e<this.currentBlock.referencedTimestamps.length;e++)this.currentBlock.referencedTimestamps[e]+=this.currentBlock.timestamp;this.currentBlock=null}break;case v.Cl.Block:{if(!this.currentCluster)break;let t=e.readVarInt();if(null===t)break;let r=e.readS16(),s=e.readU8(),n=this.getTrackDataInCluster(this.currentCluster,t);this.currentBlock={timestamp:r,duration:0,isKeyFrame:!0,referencedTimestamps:[],data:e.readBytes(a-(e.pos-i)),lacing:s>>1&3},n.blocks.push(this.currentBlock)}break;case v.Cl.BlockDuration:if(!this.currentBlock)break;this.currentBlock.duration=e.readUnsignedInt(a);break;case v.Cl.ReferenceBlock:{if(!this.currentBlock)break;this.currentBlock.isKeyFrame=!1;let t=e.readSignedInt(a);this.currentBlock.referencedTimestamps.push(t)}}return e.pos=i+a,!0}}class I{constructor(e){this.internalTrack=e,this.packetToClusterLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw Error("Not implemented on base class.")}async computeDuration(){let e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getLanguageCode(){return this.internalTrack.languageCode}async getFirstTimestamp(){let e=await this.getFirstPacket({metadataOnly:!0});return e?.timestamp??0}getTimeResolution(){return this.internalTrack.segment.timestampFactor}async getFirstPacket(e){return this.performClusterLookup(()=>{let e=this.internalTrack.segment.clusters[0]??null;if(e?.isKnownToBeFirstCluster){let t=e;for(;t;){if(t.trackData.get(this.internalTrack.id))return{clusterIndex:(0,l.pl)(this.internalTrack.clusters,t.elementStartPos,e=>e.elementStartPos),blockIndex:0,correctBlockFound:!0};t=t.nextCluster}}return{clusterIndex:-1,blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,e)}intoTimescale(e){return(0,l.CR)(e*this.internalTrack.segment.timestampFactor,14)}async getPacket(e,t){let r=this.intoTimescale(e);return this.performClusterLookup(()=>this.findBlockInClustersForTimestamp(r),r,r,t)}async getNextPacket(e,t){let r=this.packetToClusterLocation.get(e);if(void 0===r)throw Error("Packet was not created from this track.");let a=r.cluster.trackData.get(this.internalTrack.id),i=(0,l.pl)(this.internalTrack.clusters,r.cluster.elementStartPos,e=>e.elementStartPos);return(0,l.vA)(-1!==i),this.performClusterLookup(()=>{if(r.blockIndex+1<a.blocks.length)return{clusterIndex:i,blockIndex:r.blockIndex+1,correctBlockFound:!0};{let e=r.cluster;for(;e.nextCluster;)if((e=e.nextCluster).trackData.get(this.internalTrack.id)){let t=(0,l.pl)(this.internalTrack.clusters,e.elementStartPos,e=>e.elementStartPos);return(0,l.vA)(-1!==t),{clusterIndex:t,blockIndex:0,correctBlockFound:!0}}return{clusterIndex:i,blockIndex:-1,correctBlockFound:!1}}},-1/0,1/0,t)}async getKeyPacket(e,t){let r=this.intoTimescale(e);return this.performClusterLookup(()=>this.findKeyBlockInClustersForTimestamp(r),r,r,t)}async getNextKeyPacket(e,t){let r=this.packetToClusterLocation.get(e);if(void 0===r)throw Error("Packet was not created from this track.");let a=r.cluster.trackData.get(this.internalTrack.id),i=(0,l.pl)(this.internalTrack.clusters,r.cluster.elementStartPos,e=>e.elementStartPos);return(0,l.vA)(-1!==i),this.performClusterLookup(()=>{let e=a.blocks.findIndex((e,t)=>e.isKeyFrame&&t>r.blockIndex);if(-1!==e)return{clusterIndex:i,blockIndex:e,correctBlockFound:!0};{let e=r.cluster;for(;e.nextCluster;){let t=(e=e.nextCluster).trackData.get(this.internalTrack.id);if(t&&null!==t.firstKeyFrameTimestamp){let r=(0,l.pl)(this.internalTrack.clusters,e.elementStartPos,e=>e.elementStartPos);(0,l.vA)(-1!==r);let a=t.blocks.findIndex(e=>e.isKeyFrame);return(0,l.vA)(-1!==a),{clusterIndex:r,blockIndex:a,correctBlockFound:!0}}}return{clusterIndex:i,blockIndex:-1,correctBlockFound:!1}}},-1/0,1/0,t)}async fetchPacketInCluster(e,t,r){if(-1===t)return null;let a=e.trackData.get(this.internalTrack.id).blocks[t];(0,l.vA)(a);let i=r.metadataOnly?c.T:a.data,s=a.timestamp/this.internalTrack.segment.timestampFactor,n=a.duration/this.internalTrack.segment.timestampFactor,o=new c.Z(i,a.isKeyFrame?"key":"delta",s,n,e.dataStartPos+t,a.data.byteLength);return this.packetToClusterLocation.set(o,{cluster:e,blockIndex:t}),o}findBlockInClustersForTimestamp(e){let t=(0,l.eE)(this.internalTrack.clusters,e,e=>e.trackData.get(this.internalTrack.id).startTimestamp),r=-1,a=!1;if(-1!==t){let i=this.internalTrack.clusters[t].trackData.get(this.internalTrack.id),s=(0,l.eE)(i.presentationTimestamps,e,e=>e.timestamp);(0,l.vA)(-1!==s),r=i.presentationTimestamps[s].blockIndex,a=e<i.endTimestamp}return{clusterIndex:t,blockIndex:r,correctBlockFound:a}}findKeyBlockInClustersForTimestamp(e){let t=(0,l.eE)(this.internalTrack.clustersWithKeyFrame,e,e=>e.trackData.get(this.internalTrack.id).firstKeyFrameTimestamp),r=-1,a=-1,i=!1;if(-1!==t){let s=this.internalTrack.clustersWithKeyFrame[t];r=(0,l.pl)(this.internalTrack.clusters,s.elementStartPos,e=>e.elementStartPos),(0,l.vA)(-1!==r);let n=s.trackData.get(this.internalTrack.id),o=(0,l.Kl)(n.presentationTimestamps,t=>n.blocks[t.blockIndex].isKeyFrame&&t.timestamp<=e);(0,l.vA)(-1!==o),a=n.presentationTimestamps[o].blockIndex,i=e<n.endTimestamp}return{clusterIndex:r,blockIndex:a,correctBlockFound:i}}async performClusterLookup(e,t,r,a){let{demuxer:i,segment:s}=this.internalTrack,n=await s.clusterLookupMutex.acquire();try{let{clusterIndex:n,blockIndex:o,correctBlockFound:c}=e();if(c){let e=this.internalTrack.clusters[n];return this.fetchPacketInCluster(e,o,a)}let d=i.metadataReader,u=i.clusterReader,h=null,m=n,f=o,p=(0,l.eE)(this.internalTrack.cuePoints,t,e=>e.time),g=-1!==p?this.internalTrack.cuePoints[p]:null,k=!1;if(-1===n)d.pos=g?.clusterPosition??s.clusterSeekStartPos,k=d.pos===s.clusterSeekStartPos;else{let e=this.internalTrack.clusters[n];!g||e.elementStartPos>=g.clusterPosition?(d.pos=e.elementEndPos,h=e):d.pos=g.clusterPosition}for(;d.pos<=s.elementEndPos-v.De;){if(h){let e=h.trackData.get(this.internalTrack.id);if(e&&e.startTimestamp>r)break;if(h.nextCluster){d.pos=h.nextCluster.elementEndPos,h=h.nextCluster;continue}}await d.reader.loadRange(d.pos,d.pos+v.r1);let t=d.pos,n=d.readElementHeader();if(!n)break;let o=n.id,c=n.size,p=d.pos;if(o===v.Cl.Cluster){let r;let n=(0,l.pl)(s.clusters,t,e=>e.elementStartPos);-1===n?(d.pos=t,r=await i.readCluster(s)):r=s.clusters[n],h&&(h.nextCluster=r),h=r,k&&(r.isKnownToBeFirstCluster=!0,k=!1);let{clusterIndex:o,blockIndex:c,correctBlockFound:u}=e();if(u){let e=this.internalTrack.clusters[o];return this.fetchPacketInCluster(e,c,a)}-1!==o&&(m=o,f=c)}if(null===c){o===v.Cl.Cluster?((0,l.vA)(h),c=h.elementEndPos-p):(u.pos=p,c=(await u.searchForNextElementId(v.K9,s.elementEndPos)??s.elementEndPos)-p);let e=p+c;if(e>s.elementEndPos-v.De)break;if(u.pos=e,u.readElementId()===v.Cl.Segment){s.elementEndPos=e;break}}d.pos=p+c}let b=null,y=-1!==m?this.internalTrack.clusters[m]:null;if(y&&(b=await this.fetchPacketInCluster(y,f,a)),!b&&g&&(!y||y.elementStartPos<g.clusterPosition)){let t=this.internalTrack.cuePoints[p-1],i=t?.time??-1/0;return this.performClusterLookup(e,i,r,a)}return b}finally{n()}}}class P extends I{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.info.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{let e=null;return"vp9"!==this.internalTrack.info.codec&&"av1"!==this.internalTrack.info.codec&&("avc"!==this.internalTrack.info.codec||this.internalTrack.info.codecDescription)&&("hevc"!==this.internalTrack.info.codec||this.internalTrack.info.codecDescription)||(e=await this.getFirstPacket({})),{codec:(0,i.QP)({width:this.internalTrack.info.width,height:this.internalTrack.info.height,codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,colorSpace:this.internalTrack.info.colorSpace,avcCodecInfo:"avc"===this.internalTrack.info.codec&&e?(0,s.fH)(e.data):null,hevcCodecInfo:"hevc"===this.internalTrack.info.codec&&e?(0,s.D5)(e.data):null,vp9CodecInfo:"vp9"===this.internalTrack.info.codec&&e?(0,s.bs)(e.data):null,av1CodecInfo:"av1"===this.internalTrack.info.codec&&e?(0,s.UU)(e.data):null}),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class _ extends I{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:(0,i.X0)({codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,aacCodecInfo:this.internalTrack.info.aacCodecInfo}),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}let R=e=>{let t=new Map;for(let r=0;r<e.length;r++){let a=e[r];t.set(a.timestamp,a)}let r=new Set,a=[],i=e=>{if(!r.has(e)){r.add(e);for(let r=0;r<e.referencedTimestamps.length;r++){let a=e.referencedTimestamps[r],s=t.get(a);s&&i(s)}a.push(e)}};for(let t=0;t<e.length;t++)i(e[t]);return a};var B=r(950899);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class M{constructor(e){this.reader=e,this.pos=0,this.fileSize=null}readBytes(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU16(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getUint16(t,!1)}readU32(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getUint32(t,!1)}readAscii(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let a="";for(let i=0;i<e;i++)a+=String.fromCharCode(t.getUint8(r+i));return a}readId3(){return"ID3"!==this.readAscii(3)?(this.pos-=3,null):(this.pos+=3,{size:F(this.readU32())})}readNextFrameHeader(e){for((0,l.vA)(this.fileSize),e??=this.fileSize;this.pos<=e-B.Yq;){let e=this.readU32();this.pos-=4;let t=(0,B.Xg)(e,this);if(t)return t}return null}}let F=e=>{let t=0x7f000000,r=0;for(;0!==t;)r>>=1,r|=e&t,t>>=8;return r};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class U extends n.B{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.tracks=[],this.loadingMutex=new l.aD,this.lastLoadedPos=0,this.fileSize=0,this.nextTimestampInSamples=0,this.reader=new M(e._mainReader)}async readMetadata(){return this.metadataPromise??=(async()=>{for(this.fileSize=await this.input.source.getSize(),this.reader.fileSize=this.fileSize;!this.firstFrameHeader&&this.lastLoadedPos<this.fileSize;)await this.loadNextChunk();if(!this.firstFrameHeader)throw Error("No MP3 frames found.");this.tracks=[new o.Yi(new D(this))]})()}async loadNextChunk(){let e=await this.loadingMutex.acquire();try{(0,l.vA)(this.lastLoadedPos<this.fileSize);let e=Math.min(this.lastLoadedPos+524288,this.fileSize);if(await this.reader.reader.loadRange(this.lastLoadedPos,e),this.lastLoadedPos=e,(0,l.vA)(this.lastLoadedPos<=this.fileSize),0===this.reader.pos){let e=this.reader.readId3();e&&(this.reader.pos+=e.size)}this.parseFramesFromLoadedData()}finally{e()}}parseFramesFromLoadedData(){for(;;){let e=this.reader.pos,t=this.reader.readNextFrameHeader();if(!t)break;if(t.startPos+t.totalSize>this.lastLoadedPos){this.reader.pos=e,this.lastLoadedPos=e;break}let r=(0,B.EZ)(t.mpegVersionId,t.channel);this.reader.pos=t.startPos+r;let a=this.reader.readU32(),i=a===B.hY||a===B.rD;if(this.reader.pos=t.startPos+t.totalSize-1,i)continue;this.firstFrameHeader||(this.firstFrameHeader=t);let s=t.audioSamplesInFrame/t.sampleRate,n={timestamp:this.nextTimestampInSamples/t.sampleRate,duration:s,dataStart:t.startPos,dataSize:t.totalSize};this.loadedSamples.push(n),this.nextTimestampInSamples+=t.audioSamplesInFrame}}async getMimeType(){return"audio/mpeg"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();let e=this.tracks[0];return(0,l.vA)(e),e.computeDuration()}}class D{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return(0,l.vA)(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate/this.demuxer.firstFrameHeader.audioSamplesInFrame}async computeDuration(){let e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getLanguageCode(){return l.IR}getCodec(){return"mp3"}getNumberOfChannels(){return(0,l.vA)(this.demuxer.firstFrameHeader),3===this.demuxer.firstFrameHeader.channel?1:2}getSampleRate(){return(0,l.vA)(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate}async getDecoderConfig(){return(0,l.vA)(this.demuxer.firstFrameHeader),{codec:"mp3",numberOfChannels:3===this.demuxer.firstFrameHeader.channel?1:2,sampleRate:this.demuxer.firstFrameHeader.sampleRate}}getPacketAtIndex(e,t){let r;if(-1===e)return null;let a=this.demuxer.loadedSamples[e];return a?(t.metadataOnly?r=c.T:(this.demuxer.reader.pos=a.dataStart,r=this.demuxer.reader.readBytes(a.dataSize)),new c.Z(r,"key",a.timestamp,a.duration,e,a.dataSize)):null}async getFirstPacket(e){for(;0===this.demuxer.loadedSamples.length&&this.demuxer.lastLoadedPos<this.demuxer.fileSize;)await this.demuxer.loadNextChunk();return this.getPacketAtIndex(0,e)}async getNextPacket(e,t){let r=(0,l.pl)(this.demuxer.loadedSamples,e.timestamp,e=>e.timestamp);if(-1===r)throw Error("Packet was not created from this track.");let a=r+1;for(;a>=this.demuxer.loadedSamples.length&&this.demuxer.lastLoadedPos<this.demuxer.fileSize;)await this.demuxer.loadNextChunk();return this.getPacketAtIndex(a,t)}async getPacket(e,t){for(;;){let r=(0,l.eE)(this.demuxer.loadedSamples,e,e=>e.timestamp);if(-1===r&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastLoadedPos===this.demuxer.fileSize||r>=0&&r+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(r,t);await this.demuxer.loadNextChunk()}}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}}var z=r(631959),O=r(693848);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class L extends n.B{constructor(e){super(e),this.readingMutex=new l.aD,this.metadataPromise=null,this.fileSize=null,this.bitstreams=[],this.tracks=[],this.reader=new O.vC(new d.m(e.source,0x4000000))}async readMetadata(){return this.metadataPromise??=(async()=>{for(this.fileSize=await this.input.source.getSize();this.reader.pos<this.fileSize-O.b0;){await this.reader.reader.loadRange(this.reader.pos,this.reader.pos+O.H9);let e=this.reader.readPageHeader();if(!e||!(2&e.headerType))break;this.bitstreams.push({serialNumber:e.serialNumber,bosPage:e,description:null,numberOfChannels:-1,sampleRate:-1,codecInfo:{codec:null,vorbisInfo:null,opusInfo:null},lastMetadataPacket:null}),this.reader.pos=e.headerStartPos+e.totalSize}for(let e of this.bitstreams){let t=await this.readPacket(this.reader,e.bosPage,0);t&&(t.data.byteLength>=7&&1===t.data[0]&&118===t.data[1]&&111===t.data[2]&&114===t.data[3]&&98===t.data[4]&&105===t.data[5]&&115===t.data[6]?await this.readVorbisMetadata(t,e):t.data.byteLength>=8&&79===t.data[0]&&112===t.data[1]&&117===t.data[2]&&115===t.data[3]&&72===t.data[4]&&101===t.data[5]&&97===t.data[6]&&100===t.data[7]&&await this.readOpusMetadata(t,e),null!==e.codecInfo.codec&&this.tracks.push(new o.Yi(new V(e,this))))}})()}async readVorbisMetadata(e,t){let r=await this.findNextPacketStart(this.reader,e);if(!r)return;let a=await this.readPacket(this.reader,r.startPage,r.startSegmentIndex);if(!a||!(r=await this.findNextPacketStart(this.reader,a)))return;let i=await this.readPacket(this.reader,r.startPage,r.startSegmentIndex);if(!i||3!==a.data[0]||5!==i.data[0])return;let n=[],o=e=>{for(;n.push(Math.min(255,e)),!(e<255);)e-=255};o(e.data.length),o(a.data.length);let c=new Uint8Array(1+n.length+e.data.length+a.data.length+i.data.length);c[0]=n.length,c.set(n,1),c.set(e.data,1+n.length),c.set(a.data,1+n.length+e.data.length),c.set(i.data,1+n.length+e.data.length+a.data.length),t.codecInfo.codec="vorbis",t.description=c,t.lastMetadataPacket=i;let d=(0,l.Zc)(e.data);t.numberOfChannels=d.getUint8(11),t.sampleRate=d.getUint32(12,!0);let u=d.getUint8(28);t.codecInfo.vorbisInfo={blocksizes:[1<<(15&u),1<<(u>>4)],modeBlockflags:(0,s.Co)(i.data).modeBlockflags}}async readOpusMetadata(e,t){let r=await this.findNextPacketStart(this.reader,e);if(!r)return;let a=await this.readPacket(this.reader,r.startPage,r.startSegmentIndex);if(!a)return;t.codecInfo.codec="opus",t.description=e.data,t.lastMetadataPacket=a;let i=(0,s.Qf)(e.data);t.numberOfChannels=i.outputChannelCount,t.sampleRate=i.inputSampleRate,t.codecInfo.opusInfo={preSkip:i.preSkip}}async readPacket(e,t,r){(0,l.vA)(r<t.lacingValues.length),(0,l.vA)(this.fileSize);let a=0;for(let e=0;e<r;e++)a+=t.lacingValues[e];let i=t,s=a,n=r,o=[];e:for(;;){await e.reader.loadRange(i.dataStartPos,i.dataStartPos+i.dataSize),e.pos=i.dataStartPos;let r=e.readBytes(i.dataSize);for(;;){if(n===i.lacingValues.length){o.push(r.subarray(a,s));break}let e=i.lacingValues[n];if(s+=e,e<255){o.push(r.subarray(a,s));break e}n++}for(;;){if(e.pos=i.headerStartPos+i.totalSize,e.pos>=this.fileSize-O.b0)return null;await e.reader.loadRange(e.pos,e.pos+O.H9);let r=e.readPageHeader();if(!r)return null;if((i=r).serialNumber===t.serialNumber)break}a=0,s=0,n=0}let c=new Uint8Array(o.reduce((e,t)=>e+t.length,0)),d=0;for(let e=0;e<o.length;e++){let t=o[e];c.set(t,d),d+=t.length}return{data:c,endPage:i,endSegmentIndex:n}}async findNextPacketStart(e,t){if((0,l.vA)(null!==this.fileSize),t.endSegmentIndex<t.endPage.lacingValues.length-1)return{startPage:t.endPage,startSegmentIndex:t.endSegmentIndex+1};if(4&t.endPage.headerType)return null;for(e.pos=t.endPage.headerStartPos+t.endPage.totalSize;;){if(e.pos>=this.fileSize-O.b0)return null;await e.reader.loadRange(e.pos,e.pos+O.H9);let r=e.readPageHeader();if(!r)return null;if(r.serialNumber===t.endPage.serialNumber)return{startPage:r,startSegmentIndex:0};e.pos=r.headerStartPos+r.totalSize}}async getMimeType(){await this.readMetadata();let e=await Promise.all(this.tracks.map(e=>e.getCodecParameterString()));return(0,z.Ob)({codecStrings:e.filter(Boolean)})}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){let e=await this.getTracks();return Math.max(0,...await Promise.all(e.map(e=>e.computeDuration())))}}class V{constructor(e,t){this.bitstream=e,this.demuxer=t,this.encodedPacketToMetadata=new WeakMap,this.internalSampleRate="opus"===e.codecInfo.codec?i.cj:e.sampleRate}getId(){return this.bitstream.serialNumber}getNumberOfChannels(){return this.bitstream.numberOfChannels}getSampleRate(){return this.bitstream.sampleRate}getTimeResolution(){return this.bitstream.sampleRate}getCodec(){return this.bitstream.codecInfo.codec}async getDecoderConfig(){return(0,l.vA)(this.bitstream.codecInfo.codec),{codec:this.bitstream.codecInfo.codec,numberOfChannels:this.bitstream.numberOfChannels,sampleRate:this.bitstream.sampleRate,description:this.bitstream.description??void 0}}getLanguageCode(){return l.IR}async getFirstTimestamp(){return 0}async computeDuration(){let e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}granulePositionToTimestampInSamples(e){return"opus"===this.bitstream.codecInfo.codec?((0,l.vA)(this.bitstream.codecInfo.opusInfo),e-this.bitstream.codecInfo.opusInfo.preSkip):e}createEncodedPacketFromOggPacket(e,t,r){if(!e)return null;let{durationInSamples:a,vorbisBlockSize:i}=(0,z.nL)(e.data,this.bitstream.codecInfo,t.vorbisLastBlocksize),s=new c.Z(r.metadataOnly?c.T:e.data,"key",Math.max(0,t.timestampInSamples)/this.internalSampleRate,a/this.internalSampleRate,e.endPage.headerStartPos+e.endSegmentIndex,e.data.byteLength);return this.encodedPacketToMetadata.set(s,{packet:e,timestampInSamples:t.timestampInSamples,durationInSamples:a,vorbisBlockSize:i}),s}async getFirstPacket(e,t=!0){let r=t?await this.demuxer.readingMutex.acquire():null;try{(0,l.vA)(this.bitstream.lastMetadataPacket);let t=await this.demuxer.findNextPacketStart(this.demuxer.reader,this.bitstream.lastMetadataPacket);if(!t)return null;let r=0;"opus"===this.bitstream.codecInfo.codec&&((0,l.vA)(this.bitstream.codecInfo.opusInfo),r-=this.bitstream.codecInfo.opusInfo.preSkip);let a=await this.demuxer.readPacket(this.demuxer.reader,t.startPage,t.startSegmentIndex);return this.createEncodedPacketFromOggPacket(a,{timestampInSamples:r,vorbisLastBlocksize:null},e)}finally{r?.()}}async getNextPacket(e,t){let r=await this.demuxer.readingMutex.acquire();try{let r=this.encodedPacketToMetadata.get(e);if(!r)throw Error("Packet was not created from this track.");let a=await this.demuxer.findNextPacketStart(this.demuxer.reader,r.packet);if(!a)return null;let i=r.timestampInSamples+r.durationInSamples,s=await this.demuxer.readPacket(this.demuxer.reader,a.startPage,a.startSegmentIndex);return this.createEncodedPacketFromOggPacket(s,{timestampInSamples:i,vorbisLastBlocksize:r.vorbisBlockSize},t)}finally{r()}}async getPacket(e,t){let r=await this.demuxer.readingMutex.acquire();try{let r,a;(0,l.vA)(null!==this.demuxer.fileSize);let i=(0,l.CR)(e*this.internalSampleRate,14);if(0===i)return this.getFirstPacket(t,!1);if(i<0)return null;let s=this.demuxer.reader;(0,l.vA)(this.bitstream.lastMetadataPacket);let n=await this.demuxer.findNextPacketStart(s,this.bitstream.lastMetadataPacket);if(!n)return null;let o=n.startPage,d=this.demuxer.fileSize,u=[o];e:for(;o.headerStartPos+o.totalSize<d;){let e=o.headerStartPos,t=Math.floor((e+d)/2),r=t;for(;;){let e=Math.min(r+O.H4,d-O.b0);if(await s.reader.loadRange(r,e),s.pos=r,!s.findNextPageHeader(e)){d=t+O.b0;continue e}await s.reader.loadRange(s.pos,s.pos+O.H9);let a=s.readPageHeader();(0,l.vA)(a);let n=!1;if(a.serialNumber===this.bitstream.serialNumber)n=!0;else{await s.reader.loadRange(a.headerStartPos,a.headerStartPos+a.totalSize),s.pos=a.headerStartPos;let e=s.readBytes(a.totalSize);n=(0,z._S)(e)===a.checksum}if(!n){r=a.headerStartPos+4;continue}if(n&&a.serialNumber!==this.bitstream.serialNumber||-1===a.granulePosition){r=a.headerStartPos+a.totalSize;continue}this.granulePositionToTimestampInSamples(a.granulePosition)>i?d=a.headerStartPos:(o=a,u.push(a));continue e}}let h=n.startPage;for(let e of u){if(e.granulePosition===o.granulePosition)break;(!h||e.headerStartPos>h.headerStartPos)&&(h=e)}let m=h,f=[m];for(;m.serialNumber!==this.bitstream.serialNumber||m.granulePosition!==o.granulePosition;){s.pos=m.headerStartPos+m.totalSize,await s.reader.loadRange(s.pos,s.pos+O.H9);let e=s.readPageHeader();(0,l.vA)(e),(m=e).serialNumber===this.bitstream.serialNumber&&f.push(m)}(0,l.vA)(-1!==m.granulePosition);let p=null,g=m,k=0;if(m.headerStartPos===n.startPage.headerStartPos)r=this.granulePositionToTimestampInSamples(0),a=!0,p=0;else{r=0,a=!1;for(let e=m.lacingValues.length-1;e>=0;e--)if(m.lacingValues[e]<255){p=e+1;break}if(null===p)throw Error("Invalid page with granule position: no packets end on this page.");k=p-1;let e={data:c.T,endPage:g,endSegmentIndex:k};if(await this.demuxer.findNextPacketStart(s,e)){let e=N(f,m,p);(0,l.vA)(e);let t=W(f,e.page,e.segmentIndex);t&&(m=t.page,p=t.segmentIndex)}else for(;;){let e=N(f,m,p);if(!e)break;let t=W(f,e.page,e.segmentIndex);if(!t)break;if(m=t.page,p=t.segmentIndex,e.page.headerStartPos!==g.headerStartPos){g=e.page,k=e.segmentIndex;break}}}let b=null,y=null;for(;null!==m;){(0,l.vA)(null!==p);let e=await this.demuxer.readPacket(s,m,p);if(!e)break;if(!(m.headerStartPos===n.startPage.headerStartPos&&p<n.startSegmentIndex)){let s=this.createEncodedPacketFromOggPacket(e,{timestampInSamples:r,vorbisLastBlocksize:y?.vorbisBlockSize??null},t);(0,l.vA)(s);let n=this.encodedPacketToMetadata.get(s);if((0,l.vA)(n),a||e.endPage.headerStartPos!==g.headerStartPos||e.endSegmentIndex!==k?r+=n.durationInSamples:(r=this.granulePositionToTimestampInSamples(m.granulePosition),a=!0,s=this.createEncodedPacketFromOggPacket(e,{timestampInSamples:r-n.durationInSamples,vorbisLastBlocksize:y?.vorbisBlockSize??null},t),(0,l.vA)(s),n=this.encodedPacketToMetadata.get(s),(0,l.vA)(n)),b=s,y=n,a&&(Math.max(r,0)>i||Math.max(n.timestampInSamples,0)===i))break}let o=await this.demuxer.findNextPacketStart(s,e);if(!o)break;m=o.startPage,p=o.startSegmentIndex}return b}finally{r()}}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}}let W=(e,t,r)=>{let a=t,i=r;e:for(;;){for(i--;i>=0;i--)if(a.lacingValues[i]<255){i++;break e}if((0,l.vA)(-1===i),!(1&a.headerType)){i=0;break}let t=(0,l.Uk)(e,e=>e.headerStartPos<a.headerStartPos);if(!t)return null;i=(a=t).lacingValues.length}if((0,l.vA)(-1!==i),i===a.lacingValues.length){let t=e[e.indexOf(a)+1];(0,l.vA)(t),a=t,i=0}return{page:a,segmentIndex:i}},N=(e,t,r)=>{if(r>0)return{page:t,segmentIndex:r-1};let a=(0,l.Uk)(e,e=>e.headerStartPos<t.headerStartPos);return a?{page:a,segmentIndex:a.lacingValues.length-1}:null};var H=r(471936),j=r(263935);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class q{}class K extends q{async _getMajorBrand(e){if(await e._mainReader.source.getSize()<12)return null;let t=new h.oj(e._mainReader);return(t.pos=4,"ftyp"!==t.readAscii(4))?null:t.readAscii(4)}_createDemuxer(e){return new m(e)}}class $ extends q{async isSupportedEBMLOfDocType(e,t){if(await e._mainReader.source.getSize()<8)return!1;let r=new v.q0(e._mainReader),a=r.readVarIntSize();if(null===a||a<1||a>8||r.readUnsignedInt(a)!==v.Cl.EBML)return!1;let i=r.readElementSize();if(null===i)return!1;let s=r.pos;for(;r.pos<=s+i-v.De;){let e=r.readElementHeader();if(!e)break;let{id:a,size:i}=e,s=r.pos;if(null===i)return!1;switch(a){case v.Cl.EBMLVersion:case v.Cl.EBMLReadVersion:if(1!==r.readUnsignedInt(i))return!1;break;case v.Cl.DocType:if(r.readAsciiString(i)!==t)return!1;break;case v.Cl.DocTypeVersion:if(r.readUnsignedInt(i)>4)return!1}r.pos=s+i}return!0}_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"matroska")}_createDemuxer(e){return new E(e)}get name(){return"Matroska"}get mimeType(){return"video/x-matroska"}}let Q=new class extends K{async _canReadInput(e){let t=await this._getMajorBrand(e);return!!t&&"qt  "!==t}get name(){return"MP4"}get mimeType(){return"video/mp4"}};new class extends K{async _canReadInput(e){return"qt  "===await this._getMajorBrand(e)}get name(){return"QuickTime File Format"}get mimeType(){return"video/quicktime"}},new $,new class extends ${_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"webm")}get name(){return"WebM"}get mimeType(){return"video/webm"}},new class extends q{async _canReadInput(e){let t=await e._mainReader.source.getSize();if(t<4)return!1;let r=new M(e._mainReader);r.fileSize=t;let a=r.readId3();a&&(r.pos+=a.size);let i=r.pos;await r.reader.loadRange(r.pos,r.pos+4096);let s=r.readNextFrameHeader(Math.min(i+4096,t));if(!s)return!1;if(a)return!0;r.pos=s.startPos+s.totalSize,await r.reader.loadRange(r.pos,r.pos+B.Yq);let n=r.readNextFrameHeader(r.pos+B.Yq);return!!n&&s.channel===n.channel&&s.sampleRate===n.sampleRate}_createDemuxer(e){return new U(e)}get name(){return"MP3"}get mimeType(){return"audio/mpeg"}},new class extends q{async _canReadInput(e){if(await e._mainReader.source.getSize()<12)return!1;let t=new H.H(e._mainReader),r=t.readAscii(4);return("RIFF"===r||"RIFX"===r||"RF64"===r)&&(t.pos=8,"WAVE"===t.readAscii(4))}_createDemuxer(e){return new j.E(e)}get name(){return"WAVE"}get mimeType(){return"audio/wav"}},new class extends q{async _canReadInput(e){return!(await e._mainReader.source.getSize()<4)&&"OggS"===new O.vC(e._mainReader).readAscii(4)}_createDemuxer(e){return new L(e)}get name(){return"Ogg"}get mimeType(){return"application/ogg"}}},574019:(e,t,r)=>{"use strict";r.d(t,{Kh:()=>l,N0:()=>c,Yi:()=>d});var a=r(481140),i=r(131110),s=r(484009),n=r(250601),o=r(909929);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class l{constructor(e){this._backing=e}isVideoTrack(){return this instanceof c}isAudioTrack(){return this instanceof d}get id(){return this._backing.getId()}get languageCode(){return this._backing.getLanguageCode()}get timeResolution(){return this._backing.getTimeResolution()}getFirstTimestamp(){return this._backing.getFirstTimestamp()}computeDuration(){return this._backing.computeDuration()}async computePacketStats(e=1/0){let t=new s.kQ(this),r=1/0,a=-1/0,i=0,n=0;for await(let s of t.packets(void 0,void 0,{metadataOnly:!0})){if(i>=e&&s.timestamp>=a)break;r=Math.min(r,s.timestamp),a=Math.max(a,s.timestamp+s.duration),i++,n+=s.byteLength}return{packetCount:i,averagePacketRate:i?Number((i/(a-r)).toPrecision(16)):0,averageBitrate:i?Number((8*n/(a-r)).toPrecision(16)):0}}}class c extends l{constructor(e){super(e),this._backing=e}get type(){return"video"}get codec(){return this._backing.getCodec()}get codedWidth(){return this._backing.getCodedWidth()}get codedHeight(){return this._backing.getCodedHeight()}get rotation(){return this._backing.getRotation()}get displayWidth(){return this._backing.getRotation()%180==0?this._backing.getCodedWidth():this._backing.getCodedHeight()}get displayHeight(){return this._backing.getRotation()%180==0?this._backing.getCodedHeight():this._backing.getCodedWidth()}getColorSpace(){return this._backing.getColorSpace()}async hasHighDynamicRange(){let e=await this._backing.getColorSpace();return"bt2020"===e.primaries||"smpte432"===e.primaries||"pg"===e.transfer||"hlg"===e.transfer||"bt2020-ncl"===e.matrix}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){let e=await this._backing.getDecoderConfig();return e?.codec??null}async canDecode(){try{let e=await this._backing.getDecoderConfig();if(!e)return!1;let t=this._backing.getCodec();if((0,n.vA)(null!==t),i.wb.some(r=>r.supports(t,e)))return!0;if("undefined"==typeof VideoDecoder)return!1;let r=await VideoDecoder.isConfigSupported(e);return!0===r.supported}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof o.Z))throw TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw TypeError("packet must not be metadata-only to determine its type.");return null===this.codec?null:(0,a.PR)(this,e)}}class d extends l{constructor(e){super(e),this._backing=e}get type(){return"audio"}get codec(){return this._backing.getCodec()}get numberOfChannels(){return this._backing.getNumberOfChannels()}get sampleRate(){return this._backing.getSampleRate()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){let e=await this._backing.getDecoderConfig();return e?.codec??null}async canDecode(){try{let e=await this._backing.getDecoderConfig();if(!e)return!1;let t=this._backing.getCodec();if((0,n.vA)(null!==t),i.zx.some(r=>r.supports(t,e))||e.codec.startsWith("pcm-"))return!0;{if("undefined"==typeof AudioDecoder)return!1;let t=await AudioDecoder.isConfigSupported(e);return!0===t.supported}}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof o.Z))throw TypeError("packet must be an EncodedPacket.");return null===this.codec?null:"key"}}},998653:(e,t,r)=>{"use strict";r.d(t,{p:()=>o});var a=r(392528),i=r(250601),s=r(107530),n=r(672328);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class o{constructor(e){if(this._demuxerPromise=null,this._format=null,!e||"object"!=typeof e)throw TypeError("options must be an object.");if(!Array.isArray(e.formats)||e.formats.some(e=>!(e instanceof a.CW)))throw TypeError("options.formats must be an array of InputFormat.");if(!(e.source instanceof n.kL))throw TypeError("options.source must be a Source.");this._formats=e.formats,this._source=e.source,this._mainReader=new s.m(e.source)}_getDemuxer(){return this._demuxerPromise??=(async()=>{for(let e of(await this._mainReader.loadRange(0,4096),this._formats))if(await e._canReadInput(this))return this._format=e,e._createDemuxer(this);throw Error("Input has an unsupported or unrecognizable format.")})()}get source(){return this._source}async getFormat(){return await this._getDemuxer(),(0,i.vA)(this._format),this._format}async computeDuration(){return(await this._getDemuxer()).computeDuration()}async getTracks(){return(await this._getDemuxer()).getTracks()}async getVideoTracks(){return(await this.getTracks()).filter(e=>e.isVideoTrack())}async getPrimaryVideoTrack(){return(await this.getTracks()).find(e=>e.isVideoTrack())??null}async getAudioTracks(){return(await this.getTracks()).filter(e=>e.isAudioTrack())}async getPrimaryAudioTrack(){return(await this.getTracks()).find(e=>e.isAudioTrack())??null}async getMimeType(){return(await this._getDemuxer()).getMimeType()}}},955911:(e,t,r)=>{"use strict";r.d(t,{X:()=>a});/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let a=e=>{let t=(e.hasVideo?"video/":e.hasAudio?"audio/":"application/")+(e.isQuickTime?"quicktime":"mp4");if(e.codecStrings.length>0){let r=[...new Set(e.codecStrings)];t+=`; codecs="${r.join(", ")}"`}return t}},492648:(e,t,r)=>{"use strict";r.d(t,{Xk:()=>i,ZM:()=>a,oj:()=>s});/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let a=8,i=16;class s{constructor(e){this.reader=e,this.pos=0}readBytes(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU8(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1);return this.pos++,e.getUint8(t)}readU16(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getUint16(t,!1)}readI16(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getInt16(t,!1)}readU24(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+3);return this.pos+=3,256*e.getUint16(t,!1)+e.getUint8(t+2)}readU32(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getUint32(t,!1)}readI32(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getInt32(t,!1)}readU64(){return 0x100000000*this.readU32()+this.readU32()}readI64(){return 0x100000000*this.readI32()+this.readU32()}readF64(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+8);return this.pos+=8,e.getFloat64(t,!1)}readFixed_16_16(){return this.readI32()/65536}readFixed_2_30(){return this.readI32()/0x40000000}readAscii(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let a="";for(let i=0;i<e;i++)a+=String.fromCharCode(t.getUint8(r+i));return a}readIsomVariableInteger(){let e=0;for(let t=0;t<4;t++){e<<=7;let t=this.readU8();if(e|=127&t,(128&t)==0)break}return e}readBoxHeader(){let e=this.readU32(),t=this.readAscii(4),r=8;return 1===e&&(e=this.readU64(),r=16),{name:t,totalSize:e,headerSize:r,contentSize:e-r}}}},237184:(e,t,r)=>{"use strict";var a;r.d(t,{Cl:()=>a,De:()=>h,K9:()=>o,Qn:()=>u,Z4:()=>s,_v:()=>i,oo:()=>p,p:()=>k,pT:()=>g,q0:()=>f,r1:()=>m,ys:()=>n});/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class i{constructor(e){this.value=e}}class s{constructor(e){this.value=e}}class n{constructor(e){this.value=e}}!function(e){e[e.EBML=0x1a45dfa3]="EBML",e[e.EBMLVersion=17030]="EBMLVersion",e[e.EBMLReadVersion=17143]="EBMLReadVersion",e[e.EBMLMaxIDLength=17138]="EBMLMaxIDLength",e[e.EBMLMaxSizeLength=17139]="EBMLMaxSizeLength",e[e.DocType=17026]="DocType",e[e.DocTypeVersion=17031]="DocTypeVersion",e[e.DocTypeReadVersion=17029]="DocTypeReadVersion",e[e.SeekHead=0x114d9b74]="SeekHead",e[e.Seek=19899]="Seek",e[e.SeekID=21419]="SeekID",e[e.SeekPosition=21420]="SeekPosition",e[e.Duration=17545]="Duration",e[e.Info=0x1549a966]="Info",e[e.TimestampScale=2807729]="TimestampScale",e[e.MuxingApp=19840]="MuxingApp",e[e.WritingApp=22337]="WritingApp",e[e.Tracks=0x1654ae6b]="Tracks",e[e.TrackEntry=174]="TrackEntry",e[e.TrackNumber=215]="TrackNumber",e[e.TrackUID=29637]="TrackUID",e[e.TrackType=131]="TrackType",e[e.FlagEnabled=185]="FlagEnabled",e[e.FlagDefault=136]="FlagDefault",e[e.FlagForced=21930]="FlagForced",e[e.FlagLacing=156]="FlagLacing",e[e.Language=2274716]="Language",e[e.CodecID=134]="CodecID",e[e.CodecPrivate=25506]="CodecPrivate",e[e.CodecDelay=22186]="CodecDelay",e[e.SeekPreRoll=22203]="SeekPreRoll",e[e.DefaultDuration=2352003]="DefaultDuration",e[e.Video=224]="Video",e[e.PixelWidth=176]="PixelWidth",e[e.PixelHeight=186]="PixelHeight",e[e.Audio=225]="Audio",e[e.SamplingFrequency=181]="SamplingFrequency",e[e.Channels=159]="Channels",e[e.BitDepth=25188]="BitDepth",e[e.Segment=0x18538067]="Segment",e[e.SimpleBlock=163]="SimpleBlock",e[e.BlockGroup=160]="BlockGroup",e[e.Block=161]="Block",e[e.BlockAdditions=30113]="BlockAdditions",e[e.BlockMore=166]="BlockMore",e[e.BlockAdditional=165]="BlockAdditional",e[e.BlockAddID=238]="BlockAddID",e[e.BlockDuration=155]="BlockDuration",e[e.ReferenceBlock=251]="ReferenceBlock",e[e.Cluster=0x1f43b675]="Cluster",e[e.Timestamp=231]="Timestamp",e[e.Cues=0x1c53bb6b]="Cues",e[e.CuePoint=187]="CuePoint",e[e.CueTime=179]="CueTime",e[e.CueTrackPositions=183]="CueTrackPositions",e[e.CueTrack=247]="CueTrack",e[e.CueClusterPosition=241]="CueClusterPosition",e[e.Colour=21936]="Colour",e[e.MatrixCoefficients=21937]="MatrixCoefficients",e[e.TransferCharacteristics=21946]="TransferCharacteristics",e[e.Primaries=21947]="Primaries",e[e.Range=21945]="Range",e[e.Projection=30320]="Projection",e[e.ProjectionType=30321]="ProjectionType",e[e.ProjectionPoseRoll=30325]="ProjectionPoseRoll",e[e.Attachments=0x1941a469]="Attachments",e[e.Chapters=0x1043a770]="Chapters",e[e.Tags=0x1254c367]="Tags"}(a||(a={}));let o=[a.EBML,a.Segment,a.EBMLMaxIDLength,a.EBMLMaxSizeLength,a.SeekHead,a.Info,a.Cluster,a.Tracks,a.Cues,a.Attachments,a.Chapters,a.Tags],l=e=>e<256?1:e<65536?2:e<0x1000000?3:e<0x100000000?4:e<0x10000000000?5:6,c=e=>e>=-64&&e<64?1:e>=-8192&&e<8192?2:e>=-1048576&&e<1048576?3:e>=-0x8000000&&e<0x8000000?4:e>=-0x400000000&&e<0x400000000?5:6,d=e=>{if(e<127)return 1;if(e<16383)return 2;if(e<2097151)return 3;if(e<0xfffffff)return 4;if(e<0x800000000-1)return 5;if(e<0x40000000000-1)return 6;throw Error("EBML varint size not supported "+e)};class u{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}writeByte(e){this.helperView.setUint8(0,e),this.writer.write(this.helper.subarray(0,1))}writeFloat32(e){this.helperView.setFloat32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeFloat64(e){this.helperView.setFloat64(0,e,!1),this.writer.write(this.helper)}writeUnsignedInt(e,t=l(e)){let r=0;switch(t){case 6:this.helperView.setUint8(r++,e/0x10000000000|0);case 5:this.helperView.setUint8(r++,e/0x100000000|0);case 4:this.helperView.setUint8(r++,e>>24);case 3:this.helperView.setUint8(r++,e>>16);case 2:this.helperView.setUint8(r++,e>>8);case 1:this.helperView.setUint8(r++,e);break;default:throw Error("Bad unsigned int size "+t)}this.writer.write(this.helper.subarray(0,r))}writeSignedInt(e,t=c(e)){e<0&&(e+=2**(8*t)),this.writeUnsignedInt(e,t)}writeVarInt(e,t=d(e)){let r=0;switch(t){case 1:this.helperView.setUint8(r++,128|e);break;case 2:this.helperView.setUint8(r++,64|e>>8),this.helperView.setUint8(r++,e);break;case 3:this.helperView.setUint8(r++,32|e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;case 4:this.helperView.setUint8(r++,16|e>>24),this.helperView.setUint8(r++,e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;case 5:this.helperView.setUint8(r++,8|e/0x100000000&7),this.helperView.setUint8(r++,e>>24),this.helperView.setUint8(r++,e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;case 6:this.helperView.setUint8(r++,4|e/0x10000000000&3),this.helperView.setUint8(r++,e/0x100000000|0),this.helperView.setUint8(r++,e>>24),this.helperView.setUint8(r++,e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;default:throw Error("Bad EBML varint size "+t)}this.writer.write(this.helper.subarray(0,r))}writeAsciiString(e){this.writer.write(new Uint8Array(e.split("").map(e=>e.charCodeAt(0))))}writeEBML(e){if(null!==e){if(e instanceof Uint8Array)this.writer.write(e);else if(Array.isArray(e))for(let t of e)this.writeEBML(t);else if(this.offsets.set(e,this.writer.getPos()),this.writeUnsignedInt(e.id),Array.isArray(e.data)){let t=this.writer.getPos(),r=-1===e.size?1:e.size??4;-1===e.size?this.writeByte(255):this.writer.seek(this.writer.getPos()+r);let a=this.writer.getPos();if(this.dataOffsets.set(e,a),this.writeEBML(e.data),-1!==e.size){let e=this.writer.getPos()-a,i=this.writer.getPos();this.writer.seek(t),this.writeVarInt(e,r),this.writer.seek(i)}}else if("number"==typeof e.data){let t=e.size??l(e.data);this.writeVarInt(t),this.writeUnsignedInt(e.data,t)}else if("string"==typeof e.data)this.writeVarInt(e.data.length),this.writeAsciiString(e.data);else if(e.data instanceof Uint8Array)this.writeVarInt(e.data.byteLength,e.size),this.writer.write(e.data);else if(e.data instanceof i)this.writeVarInt(4),this.writeFloat32(e.data.value);else if(e.data instanceof s)this.writeVarInt(8),this.writeFloat64(e.data.value);else if(e.data instanceof n){let t=e.size??c(e.data.value);this.writeVarInt(t),this.writeSignedInt(e.data.value,t)}}}}let h=2,m=16;class f{constructor(e){this.reader=e,this.pos=0}readBytes(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU8(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1);return this.pos++,e.getUint8(t)}readS16(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getInt16(t,!1)}readVarIntSize(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1),r=e.getUint8(t);if(0===r)return null;let a=1,i=128;for(;(r&i)==0;)a++,i>>=1;return a}readVarInt(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1),r=e.getUint8(t);if(0===r)return null;let a=1,i=128;for(;(r&i)==0;)a++,i>>=1;let{view:s,offset:n}=this.reader.getViewAndOffset(this.pos,this.pos+a),o=r&i-1;for(let e=1;e<a;e++)o*=256,o+=s.getUint8(n+e);return this.pos+=a,o}readUnsignedInt(e){if(e<1||e>8)throw Error("Bad unsigned int size "+e);let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e),a=0;for(let i=0;i<e;i++)a*=256,a+=t.getUint8(r+i);return this.pos+=e,a}readSignedInt(e){let t=this.readUnsignedInt(e);return t&1<<8*e-1&&(t-=2**(8*e)),t}readFloat(e){if(0===e)return 0;if(4!==e&&8!==e)throw Error("Bad float size "+e);let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e),a=4===e?t.getFloat32(r,!1):t.getFloat64(r,!1);return this.pos+=e,a}readAsciiString(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let a=0;for(;a<e&&0!==t.getUint8(r+a);)a+=1;return String.fromCharCode(...new Uint8Array(t.buffer,r,a))}readElementId(){let e=this.readVarIntSize();return null===e?null:this.readUnsignedInt(e)}readElementSize(){let e=this.readU8();return 255===e?e=null:(this.pos--,0x100000000000000===(e=this.readVarInt())&&(e=null)),e}readElementHeader(){let e=this.readElementId();return null===e?null:{id:e,size:this.readElementSize()}}async searchForNextElementId(e,t){let r=new Set(e);for(;this.pos<=t-h;){this.reader.rangeIsLoaded(this.pos,Math.min(this.pos+m,t))||await this.reader.loadRange(this.pos,Math.min(this.pos+1048576,t));let e=this.pos,a=this.readElementHeader();if(!a)break;if(r.has(a.id))return e;k(a.size),this.pos+=a.size}return null}}let p={avc:"V_MPEG4/ISO/AVC",hevc:"V_MPEGH/ISO/HEVC",vp8:"V_VP8",vp9:"V_VP9",av1:"V_AV1",aac:"A_AAC",mp3:"A_MPEG/L3",opus:"A_OPUS",vorbis:"A_VORBIS",flac:"A_FLAC","pcm-u8":"A_PCM/INT/LIT","pcm-s16":"A_PCM/INT/LIT","pcm-s16be":"A_PCM/INT/BIG","pcm-s24":"A_PCM/INT/LIT","pcm-s24be":"A_PCM/INT/BIG","pcm-s32":"A_PCM/INT/LIT","pcm-s32be":"A_PCM/INT/BIG","pcm-f32":"A_PCM/FLOAT/IEEE","pcm-f64":"A_PCM/FLOAT/IEEE",webvtt:"S_TEXT/WEBVTT"},g=(e,t)=>{if(t>=e.length)throw Error("Offset out of bounds.");let r=e[t],a=1,i=128;for(;(r&i)==0&&a<8;)a++,i>>=1;if(t+a>e.length)throw Error("VarInt extends beyond data bounds.");let s=r&i-1;for(let r=1;r<a;r++)s*=256,s+=e[t+r];return{value:s,width:a}};function k(e){if(null===e)throw Error("Undefined element size is used in a place where it is not supported.")}},370053:(e,t,r)=>{"use strict";r.d(t,{V:()=>a});/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let a=e=>{let t=(e.hasVideo?"video/":e.hasAudio?"audio/":"application/")+(e.isWebM?"webm":"x-matroska");if(e.codecStrings.length>0){let r=[...new Set(e.codecStrings.filter(Boolean))];t+=`; codecs="${r.join(", ")}"`}return t}},484009:(e,t,r)=>{"use strict";r.d(t,{kQ:()=>m,lc:()=>b,qw:()=>T});var a=r(496023),i=r(131110),s=r(574019),n=r(250601),o=r(909929),l=r(10397),c=r(119699);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let d=e=>{if(!e||"object"!=typeof e)throw TypeError("options must be an object.");if(void 0!==e.metadataOnly&&"boolean"!=typeof e.metadataOnly)throw TypeError("options.metadataOnly, when defined, must be a boolean.");if(void 0!==e.verifyKeyPackets&&"boolean"!=typeof e.verifyKeyPackets)throw TypeError("options.verifyKeyPackets, when defined, must be a boolean.");if(e.verifyKeyPackets&&e.metadataOnly)throw TypeError("options.verifyKeyPackets and options.metadataOnly cannot be enabled together.")},u=e=>{if("number"!=typeof e||Number.isNaN(e))throw TypeError("timestamp must be a number.")},h=(e,t,r)=>r.verifyKeyPackets?t.then(async t=>{if(!t||"delta"===t.type)return t;let r=await e.determinePacketType(t);return r&&(t.type=r),t}):t;class m{constructor(e){if(!(e instanceof s.Kh))throw TypeError("track must be an InputTrack.");this._track=e}getFirstPacket(e={}){return d(e),h(this._track,this._track._backing.getFirstPacket(e),e)}getPacket(e,t={}){return u(e),d(t),h(this._track,this._track._backing.getPacket(e,t),t)}getNextPacket(e,t={}){if(!(e instanceof o.Z))throw TypeError("packet must be an EncodedPacket.");return d(t),h(this._track,this._track._backing.getNextPacket(e,t),t)}async getKeyPacket(e,t={}){if(u(e),d(t),!t.verifyKeyPackets)return this._track._backing.getKeyPacket(e,t);let r=await this._track._backing.getKeyPacket(e,t);return r&&"delta"!==r.type&&"delta"===await this._track.determinePacketType(r)?this.getKeyPacket(r.timestamp-1/this._track.timeResolution,t):r}async getNextKeyPacket(e,t={}){if(!(e instanceof o.Z))throw TypeError("packet must be an EncodedPacket.");if(d(t),!t.verifyKeyPackets)return this._track._backing.getNextKeyPacket(e,t);let r=await this._track._backing.getNextKeyPacket(e,t);return r&&"delta"!==r.type&&"delta"===await this._track.determinePacketType(r)?this.getNextKeyPacket(r,t):r}packets(e,t,r={}){if(void 0!==e&&!(e instanceof o.Z))throw TypeError("startPacket must be an EncodedPacket.");if(void 0!==e&&e.isMetadataOnly&&!r?.metadataOnly)throw TypeError("startPacket can only be metadata-only if options.metadataOnly is enabled.");if(void 0!==t&&!(t instanceof o.Z))throw TypeError("endPacket must be an EncodedPacket.");d(r);let a=[],{promise:i,resolve:s}=(0,n.nJ)(),{promise:l,resolve:c}=(0,n.nJ)(),u=!1,h=!1,m=null,f=[],p=()=>Math.max(2,f.length);return(async()=>{let o=e??await this.getFirstPacket(r);for(;o&&!h&&!(t&&o.sequenceNumber>=t?.sequenceNumber);){if(a.length>p()){({promise:l,resolve:c}=(0,n.nJ)()),await l;continue}a.push(o),s(),({promise:i,resolve:s}=(0,n.nJ)()),o=await this.getNextPacket(o,r)}u=!0,s()})().catch(e=>{m||(m=e,s())}),{async next(){for(;;){if(h)return{value:void 0,done:!0};if(m)throw m;if(a.length>0){let e=a.shift(),t=performance.now();for(f.push(t);f.length>0&&t-f[0]>=1e3;)f.shift();return c(),{value:e,done:!1}}if(u)return{value:void 0,done:!0};await i}},return:async()=>(h=!0,c(),s(),{value:void 0,done:!0}),async throw(e){throw e},[Symbol.asyncIterator](){return this}}}}class f{constructor(e,t){this.onSample=e,this.onError=t}}class p{mediaSamplesInRange(e=0,t=1/0){u(e),u(t);let r=[],a=!1,i=null,{promise:s,resolve:o}=(0,n.nJ)(),{promise:l,resolve:c}=(0,n.nJ)(),d=!1,h=!1,m=!1,f=null;return(async()=>{let u;let p=Error(),k=await this._createDecoder(l=>{if(c(),l.timestamp>=t&&(h=!0),h){l.close();return}i&&(l.timestamp>e?(r.push(i),a=!0):i.close()),l.timestamp>=e&&(r.push(l),a=!0),i=a?null:l,r.length>0&&(o(),{promise:s,resolve:o}=(0,n.nJ)())},e=>{f||(e.stack=p.stack,f=e,o())}),b=this._createPacketSink(),y=await b.getKeyPacket(e,{verifyKeyPackets:!0})??await b.getFirstPacket();if(!y)return;let w=y;if(t<1/0){let e=await b.getPacket(t),r=e?"key"===e.type&&e.timestamp===t?e:await b.getNextKeyPacket(e,{verifyKeyPackets:!0}):null;r&&(u=r)}let T=b.packets(y,u);for(await T.next();w&&!h;){let e=g(r.length);if(r.length+k.getDecodeQueueSize()>e){({promise:l,resolve:c}=(0,n.nJ)()),await l;continue}k.decode(w);let t=await T.next();if(t.done)break;w=t.value}await T.return(),m||await k.flush(),k.close(),!a&&i&&r.push(i),d=!0,o()})().catch(e=>{f||(f=e,o())}),{async next(){for(;;){if(m)return{value:void 0,done:!0};if(f)throw f;if(r.length>0){let e=r.shift();return c(),{value:e,done:!1}}if(d)return{value:void 0,done:!0};await s}},async return(){for(let e of(m=!0,h=!0,c(),o(),i?.close(),r))e.close();return{value:void 0,done:!0}},async throw(e){throw e},[Symbol.asyncIterator](){return this}}}mediaSamplesAtTimestamps(e){(0,n.D5)(e);let t=(0,n.i1)(e),r=[],a=[],{promise:i,resolve:s}=(0,n.nJ)(),{promise:o,resolve:l}=(0,n.nJ)(),c=!1,d=!1,h=null,m=e=>{a.push(e),s(),{promise:i,resolve:s}=(0,n.nJ)()};return(async()=>{let e=Error(),i=await this._createDecoder(e=>{if(l(),d){e.close();return}let t=0;for(;r.length>0&&e.timestamp-r[0]>-1e-10;)t++,r.shift();if(t>0)for(let r=0;r<t;r++)m(r<t-1?e.clone():e);else e.close()},t=>{h||(t.stack=e.stack,h=t,s())}),f=this._createPacketSink(),p=null,k=null,b=-1,y=async()=>{(0,n.vA)(k);let e=k;for(i.decode(e);e.sequenceNumber<b;){let t=g(a.length);for(;a.length+i.getDecodeQueueSize()>t&&!d;)({promise:o,resolve:l}=(0,n.nJ)()),await o;if(d)break;let r=await f.getNextPacket(e);(0,n.vA)(r),e=r,i.decode(r)}b=-1},w=async()=>{await i.flush();for(let e=0;e<r.length;e++)m(null);r.length=0};for await(let e of t){if(u(e),d)break;let t=await f.getPacket(e),a=t&&await f.getKeyPacket(e,{verifyKeyPackets:!0});if(!a){-1!==b&&(await y(),await w()),m(null),p=null;continue}p&&(a.sequenceNumber!==k.sequenceNumber||t.timestamp<p.timestamp)&&(await y(),await w()),r.push(t.timestamp),b=Math.max(t.sequenceNumber,b),p=t,k=a}d||(-1!==b&&await y(),await w()),i.close(),c=!0,s()})().catch(e=>{h||(h=e,s())}),{async next(){for(;;){if(d)return{value:void 0,done:!0};if(h)throw h;if(a.length>0){let e=a.shift();return(0,n.vA)(void 0!==e),l(),{value:e,done:!1}}if(c)return{value:void 0,done:!0};await i}},async return(){for(let e of(d=!0,l(),s(),a))e?.close();return{value:void 0,done:!0}},async throw(e){throw e},[Symbol.asyncIterator](){return this}}}}let g=e=>0===e?40:8;class k extends f{constructor(e,t,r,a,s,o){super(e,t),this.rotation=s,this.timeResolution=o,this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new n.dY,this.customDecoderQueueSize=0,this.inputTimestamps=[],this.sampleQueue=[];let l=i.wb.find(e=>e.supports(r,a));if(l)this.customDecoder=new l,this.customDecoder.codec=r,this.customDecoder.config=a,this.customDecoder.onSample=e=>{if(!(e instanceof c.U))throw TypeError("The argument passed to onSample must be a VideoSample.");this.finalizeAndEmitSample(e)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{let e=e=>{if((0,n.nr)()){if(this.sampleQueue.length>0&&e.timestamp>=(0,n._g)(this.sampleQueue).timestamp){for(let e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}(0,n.h8)(this.sampleQueue,e,e=>e.timestamp)}else{let t=this.inputTimestamps.shift();(0,n.vA)(void 0!==t),e.setTimestamp(t),this.finalizeAndEmitSample(e)}};this.decoder=new VideoDecoder({output:t=>e(new c.U(t)),error:t}),this.decoder.configure(a)}}finalizeAndEmitSample(e){e.setTimestamp(Math.round(e.timestamp*this.timeResolution)/this.timeResolution),e.setDuration(Math.round(e.duration*this.timeResolution)/this.timeResolution),e.setRotation(this.rotation),this.onSample(e)}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:((0,n.vA)(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):((0,n.vA)(this.decoder),(0,n.nr)()||(0,n.h8)(this.inputTimestamps,e.timestamp,e=>e),this.decoder.decode(e.toEncodedVideoChunk()))}async flush(){if(this.customDecoder?await this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):((0,n.vA)(this.decoder),await this.decoder.flush()),(0,n.nr)()){for(let e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}}close(){for(let e of(this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):((0,n.vA)(this.decoder),this.decoder.close()),this.sampleQueue))e.close();this.sampleQueue.length=0}}class b extends p{constructor(e){if(!(e instanceof s.N0))throw TypeError("videoTrack must be an InputVideoTrack.");super(),this._videoTrack=e}async _createDecoder(e,t){if(!await this._videoTrack.canDecode())throw Error("This video track cannot be decoded by this browser. Make sure to check decodability before using a track.");let r=this._videoTrack.codec,a=this._videoTrack.rotation,i=await this._videoTrack.getDecoderConfig(),s=this._videoTrack.timeResolution;return(0,n.vA)(r&&i),new k(e,t,r,i,a,s)}_createPacketSink(){return new m(this._videoTrack)}async getSample(e){for await(let t of(u(e),this.mediaSamplesAtTimestamps([e])))return t;throw Error("Internal error: Iterator returned nothing.")}samples(e=0,t=1/0){return this.mediaSamplesInRange(e,t)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class y extends f{constructor(e,t,r,a){super(e,t),this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new n.dY,this.customDecoderQueueSize=0;let s=t=>{if(0===t.numberOfFrames){t.close();return}let r=a.sampleRate;t.setTimestamp(Math.round(t.timestamp*r)/r),e(t)},o=i.zx.find(e=>e.supports(r,a));o?(this.customDecoder=new o,this.customDecoder.codec=r,this.customDecoder.config=a,this.customDecoder.onSample=e=>{if(!(e instanceof c.B))throw TypeError("The argument passed to onSample must be an AudioSample.");s(e)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init())):(this.decoder=new AudioDecoder({output:e=>s(new c.B(e)),error:t}),this.decoder.configure(a))}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:((0,n.vA)(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):((0,n.vA)(this.decoder),this.decoder.decode(e.toEncodedAudioChunk()))}flush(){return this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):((0,n.vA)(this.decoder),this.decoder.flush())}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):((0,n.vA)(this.decoder),this.decoder.close())}}class w extends f{constructor(e,t,r){super(e,t),this.decoderConfig=r,this.currentTimestamp=null,(0,n.vA)(a.Wq.includes(r.codec)),this.codec=r.codec;let{dataType:i,sampleSize:s,littleEndian:o}=(0,a.Ei)(this.codec);switch(this.inputSampleSize=s,s){case 1:"unsigned"===i?this.readInputValue=(e,t)=>e.getUint8(t)-128:"signed"===i?this.readInputValue=(e,t)=>e.getInt8(t):"ulaw"===i?this.readInputValue=(e,t)=>(0,l.qS)(e.getUint8(t)):"alaw"===i?this.readInputValue=(e,t)=>(0,l.aw)(e.getUint8(t)):(0,n.vA)(!1);break;case 2:"unsigned"===i?this.readInputValue=(e,t)=>e.getUint16(t,o)-32768:"signed"===i?this.readInputValue=(e,t)=>e.getInt16(t,o):(0,n.vA)(!1);break;case 3:"unsigned"===i?this.readInputValue=(e,t)=>(0,n.dq)(e,t,o)-8388608:"signed"===i?this.readInputValue=(e,t)=>(0,n.Wh)(e,t,o):(0,n.vA)(!1);break;case 4:"unsigned"===i?this.readInputValue=(e,t)=>e.getUint32(t,o)-0x80000000:"signed"===i?this.readInputValue=(e,t)=>e.getInt32(t,o):"float"===i?this.readInputValue=(e,t)=>e.getFloat32(t,o):(0,n.vA)(!1);break;case 8:"float"===i?this.readInputValue=(e,t)=>e.getFloat64(t,o):(0,n.vA)(!1);break;default:(0,n.xb)(s),(0,n.vA)(!1)}switch(s){case 1:"ulaw"===i||"alaw"===i?(this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(e,t,r)=>e.setInt16(t,r,!0)):(this.outputSampleSize=1,this.outputFormat="u8",this.writeOutputValue=(e,t,r)=>e.setUint8(t,r+128));break;case 2:this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(e,t,r)=>e.setInt16(t,r,!0);break;case 3:this.outputSampleSize=4,this.outputFormat="s32",this.writeOutputValue=(e,t,r)=>e.setInt32(t,r<<8,!0);break;case 4:this.outputSampleSize=4,"float"===i?(this.outputFormat="f32",this.writeOutputValue=(e,t,r)=>e.setFloat32(t,r,!0)):(this.outputFormat="s32",this.writeOutputValue=(e,t,r)=>e.setInt32(t,r,!0));break;case 8:this.outputSampleSize=4,this.outputFormat="f32",this.writeOutputValue=(e,t,r)=>e.setFloat32(t,r,!0);break;default:(0,n.xb)(s),(0,n.vA)(!1)}}getDecodeQueueSize(){return 0}decode(e){let t=(0,n.Zc)(e.data),r=e.byteLength/this.decoderConfig.numberOfChannels/this.inputSampleSize,a=new ArrayBuffer(r*this.decoderConfig.numberOfChannels*this.outputSampleSize),i=new DataView(a);for(let e=0;e<r*this.decoderConfig.numberOfChannels;e++){let r=e*this.inputSampleSize,a=e*this.outputSampleSize,s=this.readInputValue(t,r);this.writeOutputValue(i,a,s)}let s=r/this.decoderConfig.sampleRate;(null===this.currentTimestamp||Math.abs(e.timestamp-this.currentTimestamp)>=s)&&(this.currentTimestamp=e.timestamp);let o=this.currentTimestamp;this.currentTimestamp+=s;let l=new c.B({format:this.outputFormat,data:a,numberOfChannels:this.decoderConfig.numberOfChannels,sampleRate:this.decoderConfig.sampleRate,numberOfFrames:r,timestamp:o});this.onSample(l)}async flush(){}close(){}}class T extends p{constructor(e){if(!(e instanceof s.Yi))throw TypeError("audioTrack must be an InputAudioTrack.");super(),this._audioTrack=e}async _createDecoder(e,t){if(!await this._audioTrack.canDecode())throw Error("This audio track cannot be decoded by this browser. Make sure to check decodability before using a track.");let r=this._audioTrack.codec,i=await this._audioTrack.getDecoderConfig();return((0,n.vA)(r&&i),a.Wq.includes(i.codec))?new w(e,t,i):new y(e,t,r,i)}_createPacketSink(){return new m(this._audioTrack)}async getSample(e){for await(let t of(u(e),this.mediaSamplesAtTimestamps([e])))return t;throw Error("Internal error: Iterator returned nothing.")}samples(e=0,t=1/0){return this.mediaSamplesInRange(e,t)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}},346075:(e,t,r)=>{"use strict";r.d(t,{$b:()=>d,Fl:()=>m,Ii:()=>k,_8:()=>b,uC:()=>f});var a=r(496023),i=r(250601);r(553512);var s=r(10397),n=r(131110),o=r(909929),l=r(119699);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class c{constructor(){this._connectedTrack=null,this._closingPromise=null,this._closed=!1,this._timestampOffset=0}_ensureValidAdd(){if(!this._connectedTrack)throw Error("Source is not connected to an output track.");if("canceled"===this._connectedTrack.output.state)throw Error("Output has been canceled.");if("finalizing"===this._connectedTrack.output.state||"finalized"===this._connectedTrack.output.state)throw Error("Output has been finalized.");if("pending"===this._connectedTrack.output.state)throw Error("Output has not started.");if(this._closed)throw Error("Source is closed.")}async _start(){}async _flushAndClose(e){}close(){if(this._closingPromise)return;let e=this._connectedTrack;if(!e)throw Error("Cannot call close without connecting the source to an output track.");if("pending"===e.output.state)throw Error("Cannot call close before output has been started.");this._closingPromise=(async()=>{await this._flushAndClose(!1),this._closed=!0,"finalizing"!==e.output.state&&"finalized"!==e.output.state&&e.output._muxer.onTrackClose(e)})()}async _flushOrWaitForOngoingClose(e){return this._closingPromise?this._closingPromise:this._flushAndClose(e)}}class d extends c{constructor(e){if(super(),this._connectedTrack=null,!a.WN.includes(e))throw TypeError(`Invalid video codec '${e}'. Must be one of: ${a.WN.join(", ")}.`);this._codec=e}}let u=e=>{if(!e||"object"!=typeof e)throw TypeError("Encoding config must be an object.");if(!a.WN.includes(e.codec))throw TypeError(`Invalid video codec '${e.codec}'. Must be one of: ${a.WN.join(", ")}.`);if(!(e.bitrate instanceof a.en)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw TypeError("config.bitrate must be a positive integer or a quality.");if(void 0!==e.latencyMode&&!["quality","realtime"].includes(e.latencyMode))throw TypeError("config.latencyMode, when provided, must be 'quality' or 'realtime'.");if(void 0!==e.keyFrameInterval&&(!Number.isFinite(e.keyFrameInterval)||e.keyFrameInterval<0))throw TypeError("config.keyFrameInterval, when provided, must be a non-negative number.");if(void 0!==e.fullCodecString&&"string"!=typeof e.fullCodecString)throw TypeError("config.fullCodecString, when provided, must be a string.");if(void 0!==e.fullCodecString&&(0,a.oU)(e.fullCodecString)!==e.codec)throw TypeError(`config.fullCodecString, when provided, must be a string that matches the specified codec (${e.codec}).`);if(void 0!==e.onEncodedPacket&&"function"!=typeof e.onEncodedPacket)throw TypeError("config.onEncodedChunk, when provided, must be a function.");if(void 0!==e.onEncoderConfig&&"function"!=typeof e.onEncoderConfig)throw TypeError("config.onEncoderConfig, when provided, must be a function.")};class h{constructor(e,t){this.source=e,this.encodingConfig=t,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastMultipleOfKeyFrameInterval=-1,this.lastWidth=null,this.lastHeight=null,this.customEncoder=null,this.customEncoderCallSerializer=new i.dY,this.customEncoderQueueSize=0,this.encoderError=null}async add(e,t,r){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),null!==this.lastWidth&&null!==this.lastHeight){if(e.codedWidth!==this.lastWidth||e.codedHeight!==this.lastHeight)throw Error(`Video sample size must remain constant. Expected ${this.lastWidth}x${this.lastHeight}, got ${e.codedWidth}x${e.codedHeight}.`)}else this.lastWidth=e.codedWidth,this.lastHeight=e.codedHeight;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),(0,i.vA)(this.encoderInitialized);let a=this.encodingConfig.keyFrameInterval??5,s=Math.floor(e.timestamp/a),n={...r,keyFrame:r?.keyFrame||0===a||s!==this.lastMultipleOfKeyFrameInterval};if(this.lastMultipleOfKeyFrameInterval=s,this.customEncoder){this.customEncoderQueueSize++;let t=e.clone(),r=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(t,n)).then(()=>this.customEncoderQueueSize--).catch(e=>this.encoderError??=e).finally(()=>{t.close()});this.customEncoderQueueSize>=4&&await r}else{(0,i.vA)(this.encoder);let r=e.toVideoFrame();this.encoder.encode(r,n),r.close(),t&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(e=>this.encoder.addEventListener("dequeue",e,{once:!0}))}await this.muxer.mutex.currentPromise}finally{t&&e.close()}}async ensureEncoder(e){if(!this.encoder)return this.ensureEncoderPromise=(async()=>{let t=e.codedWidth,r=e.codedHeight,s=this.encodingConfig.bitrate instanceof a.en?this.encodingConfig.bitrate._toVideoBitrate(this.encodingConfig.codec,t,r):this.encodingConfig.bitrate,l={codec:this.encodingConfig.fullCodecString??(0,a.j7)(this.encodingConfig.codec,t,r,s),width:t,height:r,bitrate:s,framerate:this.source._connectedTrack?.metadata.frameRate,latencyMode:this.encodingConfig.latencyMode,...(0,a.Rc)(this.encodingConfig.codec)};this.encodingConfig.onEncoderConfig?.(l);let c=n.WE.find(e=>e.supports(this.encodingConfig.codec,l));if(c)this.customEncoder=new c,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=l,this.customEncoder.onPacket=(e,t)=>{if(!(e instanceof o.Z))throw TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(void 0!==t&&(!t||"object"!=typeof t))throw TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(e,t),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,e,t)},await this.customEncoder.init();else{if("undefined"==typeof VideoEncoder)throw Error("VideoEncoder is not supported by this browser.");if(!(await VideoEncoder.isConfigSupported(l)).supported)throw Error(`This specific encoder configuration (${l.codec}, ${l.bitrate} bps, ${l.width}x${l.height}) is not supported by this browser. Consider using another codec or changing your video parameters.`);this.encoder=new VideoEncoder({output:(e,t)=>{let r=o.Z.fromEncodedChunk(e);this.encodingConfig.onEncodedPacket?.(r,t),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,r,t)},error:e=>{e.stack=Error().stack,this.encoderError??=e}}),this.encoder.configure(l)}(0,i.vA)(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}async flushAndClose(e){this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||await this.encoder.flush(),this.encoder.close()),this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.encoderError)throw this.encoderError}}class m extends d{constructor(e){u(e),super(e.codec),this._encoder=new h(this,e)}add(e,t){if(!(e instanceof l.U))throw TypeError("videoSample must be a VideoSample.");return this._encoder.add(e,!1,t)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class f extends c{constructor(e){if(super(),this._connectedTrack=null,!a.PP.includes(e))throw TypeError(`Invalid audio codec '${e}'. Must be one of: ${a.PP.join(", ")}.`);this._codec=e}}let p=e=>{if(!e||"object"!=typeof e)throw TypeError("Encoding config must be an object.");if(!a.PP.includes(e.codec))throw TypeError(`Invalid audio codec '${e.codec}'. Must be one of: ${a.PP.join(", ")}.`);if(void 0===e.bitrate&&(!a.Wq.includes(e.codec)||"flac"===e.codec))throw TypeError("config.bitrate must be provided for compressed audio codecs.");if(void 0!==e.bitrate&&!(e.bitrate instanceof a.en)&&(!Number.isInteger(e.bitrate)||e.bitrate<=0))throw TypeError("config.bitrate, when provided, must be a positive integer or a quality.");if(void 0!==e.fullCodecString&&"string"!=typeof e.fullCodecString)throw TypeError("config.fullCodecString, when provided, must be a string.");if(void 0!==e.fullCodecString&&(0,a.oU)(e.fullCodecString)!==e.codec)throw TypeError(`config.fullCodecString, when provided, must be a string that matches the specified codec (${e.codec}).`);if(void 0!==e.onEncodedPacket&&"function"!=typeof e.onEncodedPacket)throw TypeError("config.onEncodedChunk, when provided, must be a function.");if(void 0!==e.onEncoderConfig&&"function"!=typeof e.onEncoderConfig)throw TypeError("config.onEncoderConfig, when provided, must be a function.")};class g{constructor(e,t){this.source=e,this.encodingConfig=t,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastNumberOfChannels=null,this.lastSampleRate=null,this.isPcmEncoder=!1,this.outputSampleSize=null,this.writeOutputValue=null,this.customEncoder=null,this.customEncoderCallSerializer=new i.dY,this.customEncoderQueueSize=0,this.encoderError=null}async add(e,t){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),null!==this.lastNumberOfChannels&&null!==this.lastSampleRate){if(e.numberOfChannels!==this.lastNumberOfChannels||e.sampleRate!==this.lastSampleRate)throw Error(`Audio parameters must remain constant. Expected ${this.lastNumberOfChannels} channels at ${this.lastSampleRate} Hz, got ${e.numberOfChannels} channels at ${e.sampleRate} Hz.`)}else this.lastNumberOfChannels=e.numberOfChannels,this.lastSampleRate=e.sampleRate;if(this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),(0,i.vA)(this.encoderInitialized),this.customEncoder){this.customEncoderQueueSize++;let t=e.clone(),r=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(t)).then(()=>this.customEncoderQueueSize--).catch(e=>this.encoderError??=e).finally(()=>{t.close()});this.customEncoderQueueSize>=4&&await r,await this.muxer.mutex.currentPromise}else if(this.isPcmEncoder)await this.doPcmEncoding(e,t);else{(0,i.vA)(this.encoder);let r=e.toAudioData();this.encoder.encode(r),r.close(),t&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(e=>this.encoder.addEventListener("dequeue",e,{once:!0})),await this.muxer.mutex.currentPromise}}finally{t&&e.close()}}async doPcmEncoding(e,t){(0,i.vA)(this.outputSampleSize),(0,i.vA)(this.writeOutputValue);let{numberOfChannels:r,numberOfFrames:a,sampleRate:s,timestamp:n}=e,l=[];for(let t=0;t<a;t+=2048){let a=Math.min(2048,e.numberOfFrames-t),i=new DataView(new ArrayBuffer(a*r*this.outputSampleSize));l.push({frameCount:a,view:i})}let c=new Float32Array(e.allocationSize({planeIndex:0,format:"f32-planar"})/Float32Array.BYTES_PER_ELEMENT);for(let t=0;t<r;t++){e.copyTo(c,{planeIndex:t,format:"f32-planar"});for(let e=0;e<l.length;e++){let{frameCount:a,view:i}=l[e];for(let s=0;s<a;s++)this.writeOutputValue(i,(s*r+t)*this.outputSampleSize,c[2048*e+s])}}t&&e.close();let d={decoderConfig:{codec:this.encodingConfig.codec,numberOfChannels:r,sampleRate:s}};for(let e=0;e<l.length;e++){let{frameCount:t,view:r}=l[e],a=r.buffer,i=2048*e,c=new o.Z(new Uint8Array(a),"key",n+i/s,t/s);this.encodingConfig.onEncodedPacket?.(c,d),await this.muxer.addEncodedAudioPacket(this.source._connectedTrack,c,d)}}ensureEncoder(e){if(!this.encoderInitialized)return this.ensureEncoderPromise=(async()=>{let{numberOfChannels:t,sampleRate:r}=e,s=this.encodingConfig.bitrate instanceof a.en?this.encodingConfig.bitrate._toAudioBitrate(this.encodingConfig.codec):this.encodingConfig.bitrate,l={codec:this.encodingConfig.fullCodecString??(0,a.KZ)(this.encodingConfig.codec,t,r),numberOfChannels:t,sampleRate:r,bitrate:s,...(0,a.IJ)(this.encodingConfig.codec)};this.encodingConfig.onEncoderConfig?.(l);let c=n.Lr.find(e=>e.supports(this.encodingConfig.codec,l));if(c)this.customEncoder=new c,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=l,this.customEncoder.onPacket=(e,t)=>{if(!(e instanceof o.Z))throw TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(void 0!==t&&(!t||"object"!=typeof t))throw TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(e,t),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,e,t)},await this.customEncoder.init();else if(a.Wq.includes(this.encodingConfig.codec))this.initPcmEncoder();else{if("undefined"==typeof AudioEncoder)throw Error("AudioEncoder is not supported by this browser.");if(!(await AudioEncoder.isConfigSupported(l)).supported)throw Error(`This specific encoder configuration (${l.codec}, ${l.bitrate} bps, ${l.numberOfChannels} channels, ${l.sampleRate} Hz) is not supported by this browser. Consider using another codec or changing your audio parameters.`);this.encoder=new AudioEncoder({output:(e,t)=>{let r=o.Z.fromEncodedChunk(e);this.encodingConfig.onEncodedPacket?.(r,t),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,r,t)},error:e=>{e.stack=Error().stack,this.encoderError??=e}}),this.encoder.configure(l)}(0,i.vA)(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}initPcmEncoder(){this.isPcmEncoder=!0;let e=this.encodingConfig.codec,{dataType:t,sampleSize:r,littleEndian:n}=(0,a.Ei)(e);switch(this.outputSampleSize=r,r){case 1:"unsigned"===t?this.writeOutputValue=(e,t,r)=>e.setUint8(t,(0,i.qE)((r+1)*127.5,0,255)):"signed"===t?this.writeOutputValue=(e,t,r)=>{e.setInt8(t,(0,i.qE)(Math.round(128*r),-128,127))}:"ulaw"===t?this.writeOutputValue=(e,t,r)=>{let a=(0,i.qE)(Math.floor(32767*r),-32768,32767);e.setUint8(t,(0,s.vX)(a))}:"alaw"===t?this.writeOutputValue=(e,t,r)=>{let a=(0,i.qE)(Math.floor(32767*r),-32768,32767);e.setUint8(t,(0,s.xq)(a))}:(0,i.vA)(!1);break;case 2:"unsigned"===t?this.writeOutputValue=(e,t,r)=>e.setUint16(t,(0,i.qE)((r+1)*32767.5,0,65535),n):"signed"===t?this.writeOutputValue=(e,t,r)=>e.setInt16(t,(0,i.qE)(Math.round(32767*r),-32768,32767),n):(0,i.vA)(!1);break;case 3:"unsigned"===t?this.writeOutputValue=(e,t,r)=>(0,i.jD)(e,t,(0,i.qE)((r+1)*8388607.5,0,0xffffff),n):"signed"===t?this.writeOutputValue=(e,t,r)=>(0,i.iP)(e,t,(0,i.qE)(Math.round(8388607*r),-8388608,8388607),n):(0,i.vA)(!1);break;case 4:"unsigned"===t?this.writeOutputValue=(e,t,r)=>e.setUint32(t,(0,i.qE)((r+1)*2147483647.5,0,0xffffffff),n):"signed"===t?this.writeOutputValue=(e,t,r)=>e.setInt32(t,(0,i.qE)(Math.round(0x7fffffff*r),-0x80000000,0x7fffffff),n):"float"===t?this.writeOutputValue=(e,t,r)=>e.setFloat32(t,r,n):(0,i.vA)(!1);break;case 8:"float"===t?this.writeOutputValue=(e,t,r)=>e.setFloat64(t,r,n):(0,i.vA)(!1);break;default:(0,i.xb)(r),(0,i.vA)(!1)}}async flushAndClose(e){this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||await this.encoder.flush(),this.encoder.close()),this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.isPcmEncoder?0:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.encoderError)throw this.encoderError}}class k extends f{constructor(e){p(e),super(e.codec),this._encoder=new g(this,e)}add(e){if(!(e instanceof l.B))throw TypeError("audioSample must be an AudioSample.");return this._encoder.add(e,!1)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class b extends c{constructor(e){if(super(),this._connectedTrack=null,!a.VW.includes(e))throw TypeError(`Invalid subtitle codec '${e}'. Must be one of: ${a.VW.join(", ")}.`);this._codec=e}}},250601:(e,t,r)=>{"use strict";/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */function a(e){if(!e)throw Error("Assertion failed.")}r.d(t,{Ai:()=>_,Au:()=>y,BL:()=>g,Br:()=>v,CR:()=>H,D5:()=>F,Fo:()=>u,G8:()=>Z,HV:()=>T,IP:()=>l,IR:()=>N,KA:()=>G,Kl:()=>B,MW:()=>Q,Nu:()=>$,OO:()=>c,P5:()=>x,SM:()=>C,UG:()=>m,Uk:()=>R,Wh:()=>z,Wo:()=>d,Zc:()=>h,_c:()=>o,_g:()=>s,_j:()=>V,aD:()=>S,al:()=>q,b_:()=>X,dY:()=>Y,dq:()=>D,eE:()=>E,fl:()=>w,h8:()=>I,i1:()=>M,iP:()=>L,in:()=>j,jD:()=>O,nJ:()=>P,nr:()=>ee,pl:()=>A,qE:()=>W,qT:()=>i,uN:()=>k,vA:()=>a,vv:()=>n,wd:()=>p,x_:()=>b,xb:()=>U});let i=e=>{let t=(e%360+360)%360;if(0===t||90===t||180===t||270===t)return t;throw Error(`Invalid rotation ${e}.`)},s=e=>e&&e[e.length-1],n=e=>e>=0&&e<0x100000000;class o{constructor(e){this.bytes=e,this.pos=0}seekToByte(e){this.pos=8*e}readBit(){let e=Math.floor(this.pos/8),t=this.bytes[e]??0,r=7-(7&this.pos);return this.pos++,(t&1<<r)>>r}readBits(e){if(1===e)return this.readBit();let t=0;for(let r=0;r<e;r++)t<<=1,t|=this.readBit();return t}readAlignedByte(){if(this.pos%8!=0)throw Error("Bitstream is not byte-aligned.");let e=this.pos/8,t=this.bytes[e]??0;return this.pos+=8,t}skipBits(e){this.pos+=e}getBitsLeft(){return 8*this.bytes.length-this.pos}clone(){let e=new o(this.bytes);return e.pos=this.pos,e}}let l=e=>{let t=0;for(;0===e.readBits(1)&&t<32;)t++;if(t>=32)throw Error("Invalid exponential-Golomb code.");return(1<<t)-1+e.readBits(t)},c=e=>{let t=l(e);return(1&t)==0?-(t>>1):t+1>>1},d=(e,t,r,a)=>{for(let i=t;i<r;i++){let t=Math.floor(i/8),s=e[t],n=7-(7&i);s&=~(1<<n),s|=(a&1<<r-i-1)>>r-i-1<<n,e[t]=s}},u=e=>e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength),h=e=>e instanceof DataView?e:e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),m=new TextEncoder,f=e=>Object.fromEntries(Object.entries(e).map(([e,t])=>[t,e])),p={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},g=f(p),k={bt709:1,smpte170m:6,linear:8,"iec61966-2-1":13,pg:16,hlg:18},b=f(k),y={rgb:0,bt709:1,bt470bg:5,smpte170m:6,"bt2020-ncl":9},w=f(y),T=e=>!!e&&!!e.primaries&&!!e.transfer&&!!e.matrix&&void 0!==e.fullRange,C=e=>e instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer||ArrayBuffer.isView(e);class S{constructor(){this.currentPromise=Promise.resolve()}async acquire(){let e;let t=new Promise(t=>{e=t}),r=this.currentPromise;return this.currentPromise=t,await r,e}}let v=e=>[...e].map(e=>e.toString(16).padStart(2,"0")).join(""),x=e=>(e=(e=(e=(e=(e=e>>1&0x55555555|(0x55555555&e)<<1)>>2&0x33333333|(0x33333333&e)<<2)>>4&0xf0f0f0f|(0xf0f0f0f&e)<<4)>>8&0xff00ff|(0xff00ff&e)<<8)>>16&65535|(65535&e)<<16)>>>0,A=(e,t,r)=>{let a=0,i=e.length-1,s=-1;for(;a<=i;){let n=a+i>>1,o=r(e[n]);o===t?(s=n,i=n-1):o<t?a=n+1:i=n-1}return s},E=(e,t,r)=>{let a=0,i=e.length-1,s=-1;for(;a<=i;){let n=a+(i-a+1)/2|0;r(e[n])<=t?(s=n,a=n+1):i=n-1}return s},I=(e,t,r)=>{let a=E(e,r(t),r);e.splice(a+1,0,t)},P=()=>{let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}},_=(e,t)=>{let r=e.indexOf(t);-1!==r&&e.splice(r,1)},R=(e,t)=>{for(let r=e.length-1;r>=0;r--)if(t(e[r]))return e[r]},B=(e,t)=>{for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1},M=async function*(e){Symbol.iterator in e?yield*e[Symbol.iterator]():yield*e[Symbol.asyncIterator]()},F=e=>{if(!(Symbol.iterator in e)&&!(Symbol.asyncIterator in e))throw TypeError("Argument must be an iterable or async iterable.")},U=e=>{throw Error(`Unexpected value: ${e}`)},D=(e,t,r)=>{let a=e.getUint8(t),i=e.getUint8(t+1),s=e.getUint8(t+2);return r?a|i<<8|s<<16:a<<16|i<<8|s},z=(e,t,r)=>D(e,t,r)<<8>>8,O=(e,t,r,a)=>{r>>>=0,r&=0xffffff,a?(e.setUint8(t,255&r),e.setUint8(t+1,r>>>8&255),e.setUint8(t+2,r>>>16&255)):(e.setUint8(t,r>>>16&255),e.setUint8(t+1,r>>>8&255),e.setUint8(t+2,255&r))},L=(e,t,r,a)=>{(r=W(r,-8388608,8388607))<0&&(r=r+0x1000000&0xffffff),O(e,t,r,a)},V=(e,t,r,a)=>{a?(e.setUint32(t+0,r,!0),e.setInt32(t+4,Math.floor(r/0x100000000),!0)):(e.setInt32(t+0,Math.floor(r/0x100000000),!0),e.setUint32(t+4,r,!0))},W=(e,t,r)=>Math.max(t,Math.min(r,e)),N="und",H=(e,t)=>{let r=10**t;return Math.round(e*r)/r},j=(e,t)=>Math.round(e/t)*t,q=e=>{let t=0;for(;e;)t++,e>>=1;return t},K=/^[a-z]{3}$/,$=e=>K.test(e),Q=1e6*(1+Number.EPSILON),G=(e,t)=>{let r={...e};for(let a in t)"object"==typeof e[a]&&null!==e[a]&&"object"==typeof t[a]&&null!==t[a]?r[a]=G(e[a],t[a]):r[a]=t[a];return r},Z=async(e,t,r)=>{let a=0;for(;;)try{return await fetch(e,t)}catch(t){let e=r(++a);if(null===e)throw t;if(console.error("Retrying failed fetch. Error:",t),!Number.isFinite(e)||e<0)throw TypeError("Retry delay must be a non-negative finite number.");e>0&&await new Promise(t=>setTimeout(t,1e3*e))}},X=(e,t)=>{let r=e<0?-1:1,a=0,i=1,s=1,n=0,o=e=Math.abs(e);for(;;){let e=Math.floor(o),r=e*s+a,l=e*n+i;if(l>t||(a=s,i=n,s=r,n=l,!isFinite(o=1/(o-e))))break}return{numerator:r*s,denominator:n}};class Y{constructor(){this.currentPromise=Promise.resolve()}call(e){return this.currentPromise=this.currentPromise.then(e)}}let J=null,ee=()=>{if(null!==J)return J;let e=!!("undefined"!=typeof navigator&&navigator.vendor?.match(/apple/i)&&!navigator.userAgent?.match(/crios/i)&&!navigator.userAgent?.match(/fxios/i)&&!navigator.userAgent?.match(/Opera|OPT\//));return J=e,e}},631959:(e,t,r)=>{"use strict";r.d(t,{Ob:()=>c,Zk:()=>s,_S:()=>o,nL:()=>l});var a=r(481140),i=r(250601);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let s=0x5367674f,n=new Uint32Array(256);for(let e=0;e<256;e++){let t=e<<24;for(let e=0;e<8;e++)t=0x80000000&t?t<<1^0x4c11db7:t<<1;n[e]=t>>>0&0xffffffff}let o=e=>{let t=(0,i.Zc)(e),r=t.getUint32(22,!0);t.setUint32(22,0,!0);let a=0;for(let t=0;t<e.length;t++)a=(a<<8^n[a>>>24^e[t]])>>>0;return t.setUint32(22,r,!0),a},l=(e,t,r)=>{let s=0,n=null;if(e.length>0){if("vorbis"===t.codec){(0,i.vA)(t.vorbisInfo);let a=t.vorbisInfo.modeBlockflags.length,o=(1<<(0,i.al)(a-1))-1<<1,l=(e[0]&o)>>1;if(l>=t.vorbisInfo.modeBlockflags.length)throw Error("Invalid mode number.");let c=r,d=t.vorbisInfo.modeBlockflags[l];if(n=t.vorbisInfo.blocksizes[d],1===d){let r=e[0]&(1|o)+1?1:0;c=t.vorbisInfo.blocksizes[r]}s=null!==c?c+n>>2:0}else"opus"===t.codec&&(s=(0,a.ls)(e).durationInSamples)}return{durationInSamples:s,vorbisBlockSize:n}},c=e=>{let t="audio/ogg";if(e.codecStrings){let r=[...new Set(e.codecStrings)];t+=`; codecs="${r.join(", ")}"`}return t}},693848:(e,t,r)=>{"use strict";r.d(t,{H4:()=>n,H9:()=>s,b0:()=>i,vC:()=>o});var a=r(631959);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let i=27,s=282,n=65307;class o{constructor(e){this.reader=e,this.pos=0}readBytes(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU8(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+1);return this.pos+=1,e.getUint8(t)}readU32(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getUint32(t,!0)}readI32(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getInt32(t,!0)}readI64(){let e=this.readU32();return 0x100000000*this.readI32()+e}readAscii(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let a="";for(let i=0;i<e;i++)a+=String.fromCharCode(t.getUint8(r+i));return a}readPageHeader(){let e=this.pos;if(this.readU32()!==a.Zk)return null;this.pos+=1;let t=this.readU8(),r=this.readI64(),i=this.readU32(),s=this.readU32(),n=this.readU32(),o=this.readU8(),l=new Uint8Array(o);for(let e=0;e<o;e++)l[e]=this.readU8();let c=27+o,d=l.reduce((e,t)=>e+t,0);return{headerStartPos:e,totalSize:c+d,dataStartPos:e+c,dataSize:d,headerType:t,granulePosition:r,serialNumber:i,sequenceNumber:s,checksum:n,lacingValues:l}}findNextPageHeader(e){for(;this.pos<e-3;){let e=this.readU32(),t=255&e,r=e>>>8&255,i=e>>>16&255,s=e>>>24&255;if(79===t||79===r||79===i||79===s){if(this.pos-=4,e===a.Zk)return!0;this.pos+=1}}return!1}}},57106:(e,t,r)=>{"use strict";r.d(t,{fE:()=>eQ,si:()=>e$,$y:()=>eq,wQ:()=>eZ});var a=r(496023),i=r(250601),s=r(553512),n=r(481140);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class o{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,Math.floor(e/0x100000000),!1),this.helperView.setUint32(4,e,!1),this.writer.write(this.helper.subarray(0,8))}writeAscii(e){for(let t=0;t<e.length;t++)this.helperView.setUint8(t%8,e.charCodeAt(t)),t%8==7&&this.writer.write(this.helper);e.length%8!=0&&this.writer.write(this.helper.subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.writer.getPos()),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.writer.write(e.contents);else{let t=this.writer.getPos();if(this.writeBoxHeader(e,0),e.contents&&this.writer.write(e.contents),e.children)for(let t of e.children)t&&this.writeBox(t);let r=this.writer.getPos(),a=e.size??r-t;this.writer.seek(t),this.writeBoxHeader(e,a),this.writer.seek(r)}}writeBoxHeader(e,t){this.writeU32(e.largeSize?1:t),this.writeAscii(e.type),e.largeSize&&this.writeU64(t)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){let t=this.offsets.get(e);(0,i.vA)(void 0!==t);let r=this.writer.getPos();this.writer.seek(t),this.writeBox(e),this.writer.seek(r)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let t=this.measureBoxHeader(e);if(e.contents&&(t+=e.contents.byteLength),e.children)for(let r of e.children)r&&(t+=this.measureBox(r));return t}}}let l=new Uint8Array(8),c=new DataView(l.buffer),d=e=>[(e%256+256)%256],u=e=>(c.setUint16(0,e,!1),[l[0],l[1]]),h=e=>(c.setInt16(0,e,!1),[l[0],l[1]]),m=e=>(c.setUint32(0,e,!1),[l[1],l[2],l[3]]),f=e=>(c.setUint32(0,e,!1),[l[0],l[1],l[2],l[3]]),p=e=>(c.setInt32(0,e,!1),[l[0],l[1],l[2],l[3]]),g=e=>(c.setUint32(0,Math.floor(e/0x100000000),!1),c.setUint32(4,e,!1),[l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7]]),k=e=>(c.setInt16(0,256*e,!1),[l[0],l[1]]),b=e=>(c.setInt32(0,65536*e,!1),[l[0],l[1],l[2],l[3]]),y=e=>(c.setInt32(0,0x40000000*e,!1),[l[0],l[1],l[2],l[3]]),w=(e,t)=>{let r=[],a=e;do{let e=127&a;a>>=7,r.length>0&&(e|=128),r.push(e),void 0!==t&&t--}while(a>0||t)return r.reverse()},T=(e,t=!1)=>{let r=Array(e.length).fill(null).map((t,r)=>e.charCodeAt(r));return t&&r.push(0),r},C=e=>{let t=null;for(let r of e)(!t||r.timestamp>t.timestamp)&&(t=r);return t},S=e=>{let t=Math.PI/180*e,r=Math.round(Math.cos(t)),a=Math.round(Math.sin(t));return[r,a,0,-a,r,0,0,0,1]},v=S(0),x=e=>[b(e[0]),b(e[1]),y(e[2]),b(e[3]),b(e[4]),y(e[5]),b(e[6]),b(e[7]),y(e[8])],A=(e,t,r)=>({type:e,contents:t&&new Uint8Array(t.flat(10)),children:r}),E=(e,t,r,a,i)=>A(e,[d(t),m(r),a??[]],i),I=e=>e.isQuickTime?A("ftyp",[T("qt  "),f(512),T("qt  ")]):e.fragmented?A("ftyp",[T("iso5"),f(512),T("iso5"),T("iso6"),T("mp41")]):A("ftyp",[T("isom"),f(512),T("isom"),e.holdsAvc?T("avc1"):[],T("mp41")]),P=e=>({type:"mdat",largeSize:e}),_=(e,t,r=!1)=>A("moov",void 0,[R(t,e),...e.map(e=>B(e,t)),r?eu(e):null]),R=(e,t)=>{let r=eO(Math.max(0,...t.filter(e=>e.samples.length>0).map(e=>{let t=C(e.samples);return t.timestamp+t.duration})),ez),a=Math.max(0,...t.map(e=>e.track.id))+1,s=!(0,i.vv)(e)||!(0,i.vv)(r),n=s?g:f;return E("mvhd",+s,0,[n(e),n(e),f(ez),n(r),b(1),k(1),Array(10).fill(0),x(v),Array(24).fill(0),f(a)])},B=(e,t)=>A("trak",void 0,[M(e,t),F(e,t)]),M=(e,t)=>{let r;let a=C(e.samples),s=eO(a?a.timestamp+a.duration:0,ez),n=!(0,i.vv)(t)||!(0,i.vv)(s),o=n?g:f;return r="video"===e.type?S(e.track.metadata.rotation??0):v,E("tkhd",+n,3,[o(t),o(t),f(e.track.id),f(0),o(s),Array(8).fill(0),u(0),u(e.track.id),k("audio"===e.type?1:0),u(0),x(r),b("video"===e.type?e.info.width:0),b("video"===e.type?e.info.height:0)])},F=(e,t)=>A("mdia",void 0,[U(e,t),O(e),L(e)]),U=(e,t)=>{let r=C(e.samples),a=eO(r?r.timestamp+r.duration:0,e.timescale),s=!(0,i.vv)(t)||!(0,i.vv)(a),n=s?g:f,o=0;for(let t of e.track.metadata.languageCode??i.IR)o<<=5,o+=t.charCodeAt(0)-96;return E("mdhd",+s,0,[n(t),n(t),f(e.timescale),n(a),u(o),u(0)])},D={video:"vide",audio:"soun",subtitle:"text"},z={video:"MediabunnyVideoHandler",audio:"MediabunnySoundHandler",subtitle:"MediabunnyTextHandler"},O=e=>E("hdlr",0,0,[T("mhlr"),T(D[e.type]),f(0),f(0),f(0),T(z[e.type],!0)]),L=e=>A("minf",void 0,[V[e.type](),W(),j(e)]),V={video:()=>E("vmhd",0,1,[u(0),u(0),u(0),u(0)]),audio:()=>E("smhd",0,0,[u(0),u(0)]),subtitle:()=>E("nmhd",0,0)},W=()=>A("dinf",void 0,[N()]),N=()=>E("dref",0,0,[f(1)],[H()]),H=()=>E("url ",0,1),j=e=>{let t=e.compositionTimeOffsetTable.length>1||e.compositionTimeOffsetTable.some(e=>0!==e.sampleCompositionTimeOffset);return A("stbl",void 0,[q(e),ei(e),t?ec(e):null,t?ed(e):null,en(e),eo(e),el(e),es(e)])},q=e=>{let t;if("video"===e.type)t=K(eA[e.track.source._codec],e);else if("audio"===e.type){let r=eI(e.track.source._codec,e.muxer.isQuickTime);(0,i.vA)(r),t=G(r,e)}else"subtitle"===e.type&&(t=ea(e_[e.track.source._codec],e));return(0,i.vA)(t),E("stsd",0,0,[f(1)],[t])},K=(e,t)=>A(e,[Array(6).fill(0),u(1),u(0),u(0),Array(12).fill(0),u(t.info.width),u(t.info.height),f(4718592),f(4718592),f(0),u(1),Array(32).fill(0),u(24),h(65535)],[eE[t.track.source._codec](t),(0,i.HV)(t.info.decoderConfig.colorSpace)?$(t):null]),$=e=>A("colr",[T("nclx"),u(i.wd[e.info.decoderConfig.colorSpace.primaries]),u(i.uN[e.info.decoderConfig.colorSpace.transfer]),u(i.Au[e.info.decoderConfig.colorSpace.matrix]),d((e.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),Q=e=>{if(!e.info.decoderConfig)return null;let t=e.info.decoderConfig,r=t.codec.split("."),a=Number(r[1]),s=Number(r[2]),n=Number(r[3]),o=r[4]?Number(r[4]):1,l=r[8]?Number(r[8]):Number(t.colorSpace?.fullRange??0),c=r[5]?Number(r[5]):t.colorSpace?.primaries?i.wd[t.colorSpace.primaries]:2,h=r[6]?Number(r[6]):t.colorSpace?.transfer?i.uN[t.colorSpace.transfer]:2,m=r[7]?Number(r[7]):t.colorSpace?.matrix?i.Au[t.colorSpace.matrix]:2;return E("vpcC",1,0,[d(a),d(s),d((n<<4)+(o<<1)+l),d(c),d(h),d(m),u(0)])},G=(e,t)=>{let r=0,i=16;if(a.Wq.includes(t.track.source._codec)){let e=t.track.source._codec,{sampleSize:s}=(0,a.Ei)(e);(i=8*s)>16&&(r=1)}return A(e,0===r?[Array(6).fill(0),u(1),u(r),u(0),f(0),u(t.info.numberOfChannels),u(i),u(0),u(0),u(t.info.sampleRate<65536?t.info.sampleRate:0),u(0)]:[Array(6).fill(0),u(1),u(r),u(0),f(0),u(t.info.numberOfChannels),u(Math.min(i,16)),u(0),u(0),u(t.info.sampleRate<65536?t.info.sampleRate:0),u(0),f(1),f(i/8),f(t.info.numberOfChannels*i/8),f(2)],[eP(t.track.source._codec,t.muxer.isQuickTime)?.(t)??null])},Z=e=>{let t;switch(e.track.source._codec){case"aac":t=64;break;case"mp3":t=107;break;case"vorbis":t=221;break;default:throw Error(`Unhandled audio codec: ${e.track.source._codec}`)}let r=[...d(t),...d(21),...m(0),...f(0),...f(0)];if(e.info.decoderConfig.description){let t=(0,i.Fo)(e.info.decoderConfig.description);r=[...r,...d(5),...w(t.byteLength),...t]}return r=[...u(1),...d(0),...d(4),...w(r.length),...r,...d(6),...d(1),...d(2)],E("esds",0,0,r=[...d(3),...w(r.length),...r])},X=e=>A("wave",void 0,[Y(e),J(e),A("\0\0\0\0")]),Y=e=>A("frma",[T(eI(e.track.source._codec,e.muxer.isQuickTime))]),J=e=>{let{littleEndian:t}=(0,a.Ei)(e.track.source._codec);return A("enda",[u(+t)])},ee=e=>{let t=e.info.numberOfChannels,r=3840,a=e.info.sampleRate,s=0,o=0,l=new Uint8Array(0),c=e.info.decoderConfig?.description;if(c){(0,i.vA)(c.byteLength>=18);let e=(0,i.Fo)(c),d=(0,n.Qf)(e);t=d.outputChannelCount,r=d.preSkip,a=d.inputSampleRate,s=d.outputGain,o=d.channelMappingFamily,d.channelMappingTable&&(l=d.channelMappingTable)}return A("dOps",[d(0),d(t),u(r),f(a),h(s),d(o),...l])},et=e=>{let t=e.info.decoderConfig?.description;return(0,i.vA)(t),E("dfLa",0,0,[...(0,i.Fo)(t).subarray(4)])},er=e=>{let{littleEndian:t,sampleSize:r}=(0,a.Ei)(e.track.source._codec);return E("pcmC",0,0,[d(+t),d(8*r)])},ea=(e,t)=>A(e,[Array(6).fill(0),u(1)],[eR[t.track.source._codec](t)]),ei=e=>E("stts",0,0,[f(e.timeToSampleTable.length),e.timeToSampleTable.map(e=>[f(e.sampleCount),f(e.sampleDelta)])]),es=e=>{if(e.samples.every(e=>"key"===e.type))return null;let t=[...e.samples.entries()].filter(([,e])=>"key"===e.type);return E("stss",0,0,[f(t.length),t.map(([e])=>f(e+1))])},en=e=>E("stsc",0,0,[f(e.compactlyCodedChunkTable.length),e.compactlyCodedChunkTable.map(e=>[f(e.firstChunk),f(e.samplesPerChunk),f(1)])]),eo=e=>{if("audio"===e.type&&e.info.requiresPcmTransformation){let{sampleSize:t}=(0,a.Ei)(e.track.source._codec);return E("stsz",0,0,[f(t*e.info.numberOfChannels),f(e.samples.reduce((t,r)=>t+eO(r.duration,e.timescale),0))])}return E("stsz",0,0,[f(0),f(e.samples.length),e.samples.map(e=>f(e.size))])},el=e=>e.finalizedChunks.length>0&&(0,i._g)(e.finalizedChunks).offset>=0x100000000?E("co64",0,0,[f(e.finalizedChunks.length),e.finalizedChunks.map(e=>g(e.offset))]):E("stco",0,0,[f(e.finalizedChunks.length),e.finalizedChunks.map(e=>f(e.offset))]),ec=e=>E("ctts",1,0,[f(e.compositionTimeOffsetTable.length),e.compositionTimeOffsetTable.map(e=>[f(e.sampleCount),p(e.sampleCompositionTimeOffset)])]),ed=e=>{let t=1/0,r=-1/0,a=1/0,s=-1/0;(0,i.vA)(e.compositionTimeOffsetTable.length>0),(0,i.vA)(e.samples.length>0);for(let a=0;a<e.compositionTimeOffsetTable.length;a++){let i=e.compositionTimeOffsetTable[a];t=Math.min(t,i.sampleCompositionTimeOffset),r=Math.max(r,i.sampleCompositionTimeOffset)}for(let t=0;t<e.samples.length;t++){let r=e.samples[t];a=Math.min(a,eO(r.timestamp,e.timescale)),s=Math.max(s,eO(r.timestamp+r.duration,e.timescale))}let n=Math.max(-t,0);return s>=0x80000000?null:E("cslg",0,0,[p(n),p(t),p(r),p(a),p(s)])},eu=e=>A("mvex",void 0,e.map(eh)),eh=e=>E("trex",0,0,[f(e.track.id),f(1),f(0),f(0),f(0)]),em=(e,t)=>A("moof",void 0,[ef(e),...t.map(eg)]),ef=e=>E("mfhd",0,0,[f(e)]),ep=e=>{let t=0,r=0,a="delta"===e.type;return r|=+a,a?t|=1:t|=2,t<<24|r<<16|0},eg=e=>A("traf",void 0,[ek(e),eb(e),ey(e)]),ek=e=>{(0,i.vA)(e.currentChunk);let t=e.currentChunk.samples[1]??e.currentChunk.samples[0],r={duration:t.timescaleUnitsToNextSample,size:t.size,flags:ep(t)};return E("tfhd",0,131128,[f(e.track.id),f(r.duration),f(r.size),f(r.flags)])},eb=e=>((0,i.vA)(e.currentChunk),E("tfdt",1,0,[g(eO(e.currentChunk.startTimestamp,e.timescale))])),ey=e=>{(0,i.vA)(e.currentChunk);let t=e.currentChunk.samples.map(e=>e.timescaleUnitsToNextSample),r=e.currentChunk.samples.map(e=>e.size),a=e.currentChunk.samples.map(ep),s=e.currentChunk.samples.map(t=>eO(t.timestamp-t.decodeTimestamp,e.timescale)),n=new Set(t),o=new Set(r),l=new Set(a),c=new Set(s),d=2===l.size&&a[0]!==a[1],u=n.size>1,h=o.size>1,m=!d&&l.size>1,g=c.size>1||[...c].some(e=>0!==e);return E("trun",1,1|4*+d|256*+u|512*+h|1024*+m|2048*+g,[f(e.currentChunk.samples.length),f(e.currentChunk.offset-e.currentChunk.moofOffset||0),d?f(a[0]):[],e.currentChunk.samples.map((e,i)=>[u?f(t[i]):[],h?f(r[i]):[],m?f(a[i]):[],g?p(s[i]):[]])])},ew=e=>A("mfra",void 0,[...e.map(eT),eC()]),eT=(e,t)=>E("tfra",1,0,[f(e.track.id),f(63),f(e.finalizedChunks.length),e.finalizedChunks.map(r=>[g(eO(r.samples[0].timestamp,e.timescale)),g(r.moofOffset),f(t+1),f(1),f(1)])]),eC=()=>E("mfro",0,0,[f(0)]),eS=()=>A("vtte"),ev=(e,t,r,a,n)=>A("vttc",void 0,[null!==n?A("vsid",[p(n)]):null,null!==r?A("iden",[...i.UG.encode(r)]):null,null!==t?A("ctim",[...i.UG.encode((0,s.ce)(t))]):null,null!==a?A("sttg",[...i.UG.encode(a)]):null,A("payl",[...i.UG.encode(e)])]),ex=e=>A("vtta",[...i.UG.encode(e)]),eA={avc:"avc1",hevc:"hvc1",vp8:"vp08",vp9:"vp09",av1:"av01"},eE={avc:e=>e.info.decoderConfig&&A("avcC",[...(0,i.Fo)(e.info.decoderConfig.description)]),hevc:e=>e.info.decoderConfig&&A("hvcC",[...(0,i.Fo)(e.info.decoderConfig.description)]),vp8:Q,vp9:Q,av1:e=>A("av1C",(0,a.DC)(e.info.decoderConfig.codec))},eI=(e,t)=>{switch(e){case"aac":case"mp3":case"vorbis":return"mp4a";case"opus":return"Opus";case"flac":return"fLaC";case"ulaw":return"ulaw";case"alaw":return"alaw";case"pcm-u8":return"raw ";case"pcm-s8":return"sowt"}if(t)switch(e){case"pcm-s16":return"sowt";case"pcm-s16be":return"twos";case"pcm-s24":case"pcm-s24be":return"in24";case"pcm-s32":case"pcm-s32be":return"in32";case"pcm-f32":case"pcm-f32be":return"fl32";case"pcm-f64":case"pcm-f64be":return"fl64"}else switch(e){case"pcm-s16":case"pcm-s16be":case"pcm-s24":case"pcm-s24be":case"pcm-s32":case"pcm-s32be":return"ipcm";case"pcm-f32":case"pcm-f32be":case"pcm-f64":case"pcm-f64be":return"fpcm"}},eP=(e,t)=>{switch(e){case"aac":case"mp3":case"vorbis":return Z;case"opus":return ee;case"flac":return et}if(t)switch(e){case"pcm-s24":case"pcm-s24be":case"pcm-s32":case"pcm-s32be":case"pcm-f32":case"pcm-f32be":case"pcm-f64":case"pcm-f64be":return X}else switch(e){case"pcm-s16":case"pcm-s16be":case"pcm-s24":case"pcm-s24be":case"pcm-s32":case"pcm-s32be":case"pcm-f32":case"pcm-f32be":case"pcm-f64":case"pcm-f64be":return er}return null},e_={webvtt:"wvtt"},eR={webvtt:e=>A("vttC",[...i.UG.encode(e.info.config.description)])};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class eB{constructor(e){this.mutex=new i.aD,this.firstMediaStreamTimestamp=null,this.trackTimestampInfo=new WeakMap,this.output=e}onTrackClose(e){}validateAndNormalizeTimestamp(e,t,r){t+=e.source._timestampOffset;let a=this.trackTimestampInfo.get(e);if(!a){if(!r)throw Error("First frame must be a key frame.");a={maxTimestamp:t,maxTimestampBeforeLastKeyFrame:t},this.trackTimestampInfo.set(e,a)}if(t<0)throw Error(`Timestamps must be non-negative (got ${t}s).`);if(r&&(a.maxTimestampBeforeLastKeyFrame=a.maxTimestamp),t<a.maxTimestampBeforeLastKeyFrame)throw Error(`Timestamps cannot be smaller than the highest timestamp of the previous run (a run begins with a key frame and ends right before the next key frame). Got ${t}s, but highest timestamp is ${a.maxTimestampBeforeLastKeyFrame}s.`);return a.maxTimestamp=Math.max(a.maxTimestamp,t),t}}var eM=r(596954),eF=r(328420),eU=r(955911),eD=r(492648);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let ez=1e3,eO=(e,t,r=!0)=>{let a=e*t;return r?Math.round(a):a};class eL extends eB{constructor(e,t){super(e),this.auxTarget=new eF.Sn,this.auxWriter=this.auxTarget._createWriter(),this.auxBoxWriter=new o(this.auxWriter),this.mdat=null,this.trackDatas=[],this.allTracksKnown=(0,i.nJ)(),this.creationTime=Math.floor(Date.now()/1e3)+0x7c25b080,this.finalizedChunks=[],this.nextFragmentNumber=1,this.maxWrittenTimestamp=-1/0,this.format=t,this.writer=e._writer,this.boxWriter=new o(this.writer),this.isQuickTime=t instanceof eQ;let r=this.writer instanceof eM.p2&&"in-memory";this.fastStart=t._options.fastStart??r,this.isFragmented="fragmented"===this.fastStart,("in-memory"===this.fastStart||this.isFragmented)&&(this.writer.ensureMonotonicity=!0),this.minimumFragmentDuration=t._options.minimumFragmentDuration??1}async start(){let e=await this.mutex.acquire(),t=this.output._tracks.some(e=>"video"===e.type&&"avc"===e.source._codec);if(this.format._options.onFtyp&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(I({isQuickTime:this.isQuickTime,holdsAvc:t,fragmented:this.isFragmented})),this.format._options.onFtyp){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onFtyp(e,t)}"in-memory"===this.fastStart?this.mdat=P(!1):this.isFragmented||(this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=P(!0),this.boxWriter.writeBox(this.mdat)),await this.writer.flush(),e()}allTracksAreKnown(){for(let e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(t=>t.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;let e=this.trackDatas.map(e=>"video"===e.type?e.info.decoderConfig.codec:"audio"===e.type?e.info.decoderConfig.codec:({webvtt:"wvtt"})[e.track.source._codec]);return(0,eU.X)({isQuickTime:this.isQuickTime,hasVideo:this.trackDatas.some(e=>"video"===e.type),hasAudio:this.trackDatas.some(e=>"audio"===e.type),codecStrings:e})}getVideoTrackData(e,t,r){let s=this.trackDatas.find(t=>t.track===e);if(s)return s;(0,a.aF)(r),(0,i.vA)(r),(0,i.vA)(r.decoderConfig);let o={...r.decoderConfig};(0,i.vA)(void 0!==o.codedWidth),(0,i.vA)(void 0!==o.codedHeight);let l=!1;if("avc"!==e.source._codec||o.description){if("hevc"===e.source._codec&&!o.description){let e=(0,n.D5)(t.data);if(!e)throw Error("Couldn't extract an HEVCDecoderConfigurationRecord from the HEVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.265) when not providing a description, or provide a description (must be an HEVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in HEVC format.");o.description=(0,n.Us)(e),l=!0}}else{let e=(0,n.fH)(t.data);if(!e)throw Error("Couldn't extract an AVCDecoderConfigurationRecord from the AVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.264) when not providing a description, or provide a description (must be an AVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in AVCC format.");o.description=(0,n.KU)(e),l=!0}let c=(0,i.b_)(1/(e.metadata.frameRate??57600),1e6).denominator,d={muxer:this,track:e,type:"video",info:{width:o.codedWidth,height:o.codedHeight,decoderConfig:o,requiresAnnexBTransformation:l},timescale:c,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(d),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),d}getAudioTrackData(e,t){let r=this.trackDatas.find(t=>t.track===e);if(r)return r;(0,a.P7)(t),(0,i.vA)(t),(0,i.vA)(t.decoderConfig);let s={muxer:this,track:e,type:"audio",info:{numberOfChannels:t.decoderConfig.numberOfChannels,sampleRate:t.decoderConfig.sampleRate,decoderConfig:t.decoderConfig,requiresPcmTransformation:!this.isFragmented&&a.Wq.includes(e.source._codec)},timescale:t.decoderConfig.sampleRate,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(s),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),s}getSubtitleTrackData(e,t){let r=this.trackDatas.find(t=>t.track===e);if(r)return r;(0,a.GL)(t),(0,i.vA)(t),(0,i.vA)(t.config);let s={muxer:this,track:e,type:"subtitle",info:{config:t.config},timescale:1e3,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[],lastCueEndTimestamp:0,cueQueue:[],nextSourceId:0,cueToSourceId:new WeakMap};return this.trackDatas.push(s),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),s}async addEncodedVideoPacket(e,t,r){let a=await this.mutex.acquire();try{let a=this.getVideoTrackData(e,t,r),i=t.data;if(a.info.requiresAnnexBTransformation){let e=(0,n.no)(i);if(!e)throw Error("Failed to transform packet data. Make sure all packets are provided in Annex B format, as specified in ITU-T-REC-H.264 and ITU-T-REC-H.265.");i=e}let s=this.validateAndNormalizeTimestamp(a.track,t.timestamp,"key"===t.type),o=this.createSampleForTrack(a,i,s,t.duration,t.type);await this.registerSample(a,o)}finally{a()}}async addEncodedAudioPacket(e,t,r){let a=await this.mutex.acquire();try{let a=this.getAudioTrackData(e,r),i=this.validateAndNormalizeTimestamp(a.track,t.timestamp,"key"===t.type),s=this.createSampleForTrack(a,t.data,i,t.duration,t.type);a.info.requiresPcmTransformation&&await this.maybePadWithSilence(a,i),await this.registerSample(a,s)}finally{a()}}async maybePadWithSilence(e,t){let r=(0,i._g)(e.samples),s=r?r.timestamp+r.duration:0,n=t-s,o=eO(n,e.timescale);if(o>0){let{sampleSize:t,silentValue:r}=(0,a.Ei)(e.info.decoderConfig.codec),i=new Uint8Array(t*(o*e.info.numberOfChannels)).fill(r),l=this.createSampleForTrack(e,new Uint8Array(i.buffer),s,n,"key");await this.registerSample(e,l)}}async addSubtitleCue(e,t,r){let a=await this.mutex.acquire();try{let a=this.getSubtitleTrackData(e,r);this.validateAndNormalizeTimestamp(a.track,t.timestamp,!0),"webvtt"===e.source._codec&&(a.cueQueue.push(t),await this.processWebVTTCues(a,t.timestamp))}finally{a()}}async processWebVTTCues(e,t){for(;e.cueQueue.length>0;){let r=new Set([]);for(let a of e.cueQueue)(0,i.vA)(a.timestamp<=t),(0,i.vA)(e.lastCueEndTimestamp<=a.timestamp+a.duration),r.add(Math.max(a.timestamp,e.lastCueEndTimestamp)),r.add(a.timestamp+a.duration);let a=[...r].sort((e,t)=>e-t),n=a[0],o=a[1]??n;if(t<o)break;if(e.lastCueEndTimestamp<n){this.auxWriter.seek(0);let t=eS();this.auxBoxWriter.writeBox(t);let r=this.auxWriter.getSlice(0,this.auxWriter.getPos()),a=this.createSampleForTrack(e,r,e.lastCueEndTimestamp,n-e.lastCueEndTimestamp,"key");await this.registerSample(e,a),e.lastCueEndTimestamp=n}this.auxWriter.seek(0);for(let t=0;t<e.cueQueue.length;t++){let r=e.cueQueue[t];if(r.timestamp>=o)break;s.Fp.lastIndex=0;let a=s.Fp.test(r.text),i=r.timestamp+r.duration,l=e.cueToSourceId.get(r);if(void 0===l&&o<i&&(l=e.nextSourceId++,e.cueToSourceId.set(r,l)),r.notes){let e=ex(r.notes);this.auxBoxWriter.writeBox(e)}let c=ev(r.text,a?n:null,r.identifier??null,r.settings??null,l??null);this.auxBoxWriter.writeBox(c),i===o&&e.cueQueue.splice(t--,1)}let l=this.auxWriter.getSlice(0,this.auxWriter.getPos()),c=this.createSampleForTrack(e,l,n,o-n,"key");await this.registerSample(e,c),e.lastCueEndTimestamp=o}}createSampleForTrack(e,t,r,a,i){return{timestamp:r,decodeTimestamp:r,duration:a,data:t,size:t.byteLength,type:i,timescaleUnitsToNextSample:eO(a,e.timescale)}}processTimestamps(e,t){if(0===e.timestampProcessingQueue.length)return;if("audio"===e.type&&e.info.requiresPcmTransformation){let t=0;for(let r=0;r<e.timestampProcessingQueue.length;r++)t+=eO(e.timestampProcessingQueue[r].duration,e.timescale);if(0===e.timeToSampleTable.length)e.timeToSampleTable.push({sampleCount:t,sampleDelta:1});else{let r=(0,i._g)(e.timeToSampleTable);r.sampleCount+=t}e.timestampProcessingQueue.length=0;return}let r=e.timestampProcessingQueue.map(e=>e.timestamp).sort((e,t)=>e-t);for(let t=0;t<e.timestampProcessingQueue.length;t++){let a=e.timestampProcessingQueue[t];a.decodeTimestamp=r[t],this.isFragmented||null!==e.lastTimescaleUnits||(a.decodeTimestamp=0);let s=eO(a.timestamp-a.decodeTimestamp,e.timescale),n=eO(a.duration,e.timescale);if(null!==e.lastTimescaleUnits){(0,i.vA)(e.lastSample);let t=Math.round(eO(a.decodeTimestamp,e.timescale,!1)-e.lastTimescaleUnits);if((0,i.vA)(t>=0),e.lastTimescaleUnits+=t,e.lastSample.timescaleUnitsToNextSample=t,!this.isFragmented){let r=(0,i._g)(e.timeToSampleTable);if((0,i.vA)(r),1===r.sampleCount){r.sampleDelta=t;let a=e.timeToSampleTable[e.timeToSampleTable.length-2];a&&a.sampleDelta===t&&(a.sampleCount++,e.timeToSampleTable.pop(),r=a)}else r.sampleDelta!==t&&(r.sampleCount--,e.timeToSampleTable.push(r={sampleCount:1,sampleDelta:t}));r.sampleDelta===n?r.sampleCount++:e.timeToSampleTable.push({sampleCount:1,sampleDelta:n});let a=(0,i._g)(e.compositionTimeOffsetTable);(0,i.vA)(a),a.sampleCompositionTimeOffset===s?a.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:s})}}else e.lastTimescaleUnits=eO(a.decodeTimestamp,e.timescale,!1),this.isFragmented||(e.timeToSampleTable.push({sampleCount:1,sampleDelta:n}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:s}));e.lastSample=a}if(e.timestampProcessingQueue.length=0,(0,i.vA)(e.lastSample),(0,i.vA)(null!==e.lastTimescaleUnits),void 0!==t&&0===e.lastSample.timescaleUnitsToNextSample){(0,i.vA)("key"===t.type);let r=Math.round(eO(t.timestamp,e.timescale,!1)-e.lastTimescaleUnits);e.lastSample.timescaleUnitsToNextSample=r}}async registerSample(e,t){"key"===t.type&&this.processTimestamps(e,t),e.timestampProcessingQueue.push(t),this.isFragmented?(e.sampleQueue.push(t),await this.interleaveSamples()):await this.addSampleToTrack(e,t)}async addSampleToTrack(e,t){this.isFragmented||e.samples.push(t);let r=!1;if(e.currentChunk){e.currentChunk.startTimestamp=Math.min(e.currentChunk.startTimestamp,t.timestamp);let a=t.timestamp-e.currentChunk.startTimestamp;if(this.isFragmented){let i=this.trackDatas.every(r=>{if(e===r)return"key"===t.type;let a=r.sampleQueue[0];return a?"key"===a.type:r.track.source._closed});a>=this.minimumFragmentDuration&&i&&t.timestamp>this.maxWrittenTimestamp&&(r=!0,await this.finalizeFragment())}else r=a>=.5}else r=!0;r&&(e.currentChunk&&await this.finalizeCurrentChunk(e),e.currentChunk={startTimestamp:t.timestamp,samples:[],offset:null,moofOffset:null}),(0,i.vA)(e.currentChunk),e.currentChunk.samples.push(t),this.isFragmented&&(this.maxWrittenTimestamp=Math.max(this.maxWrittenTimestamp,t.timestamp))}async finalizeCurrentChunk(e){if((0,i.vA)(!this.isFragmented),!e.currentChunk)return;e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk);let t=e.currentChunk.samples.length;if("audio"===e.type&&e.info.requiresPcmTransformation&&(t=e.currentChunk.samples.reduce((t,r)=>t+eO(r.duration,e.timescale),0)),(0===e.compactlyCodedChunkTable.length||(0,i._g)(e.compactlyCodedChunkTable).samplesPerChunk!==t)&&e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:t}),"in-memory"===this.fastStart){e.currentChunk.offset=0;return}for(let t of(e.currentChunk.offset=this.writer.getPos(),e.currentChunk.samples))(0,i.vA)(t.data),this.writer.write(t.data),t.data=null;await this.writer.flush()}async interleaveSamples(e=!1){if((0,i.vA)(this.isFragmented),e||this.allTracksAreKnown())e:for(;;){let t=null,r=1/0;for(let a of this.trackDatas){if(!e&&0===a.sampleQueue.length&&!a.track.source._closed)break e;a.sampleQueue.length>0&&a.sampleQueue[0].timestamp<r&&(t=a,r=a.sampleQueue[0].timestamp)}if(!t)break;let a=t.sampleQueue.shift();await this.addSampleToTrack(t,a)}}async finalizeFragment(e=!0){(0,i.vA)(this.isFragmented);let t=this.nextFragmentNumber++;if(1===t){this.format._options.onMoov&&this.writer.startTrackingWrites();let e=_(this.trackDatas,this.creationTime,!0);if(this.boxWriter.writeBox(e),this.format._options.onMoov){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoov(e,t)}}let r=this.trackDatas.filter(e=>e.currentChunk),a=em(t,r),s=this.writer.getPos(),n=s+this.boxWriter.measureBox(a),o=n+eD.ZM,l=1/0;for(let e of r){for(let t of(e.currentChunk.offset=o,e.currentChunk.moofOffset=s,e.currentChunk.samples))o+=t.size;l=Math.min(l,e.currentChunk.startTimestamp)}let c=o-n,d=c>=0x100000000;if(d)for(let e of r)e.currentChunk.offset+=eD.Xk-eD.ZM;this.format._options.onMoof&&this.writer.startTrackingWrites();let u=em(t,r);if(this.boxWriter.writeBox(u),this.format._options.onMoof){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoof(e,t,l)}(0,i.vA)(this.writer.getPos()===n),this.format._options.onMdat&&this.writer.startTrackingWrites();let h=P(d);for(let e of(h.size=c,this.boxWriter.writeBox(h),this.writer.seek(n+(d?eD.Xk:eD.ZM)),r))for(let t of e.currentChunk.samples)this.writer.write(t.data),t.data=null;if(this.format._options.onMdat){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMdat(e,t)}for(let e of r)e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk),e.currentChunk=null;e&&await this.writer.flush()}async onTrackClose(e){let t=await this.mutex.acquire();if("subtitle"===e.type&&"webvtt"===e.source._codec){let t=this.trackDatas.find(t=>t.track===e);t&&await this.processWebVTTCues(t,1/0)}this.allTracksAreKnown()&&this.allTracksKnown.resolve(),this.isFragmented&&await this.interleaveSamples(),t()}async finalize(){let e=await this.mutex.acquire();for(let e of(this.allTracksKnown.resolve(),this.trackDatas))"subtitle"===e.type&&"webvtt"===e.track.source._codec&&await this.processWebVTTCues(e,1/0);if(this.isFragmented){for(let e of(await this.interleaveSamples(!0),this.trackDatas))this.processTimestamps(e);await this.finalizeFragment(!1)}else for(let e of this.trackDatas)this.processTimestamps(e),await this.finalizeCurrentChunk(e);if("in-memory"===this.fastStart){let e;(0,i.vA)(this.mdat);for(let t=0;t<2;t++){let t=_(this.trackDatas,this.creationTime),r=this.boxWriter.measureBox(t);e=this.boxWriter.measureBox(this.mdat);let a=this.writer.getPos()+r+e;for(let t of this.finalizedChunks)for(let{data:r}of(t.offset=a,t.samples))(0,i.vA)(r),a+=r.byteLength,e+=r.byteLength;if(a<0x100000000)break;e>=0x100000000&&(this.mdat.largeSize=!0)}this.format._options.onMoov&&this.writer.startTrackingWrites();let t=_(this.trackDatas,this.creationTime);if(this.boxWriter.writeBox(t),this.format._options.onMoov){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoov(e,t)}for(let t of(this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat.size=e,this.boxWriter.writeBox(this.mdat),this.finalizedChunks))for(let e of t.samples)(0,i.vA)(e.data),this.writer.write(e.data),e.data=null;if(this.format._options.onMdat){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMdat(e,t)}}else if(this.isFragmented){let e=this.writer.getPos(),t=ew(this.trackDatas);this.boxWriter.writeBox(t);let r=this.writer.getPos()-e;this.writer.seek(this.writer.getPos()-4),this.boxWriter.writeU32(r)}else{(0,i.vA)(this.mdat);let e=this.boxWriter.offsets.get(this.mdat);(0,i.vA)(void 0!==e);let t=this.writer.getPos()-e;if(this.mdat.size=t,this.mdat.largeSize=t>=0x100000000,this.boxWriter.patchBox(this.mdat),this.format._options.onMdat){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMdat(e,t)}this.format._options.onMoov&&this.writer.startTrackingWrites();let r=_(this.trackDatas,this.creationTime);if(this.boxWriter.writeBox(r),this.format._options.onMoov){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onMoov(e,t)}}e()}}var eV=r(237184),eW=r(370053);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let eN="https://github.com/Vanilagy/mediabunny",eH={video:1,audio:2,subtitle:17};class ej extends eB{constructor(e,t){super(e),this.trackDatas=[],this.allTracksKnown=(0,i.nJ)(),this.segment=null,this.segmentInfo=null,this.seekHead=null,this.tracksElement=null,this.segmentDuration=null,this.cues=null,this.currentCluster=null,this.currentClusterStartMsTimestamp=null,this.currentClusterMaxMsTimestamp=null,this.trackDatasInCurrentCluster=new Map,this.duration=0,this.writer=e._writer,this.format=t,this.ebmlWriter=new eV.Qn(this.writer),this.format._options.appendOnly&&(this.writer.ensureMonotonicity=!0)}async start(){let e=await this.mutex.acquire();this.writeEBMLHeader(),this.format._options.appendOnly||this.createSeekHead(),this.createSegmentInfo(),this.createCues(),await this.writer.flush(),e()}writeEBMLHeader(){this.format._options.onEbmlHeader&&this.writer.startTrackingWrites();let e={id:eV.Cl.EBML,data:[{id:eV.Cl.EBMLVersion,data:1},{id:eV.Cl.EBMLReadVersion,data:1},{id:eV.Cl.EBMLMaxIDLength,data:4},{id:eV.Cl.EBMLMaxSizeLength,data:8},{id:eV.Cl.DocType,data:this.format instanceof eZ?"webm":"matroska"},{id:eV.Cl.DocTypeVersion,data:2},{id:eV.Cl.DocTypeReadVersion,data:2}]};if(this.ebmlWriter.writeEBML(e),this.format._options.onEbmlHeader){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onEbmlHeader(e,t)}}createSeekHead(){let e=new Uint8Array([28,83,187,107]),t=new Uint8Array([21,73,169,102]),r=new Uint8Array([22,84,174,107]),a={id:eV.Cl.SeekHead,data:[{id:eV.Cl.Seek,data:[{id:eV.Cl.SeekID,data:e},{id:eV.Cl.SeekPosition,size:5,data:0}]},{id:eV.Cl.Seek,data:[{id:eV.Cl.SeekID,data:t},{id:eV.Cl.SeekPosition,size:5,data:0}]},{id:eV.Cl.Seek,data:[{id:eV.Cl.SeekID,data:r},{id:eV.Cl.SeekPosition,size:5,data:0}]}]};this.seekHead=a}createSegmentInfo(){let e={id:eV.Cl.Duration,data:new eV.Z4(0)};this.segmentDuration=e;let t={id:eV.Cl.Info,data:[{id:eV.Cl.TimestampScale,data:1e6},{id:eV.Cl.MuxingApp,data:eN},{id:eV.Cl.WritingApp,data:eN},this.format._options.appendOnly?null:e]};this.segmentInfo=t}createTracks(){let e={id:eV.Cl.Tracks,data:[]};for(let t of(this.tracksElement=e,this.trackDatas)){let r=eV.oo[t.track.source._codec];(0,i.vA)(r);let s=0;if("audio"===t.type&&"opus"===t.track.source._codec){s=1e6*80;let e=t.info.decoderConfig.description;if(e){let t=(0,i.Fo)(e);s=Math.round(1e9*((0,n.Qf)(t).preSkip/a.cj))}}e.data.push({id:eV.Cl.TrackEntry,data:[{id:eV.Cl.TrackNumber,data:t.track.id},{id:eV.Cl.TrackUID,data:t.track.id},{id:eV.Cl.TrackType,data:eH[t.type]},{id:eV.Cl.FlagLacing,data:0},{id:eV.Cl.Language,data:t.track.metadata.languageCode??i.IR},{id:eV.Cl.CodecID,data:r},{id:eV.Cl.CodecDelay,data:0},{id:eV.Cl.SeekPreRoll,data:s},"video"===t.type?this.videoSpecificTrackInfo(t):null,"audio"===t.type?this.audioSpecificTrackInfo(t):null,"subtitle"===t.type?this.subtitleSpecificTrackInfo(t):null]})}}videoSpecificTrackInfo(e){let{frameRate:t,rotation:r}=e.track.metadata,a=[e.info.decoderConfig.description?{id:eV.Cl.CodecPrivate,data:(0,i.Fo)(e.info.decoderConfig.description)}:null,t?{id:eV.Cl.DefaultDuration,data:1e9/t}:null],s=r?(0,i.qT)(-r):0,n=e.info.decoderConfig.colorSpace;return a.push({id:eV.Cl.Video,data:[{id:eV.Cl.PixelWidth,data:e.info.width},{id:eV.Cl.PixelHeight,data:e.info.height},(0,i.HV)(n)?{id:eV.Cl.Colour,data:[{id:eV.Cl.MatrixCoefficients,data:i.Au[n.matrix]},{id:eV.Cl.TransferCharacteristics,data:i.uN[n.transfer]},{id:eV.Cl.Primaries,data:i.wd[n.primaries]},{id:eV.Cl.Range,data:n.fullRange?2:1}]}:null,s?{id:eV.Cl.Projection,data:[{id:eV.Cl.ProjectionType,data:0},{id:eV.Cl.ProjectionPoseRoll,data:new eV._v((s+180)%360-180)}]}:null]}),a}audioSpecificTrackInfo(e){let t=a.Wq.includes(e.track.source._codec)?(0,a.Ei)(e.track.source._codec):null;return[e.info.decoderConfig.description?{id:eV.Cl.CodecPrivate,data:(0,i.Fo)(e.info.decoderConfig.description)}:null,{id:eV.Cl.Audio,data:[{id:eV.Cl.SamplingFrequency,data:new eV._v(e.info.sampleRate)},{id:eV.Cl.Channels,data:e.info.numberOfChannels},t?{id:eV.Cl.BitDepth,data:8*t.sampleSize}:null]}]}subtitleSpecificTrackInfo(e){return[{id:eV.Cl.CodecPrivate,data:i.UG.encode(e.info.config.description)}]}createSegment(){let e={id:eV.Cl.Segment,size:this.format._options.appendOnly?-1:6,data:[this.format._options.appendOnly?null:this.seekHead,this.segmentInfo,this.tracksElement]};if(this.segment=e,this.format._options.onSegmentHeader&&this.writer.startTrackingWrites(),this.ebmlWriter.writeEBML(e),this.format._options.onSegmentHeader){let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onSegmentHeader(e,t)}}createCues(){this.cues={id:eV.Cl.Cues,data:[]}}get segmentDataOffset(){return(0,i.vA)(this.segment),this.ebmlWriter.dataOffsets.get(this.segment)}allTracksAreKnown(){for(let e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(t=>t.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;let e=this.trackDatas.map(e=>"video"===e.type?e.info.decoderConfig.codec:"audio"===e.type?e.info.decoderConfig.codec:({webvtt:"wvtt"})[e.track.source._codec]);return(0,eW.V)({isWebM:this.format instanceof eZ,hasVideo:this.trackDatas.some(e=>"video"===e.type),hasAudio:this.trackDatas.some(e=>"audio"===e.type),codecStrings:e})}getVideoTrackData(e,t){let r=this.trackDatas.find(t=>t.track===e);if(r)return r;(0,a.aF)(t),(0,i.vA)(t),(0,i.vA)(t.decoderConfig),(0,i.vA)(void 0!==t.decoderConfig.codedWidth),(0,i.vA)(void 0!==t.decoderConfig.codedHeight);let s={track:e,type:"video",info:{width:t.decoderConfig.codedWidth,height:t.decoderConfig.codedHeight,decoderConfig:t.decoderConfig},chunkQueue:[],lastWrittenMsTimestamp:null};return"vp9"===e.source._codec?s.info.decoderConfig={...s.info.decoderConfig,description:new Uint8Array((0,a.mD)(s.info.decoderConfig.codec))}:"av1"===e.source._codec&&(s.info.decoderConfig={...s.info.decoderConfig,description:new Uint8Array((0,a.DC)(s.info.decoderConfig.codec))}),this.trackDatas.push(s),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),s}getAudioTrackData(e,t){let r=this.trackDatas.find(t=>t.track===e);if(r)return r;(0,a.P7)(t),(0,i.vA)(t),(0,i.vA)(t.decoderConfig);let s={track:e,type:"audio",info:{numberOfChannels:t.decoderConfig.numberOfChannels,sampleRate:t.decoderConfig.sampleRate,decoderConfig:t.decoderConfig},chunkQueue:[],lastWrittenMsTimestamp:null};return this.trackDatas.push(s),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),s}getSubtitleTrackData(e,t){let r=this.trackDatas.find(t=>t.track===e);if(r)return r;(0,a.GL)(t),(0,i.vA)(t),(0,i.vA)(t.config);let s={track:e,type:"subtitle",info:{config:t.config},chunkQueue:[],lastWrittenMsTimestamp:null};return this.trackDatas.push(s),this.trackDatas.sort((e,t)=>e.track.id-t.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),s}async addEncodedVideoPacket(e,t,r){let a=await this.mutex.acquire();try{let a=this.getVideoTrackData(e,r),s="key"===t.type,n=this.validateAndNormalizeTimestamp(a.track,t.timestamp,s),o=t.duration;void 0!==e.metadata.frameRate&&(n=(0,i.in)(n,1/e.metadata.frameRate),o=(0,i.in)(o,1/e.metadata.frameRate));let l=this.createInternalChunk(t.data,n,o,t.type);"vp9"===e.source._codec&&this.fixVP9ColorSpace(a,l),a.chunkQueue.push(l),await this.interleaveChunks()}finally{a()}}async addEncodedAudioPacket(e,t,r){let a=await this.mutex.acquire();try{let a=this.getAudioTrackData(e,r),i="key"===t.type,s=this.validateAndNormalizeTimestamp(a.track,t.timestamp,i),n=this.createInternalChunk(t.data,s,t.duration,t.type);a.chunkQueue.push(n),await this.interleaveChunks()}finally{a()}}async addSubtitleCue(e,t,r){let a=await this.mutex.acquire();try{let a=this.getSubtitleTrackData(e,r),n=this.validateAndNormalizeTimestamp(a.track,t.timestamp,!0),o=t.text,l=Math.round(1e3*n);s.Fp.lastIndex=0,o=o.replace(s.Fp,e=>{let t=(0,s.cj)(e.slice(1,-1));return`<${(0,s.ce)(t-l)}>`});let c=i.UG.encode(o),d=`${t.settings??""}
${t.identifier??""}
${t.notes??""}`,u=this.createInternalChunk(c,n,t.duration,"key",d.trim()?i.UG.encode(d):null);a.chunkQueue.push(u),await this.interleaveChunks()}finally{a()}}async interleaveChunks(e=!1){if(e||this.allTracksAreKnown()){e:for(;;){let t=null,r=1/0;for(let a of this.trackDatas){if(!e&&0===a.chunkQueue.length&&!a.track.source._closed)break e;a.chunkQueue.length>0&&a.chunkQueue[0].timestamp<r&&(t=a,r=a.chunkQueue[0].timestamp)}if(!t)break;let a=t.chunkQueue.shift();this.writeBlock(t,a)}e||await this.writer.flush()}}fixVP9ColorSpace(e,t){if("key"!==t.type||!e.info.decoderConfig.colorSpace||!e.info.decoderConfig.colorSpace.matrix)return;let r=new i._c(t.data);r.skipBits(2);let a=r.readBits(1),s=(r.readBits(1)<<1)+a;if(3===s&&r.skipBits(1),r.readBits(1)||0!==r.readBits(1)||(r.skipBits(2),4817730!==r.readBits(24)))return;s>=2&&r.skipBits(1);let n={rgb:7,bt709:2,bt470bg:1,smpte170m:3}[e.info.decoderConfig.colorSpace.matrix];(0,i.Wo)(t.data,r.pos,r.pos+3,n)}createInternalChunk(e,t,r,a,i=null){return{data:e,type:a,timestamp:t,duration:r,additions:i}}writeBlock(e,t){this.segment||(this.createTracks(),this.createSegment());let r=Math.round(1e3*t.timestamp),a=this.trackDatas.every(r=>{if(e===r)return"key"===t.type;let a=r.chunkQueue[0];return a?"key"===a.type:r.track.source._closed}),s=!1;if(this.currentCluster){(0,i.vA)(null!==this.currentClusterStartMsTimestamp),(0,i.vA)(null!==this.currentClusterMaxMsTimestamp);let e=r-this.currentClusterStartMsTimestamp;s=a&&r>this.currentClusterMaxMsTimestamp&&e>=1e3*(this.format._options.minimumClusterDuration??1)||e>32767}else s=!0;s&&this.createNewCluster(r);let n=r-this.currentClusterStartMsTimestamp;if(n<-32768)return;let o=new Uint8Array(4),l=new DataView(o.buffer);l.setUint8(0,128|e.track.id),l.setInt16(1,n,!1);let c=Math.round(1e3*t.duration);if(0!==c||t.additions){let a={id:eV.Cl.BlockGroup,data:[{id:eV.Cl.Block,data:[o,t.data]},"delta"===t.type?{id:eV.Cl.ReferenceBlock,data:new eV.ys(e.lastWrittenMsTimestamp-r)}:null,t.additions?{id:eV.Cl.BlockAdditions,data:[{id:eV.Cl.BlockMore,data:[{id:eV.Cl.BlockAdditional,data:t.additions},{id:eV.Cl.BlockAddID,data:1}]}]}:null,c>0?{id:eV.Cl.BlockDuration,data:c}:null]};this.ebmlWriter.writeEBML(a)}else{l.setUint8(3,Number("key"===t.type)<<7);let e={id:eV.Cl.SimpleBlock,data:[o,t.data]};this.ebmlWriter.writeEBML(e)}this.duration=Math.max(this.duration,r+c),e.lastWrittenMsTimestamp=r,this.trackDatasInCurrentCluster.has(e)||this.trackDatasInCurrentCluster.set(e,{firstMsTimestamp:r}),this.currentClusterMaxMsTimestamp=Math.max(this.currentClusterMaxMsTimestamp,r)}createNewCluster(e){this.currentCluster&&this.finalizeCurrentCluster(),this.format._options.onCluster&&this.writer.startTrackingWrites(),this.currentCluster={id:eV.Cl.Cluster,size:this.format._options.appendOnly?-1:5,data:[{id:eV.Cl.Timestamp,data:e}]},this.ebmlWriter.writeEBML(this.currentCluster),this.currentClusterStartMsTimestamp=e,this.currentClusterMaxMsTimestamp=e,this.trackDatasInCurrentCluster.clear()}finalizeCurrentCluster(){if((0,i.vA)(this.currentCluster),!this.format._options.appendOnly){let e=this.writer.getPos()-this.ebmlWriter.dataOffsets.get(this.currentCluster),t=this.writer.getPos();this.writer.seek(this.ebmlWriter.offsets.get(this.currentCluster)+4),this.ebmlWriter.writeVarInt(e,5),this.writer.seek(t)}if(this.format._options.onCluster){(0,i.vA)(null!==this.currentClusterStartMsTimestamp);let{data:e,start:t}=this.writer.stopTrackingWrites();this.format._options.onCluster(e,t,this.currentClusterStartMsTimestamp/1e3)}let e=this.ebmlWriter.offsets.get(this.currentCluster)-this.segmentDataOffset,t=new Map;for(let[e,{firstMsTimestamp:r}]of this.trackDatasInCurrentCluster)t.has(r)||t.set(r,[]),t.get(r).push(e);for(let[r,a]of[...t.entries()].sort((e,t)=>e[0]-t[0]))(0,i.vA)(this.cues),this.cues.data.push({id:eV.Cl.CuePoint,data:[{id:eV.Cl.CueTime,data:r},...a.map(t=>({id:eV.Cl.CueTrackPositions,data:[{id:eV.Cl.CueTrack,data:t.track.id},{id:eV.Cl.CueClusterPosition,data:e}]}))]})}async onTrackClose(){let e=await this.mutex.acquire();this.allTracksAreKnown()&&this.allTracksKnown.resolve(),await this.interleaveChunks(),e()}async finalize(){let e=await this.mutex.acquire();if(this.allTracksKnown.resolve(),this.segment||(this.createTracks(),this.createSegment()),await this.interleaveChunks(!0),this.currentCluster&&this.finalizeCurrentCluster(),(0,i.vA)(this.cues),this.ebmlWriter.writeEBML(this.cues),!this.format._options.appendOnly){let e=this.writer.getPos(),t=this.writer.getPos()-this.segmentDataOffset;this.writer.seek(this.ebmlWriter.offsets.get(this.segment)+4),this.ebmlWriter.writeVarInt(t,6),this.segmentDuration.data=new eV.Z4(this.duration),this.writer.seek(this.ebmlWriter.offsets.get(this.segmentDuration)),this.ebmlWriter.writeEBML(this.segmentDuration),this.seekHead.data[0].data[1].data=this.ebmlWriter.offsets.get(this.cues)-this.segmentDataOffset,this.seekHead.data[1].data[1].data=this.ebmlWriter.offsets.get(this.segmentInfo)-this.segmentDataOffset,this.seekHead.data[2].data[1].data=this.ebmlWriter.offsets.get(this.tracksElement)-this.segmentDataOffset,this.writer.seek(this.ebmlWriter.offsets.get(this.seekHead)),this.ebmlWriter.writeEBML(this.seekHead),this.writer.seek(e)}e()}}r(950899),r(631959),r(693848),r(263935);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class eq{getSupportedVideoCodecs(){return this.getSupportedCodecs().filter(e=>a.WN.includes(e))}getSupportedAudioCodecs(){return this.getSupportedCodecs().filter(e=>a.PP.includes(e))}getSupportedSubtitleCodecs(){return this.getSupportedCodecs().filter(e=>a.VW.includes(e))}_codecUnsupportedHint(e){return""}}class eK extends eq{constructor(e={}){if(!e||"object"!=typeof e)throw TypeError("options must be an object.");if(void 0!==e.fastStart&&![!1,"in-memory","fragmented"].includes(e.fastStart))throw TypeError('options.fastStart, when provided, must be false, "in-memory", or "fragmented".');if(void 0!==e.minimumFragmentDuration&&(!Number.isFinite(e.minimumFragmentDuration)||e.minimumFragmentDuration<0))throw TypeError("options.minimumFragmentDuration, when provided, must be a non-negative number.");if(void 0!==e.onFtyp&&"function"!=typeof e.onFtyp)throw TypeError("options.onFtyp, when provided, must be a function.");if(void 0!==e.onMoov&&"function"!=typeof e.onMoov)throw TypeError("options.onMoov, when provided, must be a function.");if(void 0!==e.onMdat&&"function"!=typeof e.onMdat)throw TypeError("options.onMdat, when provided, must be a function.");if(void 0!==e.onMoof&&"function"!=typeof e.onMoof)throw TypeError("options.onMoof, when provided, must be a function.");super(),this._options=e}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:0x100000000-1}}}get supportsVideoRotationMetadata(){return!0}_createMuxer(e){return new eL(e,this)}}class e$ extends eK{get _name(){return"MP4"}get fileExtension(){return".mp4"}get mimeType(){return"video/mp4"}getSupportedCodecs(){return[...a.WN,...a.YB,"pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be",...a.VW]}_codecUnsupportedHint(e){return new eQ().getSupportedCodecs().includes(e)?" Switching to MOV will grant support for this codec.":""}}class eQ extends eK{get _name(){return"MOV"}get fileExtension(){return".mov"}get mimeType(){return"video/quicktime"}getSupportedCodecs(){return[...a.WN,...a.PP]}_codecUnsupportedHint(e){return new e$().getSupportedCodecs().includes(e)?" Switching to MP4 will grant support for this codec.":""}}class eG extends eq{constructor(e={}){if(!e||"object"!=typeof e)throw TypeError("options must be an object.");if(void 0!==e.appendOnly&&"boolean"!=typeof e.appendOnly)throw TypeError("options.appendOnly, when provided, must be a boolean.");if(void 0!==e.minimumClusterDuration&&(!Number.isFinite(e.minimumClusterDuration)||e.minimumClusterDuration<0))throw TypeError("options.minimumClusterDuration, when provided, must be a non-negative number.");if(void 0!==e.onEbmlHeader&&"function"!=typeof e.onEbmlHeader)throw TypeError("options.onEbmlHeader, when provided, must be a function.");if(void 0!==e.onSegmentHeader&&"function"!=typeof e.onSegmentHeader)throw TypeError("options.onHeader, when provided, must be a function.");if(void 0!==e.onCluster&&"function"!=typeof e.onCluster)throw TypeError("options.onCluster, when provided, must be a function.");super(),this._options=e}_createMuxer(e){return new ej(e,this)}get _name(){return"Matroska"}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:127}}}get fileExtension(){return".mkv"}get mimeType(){return"video/x-matroska"}getSupportedCodecs(){return[...a.WN,...a.YB,...a.Wq.filter(e=>!["pcm-s8","pcm-f32be","pcm-f64be","ulaw","alaw"].includes(e)),...a.VW]}get supportsVideoRotationMetadata(){return!1}}class eZ extends eG{getSupportedCodecs(){return[...a.WN.filter(e=>["vp8","vp9","av1"].includes(e)),...a.PP.filter(e=>["opus","vorbis"].includes(e)),...a.VW]}get _name(){return"WebM"}get fileExtension(){return".webm"}get mimeType(){return"video/webm"}_codecUnsupportedHint(e){return new eG().getSupportedCodecs().includes(e)?" Switching to MKV will grant support for this codec.":""}}},224804:(e,t,r)=>{"use strict";r.d(t,{k:()=>c});var a=r(250601),i=r(57106),s=r(346075),n=r(328420);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let o=["video","audio","subtitle"],l=e=>{if(!e||"object"!=typeof e)throw TypeError("metadata must be an object.");if(void 0!==e.languageCode&&!(0,a.Nu)(e.languageCode))throw TypeError("metadata.languageCode must be a three-letter, ISO 639-2/T language code.")};class c{constructor(e){if(this.state="pending",this._tracks=[],this._startPromise=null,this._cancelPromise=null,this._finalizePromise=null,this._mutex=new a.aD,!e||"object"!=typeof e)throw TypeError("options must be an object.");if(!(e.format instanceof i.$y))throw TypeError("options.format must be an OutputFormat.");if(!(e.target instanceof n.We))throw TypeError("options.target must be a Target.");if(e.target._output)throw Error("Target is already used for another output.");e.target._output=this,this.format=e.format,this.target=e.target,this._writer=e.target._createWriter(),this._muxer=e.format._createMuxer(this)}addVideoTrack(e,t={}){if(!(e instanceof s.$b))throw TypeError("source must be a VideoSource.");if(l(t),void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw TypeError(`Invalid video rotation: ${t.rotation}. Has to be 0, 90, 180 or 270.`);if(!this.format.supportsVideoRotationMetadata&&t.rotation)throw Error(`${this.format._name} does not support video rotation metadata.`);if(void 0!==t.frameRate&&(!Number.isFinite(t.frameRate)||t.frameRate<=0))throw TypeError(`Invalid video frame rate: ${t.frameRate}. Must be a positive number.`);this._addTrack("video",e,t)}addAudioTrack(e,t={}){if(!(e instanceof s.uC))throw TypeError("source must be an AudioSource.");l(t),this._addTrack("audio",e,t)}addSubtitleTrack(e,t={}){if(!(e instanceof s._8))throw TypeError("source must be a SubtitleSource.");l(t),this._addTrack("subtitle",e,t)}_addTrack(e,t,r){if("pending"!==this.state)throw Error("Cannot add track after output has been started or canceled.");if(t._connectedTrack)throw Error("Source is already used for a track.");let a=this.format.getSupportedTrackCounts(),i=this._tracks.reduce((t,r)=>t+(r.type===e?1:0),0),s=a[e].max;if(i===s)throw Error(0===s?`${this.format._name} does not support ${e} tracks.`:`${this.format._name} does not support more than ${s} ${e} track${1===s?"":"s"}.`);let n=a.total.max;if(this._tracks.length===n)throw Error(`${this.format._name} does not support more than ${n} tracks${1===n?"":"s"} in total.`);let o={id:this._tracks.length+1,output:this,type:e,source:t,metadata:r};if("video"===o.type){let e=this.format.getSupportedVideoCodecs();if(0===e.length)throw Error(`${this.format._name} does not support video tracks.`+this.format._codecUnsupportedHint(o.source._codec));if(!e.includes(o.source._codec))throw Error(`Codec '${o.source._codec}' cannot be contained within ${this.format._name}. Supported video codecs are: ${e.map(e=>`'${e}'`).join(", ")}.`+this.format._codecUnsupportedHint(o.source._codec))}else if("audio"===o.type){let e=this.format.getSupportedAudioCodecs();if(0===e.length)throw Error(`${this.format._name} does not support audio tracks.`+this.format._codecUnsupportedHint(o.source._codec));if(!e.includes(o.source._codec))throw Error(`Codec '${o.source._codec}' cannot be contained within ${this.format._name}. Supported audio codecs are: ${e.map(e=>`'${e}'`).join(", ")}.`+this.format._codecUnsupportedHint(o.source._codec))}else if("subtitle"===o.type){let e=this.format.getSupportedSubtitleCodecs();if(0===e.length)throw Error(`${this.format._name} does not support subtitle tracks.`+this.format._codecUnsupportedHint(o.source._codec));if(!e.includes(o.source._codec))throw Error(`Codec '${o.source._codec}' cannot be contained within ${this.format._name}. Supported subtitle codecs are: ${e.map(e=>`'${e}'`).join(", ")}.`+this.format._codecUnsupportedHint(o.source._codec))}this._tracks.push(o),t._connectedTrack=o}async start(){let e=this.format.getSupportedTrackCounts();for(let t of o){let r=this._tracks.reduce((e,r)=>e+(r.type===t?1:0),0),a=e[t].min;if(r<a)throw Error(a===e[t].max?`${this.format._name} requires exactly ${a} ${t} track${1===a?"":"s"}.`:`${this.format._name} requires at least ${a} ${t} track${1===a?"":"s"}.`)}let t=e.total.min;if(this._tracks.length<t)throw Error(t===e.total.max?`${this.format._name} requires exactly ${t} track${1===t?"":"s"}.`:`${this.format._name} requires at least ${t} track${1===t?"":"s"}.`);if("canceled"===this.state)throw Error("Output has been canceled.");return this._startPromise?(console.warn("Output has already been started."),this._startPromise):this._startPromise=(async()=>{this.state="started",this._writer.start();let e=await this._mutex.acquire();await this._muxer.start();let t=this._tracks.map(e=>e.source._start());await Promise.all(t),e()})()}getMimeType(){return this._muxer.getMimeType()}async cancel(){if(this._cancelPromise)return console.warn("Output has already been canceled."),this._cancelPromise;if("finalizing"===this.state||"finalized"===this.state){console.warn("Output has already been finalized.");return}return this._cancelPromise=(async()=>{this.state="canceled";let e=await this._mutex.acquire(),t=this._tracks.map(e=>e.source._flushOrWaitForOngoingClose(!0));await Promise.all(t),await this._writer.close(),e()})()}async finalize(){if("pending"===this.state)throw Error("Cannot finalize before starting.");if("canceled"===this.state)throw Error("Cannot finalize after canceling.");return this._finalizePromise?(console.warn("Output has already been finalized."),this._finalizePromise):this._finalizePromise=(async()=>{this.state="finalizing";let e=await this._mutex.acquire(),t=this._tracks.map(e=>e.source._flushOrWaitForOngoingClose(!1));await Promise.all(t),await this._muxer.finalize(),await this._writer.flush(),await this._writer.finalize(),this.state="finalized",e()})()}}},909929:(e,t,r)=>{"use strict";r.d(t,{T:()=>i,Z:()=>s});var a=r(250601);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let i=new Uint8Array(0);class s{constructor(e,t,r,a,s=-1,n){if(this.data=e,this.type=t,this.timestamp=r,this.duration=a,this.sequenceNumber=s,e===i&&void 0===n)throw Error("Internal error: byteLength must be explicitly provided when constructing metadata-only packets.");if(void 0===n&&(n=e.byteLength),!(e instanceof Uint8Array))throw TypeError("data must be a Uint8Array.");if("key"!==t&&"delta"!==t)throw TypeError('type must be either "key" or "delta".');if(!Number.isFinite(r))throw TypeError("timestamp must be a number.");if(!Number.isFinite(a)||a<0)throw TypeError("duration must be a non-negative number.");if(!Number.isFinite(s))throw TypeError("sequenceNumber must be a number.");if(!Number.isInteger(n)||n<0)throw TypeError("byteLength must be a non-negative integer.");this.byteLength=n}get isMetadataOnly(){return this.data===i}get microsecondTimestamp(){return Math.trunc(a.MW*this.timestamp)}get microsecondDuration(){return Math.trunc(a.MW*this.duration)}toEncodedVideoChunk(){if(this.isMetadataOnly)throw TypeError("Metadata-only packets cannot be converted to a video chunk.");if("undefined"==typeof EncodedVideoChunk)throw Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}toEncodedAudioChunk(){if(this.isMetadataOnly)throw TypeError("Metadata-only packets cannot be converted to an audio chunk.");if("undefined"==typeof EncodedAudioChunk)throw Error("Your browser does not support EncodedAudioChunk.");return new EncodedAudioChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}static fromEncodedChunk(e){if(!(e instanceof EncodedVideoChunk||e instanceof EncodedAudioChunk))throw TypeError("chunk must be an EncodedVideoChunk or EncodedAudioChunk.");let t=new Uint8Array(e.byteLength);return e.copyTo(t),new s(t,e.type,e.timestamp/1e6,(e.duration??0)/1e6)}clone(e){if(void 0!==e&&("object"!=typeof e||null===e))throw TypeError("options, when provided, must be an object.");if(e?.timestamp!==void 0&&!Number.isFinite(e.timestamp))throw TypeError("options.timestamp, when provided, must be a number.");if(e?.duration!==void 0&&!Number.isFinite(e.duration))throw TypeError("options.duration, when provided, must be a number.");return new s(this.data,this.type,e?.timestamp??this.timestamp,e?.duration??this.duration,this.sequenceNumber,this.byteLength)}}},10397:(e,t,r)=>{"use strict";r.d(t,{aw:()=>n,qS:()=>i,vX:()=>a,xq:()=>s});/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let a=e=>{let t=e,r=4096,a=0,i=12,s=0;for(t<0&&(t=-t,a=128),(t+=33)>8191&&(t=8191);(t&r)!==r&&i>=5;)r>>=1,i--;return s=t>>i-4&15,255&~(a|i-5<<4|s)},i=e=>{let t=0,r=0,a=~e;128&a&&(a&=-129,t=-1);let i=(1<<(r=((240&a)>>4)+5)|(15&a)<<r-4|1<<r-5)-33;return 0===t?i:-i},s=e=>{let t=2048,r=0,a=11,i=0,s=e;for(s<0&&(s=-s,r=128),s>4095&&(s=4095);(s&t)!==t&&a>=5;)t>>=1,a--;return i=s>>(4===a?1:a-4)&15,(r|a-4<<4|i)^85},n=e=>{let t=0,r=0,a=85^e;128&a&&(a&=-129,t=-1);let i=0;return i=4!=(r=((240&a)>>4)+4)?1<<r|(15&a)<<r-4|1<<r-5:a<<1|1,0===t?i:-i}},107530:(e,t,r)=>{"use strict";r.d(t,{m:()=>i});var a=r(250601);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class i{constructor(e,t=1/0){this.source=e,this.maxStorableBytes=t,this.loadedSegments=[],this.loadingSegments=[],this.sourceSizePromise=null,this.nextAge=0,this.totalStoredBytes=0}async loadRange(e,t){if(e>=(t=Math.min(t,await this.source.getSize())))return;let r=this.loadingSegments.find(r=>r.start<=e&&r.end>=t);if(r){await r.promise;return}let i=(0,a.eE)(this.loadedSegments,e,e=>e.start);if(-1!==i)for(let r=i;r<this.loadedSegments.length;r++){let a=this.loadedSegments[r];if(a.start>e)break;if(a.end>=t)return}this.source.onread?.(e,t);let s=this.source._read(e,t),n={start:e,end:t,promise:s};this.loadingSegments.push(n);let o=await s;(0,a.Ai)(this.loadingSegments,n),this.insertIntoLoadedSegments(e,o)}rangeIsLoaded(e,t){if(t<=e)return!0;let r=(0,a.eE)(this.loadedSegments,e,e=>e.start);if(-1===r)return!1;for(let a=r;a<this.loadedSegments.length;a++){let r=this.loadedSegments[a];if(r.start>e)break;if(r.end>=t)return!0}return!1}insertIntoLoadedSegments(e,t){let r={start:e,end:e+t.byteLength,bytes:t,view:new DataView(t.buffer),age:this.nextAge++},i=(0,a.eE)(this.loadedSegments,e,e=>e.start);(-1===i||this.loadedSegments[i].start<r.start)&&i++,this.loadedSegments.splice(i,0,r),this.totalStoredBytes+=t.byteLength;for(let e=i+1;e<this.loadedSegments.length;e++){let t=this.loadedSegments[e];if(t.start>=r.end)break;r.start<=t.start&&t.end<=r.end&&(this.loadedSegments.splice(e,1),e--)}for(;this.totalStoredBytes>this.maxStorableBytes&&this.loadedSegments.length>1;){let e=null,t=-1;for(let r=0;r<this.loadedSegments.length;r++){let a=this.loadedSegments[r];(!e||a.age<e.age)&&(e=a,t=r)}(0,a.vA)(e),this.totalStoredBytes-=e.bytes.byteLength,this.loadedSegments.splice(t,1)}}getViewAndOffset(e,t){let r=(0,a.eE)(this.loadedSegments,e,e=>e.start),i=null;if(-1!==r)for(let a=r;a<this.loadedSegments.length;a++){let r=this.loadedSegments[a];if(r.start>e)break;if(t<=r.end){i=r;break}}if(!i)throw Error(`No segment loaded for range [${e}, ${t}).`);return i.age=this.nextAge++,{view:i.view,offset:i.bytes.byteOffset+e-i.start}}forgetRange(e,t){if(t<=e)return;let r=(0,a.eE)(this.loadedSegments,e,e=>e.start);if(-1===r)return;let i=this.loadedSegments[r];i.start===e&&i.end===t&&(this.loadedSegments.splice(r,1),this.totalStoredBytes-=i.bytes.byteLength)}}},119699:(e,t,r)=>{"use strict";r.d(t,{B:()=>o,U:()=>i});var a=r(250601);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class i{get displayWidth(){return this.rotation%180==0?this.codedWidth:this.codedHeight}get displayHeight(){return this.rotation%180==0?this.codedHeight:this.codedWidth}get microsecondTimestamp(){return Math.trunc(a.MW*this.timestamp)}get microsecondDuration(){return Math.trunc(a.MW*this.duration)}constructor(e,t){if(this._closed=!1,e instanceof ArrayBuffer||ArrayBuffer.isView(e)){if(!t||"object"!=typeof t)throw TypeError("init must be an object.");if(!("format"in t)||"string"!=typeof t.format)throw TypeError("init.format must be a string.");if(!Number.isInteger(t.codedWidth)||t.codedWidth<=0)throw TypeError("init.codedWidth must be a positive integer.");if(!Number.isInteger(t.codedHeight)||t.codedHeight<=0)throw TypeError("init.codedHeight must be a positive integer.");if(void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(t.timestamp))throw TypeError("init.timestamp must be a number.");if(void 0!==t.duration&&(!Number.isFinite(t.duration)||t.duration<0))throw TypeError("init.duration, when provided, must be a non-negative number.");this._data=(0,a.Fo)(e).slice(),this.format=t.format,this.codedWidth=t.codedWidth,this.codedHeight=t.codedHeight,this.rotation=t.rotation??0,this.timestamp=t.timestamp,this.duration=t.duration??0,this.colorSpace=new VideoColorSpace(t.colorSpace)}else if("undefined"!=typeof VideoFrame&&e instanceof VideoFrame){if(t?.rotation!==void 0&&![0,90,180,270].includes(t.rotation))throw TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(t?.timestamp!==void 0&&!Number.isFinite(t?.timestamp))throw TypeError("init.timestamp, when provided, must be a number.");if(t?.duration!==void 0&&(!Number.isFinite(t.duration)||t.duration<0))throw TypeError("init.duration, when provided, must be a non-negative number.");this._data=e,this.format=e.format,this.codedWidth=e.codedWidth,this.codedHeight=e.codedHeight,this.rotation=t?.rotation??0,this.timestamp=t?.timestamp??e.timestamp/1e6,this.duration=t?.duration??(e.duration??0)/1e6,this.colorSpace=e.colorSpace}else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof SVGImageElement&&e instanceof SVGImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas){if(!t||"object"!=typeof t)throw TypeError("init must be an object.");if(void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(t.timestamp))throw TypeError("init.timestamp must be a number.");if(void 0!==t.duration&&(!Number.isFinite(t.duration)||t.duration<0))throw TypeError("init.duration, when provided, must be a non-negative number.");if("undefined"!=typeof VideoFrame)return new i(new VideoFrame(e,{timestamp:Math.trunc(t.timestamp*a.MW),duration:Math.trunc((t.duration??0)*a.MW)}),t);let r=0,s=0;if("naturalWidth"in e?(r=e.naturalWidth,s=e.naturalHeight):"videoWidth"in e?(r=e.videoWidth,s=e.videoHeight):"width"in e&&(r=Number(e.width),s=Number(e.height)),!r||!s)throw TypeError("Could not determine dimensions.");let n=new OffscreenCanvas(r,s),o=n.getContext("2d",{alpha:!1,willReadFrequently:!0});(0,a.vA)(o),o.drawImage(e,0,0),this._data=n,this.format="RGBX",this.codedWidth=r,this.codedHeight=s,this.rotation=t.rotation??0,this.timestamp=t.timestamp,this.duration=t.duration??0,this.colorSpace=new VideoColorSpace({matrix:"rgb",primaries:"bt709",transfer:"iec61966-2-1",fullRange:!0})}else throw TypeError("Invalid data type: Must be a BufferSource or CanvasImageSource.")}clone(){if(this._closed)throw Error("VideoSample is closed.");return((0,a.vA)(null!==this._data),s(this._data))?new i(this._data.clone(),{timestamp:this.timestamp,duration:this.duration,rotation:this.rotation}):this._data instanceof Uint8Array?new i(this._data.slice(),{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation}):new i(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})}close(){this._closed||(s(this._data)?this._data.close():this._data=null,this._closed=!0)}allocationSize(){if(this._closed)throw Error("VideoSample is closed.");return((0,a.vA)(null!==this._data),s(this._data))?this._data.allocationSize():this._data instanceof Uint8Array?this._data.byteLength:this.codedWidth*this.codedHeight*4}async copyTo(e){if(!(0,a.SM)(e))throw TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(this._closed)throw Error("VideoSample is closed.");if((0,a.vA)(null!==this._data),s(this._data))await this._data.copyTo(e);else if(this._data instanceof Uint8Array)(0,a.Fo)(e).set(this._data);else{let t=this._data.getContext("2d",{alpha:!1});(0,a.vA)(t);let r=t.getImageData(0,0,this.codedWidth,this.codedHeight);(0,a.Fo)(e).set(r.data)}}toVideoFrame(){if(this._closed)throw Error("VideoSample is closed.");return((0,a.vA)(null!==this._data),s(this._data))?new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0}):this._data instanceof Uint8Array?new VideoFrame(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration,colorSpace:this.colorSpace}):new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}draw(e,t,r,a,i,s,n,o,l){let c=0,d=0,u=this.displayWidth,h=this.displayHeight,m=0,f=0,p=this.displayWidth,g=this.displayHeight;if(void 0!==s?(c=t,d=r,u=a,h=i,m=s,f=n,void 0!==o?(p=o,g=l):(p=u,g=h)):(m=t,f=r,void 0!==a&&(p=a,g=i)),!("undefined"!=typeof CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof OffscreenCanvasRenderingContext2D&&e instanceof OffscreenCanvasRenderingContext2D))throw TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!Number.isFinite(c))throw TypeError("sx must be a number.");if(!Number.isFinite(d))throw TypeError("sy must be a number.");if(!Number.isFinite(u)||u<0)throw TypeError("sWidth must be a non-negative number.");if(!Number.isFinite(h)||h<0)throw TypeError("sHeight must be a non-negative number.");if(!Number.isFinite(m))throw TypeError("dx must be a number.");if(!Number.isFinite(f))throw TypeError("dy must be a number.");if(!Number.isFinite(p)||p<0)throw TypeError("dWidth must be a non-negative number.");if(!Number.isFinite(g)||g<0)throw TypeError("dHeight must be a non-negative number.");if(this._closed)throw Error("VideoSample is closed.");90===this.rotation?[c,d,u,h]=[d,this.codedHeight-c-u,h,u]:180===this.rotation?[c,d]=[this.codedWidth-c-u,this.codedHeight-d-h]:270===this.rotation&&([c,d,u,h]=[this.codedWidth-d-h,c,h,u]);let k=this.toCanvasImageSource();e.save();let b=m+p/2,y=f+g/2;e.translate(b,y),e.rotate(this.rotation*Math.PI/180);let w=this.rotation%180==0?1:p/g;e.scale(1/w,w),e.drawImage(k,c,d,u,h,-p/2,-g/2,p,g),e.restore()}toCanvasImageSource(){if(this._closed)throw Error("VideoSample is closed.");if((0,a.vA)(null!==this._data),!(this._data instanceof Uint8Array))return this._data;{let e=this.toVideoFrame();return queueMicrotask(()=>e.close()),e}}setRotation(e){if(![0,90,180,270].includes(e))throw TypeError("newRotation must be 0, 90, 180, or 270.");this.rotation=e}setTimestamp(e){if(!Number.isFinite(e))throw TypeError("newTimestamp must be a number.");this.timestamp=e}setDuration(e){if(!Number.isFinite(e)||e<0)throw TypeError("newDuration must be a non-negative number.");this.duration=e}}let s=e=>"undefined"!=typeof VideoFrame&&e instanceof VideoFrame,n=new Set(["f32","f32-planar","s16","s16-planar","s32","s32-planar","u8","u8-planar"]);class o{get microsecondTimestamp(){return Math.trunc(a.MW*this.timestamp)}get microsecondDuration(){return Math.trunc(a.MW*this.duration)}constructor(e){if(this._closed=!1,h(e)){if(null===e.format)throw TypeError("AudioData with null format is not supported.");this._data=e,this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=e.numberOfFrames,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp/1e6,this.duration=e.numberOfFrames/e.sampleRate}else{let t;if(!e||"object"!=typeof e)throw TypeError("Invalid AudioDataInit: must be an object.");if(!n.has(e.format))throw TypeError("Invalid AudioDataInit: invalid format.");if(!Number.isFinite(e.sampleRate)||e.sampleRate<=0)throw TypeError("Invalid AudioDataInit: sampleRate must be > 0.");if(!Number.isInteger(e.numberOfChannels)||0===e.numberOfChannels)throw TypeError("Invalid AudioDataInit: numberOfChannels must be an integer > 0.");if(!Number.isFinite(e?.timestamp))throw TypeError("init.timestamp must be a number.");let r=e.data.byteLength/(l(e.format)*e.numberOfChannels);if(!Number.isInteger(r))throw TypeError("Invalid AudioDataInit: data size is not a multiple of frame size.");if(this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=r,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp,this.duration=r/e.sampleRate,e.data instanceof ArrayBuffer)t=new Uint8Array(e.data);else if(ArrayBuffer.isView(e.data))t=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);else throw TypeError("Invalid AudioDataInit: data is not a BufferSource.");let a=this.numberOfFrames*this.numberOfChannels*l(this.format);if(t.byteLength<a)throw TypeError("Invalid AudioDataInit: insufficient data size.");this._data=t}}allocationSize(e){if(!e||"object"!=typeof e)throw TypeError("options must be an object.");if(!Number.isInteger(e.planeIndex)||e.planeIndex<0)throw TypeError("planeIndex must be a non-negative integer.");if(void 0!==e.format&&!n.has(e.format))throw TypeError("Invalid format.");if(void 0!==e.frameOffset&&(!Number.isInteger(e.frameOffset)||e.frameOffset<0))throw TypeError("frameOffset must be a non-negative integer.");if(void 0!==e.frameCount&&(!Number.isInteger(e.frameCount)||e.frameCount<0))throw TypeError("frameCount must be a non-negative integer.");if(this._closed)throw Error("AudioSample is closed.");let t=e.format??this.format,r=e.frameOffset??0;if(r>=this.numberOfFrames)throw RangeError("frameOffset out of range");let a=void 0!==e.frameCount?e.frameCount:this.numberOfFrames-r;if(a>this.numberOfFrames-r)throw RangeError("frameCount out of range");let i=l(t),s=c(t);if(s&&e.planeIndex>=this.numberOfChannels||!s&&0!==e.planeIndex)throw RangeError("planeIndex out of range");return(s?a:a*this.numberOfChannels)*i}copyTo(e,t){if(!(0,a.SM)(e))throw TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(!t||"object"!=typeof t)throw TypeError("options must be an object.");if(!Number.isInteger(t.planeIndex)||t.planeIndex<0)throw TypeError("planeIndex must be a non-negative integer.");if(void 0!==t.format&&!n.has(t.format))throw TypeError("Invalid format.");if(void 0!==t.frameOffset&&(!Number.isInteger(t.frameOffset)||t.frameOffset<0))throw TypeError("frameOffset must be a non-negative integer.");if(void 0!==t.frameCount&&(!Number.isInteger(t.frameCount)||t.frameCount<0))throw TypeError("frameCount must be a non-negative integer.");if(this._closed)throw Error("AudioSample is closed.");let{planeIndex:r,format:i,frameCount:s,frameOffset:o}=t,m=i??this.format;if(!m)throw Error("Destination format not determined");let f=this.numberOfFrames,p=this.numberOfChannels,g=o??0;if(g>=f)throw RangeError("frameOffset out of range");let k=void 0!==s?s:f-g;if(k>f-g)throw RangeError("frameCount out of range");let b=l(m),y=c(m);if(y&&r>=p||!y&&0!==r)throw RangeError("planeIndex out of range");let w=y?k:k*p;if(e.byteLength<w*b)throw RangeError("Destination buffer is too small");let T=(0,a.Zc)(e),C=u(m);if(h(this._data)){if(y){if("f32-planar"===m)this._data.copyTo(e,{planeIndex:r,frameOffset:g,frameCount:k,format:"f32-planar"});else{let e=new ArrayBuffer(4*k),t=new Float32Array(e);this._data.copyTo(t,{planeIndex:r,frameOffset:g,frameCount:k,format:"f32-planar"});let a=new DataView(e);for(let e=0;e<k;e++)C(T,e*b,a.getFloat32(4*e,!0))}}else{let e=new Float32Array(k);for(let t=0;t<p;t++){this._data.copyTo(e,{planeIndex:t,frameOffset:g,frameCount:k,format:"f32-planar"});for(let r=0;r<k;r++)C(T,(r*p+t)*b,e[r])}}}else{let e=this._data,t=new DataView(e.buffer,e.byteOffset,e.byteLength),a=this.format,i=d(a),s=l(a),n=c(a);for(let e=0;e<k;e++)if(y)C(T,e*b,i(t,n?(r*f+(e+g))*s:((e+g)*p+r)*s));else for(let r=0;r<p;r++)C(T,(e*p+r)*b,i(t,n?(r*f+(e+g))*s:((e+g)*p+r)*s))}}clone(){if(this._closed)throw Error("AudioSample is closed.");if(!h(this._data))return new o({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.timestamp,data:this._data});{let e=new o(this._data.clone());return e.setTimestamp(this.timestamp),e}}close(){this._closed||(h(this._data)?this._data.close():this._data=new Uint8Array(0),this._closed=!0)}toAudioData(){if(this._closed)throw Error("AudioSample is closed.");if(!h(this._data))return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:this._data});if(this._data.timestamp===this.microsecondTimestamp)return this._data.clone();if(c(this.format)){let e=this.allocationSize({planeIndex:0,format:this.format}),t=new ArrayBuffer(e*this.numberOfChannels);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(new Uint8Array(t,r*e,e),{planeIndex:r,format:this.format});return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:t})}{let e=new ArrayBuffer(this.allocationSize({planeIndex:0,format:this.format}));return this.copyTo(e,{planeIndex:0,format:this.format}),new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:e})}}toAudioBuffer(){if(this._closed)throw Error("AudioSample is closed.");let e=new AudioBuffer({numberOfChannels:this.numberOfChannels,length:this.numberOfFrames,sampleRate:this.sampleRate}),t=new Float32Array(this.allocationSize({planeIndex:0,format:"f32-planar"})/4);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(t,{planeIndex:r,format:"f32-planar"}),e.copyToChannel(t,r);return e}setTimestamp(e){if(!Number.isFinite(e))throw TypeError("newTimestamp must be a number.");this.timestamp=e}static fromAudioBuffer(e,t){if(!(e instanceof AudioBuffer))throw TypeError("audioBuffer must be an AudioBuffer.");let r=e.numberOfChannels,a=e.sampleRate,i=e.length,s=Math.floor(0x4000000/r),n=0,l=i,c=[];for(;l>0;){let i=Math.min(s,l),d=new Float32Array(r*i);for(let t=0;t<r;t++)e.copyFromChannel(d.subarray(t*i,t*i+i),t,n);let u=new o({format:"f32-planar",sampleRate:a,numberOfFrames:i,numberOfChannels:r,timestamp:t+n/a,data:d});c.push(u),n+=i,l-=i}return c}}let l=e=>{switch(e){case"u8":case"u8-planar":return 1;case"s16":case"s16-planar":return 2;case"s32":case"s32-planar":case"f32":case"f32-planar":return 4;default:throw Error("Unknown AudioSampleFormat")}},c=e=>{switch(e){case"u8-planar":case"s16-planar":case"s32-planar":case"f32-planar":return!0;default:return!1}},d=e=>{switch(e){case"u8":case"u8-planar":return(e,t)=>(e.getUint8(t)-128)/128;case"s16":case"s16-planar":return(e,t)=>e.getInt16(t,!0)/32768;case"s32":case"s32-planar":return(e,t)=>e.getInt32(t,!0)/0x80000000;case"f32":case"f32-planar":return(e,t)=>e.getFloat32(t,!0)}},u=e=>{switch(e){case"u8":case"u8-planar":return(e,t,r)=>e.setUint8(t,(0,a.qE)((r+1)*127.5,0,255));case"s16":case"s16-planar":return(e,t,r)=>e.setInt16(t,(0,a.qE)(Math.round(32767*r),-32768,32767),!0);case"s32":case"s32-planar":return(e,t,r)=>e.setInt32(t,(0,a.qE)(Math.round(0x7fffffff*r),-0x80000000,0x7fffffff),!0);case"f32":case"f32-planar":return(e,t,r)=>e.setFloat32(t,r,!0)}},h=e=>"undefined"!=typeof AudioData&&e instanceof AudioData},672328:(e,t,r)=>{"use strict";r.d(t,{Ts:()=>s,kL:()=>i});var a=r(250601);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class i{constructor(){this._sizePromise=null,this.onread=null}getSize(){return this._sizePromise??=this._retrieveSize()}}class s extends i{constructor(e,t={}){if("string"!=typeof e&&!(e instanceof URL))throw TypeError("url must be a string or URL.");if(!t||"object"!=typeof t)throw TypeError("options must be an object.");if(void 0!==t.requestInit&&(!t.requestInit||"object"!=typeof t.requestInit))throw TypeError("options.requestInit, when provided, must be an object.");if(void 0!==t.getRetryDelay&&"function"!=typeof t.getRetryDelay)throw TypeError("options.getRetryDelay, when provided, must be a function.");super(),this._fullData=null,this._nextUrlVersion=null,this._url=e instanceof URL?e:new URL(e),this._options=t}async _makeRequest(e){let t={};e&&(t.Range=`bytes=${e.start}-${e.end-1}`),null!==this._nextUrlVersion&&(this._url.searchParams.set("mediabunny_version",this._nextUrlVersion.toString()),this._nextUrlVersion++);let r=await (0,a.G8)(this._url,(0,a.KA)(this._options.requestInit??{},{method:"GET",headers:t}),this._options.getRetryDelay??(()=>null));if(!r.ok)throw Error(`Error fetching ${this._url}: ${r.status} ${r.statusText}`);let i=await r.arrayBuffer();return 206===r.status&&e&&i.byteLength!==e.end-e.start&&null===this._nextUrlVersion?(this._nextUrlVersion=1,this._makeRequest(e)):(200===r.status&&(this._fullData=i),{response:i,statusCode:r.status})}async _read(e,t){if(this._fullData)return new Uint8Array(this._fullData,e,t-e);let{response:r,statusCode:a}=await this._makeRequest({start:e,end:t});return 200===a?new Uint8Array(r).subarray(e,t):new Uint8Array(r)}async _retrieveSize(){if(this._fullData)return this._fullData.byteLength;try{let e=await (0,a.G8)(this._url,(0,a.KA)(this._options.requestInit??{},{method:"HEAD"}),this._options.getRetryDelay??(()=>null));if(e.ok){let t=e.headers.get("Content-Length");if(t)return parseInt(t)}}catch{}let e=await (0,a.G8)(this._url,(0,a.KA)(this._options.requestInit??{},{method:"GET",headers:{Range:"bytes=0-0"}}),this._options.getRetryDelay??(()=>null));if(206===e.status){let t=e.headers.get("Content-Range");if(t){let e=t.match(/bytes \d+-\d+\/(\d+)/);if(e&&e[1])return parseInt(e[1])}}else if(200===e.status)return this._fullData=await e.arrayBuffer(),this._fullData.byteLength;let{response:t}=await this._makeRequest();return t.byteLength}}},553512:(e,t,r)=>{"use strict";r.d(t,{Fp:()=>s,SH:()=>n,ce:()=>c,cj:()=>l});/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */let a=/(?:(.+?)\n)?((?:\d{2}:)?\d{2}:\d{2}.\d{3})\s+-->\s+((?:\d{2}:)?\d{2}:\d{2}.\d{3})/g,i=/^WEBVTT(.|\n)*?\n{2}/,s=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g;class n{constructor(e){this.preambleText=null,this.preambleEmitted=!1,this.options=e}parse(e){let t;if(e=e.replaceAll("\r\n","\n").replaceAll("\r","\n"),a.lastIndex=0,!this.preambleText){if(!i.test(e))throw Error("WebVTT preamble incorrect.");t=a.exec(e);let r=e.slice(0,t?.index??e.length).trimEnd();if(!r)throw Error("No WebVTT preamble provided.");this.preambleText=r,t&&(e=e.slice(t.index),a.lastIndex=0)}for(;t=a.exec(e);){let r=e.slice(0,t.index),i=t[1],s=t.index+t[0].length,n=e.indexOf("\n",s)+1,o=e.slice(s,n).trim(),c=e.indexOf("\n\n",s);-1===c&&(c=e.length);let d=l(t[2]),u=l(t[3])-d,h=e.slice(n,c).trim();e=e.slice(c).trimStart(),a.lastIndex=0;let m={timestamp:d/1e3,duration:u/1e3,text:h,identifier:i,settings:o,notes:r},f={};this.preambleEmitted||(f.config={description:this.preambleText},this.preambleEmitted=!0),this.options.output(m,f)}}}let o=/(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})/,l=e=>{let t=o.exec(e);if(!t)throw Error("Expected match.");return 36e5*Number(t[1]||"0")+6e4*Number(t[2])+1e3*Number(t[3])+Number(t[4])},c=e=>{let t=Math.floor(e/36e5),r=Math.floor(e%36e5/6e4),a=Math.floor(e%6e4/1e3);return t.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+":"+a.toString().padStart(2,"0")+"."+(e%1e3).toString().padStart(3,"0")}},328420:(e,t,r)=>{"use strict";r.d(t,{Sn:()=>s,We:()=>i});var a=r(596954);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class i{constructor(){this._output=null}}class s extends i{constructor(){super(...arguments),this.buffer=null}_createWriter(){return new a.p2(this)}}},471936:(e,t,r)=>{"use strict";r.d(t,{H:()=>a});/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class a{constructor(e){this.reader=e,this.pos=0,this.littleEndian=!0}readBytes(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);return this.pos+=e,new Uint8Array(t.buffer,r,e)}readU16(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+2);return this.pos+=2,e.getUint16(t,this.littleEndian)}readU32(){let{view:e,offset:t}=this.reader.getViewAndOffset(this.pos,this.pos+4);return this.pos+=4,e.getUint32(t,this.littleEndian)}readU64(){let e,t;return this.littleEndian?(e=this.readU32(),t=this.readU32()):(t=this.readU32(),e=this.readU32()),0x100000000*t+e}readAscii(e){let{view:t,offset:r}=this.reader.getViewAndOffset(this.pos,this.pos+e);this.pos+=e;let a="";for(let i=0;i<e;i++)a+=String.fromCharCode(t.getUint8(r+i));return a}}},263935:(e,t,r)=>{"use strict";r.d(t,{D:()=>a,E:()=>d});var a,i=r(602805),s=r(574019),n=r(250601),o=r(909929),l=r(107530),c=r(471936);!function(e){e[e.PCM=1]="PCM",e[e.IEEE_FLOAT=3]="IEEE_FLOAT",e[e.ALAW=6]="ALAW",e[e.MULAW=7]="MULAW",e[e.EXTENSIBLE=65534]="EXTENSIBLE"}(a||(a={}));class d extends i.B{constructor(e){super(e),this.metadataPromise=null,this.dataStart=-1,this.dataSize=-1,this.audioInfo=null,this.tracks=[],this.metadataReader=new c.H(e._mainReader),this.chunkReader=new c.H(new l.m(e.source,0x4000000))}async readMetadata(){return this.metadataPromise??=(async()=>{let e=await this.metadataReader.reader.source.getSize(),t=this.metadataReader.readAscii(4);this.metadataReader.littleEndian="RIFX"!==t;let r="RF64"===t,a=this.metadataReader.readU32(),i=r?e:Math.min(a+8,e);if("WAVE"!==this.metadataReader.readAscii(4))throw Error("Invalid WAVE file - wrong format");this.metadataReader.pos=12;let n=0,o=null;for(;this.metadataReader.pos<i;){await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+8);let t=this.metadataReader.readAscii(4),a=this.metadataReader.readU32(),s=this.metadataReader.pos;if(r&&0===n&&"ds64"!==t)throw Error('Invalid RF64 file: First chunk must be "ds64".');if("fmt "===t)await this.parseFmtChunk(a);else if("data"===t)o??=a,this.dataStart=this.metadataReader.pos,this.dataSize=Math.min(o,i-this.dataStart);else if("ds64"===t){let t=this.metadataReader.readU64();o=this.metadataReader.readU64(),i=Math.min(t+8,e)}this.metadataReader.pos=s+a+(1&a),n++}if(!this.audioInfo)throw Error('Invalid WAVE file - missing "fmt " chunk');if(-1===this.dataStart)throw Error('Invalid WAVE file - missing "data" chunk');let l=this.audioInfo.blockSizeInBytes;this.dataSize=Math.floor(this.dataSize/l)*l,this.tracks.push(new s.Yi(new u(this)))})()}async parseFmtChunk(e){let t;await this.metadataReader.reader.loadRange(this.metadataReader.pos,this.metadataReader.pos+e);let r=this.metadataReader.readU16(),i=this.metadataReader.readU16(),s=this.metadataReader.readU32();this.metadataReader.pos+=4;let n=this.metadataReader.readU16();if(t=14===e?8:this.metadataReader.readU16(),e>=18&&357!==r&&Math.min(e-18,this.metadataReader.readU16())>=22&&r===a.EXTENSIBLE){this.metadataReader.pos+=6;let e=this.metadataReader.readBytes(16);r=e[0]|e[1]<<8}(r===a.MULAW||r===a.ALAW)&&(t=8),this.audioInfo={format:r,numberOfChannels:i,sampleRate:s,sampleSizeInBytes:Math.ceil(t/8),blockSizeInBytes:n}}getCodec(){if((0,n.vA)(this.audioInfo),this.audioInfo.format===a.MULAW)return"ulaw";if(this.audioInfo.format===a.ALAW)return"alaw";if(this.audioInfo.format===a.PCM){if(1===this.audioInfo.sampleSizeInBytes)return"pcm-u8";if(2===this.audioInfo.sampleSizeInBytes)return"pcm-s16";if(3===this.audioInfo.sampleSizeInBytes)return"pcm-s24";if(4===this.audioInfo.sampleSizeInBytes)return"pcm-s32"}return this.audioInfo.format===a.IEEE_FLOAT&&4===this.audioInfo.sampleSizeInBytes?"pcm-f32":null}async getMimeType(){return"audio/wav"}async computeDuration(){return await this.readMetadata(),(0,n.vA)(this.audioInfo),this.dataSize/this.audioInfo.blockSizeInBytes/this.audioInfo.sampleRate}async getTracks(){return await this.readMetadata(),this.tracks}}class u{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return this.demuxer.getCodec()}async getDecoderConfig(){let e=this.demuxer.getCodec();return e?((0,n.vA)(this.demuxer.audioInfo),{codec:e,numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate}):null}computeDuration(){return this.demuxer.computeDuration()}getNumberOfChannels(){return(0,n.vA)(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}getSampleRate(){return(0,n.vA)(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getTimeResolution(){return(0,n.vA)(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getLanguageCode(){return n.IR}async getFirstTimestamp(){return 0}async getPacketAtIndex(e,t){let r;(0,n.vA)(this.demuxer.audioInfo);let a=2048*e*this.demuxer.audioInfo.blockSizeInBytes;if(a>=this.demuxer.dataSize)return null;let i=Math.min(2048*this.demuxer.audioInfo.blockSizeInBytes,this.demuxer.dataSize-a);if(t.metadataOnly)r=o.T;else{let e=2048*this.demuxer.audioInfo.blockSizeInBytes,t=Math.ceil(524288/e)*e,s=Math.floor(a/t)*t;await this.demuxer.chunkReader.reader.loadRange(this.demuxer.dataStart+s,this.demuxer.dataStart+(s+t)),this.demuxer.chunkReader.pos=this.demuxer.dataStart+a,r=this.demuxer.chunkReader.readBytes(i)}let s=2048*e/this.demuxer.audioInfo.sampleRate,l=i/this.demuxer.audioInfo.blockSizeInBytes/this.demuxer.audioInfo.sampleRate;return new o.Z(r,"key",s,l,e,i)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}getPacket(e,t){(0,n.vA)(this.demuxer.audioInfo);let r=Math.floor(e*this.demuxer.audioInfo.sampleRate/2048);return this.getPacketAtIndex(r,t)}getNextPacket(e,t){(0,n.vA)(this.demuxer.audioInfo);let r=Math.round(e.timestamp*this.demuxer.audioInfo.sampleRate/2048);return this.getPacketAtIndex(r+1,t)}getKeyPacket(e,t){return this.getPacket(e,t)}getNextKeyPacket(e,t){return this.getNextPacket(e,t)}}},596954:(e,t,r)=>{"use strict";r.d(t,{p2:()=>s,xz:()=>n});var a=r(250601);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class i{constructor(){this.ensureMonotonicity=!1,this.trackedWrites=null,this.trackedStart=-1,this.trackedEnd=-1}start(){}maybeTrackWrites(e){if(!this.trackedWrites)return;let t=this.getPos();if(t<this.trackedStart){if(t+e.byteLength<=this.trackedStart)return;e=e.subarray(this.trackedStart-t),t=0}let r=t+e.byteLength-this.trackedStart,a=this.trackedWrites.byteLength;for(;a<r;)a*=2;if(a!==this.trackedWrites.byteLength){let e=new Uint8Array(a);e.set(this.trackedWrites,0),this.trackedWrites=e}this.trackedWrites.set(e,t-this.trackedStart),this.trackedEnd=Math.max(this.trackedEnd,t+e.byteLength)}startTrackingWrites(){this.trackedWrites=new Uint8Array(1024),this.trackedStart=this.getPos(),this.trackedEnd=this.trackedStart}stopTrackingWrites(){if(!this.trackedWrites)throw Error("Internal error: Can't get tracked writes since nothing was tracked.");let e={data:this.trackedWrites.subarray(0,this.trackedEnd-this.trackedStart),start:this.trackedStart,end:this.trackedEnd};return this.trackedWrites=null,e}}class s extends i{constructor(e){if(super(),this.pos=0,this.maxPos=0,this.target=e,this.supportsResize="resize"in new ArrayBuffer(0),this.supportsResize)try{this.buffer=new ArrayBuffer(65536,{maxByteLength:0x100000000})}catch{this.buffer=new ArrayBuffer(65536),this.supportsResize=!1}else this.buffer=new ArrayBuffer(65536);this.bytes=new Uint8Array(this.buffer)}ensureSize(e){let t=this.buffer.byteLength;for(;t<e;)t*=2;if(t!==this.buffer.byteLength){if(t>0x100000000)throw Error("ArrayBuffer exceeded maximum size of 4294967296 bytes. Please consider using another target.");if(this.supportsResize)this.buffer.resize(t);else{let e=new ArrayBuffer(t),r=new Uint8Array(e);r.set(this.bytes,0),this.buffer=e,this.bytes=r}}}write(e){this.maybeTrackWrites(e),this.ensureSize(this.pos+e.byteLength),this.bytes.set(e,this.pos),this.pos+=e.byteLength,this.maxPos=Math.max(this.maxPos,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){}async finalize(){this.ensureSize(this.pos),this.target.buffer=this.buffer.slice(0,Math.max(this.maxPos,this.pos))}async close(){}getSlice(e,t){return this.bytes.slice(e,t)}}class n extends i{constructor(e){super(),this.pos=0,this.sections=[],this.lastWriteEnd=0,this.lastFlushEnd=0,this.writer=null,this.chunks=[],this.target=e,this.chunked=e._options.chunked??!1,this.chunkSize=e._options.chunkSize??0x1000000}start(){this.writer=this.target._writable.getWriter()}write(e){if(this.pos>this.lastWriteEnd){let e=this.pos-this.lastWriteEnd;this.pos=this.lastWriteEnd,this.write(new Uint8Array(e))}this.maybeTrackWrites(e),this.sections.push({data:e.slice(),start:this.pos}),this.pos+=e.byteLength,this.lastWriteEnd=Math.max(this.lastWriteEnd,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){if(this.pos>this.lastWriteEnd){let e=this.pos-this.lastWriteEnd;this.pos=this.lastWriteEnd,this.write(new Uint8Array(e))}if((0,a.vA)(this.writer),0===this.sections.length)return;let e=[],t=[...this.sections].sort((e,t)=>e.start-t.start);e.push({start:t[0].start,size:t[0].data.byteLength});for(let r=1;r<t.length;r++){let a=e[e.length-1],i=t[r];i.start<=a.start+a.size?a.size=Math.max(a.size,i.start+i.data.byteLength-a.start):e.push({start:i.start,size:i.data.byteLength})}for(let t of e){for(let e of(t.data=new Uint8Array(t.size),this.sections))t.start<=e.start&&e.start<t.start+t.size&&t.data.set(e.data,e.start-t.start);if(null!==this.writer.desiredSize&&this.writer.desiredSize<=0&&await this.writer.ready,this.chunked)this.writeDataIntoChunks(t.data,t.start),this.tryToFlushChunks();else{if(this.ensureMonotonicity&&t.start!==this.lastFlushEnd)throw Error("Internal error: Monotonicity violation.");this.writer.write({type:"write",data:t.data,position:t.start}),this.lastFlushEnd=t.start+t.data.byteLength}}this.sections.length=0}writeDataIntoChunks(e,t){let r=this.chunks.findIndex(e=>e.start<=t&&t<e.start+this.chunkSize);-1===r&&(r=this.createChunk(t));let a=this.chunks[r],i=t-a.start,s=e.subarray(0,Math.min(this.chunkSize-i,e.byteLength));a.data.set(s,i);let n={start:i,end:i+s.byteLength};if(this.insertSectionIntoChunk(a,n),0===a.written[0].start&&a.written[0].end===this.chunkSize&&(a.shouldFlush=!0),this.chunks.length>2){for(let e=0;e<this.chunks.length-1;e++)this.chunks[e].shouldFlush=!0;this.tryToFlushChunks()}s.byteLength<e.byteLength&&this.writeDataIntoChunks(e.subarray(s.byteLength),t+s.byteLength)}insertSectionIntoChunk(e,t){let r=0,a=e.written.length-1,i=-1;for(;r<=a;){let s=Math.floor(r+(a-r+1)/2);e.written[s].start<=t.start?(r=s+1,i=s):a=s-1}for(e.written.splice(i+1,0,t),(-1===i||e.written[i].end<t.start)&&i++;i<e.written.length-1&&e.written[i].end>=e.written[i+1].start;)e.written[i].end=Math.max(e.written[i].end,e.written[i+1].end),e.written.splice(i+1,1)}createChunk(e){let t={start:Math.floor(e/this.chunkSize)*this.chunkSize,data:new Uint8Array(this.chunkSize),written:[],shouldFlush:!1};return this.chunks.push(t),this.chunks.sort((e,t)=>e.start-t.start),this.chunks.indexOf(t)}tryToFlushChunks(e=!1){(0,a.vA)(this.writer);for(let t=0;t<this.chunks.length;t++){let r=this.chunks[t];if(r.shouldFlush||e){for(let e of r.written){let t=r.start+e.start;if(this.ensureMonotonicity&&t!==this.lastFlushEnd)throw Error("Internal error: Monotonicity violation.");this.writer.write({type:"write",data:r.data.subarray(e.start,e.end),position:t}),this.lastFlushEnd=r.start+e.end}this.chunks.splice(t--,1)}}}finalize(){return this.chunked&&this.tryToFlushChunks(!0),(0,a.vA)(this.writer),this.writer.close()}async close(){return this.writer?.close()}}},232877:e=>{"use strict";e.exports=JSON.parse('{"p":"AAACAAAAAACAOAAAAbYBSf7t2S1IBEEYBuDVDZ7FYrQMNsFiu3hgEYOI0SCXRIUrB8JhEZtgs5gEg1GMFk02m82oGI02m+9xezCOczv/uwv3fvAwc/PzfXOzcdqzWdaBDdiGPdiHdjE+DS3RNDuCfsn8idQ/g3OH3BdwKf0e96/gumTfYcncLdzBPTzAo+RZ+f0Cr/AG7/AJX4738x1wtz9FO5PX/50n6UXMNdfg/0lERERERERERERERETpdedHBvDRql4nq0cXtW9af98qdRby0Vvp8K4W0V+C5Xw0t4J2bfjeBp3cnEu1brnnCTYNa7eKdz91XP7WO9Lb4GqRb7cY6xbtAdqeVOsY/QGcevw/tb6OT85YhvfKYEx9CMuxKsKnrs+eJtVInVvHJ0eVYVvTZk2siFVLOCjb61PTZX3MdVWEyP7fjzpmMxdzTyq2Ebue6x61nXRGnzndWpf1an7dXmGYE4Y1ptqqKsK1nu26Ju0ty+maV2Rpvk+qnDZjKUIobUiesdAQE/jmCTmHmsskpFZsVYbtmXRcaoSGUPomunW2derQhDPFjtT1Q/eb8vnm990fq35oHVt11bU9m89c7DNI8Qs="}')},61286:e=>{"use strict";e.exports=JSON.parse('{"p":"ABAOAAAAAACwiAAAAYkHdvjtnH+IFkUYxx/v3vPe7uw8UkjsD43ChKICDQsT3iIJy4gSiZAjkn5JUFlaiFmjccT9ESkpGBGVIlQgWSkY/QDBoMgrQv0jRJDAfkCXhUmgRX23d4ebnndmd3Z3ZnfVeeDDzM7MPs8zv57Zd2+5hd1Ed4ClYAisBuuUsqLpMHgJjIBNFu1fBW8l1O8AO8Ee8Cn4HIyCg+CI0u4Y+AmMgVPgDOhuEHWBPjAZXAy2gjfA9kb73hlx+i7SK8AHYDf4BOwHB8AoOAyOguPgB/ArOKlcnwHdPe32/Uin9LTvvwTph0gv62nbubKnXT+nZ1z/DcjfFF8vQno7uEaxH923BGVXN9v5Zcgvj/VFPIT8Y/H1k0jXxPn1SEfARjBdab8V+TfB22CXUh5xd3OcZTH3g6di1LZJbLNs55q96M9n4J9Gm6hsfzQvcT8fbfy//TyUf8vG4Lses/5jcd2PSE/IcQan4/o/UXYadE0kaoJBMG1ivNbidNbETr1XoWyuplwyHFN0fFai/8/EY7BIKY/68EpCvwP+mc/m/2vNGnBhp1eZ51bCmgsEAoFAIBAIBAKBQKAO3Irfrg3lfc4qi/cXd+Kee5TfvAd6ieY0ie5D2cNx+eNInwZLmu33gWuRn4/8C3H9CNJNYEt8/TrS35HuSPktvRP1z0LPOvAceB4IsB5saIa6UBfqQl2oc123AjwBVjWrP7MCgcC5y/ue/56yqXv87+qcIU2Z+ny8tuHHpyxsvrDNITDXgqkDRJcPdJY/wMo24/oQmDqZaPHkdplAuhv8ApqDRDeCVj/OAvD9BUSX9qF8Qpt7lTxnZ7+5TmVtrGMM7XchP3sS0SNgGzg4yU5HIBAIBM5NfsO5QDgfjuM54STOw7/Az/F3QtfhfF4Qn9F/gxMouxm/WU7F9afBQuUM7+rtPF+jb0b6ese/I7sI+emadhEzUT5bqbsW+esNbSMWoG6hWo/8gOLPUqUu+v5rKEHX8oS6iEXQexd7XlmBe1aCNWAp6kSsYyjHc82Liv2Xkd/C/HkN1w/Geren+KryToa2PtlQg2c9zijGZnGJ9kaibzZh84jmmfx4TeYpK9H3usMKqxnDCWxsdLY/3ygy9h+l/LYbYHtuXw2/rfsSPo0a/Jrn6PvPrzL2+7CmfV88lkc9j+F7cRzYU4N48DF8uA3n/T7Fly9q4Jdvoth0uLf9LORC11hvO/0D6RnQfRa99+2Hr1NS/M26VvfEe2jaWTAOvG8zzgKf8zCrYL++qUEfbumeQAjTVnQp+QmW99gQpDoJ4+9uHZe5/l3OW/M8x6WUZaduUvUc5p13NTXlz3VpGbCVrGNe5zOnjvGlrDWY1IdWShuuQ9fWh6h+VSV1Wit1lvNhHFz1zeUYtCg5ntvOSStDW5cITRnF5RJ+rcasJHExztwu910tl6LzLYsvuvvzilB0mvSaxt/V+SY0EMurfkjbrTjfInf+FJGkNdzSlOukZaDo3snqs7RZpqj2Gx7sS52D5O79k+93W2W/T3NhQxe3VeF16pwn4eI8qev7Sl1s0PnPy5PalSV57Pp6XuDxrypR9wBR8nOCzm/eXuYp5d4s/lV1XvL+lG2b+2AaQ1nPr23Hrc7z0WT5qvZL0v7QtdX5zdu6HMei+gV1ri8et4XSVpCfdeB7fRWNRy79UP0RCT4Jyre/88bbKsQUawUrV69dxjd+nlXxbCKos79pz1BpOqucz0gEdZ5hMk+aa7Wdy/7xZ5Yqhc+nyHivrkyQ/reM7tziuFojfM7zxtq0505XYutvHrtVnzNl2ONrTGdPkLv9ZjNHOoShnCh5nLLYKOKfK4qK7bjx/gqyj9lFJc2Wz/HIqyMSYaGnqM8+xp6vB1/6feg22UmLFUno1rurvelz7yT1UVfORW3L7+d6fMcAXdzxIVK3TNNioZpSyj2242izpky6y5S0fpr6q5ZXJT7O1qrmQRVB+rkQ1Dk3vvYttyGoc+51/mUVkYLtXvTx7MCvbUnzW2czyR8pql4XUlbcN9l1pSfPfOl0JV2bylyKoM4959sHQfr9Vpbk2V8u4ry0ndcvH5I1xggP9qVem/PHZL+qeGLrc945tLnHtG/LEtdjr4urxMpM92X1RZDd+pLtsorUydeCaiuvbtdSpQ9l2M4SU01nvI1e35L3uS5Jlw8pe1ykCKo2JtrGK9O9ujOlimcD6Y9LEWQ+7019d2VDLVPrTCLrsvjsQ1TfJVJM12pZmm5b4Xptx6HM9SpFkP2c6drJa5/iSr+pD7r+CNLvATVfpST1RYog/fwKTdsyxLVNQfnWrkyziGltJK2hLLptzjHXIsh+/HytmyQfpPA5VNtzXWWLzbiVsc9sbWSJ7UWE69KNh6v9kya2c6TzMa0fwpD37TtvQ6wuiw9CA9cny33Mj2pLte9Kp6996HO/83HPQ5r+ov5mvU9Qte/fIrGJP7axPO/9eXX6kjLPKZNd17iyZdOHLP31JSbfXY6hC59c+ZZ136TZ9SFlj6cvmVkSrkSQn3NG5KBqEVSeH6Ji/vvnhFWjSlfFNDwzyMgqLvvKxXffbeASBWo+Zj4p2x6TfwE="}')}}]);

//# debugId=b29ef061-e470-52d7-91f9-35a342bb438d

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/fcc1a1091c2aaa9d82b629815d3a14b20f85f845/vendor-ea8fe20ba3a34afa.min.js.map